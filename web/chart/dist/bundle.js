(()=>{"use strict";function t(t){return"number"==typeof t&&isFinite(t)}function e(t){return"number"==typeof t&&t%1==0}function i(t){return"string"==typeof t}function _(t){return"boolean"==typeof t}function n(t){const e=t;if(!e||"object"!=typeof e)return e;let i,_,r;for(_ in i=Array.isArray(e)?[]:{},e)e.hasOwnProperty(_)&&(r=e[_],i[_]=r&&"object"==typeof r?n(r):r);return i}function r(t){return null!==t}function a(t){return null===t?void 0:t}function l(t,e){if(!t)throw new Error("Assertion failed"+(e?": "+e:""))}function s(t){if(void 0===t)throw new Error("Value is undefined");return t}function o(t){if(null===t)throw new Error("Value is null");return t}function h(t){return o(s(t))}function p(t,...e){for(const i of e)for(const e in i)void 0!==i[e]&&("object"!=typeof i[e]||void 0===t[e]||Array.isArray(i[e])?t[e]=i[e]:p(t[e],i[e]));return t}function c(t,e,i){return Math.min(Math.max(t,e),i)}function v(t,e,i){return e-t<=i}function d(t,e){return null===t||null===e?t===e:t._internal_equals(e)}function u(t,e){const i={0:[],1:[t.lineWidth,t.lineWidth],2:[2*t.lineWidth,2*t.lineWidth],3:[6*t.lineWidth,6*t.lineWidth],4:[t.lineWidth,4*t.lineWidth]}[e];t.setLineDash(i)}function m(t,e,i,_){t.beginPath();const n=t.lineWidth%2?.5:0;t.moveTo(i,e+n),t.lineTo(_,e+n),t.stroke()}function g(t){return t<0?0:t>255?255:Math.round(t)||0}function f(t){return t<=0||t>0?t<0?0:t>1?1:Math.round(1e4*t)/1e4:0}const S=/^#([0-9a-f])([0-9a-f])([0-9a-f])([0-9a-f])?$/i,b=/^#([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})?$/i,w=/^rgb\(\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*\)$/,C=/^rgba\(\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*,\s*(-?[\d]{0,10}(?:\.\d+)?)\s*\)$/;function x(t){t=t.toLowerCase();{const e=C.exec(t)||w.exec(t);if(e)return[g(parseInt(e[1],10)),g(parseInt(e[2],10)),g(parseInt(e[3],10)),f(e.length<5?1:parseFloat(e[4]))]}{const e=b.exec(t);if(e)return[g(parseInt(e[1],16)),g(parseInt(e[2],16)),g(parseInt(e[3],16)),1]}{const e=S.exec(t);if(e)return[g(17*parseInt(e[1],16)),g(17*parseInt(e[2],16)),g(17*parseInt(e[3],16)),1]}throw new Error(`Cannot parse color: ${t}`)}function T(t){const e=x(t);return{_internal_background:`rgb(${e[0]}, ${e[1]}, ${e[2]})`,_internal_foreground:(i=e,.199*i[0]+.687*i[1]+.114*i[2]>160?"black":"white")};var i}function y(t,e,i,_,n,r){t.fillRect(e+r,i,_-2*r,r),t.fillRect(e+r,i+n-r,_-2*r,r),t.fillRect(e,i,r,n),t.fillRect(e+_-r,i,r,n)}function P(t,e,i,_,n,r){t.save(),t.globalCompositeOperation="copy",t.fillStyle=r,t.fillRect(e,i,_,n),t.restore()}function M(t,e){return t.map((t=>0===t?t:t+e))}function k(t,e,i,_,n,r){t.beginPath(),t.lineTo(e+_-r[1],i),0!==r[1]&&t.arcTo(e+_,i,e+_,i+r[1],r[1]),t.lineTo(e+_,i+n-r[2]),0!==r[2]&&t.arcTo(e+_,i+n,e+_-r[2],i+n,r[2]),t.lineTo(e+r[3],i+n),0!==r[3]&&t.arcTo(e,i+n,e,i+n-r[3],r[3]),t.lineTo(e,i+r[0]),0!==r[0]&&t.arcTo(e,i,e+r[0],i,r[0])}function E(t,e,i,_,n,r,a=0,l=[0,0,0,0],s=""){if(t.save(),!a||!s||s===r)return k(t,e,i,_,n,l),t.fillStyle=r,t.fill(),void t.restore();const o=a/2;"transparent"!==r&&(k(t,e+a,i+a,_-2*a,n-2*a,M(l,-a)),t.fillStyle=r,t.fill()),"transparent"!==s&&(k(t,e+o,i+o,_-a,n-a,M(l,-o)),t.lineWidth=a,t.strokeStyle=s,t.closePath(),t.stroke()),t.restore()}function z(t,e,i,_,n,r,a){t.save(),t.globalCompositeOperation="copy";const l=t.createLinearGradient(0,0,0,n);l.addColorStop(0,r),l.addColorStop(1,a),t.fillStyle=l,t.fillRect(e,i,_,n),t.restore()}function R(t,e,i){const _=Math.max(0,e-1),n=Math.min(t.length-1,i+1);return[add(t[e],divide(subtract(t[i],t[_]),6)),subtract(t[i],divide(subtract(t[n],t[e]),6))]}function B(i,_){if(!t(i))return"n/a";if(!e(_))throw new TypeError("invalid length");if(_<0||_>16)throw new TypeError("invalid length");return 0===_?i.toString():("0000000000000000"+i.toString()).slice(-_)}class I{constructor(i,_){if(_||(_=1),t(i)&&e(i)||(i=100),i<0)throw new TypeError("invalid base");this._private__priceScale=i,this._private__minMove=_,this._private__calculateDecimal()}format(t){const e=t<0?"âˆ’":"";return t=Math.abs(t),e+this._private__formatAsDecimal(t)}_private__calculateDecimal(){if(this._internal__fractionalLength=0,this._private__priceScale>0&&this._private__minMove>0){let t=this._private__priceScale;for(;t>1;)t/=10,this._internal__fractionalLength++}}_private__formatAsDecimal(t){const e=this._private__priceScale/this._private__minMove;let i=Math.floor(t),_="";const n=void 0!==this._internal__fractionalLength?this._internal__fractionalLength:NaN;if(e>1){let r=+(Math.round(t*e)-i*e).toFixed(this._internal__fractionalLength);r>=e&&(r-=e,i+=1),_="."+B(+r.toFixed(this._internal__fractionalLength)*this._private__minMove,n)}else i=Math.round(i*e)/e,n>0&&(_="."+B(0,n));return i.toFixed(0)+_}}class A extends I{constructor(t=100){super(t)}format(t){return`${super.format(t)}%`}}class D{constructor(t){this._private__precision=t}format(t){let e="";return t<0&&(e="-",t=-t),t<995?e+this._private__formatNumber(t):t<999995?e+this._private__formatNumber(t/1e3)+"K":t<999999995?(t=1e3*Math.round(t/1e3),e+this._private__formatNumber(t/1e6)+"M"):(t=1e6*Math.round(t/1e6),e+this._private__formatNumber(t/1e9)+"B")}_private__formatNumber(t){let e;const i=Math.pow(10,this._private__precision);return e=(t=Math.round(t*i)/i)>=1e-15&&t<1?t.toFixed(this._private__precision).replace(/\.?0+$/,""):String(t),e.replace(/(\.[1-9]*)0+$/,((t,e)=>e))}}const V=t=>t.getUTCFullYear();class O{constructor(t="yyyy-MM-dd",e="default"){this._private__dateFormat=t,this._private__locale=e}_internal_format(t){return function(t,e,i){return e.replace(/yyyy/g,(t=>B(V(t),4))(t)).replace(/yy/g,(t=>B(V(t)%100,2))(t)).replace(/MMMM/g,((t,e)=>new Date(t.getUTCFullYear(),t.getUTCMonth(),1).toLocaleString(e,{month:"long"}))(t,i)).replace(/MMM/g,((t,e)=>new Date(t.getUTCFullYear(),t.getUTCMonth(),1).toLocaleString(e,{month:"short"}))(t,i)).replace(/MM/g,(t=>B((t=>t.getUTCMonth()+1)(t),2))(t)).replace(/dd/g,(t=>B((t=>t.getUTCDate())(t),2))(t))}(t,this._private__dateFormat,this._private__locale)}}class L{constructor(t){this._private__formatStr=t||"%h:%m:%s"}_internal_format(t){return this._private__formatStr.replace("%h",B(t.getUTCHours(),2)).replace("%m",B(t.getUTCMinutes(),2)).replace("%s",B(t.getUTCSeconds(),2))}}const W={_internal_dateFormat:"yyyy-MM-dd",_internal_timeFormat:"%h:%m:%s",_internal_dateTimeSeparator:" ",_internal_locale:"default"};class F{constructor(t={}){const e=Object.assign(Object.assign({},W),t);this._private__dateFormatter=new O(e._internal_dateFormat,e._internal_locale),this._private__timeFormatter=new L(e._internal_timeFormat),this._private__separator=e._internal_dateTimeSeparator}_internal_format(t){return`${this._private__dateFormatter._internal_format(t)}${this._private__separator}${this._private__timeFormatter._internal_format(t)}`}}class N{_internal_draw(t,e,i){t.useBitmapCoordinateSpace((t=>this._internal__drawImpl(t,e,i)))}}class H extends N{constructor(t){super(),this._private__data=t}_internal__drawImpl({context:t,bitmapSize:e,horizontalPixelRatio:i,verticalPixelRatio:_}){if(null===this._private__data)return;const n=this._private__data._internal_vertLine._internal_visible,r=this._private__data._internal_horzLine._internal_visible;if(!n&&!r)return;const a=Math.round(this._private__data._internal_x*i),l=Math.round(this._private__data._internal_y*_);t.lineCap="butt",n&&a>=0&&(t.lineWidth=Math.floor(this._private__data._internal_vertLine._internal_lineWidth*i),t.strokeStyle=this._private__data._internal_vertLine._internal_color,t.fillStyle=this._private__data._internal_vertLine._internal_color,u(t,this._private__data._internal_vertLine._internal_lineStyle),function(t,e,i,_){t.beginPath();const n=t.lineWidth%2?.5:0;t.moveTo(e+n,0),t.lineTo(e+n,_),t.stroke()}(t,a,0,e.height)),r&&l>=0&&(t.lineWidth=Math.floor(this._private__data._internal_horzLine._internal_lineWidth*_),t.strokeStyle=this._private__data._internal_horzLine._internal_color,t.fillStyle=this._private__data._internal_horzLine._internal_color,u(t,this._private__data._internal_horzLine._internal_lineStyle),m(t,l,0,e.width))}}class U{constructor(t){this._private__invalidated=!0,this._private__rendererData={_internal_vertLine:{_internal_lineWidth:1,_internal_lineStyle:0,_internal_color:"",_internal_visible:!1},_internal_horzLine:{_internal_lineWidth:1,_internal_lineStyle:0,_internal_color:"",_internal_visible:!1},_internal_x:0,_internal_y:0},this._private__renderer=new H(this._private__rendererData),this._private__source=t}_internal_update(){this._private__invalidated=!0}_internal_renderer(){return this._private__invalidated&&(this._private__updateImpl(),this._private__invalidated=!1),this._private__renderer}_private__updateImpl(){const t=this._private__source._internal_visible(),e=o(this._private__source._internal_pane()),i=e._internal_model()._internal_options().crosshair,_=this._private__rendererData;_._internal_horzLine._internal_visible=t&&this._private__source._internal_horzLineVisible(e),_._internal_vertLine._internal_visible=t&&this._private__source._internal_vertLineVisible(),_._internal_horzLine._internal_lineWidth=i.horzLine.width,_._internal_horzLine._internal_lineStyle=i.horzLine.style,_._internal_horzLine._internal_color=i.horzLine.color,_._internal_vertLine._internal_lineWidth=i.vertLine.width,_._internal_vertLine._internal_lineStyle=i.vertLine.style,_._internal_vertLine._internal_color=i.vertLine.color,_._internal_x=this._private__source._internal_appliedX(),_._internal_y=this._private__source._internal_appliedY()}}class Y{constructor(t,e){this._internal_setData(t,e)}_internal_setData(t,e){this._private__data=t,this._private__commonData=e}_internal_height(t,e){return this._private__data._internal_visible?t._internal_fontSize+t._internal_paddingTop+t._internal_paddingBottom:0}_internal_draw(t,e,i,_){if(!this._private__data._internal_visible||0===this._private__data._internal_text.length)return;const n=this._private__data._internal_color,r=this._private__commonData._internal_background,a=t.useBitmapCoordinateSpace((t=>{const a=t.context;a.font=e._internal_font;const l=this._private__calculateGeometry(t,e,i,_),s=l._internal_bitmap,o=(t,e)=>{l._internal_alignRight?E(a,s._internal_xOutside,s._internal_yTop,s._internal_totalWidth,s._internal_totalHeight,t,s._internal_horzBorder,[s._internal_radius,0,0,s._internal_radius],e):E(a,s._internal_xInside,s._internal_yTop,s._internal_totalWidth,s._internal_totalHeight,t,s._internal_horzBorder,[0,s._internal_radius,s._internal_radius,0],e)};return o(r,"transparent"),this._private__data._internal_tickVisible&&(a.fillStyle=n,a.fillRect(s._internal_xInside,s._internal_yMid,s._internal_xTick-s._internal_xInside,s._internal_tickHeight)),o("transparent",r),this._private__data._internal_borderVisible&&(a.fillStyle=e._internal_paneBackgroundColor,a.fillRect(l._internal_alignRight?s._internal_right-s._internal_horzBorder:0,s._internal_yTop,s._internal_horzBorder,s._internal_yBottom-s._internal_yTop)),l}));t.useMediaCoordinateSpace((({context:t})=>{const i=a._internal_media;t.font=e._internal_font,t.textAlign=a._internal_alignRight?"right":"left",t.textBaseline="middle",t.fillStyle=n,t.fillText(this._private__data._internal_text,i._internal_xText,(i._internal_yTop+i._internal_yBottom)/2+i._internal_textMidCorrection)}))}_private__calculateGeometry(t,e,i,_){var n;const{context:r,bitmapSize:a,mediaSize:l,horizontalPixelRatio:s,verticalPixelRatio:o}=t,h=this._private__data._internal_tickVisible||!this._private__data._internal_moveTextToInvisibleTick?e._internal_tickLength:0,p=this._private__data._internal_separatorVisible?e._internal_borderSize:0,c=e._internal_paddingTop+this._private__commonData._internal_additionalPaddingTop,v=e._internal_paddingBottom+this._private__commonData._internal_additionalPaddingBottom,d=e._internal_paddingInner,u=e._internal_paddingOuter,m=this._private__data._internal_text,g=e._internal_fontSize,f=i._internal_yMidCorrection(r,m),S=Math.ceil(i._internal_measureText(r,m)),b=g+c+v,w=e._internal_borderSize+d+u+S+h,C=Math.max(1,Math.floor(o));let x=Math.round(b*o);x%2!=C%2&&(x+=1);const T=p>0?Math.max(1,Math.floor(p*s)):0,y=Math.round(w*s),P=Math.round(h*s),M=null!==(n=this._private__commonData._internal_fixedCoordinate)&&void 0!==n?n:this._private__commonData._internal_coordinate,k=Math.round(M*o)-Math.floor(.5*o),E=Math.floor(k+C/2-x/2),z=E+x,R="right"===_,B=R?l.width-p:p,I=R?a.width-T:T;let A,D,V;return R?(A=I-y,D=I-P,V=B-h-d-p):(A=I+y,D=I+P,V=B+h+d),{_internal_alignRight:R,_internal_bitmap:{_internal_yTop:E,_internal_yMid:k,_internal_yBottom:z,_internal_totalWidth:y,_internal_totalHeight:x,_internal_radius:2*s,_internal_horzBorder:T,_internal_xOutside:A,_internal_xInside:I,_internal_xTick:D,_internal_tickHeight:C,_internal_right:a.width},_internal_media:{_internal_yTop:E/o,_internal_yBottom:z/o,_internal_xText:V,_internal_textMidCorrection:f}}}}class ${constructor(t){this._private__commonRendererData={_internal_coordinate:0,_internal_background:"#000",_internal_additionalPaddingBottom:0,_internal_additionalPaddingTop:0},this._private__axisRendererData={_internal_text:"",_internal_visible:!1,_internal_tickVisible:!0,_internal_moveTextToInvisibleTick:!1,_internal_borderColor:"",_internal_color:"#FFF",_internal_borderVisible:!1,_internal_separatorVisible:!1},this._private__paneRendererData={_internal_text:"",_internal_visible:!1,_internal_tickVisible:!1,_internal_moveTextToInvisibleTick:!0,_internal_borderColor:"",_internal_color:"#FFF",_internal_borderVisible:!0,_internal_separatorVisible:!0},this._private__invalidated=!0,this._private__axisRenderer=new(t||Y)(this._private__axisRendererData,this._private__commonRendererData),this._private__paneRenderer=new(t||Y)(this._private__paneRendererData,this._private__commonRendererData)}_internal_text(){return this._private__updateRendererDataIfNeeded(),this._private__axisRendererData._internal_text}_internal_coordinate(){return this._private__updateRendererDataIfNeeded(),this._private__commonRendererData._internal_coordinate}_internal_update(){this._private__invalidated=!0}_internal_height(t,e=!1){return Math.max(this._private__axisRenderer._internal_height(t,e),this._private__paneRenderer._internal_height(t,e))}_internal_getFixedCoordinate(){return this._private__commonRendererData._internal_fixedCoordinate||0}_internal_setFixedCoordinate(t){this._private__commonRendererData._internal_fixedCoordinate=t}_internal_isVisible(){return this._private__updateRendererDataIfNeeded(),this._private__axisRendererData._internal_visible||this._private__paneRendererData._internal_visible}_internal_isAxisLabelVisible(){return this._private__updateRendererDataIfNeeded(),this._private__axisRendererData._internal_visible}_internal_renderer(t){return this._private__updateRendererDataIfNeeded(),this._private__axisRendererData._internal_tickVisible=this._private__axisRendererData._internal_tickVisible&&t._internal_options().ticksVisible,this._private__paneRendererData._internal_tickVisible=this._private__paneRendererData._internal_tickVisible&&t._internal_options().ticksVisible,this._private__axisRenderer._internal_setData(this._private__axisRendererData,this._private__commonRendererData),this._private__paneRenderer._internal_setData(this._private__paneRendererData,this._private__commonRendererData),this._private__axisRenderer}_internal_paneRenderer(){return this._private__updateRendererDataIfNeeded(),this._private__axisRenderer._internal_setData(this._private__axisRendererData,this._private__commonRendererData),this._private__paneRenderer._internal_setData(this._private__paneRendererData,this._private__commonRendererData),this._private__paneRenderer}_private__updateRendererDataIfNeeded(){this._private__invalidated&&(this._private__axisRendererData._internal_tickVisible=!0,this._private__paneRendererData._internal_tickVisible=!1,this._internal__updateRendererData(this._private__axisRendererData,this._private__paneRendererData,this._private__commonRendererData))}}class j extends ${constructor(t,e,i){super(),this._private__source=t,this._private__priceScale=e,this._private__valueProvider=i}_internal__updateRendererData(t,e,i){t._internal_visible=!1;const _=this._private__source._internal_options().horzLine;if(!_.labelVisible)return;const n=this._private__priceScale._internal_firstValue();if(!this._private__source._internal_visible()||this._private__priceScale._internal_isEmpty()||null===n)return;const r=T(_.labelBackgroundColor);i._internal_background=r._internal_background,t._internal_color=r._internal_foreground;const a=2/12*this._private__priceScale._internal_fontSize();i._internal_additionalPaddingTop=a,i._internal_additionalPaddingBottom=a;const l=this._private__valueProvider(this._private__priceScale);i._internal_coordinate=l._internal_coordinate,t._internal_text=this._private__priceScale._internal_formatPrice(l._internal_price,n),t._internal_visible=!0}}const X=/[1-9]/g;class G{constructor(){this._private__data=null}_internal_setData(t){this._private__data=t}_internal_draw(t,e){if(null===this._private__data||!1===this._private__data._internal_visible||0===this._private__data._internal_text.length)return;const i=t.useMediaCoordinateSpace((({context:t})=>(t.font=e._internal_font,Math.round(e._internal_widthCache._internal_measureText(t,o(this._private__data)._internal_text,X)))));if(i<=0)return;const _=e._internal_paddingHorizontal,n=i+2*_,r=n/2,a=this._private__data._internal_width;let l=this._private__data._internal_coordinate,s=Math.floor(l-r)+.5;s<0?(l+=Math.abs(0-s),s=Math.floor(l-r)+.5):s+n>a&&(l-=Math.abs(a-(s+n)),s=Math.floor(l-r)+.5);const h=s+n,p=Math.ceil(0+e._internal_borderSize+e._internal_tickLength+e._internal_paddingTop+e._internal_fontSize+e._internal_paddingBottom);t.useBitmapCoordinateSpace((({context:t,horizontalPixelRatio:i,verticalPixelRatio:_})=>{const n=o(this._private__data);t.fillStyle=n._internal_background;const r=Math.round(s*i),a=Math.round(0*_),l=Math.round(h*i),c=Math.round(p*_),v=Math.round(2*i);if(t.beginPath(),t.moveTo(r,a),t.lineTo(r,c-v),t.arcTo(r,c,r+v,c,v),t.lineTo(l-v,c),t.arcTo(l,c,l,c-v,v),t.lineTo(l,a),t.fill(),n._internal_tickVisible){const r=Math.round(n._internal_coordinate*i),l=a,s=Math.round((l+e._internal_tickLength)*_);t.fillStyle=n._internal_color;const o=Math.max(1,Math.floor(i)),h=Math.floor(.5*i);t.fillRect(r-h,l,o,s-l)}})),t.useMediaCoordinateSpace((({context:t})=>{const i=o(this._private__data),n=0+e._internal_borderSize+e._internal_tickLength+e._internal_paddingTop+e._internal_fontSize/2;t.font=e._internal_font,t.textAlign="left",t.textBaseline="middle",t.fillStyle=i._internal_color;const r=e._internal_widthCache._internal_yMidCorrection(t,"Apr0");t.translate(s+_,n+r),t.fillText(i._internal_text,0,0)}))}}class K{constructor(t,e,i){this._private__invalidated=!0,this._private__renderer=new G,this._private__rendererData={_internal_visible:!1,_internal_background:"#4c525e",_internal_color:"white",_internal_text:"",_internal_width:0,_internal_coordinate:NaN,_internal_tickVisible:!0},this._private__crosshair=t,this._private__model=e,this._private__valueProvider=i}_internal_update(){this._private__invalidated=!0}_internal_renderer(){return this._private__invalidated&&(this._private__updateImpl(),this._private__invalidated=!1),this._private__renderer._internal_setData(this._private__rendererData),this._private__renderer}_private__updateImpl(){const t=this._private__rendererData;t._internal_visible=!1;const e=this._private__crosshair._internal_options().vertLine;if(!e.labelVisible)return;const i=this._private__model._internal_timeScale();if(i._internal_isEmpty())return;t._internal_width=i._internal_width();const _=this._private__valueProvider();if(null===_)return;t._internal_coordinate=_._internal_coordinate;const n=i._internal_indexToTimeScalePoint(this._private__crosshair._internal_appliedIndex());t._internal_text=i._internal_formatDateTime(o(n)),t._internal_visible=!0;const r=T(e.labelBackgroundColor);t._internal_background=r._internal_background,t._internal_color=r._internal_foreground,t._internal_tickVisible=i._internal_options().ticksVisible}}class Z{constructor(){this._internal__priceScale=null,this._private__zorder=0}_internal_zorder(){return this._private__zorder}_internal_setZorder(t){this._private__zorder=t}_internal_priceScale(){return this._internal__priceScale}_internal_setPriceScale(t){this._internal__priceScale=t}_internal_labelPaneViews(t){return[]}_internal_timeAxisViews(){return[]}_internal_visible(){return!0}}class q extends Z{constructor(t,e){super(),this._private__pane=null,this._private__price=NaN,this._private__index=0,this._private__visible=!0,this._private__priceAxisViews=new Map,this._private__subscribed=!1,this._private__x=NaN,this._private__y=NaN,this._private__originX=NaN,this._private__originY=NaN,this._private__model=t,this._private__options=e,this._private__currentPosPriceProvider=((t,e)=>i=>{const _=e(),n=t();if(i===o(this._private__pane)._internal_defaultPriceScale())return{_internal_price:n,_internal_coordinate:_};{const t=o(i._internal_firstValue());return{_internal_price:i._internal_coordinateToPrice(_,t),_internal_coordinate:_}}})((()=>this._private__price),(()=>this._private__y));const i=((t,e)=>()=>{const i=this._private__model._internal_timeScale()._internal_indexToTime(t()),_=e();return i&&Number.isFinite(_)?{_internal_time:i,_internal_coordinate:_}:null})((()=>this._private__index),(()=>this._internal_appliedX()));this._private__timeAxisView=new K(this,t,i),this._private__paneView=new U(this)}_internal_options(){return this._private__options}_internal_saveOriginCoord(t,e){this._private__originX=t,this._private__originY=e}_internal_clearOriginCoord(){this._private__originX=NaN,this._private__originY=NaN}_internal_originCoordX(){return this._private__originX}_internal_originCoordY(){return this._private__originY}_internal_setPosition(t,e,i){this._private__subscribed||(this._private__subscribed=!0),this._private__visible=!0,this._private__tryToUpdateViews(t,e,i)}_internal_appliedIndex(){return this._private__index}_internal_appliedX(){return this._private__x}_internal_appliedY(){return this._private__y}_internal_visible(){return this._private__visible}_internal_clearPosition(){this._private__visible=!1,this._private__setIndexToLastSeriesBarIndex(),this._private__price=NaN,this._private__x=NaN,this._private__y=NaN,this._private__pane=null,this._internal_clearOriginCoord()}_internal_paneViews(t){return null!==this._private__pane?[this._private__paneView]:[]}_internal_horzLineVisible(t){return t===this._private__pane&&this._private__options.horzLine.visible}_internal_vertLineVisible(){return this._private__options.vertLine.visible}_internal_priceAxisViews(t,e){this._private__visible&&this._private__pane===t||this._private__priceAxisViews.clear();const i=[];return this._private__pane===t&&i.push(this._private__createPriceAxisViewOnDemand(this._private__priceAxisViews,e,this._private__currentPosPriceProvider)),i}_internal_timeAxisViews(){return this._private__visible?[this._private__timeAxisView]:[]}_internal_pane(){return this._private__pane}_internal_updateAllViews(){this._private__paneView._internal_update(),this._private__priceAxisViews.forEach((t=>t._internal_update())),this._private__timeAxisView._internal_update()}_private__priceScaleByPane(t){return t&&!t._internal_defaultPriceScale()._internal_isEmpty()?t._internal_defaultPriceScale():null}_private__tryToUpdateViews(t,e,i){this._private__tryToUpdateData(t,e,i)&&this._internal_updateAllViews()}_private__tryToUpdateData(t,e,i){const _=this._private__x,n=this._private__y,r=this._private__price,a=this._private__index,l=this._private__pane,s=this._private__priceScaleByPane(i);this._private__index=t,this._private__x=isNaN(t)?NaN:this._private__model._internal_timeScale()._internal_indexToCoordinate(t),this._private__pane=i;const o=null!==s?s._internal_firstValue():null;return null!==s&&null!==o?(this._private__price=e,this._private__y=s._internal_priceToCoordinate(e,o)):(this._private__price=NaN,this._private__y=NaN),_!==this._private__x||n!==this._private__y||a!==this._private__index||r!==this._private__price||l!==this._private__pane}_private__setIndexToLastSeriesBarIndex(){const t=this._private__model._internal_serieses().map((t=>t._internal_bars()._internal_lastIndex())).filter(r),e=0===t.length?null:Math.max(...t);this._private__index=null!==e?e:NaN}_private__createPriceAxisViewOnDemand(t,e,i){let _=t.get(e);return void 0===_&&(_=new j(this,e,i),t.set(e,_)),_}}class Q extends N{constructor(){super(...arguments),this._internal__data=null}_internal_setData(t){this._internal__data=t}_internal__drawImpl(t){if(null===this._internal__data)return;const{_internal_items:e,_internal_visibleRange:i,_internal_barWidth:_,_internal_lineType:n,_internal_lineWidth:r,_internal_lineStyle:a}=this._internal__data;if(null===i)return;const l=t.context;l.lineCap="butt",l.lineWidth=r*t.verticalPixelRatio,u(l,a),l.lineJoin="round";const s=this._internal__strokeStyle.bind(this);void 0!==n&&function(t,e,i,_,n,r){function a(t,e){const i=t.context;i.strokeStyle=e,i.stroke()}if(0===e.length||_.from>=e.length||_.to<=0)return;const{context:l,horizontalPixelRatio:s,verticalPixelRatio:o}=t,h=e[_.from];let p=r(t,h),c=h;if(_.to-_.from<2){const e=n/2;l.beginPath();const i={_internal_x:h._internal_x-e,_internal_y:h._internal_y},_={_internal_x:h._internal_x+e,_internal_y:h._internal_y};l.moveTo(i._internal_x*s,i._internal_y*o),l.lineTo(_._internal_x*s,_._internal_y*o),a(t,p)}else{const n=(e,i)=>{a(t,p),l.beginPath(),p=e,c=i};let v=c;l.beginPath(),l.moveTo(h._internal_x*s,h._internal_y*o);for(let a=_.from+1;a<_.to;++a){v=e[a];const _=r(t,v);switch(i){case 0:l.lineTo(v._internal_x*s,v._internal_y*o);break;case 1:l.lineTo(v._internal_x*s,e[a-1]._internal_y*o),_!==p&&(n(_,v),l.lineTo(v._internal_x*s,e[a-1]._internal_y*o)),l.lineTo(v._internal_x*s,v._internal_y*o);break;case 2:{const[t,i]=R(e,a-1,a);l.bezierCurveTo(t._internal_x*s,t._internal_y*o,i._internal_x*s,i._internal_y*o,v._internal_x*s,v._internal_y*o);break}}1!==i&&_!==p&&(n(_,v),l.moveTo(v._internal_x*s,v._internal_y*o))}(c!==v||c===v&&1===i)&&a(t,p)}}(t,e,n,i,_,s)}}class J extends Q{_internal__strokeStyle(t,e){return e._internal_lineColor}}function tt(t,e,i,_,n=0,r=e.length){let a=r-n;for(;0<a;){const r=a>>1,l=n+r;_(e[l],i)===t?(n=l+1,a-=r+1):a=r}return n}const et=tt.bind(null,!0),it=tt.bind(null,!1);function _t(t,e){return t._internal_time<e}function nt(t,e){return e<t._internal_time}class rt{constructor(t,e,i){this._internal__invalidated=!0,this._internal__dataInvalidated=!0,this._internal__optionsInvalidated=!0,this._internal__items=[],this._internal__itemsVisibleRange=null,this._internal__series=t,this._internal__model=e,this._private__extendedVisibleRange=i}_internal_update(t){this._internal__invalidated=!0,"data"===t&&(this._internal__dataInvalidated=!0),"options"===t&&(this._internal__optionsInvalidated=!0)}_internal_renderer(){return this._internal__series._internal_visible()?(this._private__makeValid(),null===this._internal__itemsVisibleRange?null:this._internal__renderer):null}_internal__updateOptions(){this._internal__items=this._internal__items.map((t=>Object.assign(Object.assign({},t),this._internal__series._internal_barColorer()._internal_barStyle(t._internal_time))))}_internal__clearVisibleRange(){this._internal__itemsVisibleRange=null}_private__makeValid(){this._internal__dataInvalidated&&(this._internal__fillRawPoints(),this._internal__dataInvalidated=!1),this._internal__optionsInvalidated&&(this._internal__updateOptions(),this._internal__optionsInvalidated=!1),this._internal__invalidated&&(this._private__makeValidImpl(),this._internal__invalidated=!1)}_private__makeValidImpl(){const t=this._internal__series._internal_priceScale(),e=this._internal__model._internal_timeScale();if(this._internal__clearVisibleRange(),e._internal_isEmpty()||t._internal_isEmpty())return;const i=e._internal_visibleStrictRange();if(null===i)return;if(0===this._internal__series._internal_bars()._internal_size())return;const _=this._internal__series._internal_firstValue();null!==_&&(this._internal__itemsVisibleRange=function(t,e,i){const _=e._internal_left(),n=e._internal_right(),r=et(t,_,_t),a=it(t,n,nt);if(!i)return{from:r,to:a};let l=r,s=a;return r>0&&r<t.length&&t[r]._internal_time>=_&&(l=r-1),a>0&&a<t.length&&t[a-1]._internal_time<=n&&(s=a+1),{from:l,to:s}}(this._internal__items,i,this._private__extendedVisibleRange),this._internal__convertToCoordinates(t,e,_._internal_value),this._internal__prepareRendererData())}}class at extends rt{constructor(t,e){super(t,e,!0)}_internal__convertToCoordinates(t,e,i){e._internal_indexesToCoordinates(this._internal__items,a(this._internal__itemsVisibleRange)),t._internal_pointsArrayToCoordinates(this._internal__items,i,a(this._internal__itemsVisibleRange))}_internal__createRawItemBase(t,e){return{_internal_time:t,_internal_price:e,_internal_x:NaN,_internal_y:NaN}}_internal__fillRawPoints(){const t=this._internal__series._internal_barColorer();this._internal__items=this._internal__series._internal_bars()._internal_rows().map((e=>{const i=e._internal_value[3];return this._internal__createRawItem(e._internal_index,i,t)}))}}class lt extends rt{constructor(t,e){super(t,e,!1)}_internal__convertToCoordinates(t,e,i){e._internal_indexesToCoordinates(this._internal__items,a(this._internal__itemsVisibleRange)),t._internal_barPricesToCoordinates(this._internal__items,i,a(this._internal__itemsVisibleRange))}_internal__createDefaultItem(t,e,i){return{_internal_time:t,_internal_open:e._internal_value[0],_internal_high:e._internal_value[1],_internal_low:e._internal_value[2],_internal_close:e._internal_value[3],_internal_x:NaN,_internal_openY:NaN,_internal_highY:NaN,_internal_lowY:NaN,_internal_closeY:NaN}}_internal__fillRawPoints(){const t=this._internal__series._internal_barColorer();this._internal__items=this._internal__series._internal_bars()._internal_rows().map((e=>this._internal__createRawItem(e._internal_index,e,t)))}}class st extends N{constructor(){super(...arguments),this._private__data=null,this._private__barWidth=0}_internal_setData(t){this._private__data=t}_internal__drawImpl(t){if(null===this._private__data||0===this._private__data._internal_bars.length||null===this._private__data._internal_visibleRange)return;const{horizontalPixelRatio:e}=t;this._private__barWidth=function(t,e){if(t>=2.5&&t<=4)return Math.floor(3*e);const i=1-.2*Math.atan(Math.max(4,t)-4)/(.5*Math.PI),_=Math.floor(t*i*e),n=Math.floor(t*e),r=Math.min(_,n);return Math.max(Math.floor(e),r)}(this._private__data._internal_barSpacing,e),this._private__barWidth>=2&&Math.floor(e)%2!=this._private__barWidth%2&&this._private__barWidth--;const i=this._private__data._internal_bars;this._private__data._internal_wickVisible&&this._private__drawWicks(t,i,this._private__data._internal_visibleRange),this._private__data._internal_borderVisible&&this._private__drawBorder(t,i,this._private__data._internal_visibleRange);const _=this._private__calculateBorderWidth(e);(!this._private__data._internal_borderVisible||this._private__barWidth>2*_)&&this._private__drawCandles(t,i,this._private__data._internal_visibleRange)}_private__drawWicks(t,e,i){if(null===this._private__data)return;const{context:_,horizontalPixelRatio:n,verticalPixelRatio:r}=t;let a="",l=Math.min(Math.floor(n),Math.floor(this._private__data._internal_barSpacing*n));l=Math.max(Math.floor(n),Math.min(l,this._private__barWidth));const s=Math.floor(.5*l);let o=null;for(let t=i.from;t<i.to;t++){const i=e[t];i._internal_barWickColor!==a&&(_.fillStyle=i._internal_barWickColor,a=i._internal_barWickColor);const h=Math.round(Math.min(i._internal_openY,i._internal_closeY)*r),p=Math.round(Math.max(i._internal_openY,i._internal_closeY)*r),c=Math.round(i._internal_highY*r),v=Math.round(i._internal_lowY*r);let d=Math.round(n*i._internal_x)-s;const u=d+l-1;null!==o&&(d=Math.max(o+1,d),d=Math.min(d,u));const m=u-d+1;_.fillRect(d,c,m,h-c),_.fillRect(d,p+1,m,v-p),o=u}}_private__calculateBorderWidth(t){let e=Math.floor(1*t);this._private__barWidth<=2*e&&(e=Math.floor(.5*(this._private__barWidth-1)));const i=Math.max(Math.floor(t),e);return this._private__barWidth<=2*i?Math.max(Math.floor(t),Math.floor(1*t)):i}_private__drawBorder(t,e,i){if(null===this._private__data)return;const{context:_,horizontalPixelRatio:n,verticalPixelRatio:r}=t;let a="";const l=this._private__calculateBorderWidth(n);let s=null;for(let t=i.from;t<i.to;t++){const i=e[t];i._internal_barBorderColor!==a&&(_.fillStyle=i._internal_barBorderColor,a=i._internal_barBorderColor);let o=Math.round(i._internal_x*n)-Math.floor(.5*this._private__barWidth);const h=o+this._private__barWidth-1,p=Math.round(Math.min(i._internal_openY,i._internal_closeY)*r),c=Math.round(Math.max(i._internal_openY,i._internal_closeY)*r);if(null!==s&&(o=Math.max(s+1,o),o=Math.min(o,h)),this._private__data._internal_barSpacing*n>2*l)y(_,o,p,h-o+1,c-p+1,l);else{const t=h-o+1;_.fillRect(o,p,t,c-p+1)}s=h}}_private__drawCandles(t,e,i){if(null===this._private__data)return;const{context:_,horizontalPixelRatio:n,verticalPixelRatio:r}=t;let a="";for(let t=i.from;t<i.to;t++){const i=e[t];let l=Math.round(Math.min(i._internal_openY,i._internal_closeY)*r),s=Math.round(Math.max(i._internal_openY,i._internal_closeY)*r),o=Math.round(i._internal_x*n)-Math.floor(.5*this._private__barWidth),h=o+this._private__barWidth-1;if(i._internal_barColor!==a){const t=i._internal_barColor;_.fillStyle=t,a=t}l>s||_.fillRect(o,l,h-o+1,s-l+1)}}}class ot extends lt{constructor(){super(...arguments),this._internal__renderer=new st}_internal__createRawItem(t,e,i){return Object.assign(Object.assign({},this._internal__createDefaultItem(t,e,i)),i._internal_barStyle(t))}_internal__prepareRendererData(){const t=this._internal__series._internal_options();this._internal__renderer._internal_setData({_internal_bars:this._internal__items,_internal_barSpacing:this._internal__model._internal_timeScale()._internal_barSpacing(),_internal_wickVisible:t.wickVisible,_internal_borderVisible:t.borderVisible,_internal_visibleRange:this._internal__itemsVisibleRange})}}class ht{constructor(t,e){this._private__sourceRenderer=t,this._private__priceScale=e}_internal_draw(t,e,i){this._private__sourceRenderer.draw(t,this._private__priceScale,e,i)}}class pt extends rt{constructor(t,e,i){super(t,e,!1),this._private__paneView=i,this._internal__renderer=new ht(this._private__paneView.renderer(),(e=>{const i=t._internal_firstValue();return null===i?null:t._internal_priceScale()._internal_priceToCoordinate(e,i._internal_value)}))}_internal_priceValueBuilder(t){return this._private__paneView.priceValueBuilder(t)}_internal_isWhitespace(t){return this._private__paneView.isWhitespace(t)}}class ct extends at{constructor(){super(...arguments),this._internal__renderer=new J}_internal__createRawItem(t,e,i){return Object.assign(Object.assign({},this._internal__createRawItemBase(t,e)),i._internal_barStyle(t))}_internal__prepareRendererData(){const t=this._internal__series._internal_options(),e={_internal_items:this._internal__items,_internal_lineStyle:t.lineStyle,_internal_lineType:t.lineVisible?t.lineType:void 0,_internal_lineWidth:t.lineWidth,_internal_visibleRange:this._internal__itemsVisibleRange,_internal_barWidth:this._internal__model._internal_timeScale()._internal_barSpacing()};this._internal__renderer._internal_setData(e)}}const vt=/[2-9]/g;class dt{constructor(t=50){this._private__actualSize=0,this._private__usageTick=1,this._private__oldestTick=1,this._private__tick2Labels={},this._private__cache=new Map,this._private__maxSize=t}_internal_reset(){this._private__actualSize=0,this._private__cache.clear(),this._private__usageTick=1,this._private__oldestTick=1,this._private__tick2Labels={}}_internal_measureText(t,e,i){return this._private__getMetrics(t,e,i).width}_internal_yMidCorrection(t,e,i){const _=this._private__getMetrics(t,e,i);return((_.actualBoundingBoxAscent||0)-(_.actualBoundingBoxDescent||0))/2}_private__getMetrics(t,e,i){const _=i||vt,n=String(e).replace(_,"0");if(this._private__cache.has(n))return s(this._private__cache.get(n))._internal_metrics;if(this._private__actualSize===this._private__maxSize){const t=this._private__tick2Labels[this._private__oldestTick];delete this._private__tick2Labels[this._private__oldestTick],this._private__cache.delete(t),this._private__oldestTick++,this._private__actualSize--}t.save(),t.textBaseline="middle";const r=t.measureText(n);return t.restore(),0===r.width&&e.length||(this._private__cache.set(n,{_internal_metrics:r,_internal_tick:this._private__usageTick}),this._private__tick2Labels[this._private__usageTick]=n,this._private__actualSize++,this._private__usageTick++),r}}class ut{constructor(t){this._private__priceAxisViewRenderer=null,this._private__rendererOptions=null,this._private__align="right",this._private__textWidthCache=t}_internal_setParams(t,e,i){this._private__priceAxisViewRenderer=t,this._private__rendererOptions=e,this._private__align=i}_internal_draw(t){null!==this._private__rendererOptions&&null!==this._private__priceAxisViewRenderer&&this._private__priceAxisViewRenderer._internal_draw(t,this._private__rendererOptions,this._private__textWidthCache,this._private__align)}}class mt{constructor(t,e,i){this._private__priceAxisView=t,this._private__textWidthCache=new dt(50),this._private__dataSource=e,this._private__chartModel=i,this._private__fontSize=-1,this._private__renderer=new ut(this._private__textWidthCache)}_internal_renderer(){const t=this._private__chartModel._internal_paneForSource(this._private__dataSource);if(null===t)return null;const e=t._internal_isOverlay(this._private__dataSource)?t._internal_defaultVisiblePriceScale():this._private__dataSource._internal_priceScale();if(null===e)return null;const i=t._internal_priceScalePosition(e);if("overlay"===i)return null;const _=this._private__chartModel._internal_priceAxisRendererOptions();return _._internal_fontSize!==this._private__fontSize&&(this._private__fontSize=_._internal_fontSize,this._private__textWidthCache._internal_reset()),this._private__renderer._internal_setParams(this._private__priceAxisView._internal_paneRenderer(),_,i),this._private__renderer}}class gt extends N{constructor(){super(...arguments),this._private__data=null}_internal_setData(t){this._private__data=t}_internal_hitTest(t,e){var i;if(!(null===(i=this._private__data)||void 0===i?void 0:i._internal_visible))return null;const{_internal_y:_,_internal_lineWidth:n,_internal_externalId:r}=this._private__data;return e>=_-n-7&&e<=_+n+7?{_internal_hitTestData:this._private__data,_internal_externalId:r}:null}_internal__drawImpl({context:t,bitmapSize:e,horizontalPixelRatio:i,verticalPixelRatio:_}){if(null===this._private__data)return;if(!1===this._private__data._internal_visible)return;const n=Math.round(this._private__data._internal_y*_);n<0||n>e.height||(t.lineCap="butt",t.strokeStyle=this._private__data._internal_color,t.lineWidth=Math.floor(this._private__data._internal_lineWidth*i),u(t,this._private__data._internal_lineStyle),m(t,n,0,e.width))}}class ft{constructor(t){this._internal__lineRendererData={_internal_y:0,_internal_color:"rgba(0, 0, 0, 0)",_internal_lineWidth:1,_internal_lineStyle:0,_internal_visible:!1},this._internal__lineRenderer=new gt,this._private__invalidated=!0,this._internal__series=t,this._internal__lineRenderer._internal_setData(this._internal__lineRendererData)}_internal_update(){this._private__invalidated=!0}_internal_renderer(){return this._internal__series._internal_visible()?(this._private__invalidated&&(this._internal__updateImpl(),this._private__invalidated=!1),this._internal__lineRenderer):null}}class St extends ft{constructor(t){super(t)}_internal__updateImpl(){this._internal__lineRendererData._internal_visible=!1;const t=this._internal__series._internal_priceScale(),e=t._internal_mode()._internal_mode;if(2!==e&&3!==e)return;const i=this._internal__series._internal_options();if(!i.baseLineVisible||!this._internal__series._internal_visible())return;const _=this._internal__series._internal_firstValue();null!==_&&(this._internal__lineRendererData._internal_visible=!0,this._internal__lineRendererData._internal_y=t._internal_priceToCoordinate(_._internal_value,_._internal_value),this._internal__lineRendererData._internal_color=i.baseLineColor,this._internal__lineRendererData._internal_lineWidth=i.baseLineWidth,this._internal__lineRendererData._internal_lineStyle=i.baseLineStyle)}}class bt extends N{constructor(){super(...arguments),this._private__data=null}_internal_setData(t){this._private__data=t}_internal_data(){return this._private__data}_internal__drawImpl({context:t,horizontalPixelRatio:e,verticalPixelRatio:i}){const _=this._private__data;if(null===_)return;const n=Math.max(1,Math.floor(e)),r=n%2/2,a=Math.round(_._internal_center.x*e)+r,l=_._internal_center.y*i;t.fillStyle=_._internal_seriesLineColor,t.beginPath();const s=Math.max(2,1.5*_._internal_seriesLineWidth)*e;t.arc(a,l,s,0,2*Math.PI,!1),t.fill(),t.fillStyle=_._internal_fillColor,t.beginPath(),t.arc(a,l,_._internal_radius*e,0,2*Math.PI,!1),t.fill(),t.lineWidth=n,t.strokeStyle=_._internal_strokeColor,t.beginPath(),t.arc(a,l,_._internal_radius*e+n/2,0,2*Math.PI,!1),t.stroke()}}const wt=[{_internal_start:0,_internal_end:.25,_internal_startRadius:4,_internal_endRadius:10,_internal_startFillAlpha:.25,_internal_endFillAlpha:0,_internal_startStrokeAlpha:.4,_internal_endStrokeAlpha:.8},{_internal_start:.25,_internal_end:.525,_internal_startRadius:10,_internal_endRadius:14,_internal_startFillAlpha:0,_internal_endFillAlpha:0,_internal_startStrokeAlpha:.8,_internal_endStrokeAlpha:0},{_internal_start:.525,_internal_end:1,_internal_startRadius:14,_internal_endRadius:14,_internal_startFillAlpha:0,_internal_endFillAlpha:0,_internal_startStrokeAlpha:0,_internal_endStrokeAlpha:0}];function Ct(t,e,i,_){return function(t,e){if("transparent"===t)return t;const i=x(t),_=i[3];return`rgba(${i[0]}, ${i[1]}, ${i[2]}, ${e*_})`}(t,i+(_-i)*e)}function xt(t,e){const i=t%2600/2600;let _;for(const t of wt)if(i>=t._internal_start&&i<=t._internal_end){_=t;break}l(void 0!==_,"Last price animation internal logic error");const n=(i-_._internal_start)/(_._internal_end-_._internal_start);return{_internal_fillColor:Ct(e,n,_._internal_startFillAlpha,_._internal_endFillAlpha),_internal_strokeColor:Ct(e,n,_._internal_startStrokeAlpha,_._internal_endStrokeAlpha),_internal_radius:(r=n,a=_._internal_startRadius,s=_._internal_endRadius,a+(s-a)*r)};var r,a,s}class Tt{constructor(t){this._private__renderer=new bt,this._private__invalidated=!0,this._private__stageInvalidated=!0,this._private__startTime=performance.now(),this._private__endTime=this._private__startTime-1,this._private__series=t}_internal_onDataCleared(){this._private__endTime=this._private__startTime-1,this._internal_update()}_internal_onNewRealtimeDataReceived(){if(this._internal_update(),2===this._private__series._internal_options().lastPriceAnimation){const t=performance.now(),e=this._private__endTime-t;if(e>0)return void(e<650&&(this._private__endTime+=2600));this._private__startTime=t,this._private__endTime=t+2600}}_internal_update(){this._private__invalidated=!0}_internal_invalidateStage(){this._private__stageInvalidated=!0}_internal_visible(){return 0!==this._private__series._internal_options().lastPriceAnimation}_internal_animationActive(){switch(this._private__series._internal_options().lastPriceAnimation){case 0:return!1;case 1:return!0;case 2:return performance.now()<=this._private__endTime}}_internal_renderer(){return this._private__invalidated?(this._private__updateImpl(),this._private__invalidated=!1,this._private__stageInvalidated=!1):this._private__stageInvalidated&&(this._private__updateRendererDataStage(),this._private__stageInvalidated=!1),this._private__renderer}_private__updateImpl(){this._private__renderer._internal_setData(null);const t=this._private__series._internal_model()._internal_timeScale(),e=t._internal_visibleStrictRange(),i=this._private__series._internal_firstValue();if(null===e||null===i)return;const _=this._private__series._internal_lastValueData(!0);if(_._internal_noData||!e._internal_contains(_._internal_index))return;const n={x:t._internal_indexToCoordinate(_._internal_index),y:this._private__series._internal_priceScale()._internal_priceToCoordinate(_._internal_price,i._internal_value)},r=_._internal_color,a=this._private__series._internal_options().lineWidth,l=xt(this._private__duration(),r);this._private__renderer._internal_setData({_internal_seriesLineColor:r,_internal_seriesLineWidth:a,_internal_fillColor:l._internal_fillColor,_internal_strokeColor:l._internal_strokeColor,_internal_radius:l._internal_radius,_internal_center:n})}_private__updateRendererDataStage(){const t=this._private__renderer._internal_data();if(null!==t){const e=xt(this._private__duration(),t._internal_seriesLineColor);t._internal_fillColor=e._internal_fillColor,t._internal_strokeColor=e._internal_strokeColor,t._internal_radius=e._internal_radius}}_private__duration(){return this._internal_animationActive()?performance.now()-this._private__startTime:2599}}class yt extends ft{constructor(t){super(t)}_internal__updateImpl(){const t=this._internal__lineRendererData;t._internal_visible=!1;const e=this._internal__series._internal_options();if(!e.priceLineVisible||!this._internal__series._internal_visible())return;const i=this._internal__series._internal_lastValueData(0===e.priceLineSource);i._internal_noData||(t._internal_visible=!0,t._internal_y=i._internal_coordinate,t._internal_color=this._internal__series._internal_priceLineColor(i._internal_color),t._internal_lineWidth=e.priceLineWidth,t._internal_lineStyle=e.priceLineStyle)}}class Pt extends ${constructor(t){super(),this._private__source=t}_internal__updateRendererData(t,e,i){t._internal_visible=!1,e._internal_visible=!1;const _=this._private__source;if(!_._internal_visible())return;const n=_._internal_options().lastValueVisible,r=""!==_._internal_title(),a=!0,l=_._internal_lastValueData(!1);if(l._internal_noData)return;n&&(t._internal_text=this._internal__axisText(l,n,a),t._internal_visible=0!==t._internal_text.length),e._internal_text=this._internal__paneText(l,n,r,a),e._internal_visible=e._internal_text.length>0;const s=_._internal_priceLineColor(l._internal_color),o=T(s);i._internal_background=o._internal_background,i._internal_coordinate=l._internal_coordinate,e._internal_borderColor=_._internal_model()._internal_backgroundColorAtYPercentFromTop(l._internal_coordinate/_._internal_priceScale()._internal_height()),t._internal_borderColor=s,t._internal_color=o._internal_foreground,e._internal_color=o._internal_foreground}_internal__paneText(t,e,i,_){let n="";const r=this._private__source._internal_title();return i&&0!==r.length&&(n+=`${r} `),e&&_&&(n+=this._private__source._internal_priceScale()._internal_isPercentage()?t._internal_formattedPriceAbsolute:t._internal_formattedPricePercentage),n.trim()}_internal__axisText(t,e,i){return e?i?this._private__source._internal_priceScale()._internal_isPercentage()?t._internal_formattedPricePercentage:t._internal_formattedPriceAbsolute:t._internal_text:""}}class Mt{constructor(){this._private__listeners=[]}_internal_subscribe(t,e,i){const _={_internal_callback:t,_internal_linkedObject:e,_internal_singleshot:!0===i};this._private__listeners.push(_)}_internal_unsubscribeAll(t){this._private__listeners=this._private__listeners.filter((e=>e._internal_linkedObject!==t))}_internal_fire(t,e,i){const _=[...this._private__listeners];this._private__listeners=this._private__listeners.filter((t=>!t._internal_singleshot)),_.forEach((_=>_._internal_callback(t,e,i)))}_internal_hasListeners(){return this._private__listeners.length>0}_internal_destroy(){this._private__listeners=[]}}const kt="-apple-system, BlinkMacSystemFont, 'Trebuchet MS', Roboto, Ubuntu, sans-serif";function Et(t,e,i){return void 0===e&&(e=kt),`${i=void 0!==i?`${i} `:""}${t}px ${e}`}function zt(t){return"left"===t||"right"===t}class Rt{constructor(t){this._private__invalidatedPanes=new Map,this._private__timeScaleInvalidations=[],this._private__globalLevel=t}_internal_invalidatePane(t,e){const i=function(t,e){return void 0===t?e:{_internal_level:Math.max(t._internal_level,e._internal_level),_internal_autoScale:t._internal_autoScale||e._internal_autoScale}}(this._private__invalidatedPanes.get(t),e);this._private__invalidatedPanes.set(t,i)}_internal_fullInvalidation(){return this._private__globalLevel}_internal_invalidateForPane(t){const e=this._private__invalidatedPanes.get(t);return void 0===e?{_internal_level:this._private__globalLevel}:{_internal_level:Math.max(this._private__globalLevel,e._internal_level),_internal_autoScale:e._internal_autoScale}}_internal_setFitContent(){this._internal_stopTimeScaleAnimation(),this._private__timeScaleInvalidations=[{_internal_type:0}]}_internal_applyRange(t){this._internal_stopTimeScaleAnimation(),this._private__timeScaleInvalidations=[{_internal_type:1,_internal_value:t}]}_internal_setTimeScaleAnimation(t){this._private__removeTimeScaleAnimation(),this._private__timeScaleInvalidations.push({_internal_type:5,_internal_value:t})}_internal_stopTimeScaleAnimation(){this._private__removeTimeScaleAnimation(),this._private__timeScaleInvalidations.push({_internal_type:6})}_internal_resetTimeScale(){this._internal_stopTimeScaleAnimation(),this._private__timeScaleInvalidations=[{_internal_type:4}]}_internal_setBarSpacing(t){this._internal_stopTimeScaleAnimation(),this._private__timeScaleInvalidations.push({_internal_type:2,_internal_value:t})}_internal_setRightOffset(t){this._internal_stopTimeScaleAnimation(),this._private__timeScaleInvalidations.push({_internal_type:3,_internal_value:t})}_internal_timeScaleInvalidations(){return this._private__timeScaleInvalidations}_internal_merge(t){for(const e of t._private__timeScaleInvalidations)this._private__applyTimeScaleInvalidation(e);this._private__globalLevel=Math.max(this._private__globalLevel,t._private__globalLevel),t._private__invalidatedPanes.forEach(((t,e)=>{this._internal_invalidatePane(e,t)}))}static _internal_light(){return new Rt(2)}static _internal_full(){return new Rt(3)}_private__applyTimeScaleInvalidation(t){switch(t._internal_type){case 0:this._internal_setFitContent();break;case 1:this._internal_applyRange(t._internal_value);break;case 2:this._internal_setBarSpacing(t._internal_value);break;case 3:this._internal_setRightOffset(t._internal_value);break;case 4:this._internal_resetTimeScale();break;case 5:this._internal_setTimeScaleAnimation(t._internal_value);break;case 6:this._private__removeTimeScaleAnimation()}}_private__removeTimeScaleAnimation(){const t=this._private__timeScaleInvalidations.findIndex((t=>5===t._internal_type));-1!==t&&this._private__timeScaleInvalidations.splice(t,1)}}class Bt{constructor(t,e){this._private__minValue=t,this._private__maxValue=e}_internal_equals(t){return null!==t&&this._private__minValue===t._private__minValue&&this._private__maxValue===t._private__maxValue}_internal_clone(){return new Bt(this._private__minValue,this._private__maxValue)}_internal_minValue(){return this._private__minValue}_internal_maxValue(){return this._private__maxValue}_internal_length(){return this._private__maxValue-this._private__minValue}_internal_isEmpty(){return this._private__maxValue===this._private__minValue||Number.isNaN(this._private__maxValue)||Number.isNaN(this._private__minValue)}_internal_merge(t){function e(t,e,i,_){const n=Number.isFinite(e),r=Number.isFinite(i);return n&&r?t(e,i):n||r?n?e:i:_}return null===t?this:new Bt(e(Math.min,this._internal_minValue(),t._internal_minValue(),-1/0),e(Math.max,this._internal_maxValue(),t._internal_maxValue(),1/0))}_internal_scaleAroundCenter(e){if(!t(e))return;if(0==this._private__maxValue-this._private__minValue)return;const i=.5*(this._private__maxValue+this._private__minValue);let _=this._private__maxValue-i,n=this._private__minValue-i;_*=e,n*=e,this._private__maxValue=i+_,this._private__minValue=i+n}_internal_shift(e){t(e)&&(this._private__maxValue+=e,this._private__minValue+=e)}_internal_toRaw(){return{minValue:this._private__minValue,maxValue:this._private__maxValue}}static _internal_fromRaw(t){return null===t?null:new Bt(t.minValue,t.maxValue)}}class It{constructor(t,e){this._private__priceRange=t,this._private__margins=e||null}_internal_priceRange(){return this._private__priceRange}_internal_margins(){return this._private__margins}_internal_toRaw(){return null===this._private__priceRange?null:{priceRange:this._private__priceRange._internal_toRaw(),margins:this._private__margins||void 0}}static _internal_fromRaw(t){return null===t?null:new It(Bt._internal_fromRaw(t.priceRange),t.margins)}}class At extends Z{constructor(t){super(),this._private__model=t}_internal_model(){return this._private__model}}const Dt={Bar:(t,e,i,_)=>{var n;const r=e.upColor,a=e.downColor,l=o(t(i,_)),s=h(l._internal_value[0])<=h(l._internal_value[3]);return{_internal_barColor:null!==(n=l._internal_color)&&void 0!==n?n:s?r:a}},Candlestick:(t,e,i,_)=>{var n,r,a;const l=e.upColor,s=e.downColor,p=e.borderUpColor,c=e.borderDownColor,v=e.wickUpColor,d=e.wickDownColor,u=o(t(i,_)),m=h(u._internal_value[0])<=h(u._internal_value[3]);return{_internal_barColor:null!==(n=u._internal_color)&&void 0!==n?n:m?l:s,_internal_barBorderColor:null!==(r=u._internal_borderColor)&&void 0!==r?r:m?p:c,_internal_barWickColor:null!==(a=u._internal_wickColor)&&void 0!==a?a:m?v:d}},Custom:(t,e,i,_)=>{var n;return{_internal_barColor:null!==(n=o(t(i,_))._internal_color)&&void 0!==n?n:e.color}},Area:(t,e,i,_)=>{var n,r,a,l;const s=o(t(i,_));return{_internal_barColor:null!==(n=s._internal_lineColor)&&void 0!==n?n:e.lineColor,_internal_lineColor:null!==(r=s._internal_lineColor)&&void 0!==r?r:e.lineColor,_internal_topColor:null!==(a=s._internal_topColor)&&void 0!==a?a:e.topColor,_internal_bottomColor:null!==(l=s._internal_bottomColor)&&void 0!==l?l:e.bottomColor}},Baseline:(t,e,i,_)=>{var n,r,a,l,s,h;const p=o(t(i,_));return{_internal_barColor:p._internal_value[3]>=e.baseValue.price?e.topLineColor:e.bottomLineColor,_internal_topLineColor:null!==(n=p._internal_topLineColor)&&void 0!==n?n:e.topLineColor,_internal_bottomLineColor:null!==(r=p._internal_bottomLineColor)&&void 0!==r?r:e.bottomLineColor,_internal_topFillColor1:null!==(a=p._internal_topFillColor1)&&void 0!==a?a:e.topFillColor1,_internal_topFillColor2:null!==(l=p._internal_topFillColor2)&&void 0!==l?l:e.topFillColor2,_internal_bottomFillColor1:null!==(s=p._internal_bottomFillColor1)&&void 0!==s?s:e.bottomFillColor1,_internal_bottomFillColor2:null!==(h=p._internal_bottomFillColor2)&&void 0!==h?h:e.bottomFillColor2}},Line:(t,e,i,_)=>{var n,r;const a=o(t(i,_));return{_internal_barColor:null!==(n=a._internal_color)&&void 0!==n?n:e.color,_internal_lineColor:null!==(r=a._internal_color)&&void 0!==r?r:e.color}},Histogram:(t,e,i,_)=>{var n;return{_internal_barColor:null!==(n=o(t(i,_))._internal_color)&&void 0!==n?n:e.color}}};class Vt{constructor(t){this._private__findBar=(t,e)=>void 0!==e?e._internal_value:this._private__series._internal_bars()._internal_valueAt(t),this._private__series=t,this._private__styleGetter=Dt[t._internal_seriesType()]}_internal_barStyle(t,e){return this._private__styleGetter(this._private__findBar,this._private__series._internal_options(),t,e)}}const Ot=30;class Lt{constructor(){this._private__items=[],this._private__minMaxCache=new Map,this._private__rowSearchCache=new Map}_internal_last(){return this._internal_size()>0?this._private__items[this._private__items.length-1]:null}_internal_firstIndex(){return this._internal_size()>0?this._private__indexAt(0):null}_internal_lastIndex(){return this._internal_size()>0?this._private__indexAt(this._private__items.length-1):null}_internal_size(){return this._private__items.length}_internal_isEmpty(){return 0===this._internal_size()}_internal_contains(t){return null!==this._private__search(t,0)}_internal_valueAt(t){return this._internal_search(t)}_internal_search(t,e=0){const i=this._private__search(t,e);return null===i?null:Object.assign(Object.assign({},this._private__valueAt(i)),{_internal_index:this._private__indexAt(i)})}_internal_rows(){return this._private__items}_internal_minMaxOnRangeCached(t,e,i){if(this._internal_isEmpty())return null;let _=null;for(const n of i)_=Wt(_,this._private__minMaxOnRangeCachedImpl(t,e,n));return _}_internal_setData(t){this._private__rowSearchCache.clear(),this._private__minMaxCache.clear(),this._private__items=t}_private__indexAt(t){return this._private__items[t]._internal_index}_private__valueAt(t){return this._private__items[t]}_private__search(t,e){const i=this._private__bsearch(t);if(null===i&&0!==e)switch(e){case-1:return this._private__searchNearestLeft(t);case 1:return this._private__searchNearestRight(t);default:throw new TypeError("Unknown search mode")}return i}_private__searchNearestLeft(t){let e=this._private__lowerbound(t);return e>0&&(e-=1),e!==this._private__items.length&&this._private__indexAt(e)<t?e:null}_private__searchNearestRight(t){const e=this._private__upperbound(t);return e!==this._private__items.length&&t<this._private__indexAt(e)?e:null}_private__bsearch(t){const e=this._private__lowerbound(t);return e===this._private__items.length||t<this._private__items[e]._internal_index?null:e}_private__lowerbound(t){return et(this._private__items,t,((t,e)=>t._internal_index<e))}_private__upperbound(t){return it(this._private__items,t,((t,e)=>t._internal_index>e))}_private__plotMinMax(t,e,i){let _=null;for(let n=t;n<e;n++){const t=this._private__items[n]._internal_value[i];Number.isNaN(t)||(null===_?_={_internal_min:t,_internal_max:t}:(t<_._internal_min&&(_._internal_min=t),t>_._internal_max&&(_._internal_max=t)))}return _}_private__minMaxOnRangeCachedImpl(t,e,i){if(this._internal_isEmpty())return null;let _=null;const n=o(this._internal_firstIndex()),r=o(this._internal_lastIndex()),a=Math.max(t,n),l=Math.min(e,r),s=Math.ceil(a/Ot)*Ot,h=Math.max(s,Math.floor(l/Ot)*Ot);{const t=this._private__lowerbound(a),n=this._private__upperbound(Math.min(l,s,e));_=Wt(_,this._private__plotMinMax(t,n,i))}let p=this._private__minMaxCache.get(i);void 0===p&&(p=new Map,this._private__minMaxCache.set(i,p));for(let t=Math.max(s+1,a);t<h;t+=Ot){const e=Math.floor(t/Ot);let n=p.get(e);if(void 0===n){const t=this._private__lowerbound(e*Ot),_=this._private__upperbound((e+1)*Ot-1);n=this._private__plotMinMax(t,_,i),p.set(e,n)}_=Wt(_,n)}{const t=this._private__lowerbound(h),e=this._private__upperbound(l);_=Wt(_,this._private__plotMinMax(t,e,i))}return _}}function Wt(t,e){return null===t?e:null===e?t:{_internal_min:Math.min(t._internal_min,e._internal_min),_internal_max:Math.max(t._internal_max,e._internal_max)}}function Ft(t,e,i,_){t.forEach((t=>{e(t).forEach((t=>{t._internal_zOrder()===i&&_.push(t)}))}))}function Nt(t){return t._internal_paneViews()}function Ht(t){return t._internal_priceAxisPaneViews()}function Ut(t){return t._internal_timeAxisPaneViews()}class Yt extends At{constructor(t,e,i){super(t),this._private__data=new Lt,this._private__priceLineView=new yt(this),this._private__customPriceLines=[],this._private__baseHorizontalLineView=new St(this),this._private__lastPriceAnimationPaneView=null,this._private__barColorerCache=null,this._private__animationTimeoutId=null,this._private__primitives=[],this._private__options=e,this._private__seriesType=i;const _=new Pt(this);this._private__priceAxisViews=[_],this._private__panePriceAxisView=new mt(_,this,t),"Area"!==i&&"Line"!==i&&"Baseline"!==i||(this._private__lastPriceAnimationPaneView=new Tt(this)),this._private__recreateFormatter(),this._private__recreatePaneViews()}_internal_destroy(){null!==this._private__animationTimeoutId&&clearTimeout(this._private__animationTimeoutId)}_internal_priceLineColor(t){return this._private__options.priceLineColor||t}_internal_lastValueData(t){const e={_internal_noData:!0},i=this._internal_priceScale();if(this._internal_model()._internal_timeScale()._internal_isEmpty()||i._internal_isEmpty()||this._private__data._internal_isEmpty())return e;const _=this._internal_model()._internal_timeScale()._internal_visibleStrictRange(),n=this._internal_firstValue();if(null===_||null===n)return e;let r,a;if(t){const t=this._private__data._internal_last();if(null===t)return e;r=t,a=t._internal_index}else{const t=this._private__data._internal_search(_._internal_right(),-1);if(null===t)return e;if(r=this._private__data._internal_valueAt(t._internal_index),null===r)return e;a=t._internal_index}const l=r._internal_value[3],s=this._internal_barColorer()._internal_barStyle(a,{_internal_value:r}),o=i._internal_priceToCoordinate(l,n._internal_value);return{_internal_noData:!1,_internal_price:l,_internal_text:i._internal_formatPrice(l,n._internal_value),_internal_formattedPriceAbsolute:i._internal_formatPriceAbsolute(l),_internal_formattedPricePercentage:i._internal_formatPricePercentage(l,n._internal_value),_internal_color:s._internal_barColor,_internal_coordinate:o,_internal_index:a}}_internal_barColorer(){return null!==this._private__barColorerCache||(this._private__barColorerCache=new Vt(this)),this._private__barColorerCache}_internal_options(){return this._private__options}_internal_applyOptions(t){const e=t.priceScaleId;void 0!==e&&e!==this._private__options.priceScaleId&&this._internal_model()._internal_moveSeriesToScale(this,e),p(this._private__options,t),void 0!==t.priceFormat&&(this._private__recreateFormatter(),this._internal_model()._internal_fullUpdate()),this._internal_model()._internal_updateSource(this),this._internal_model()._internal_updateCrosshair(),this._private__paneView._internal_update("options")}_internal_setData(t,e){this._private__data._internal_setData(t),this._private__paneView._internal_update("data"),null!==this._private__lastPriceAnimationPaneView&&(e&&e._internal_lastBarUpdatedOrNewBarsAddedToTheRight?this._private__lastPriceAnimationPaneView._internal_onNewRealtimeDataReceived():0===t.length&&this._private__lastPriceAnimationPaneView._internal_onDataCleared());const i=this._internal_model()._internal_paneForSource(this);this._internal_model()._internal_recalculatePane(i),this._internal_model()._internal_updateSource(this),this._internal_model()._internal_updateCrosshair(),this._internal_model()._internal_lightUpdate()}_internal_seriesType(){return this._private__seriesType}_internal_firstValue(){const t=this._internal_firstBar();return null===t?null:{_internal_value:t._internal_value[3],_internal_timePoint:t._internal_time}}_internal_firstBar(){const t=this._internal_model()._internal_timeScale()._internal_visibleStrictRange();if(null===t)return null;const e=t._internal_left();return this._private__data._internal_search(e,1)}_internal_bars(){return this._private__data}_internal_topPaneViews(t){const e=[];Ft(this._private__primitives,Nt,"top",e);const i=this._private__lastPriceAnimationPaneView;return null!==i&&i._internal_visible()?(null===this._private__animationTimeoutId&&i._internal_animationActive()&&(this._private__animationTimeoutId=setTimeout((()=>{this._private__animationTimeoutId=null,this._internal_model()._internal_cursorUpdate()}),0)),i._internal_invalidateStage(),e.push(i),e):e}_internal_paneViews(){const t=[];this._private__isOverlay()||t.push(this._private__baseHorizontalLineView),t.push(this._private__paneView,this._private__priceLineView);const e=this._private__customPriceLines.map((t=>t._internal_paneView()));return t.push(...e),Ft(this._private__primitives,Nt,"normal",t),t}_internal_bottomPaneViews(){return this._private__extractPaneViews(Nt,"bottom")}_internal_pricePaneViews(t){return this._private__extractPaneViews(Ht,t)}_internal_timePaneViews(t){return this._private__extractPaneViews(Ut,t)}_internal_primitiveHitTest(t,e){return this._private__primitives.map((i=>i._internal_hitTest(t,e))).filter((t=>null!==t))}_internal_labelPaneViews(t){return[this._private__panePriceAxisView,...this._private__customPriceLines.map((t=>t._internal_labelPaneView()))]}_internal_priceAxisViews(t,e){if(e!==this._internal__priceScale&&!this._private__isOverlay())return[];const i=[...this._private__priceAxisViews];for(const t of this._private__customPriceLines)i.push(t._internal_priceAxisView());return this._private__primitives.forEach((t=>{i.push(...t._internal_priceAxisViews())})),i}_internal_timeAxisViews(){const t=[];return this._private__primitives.forEach((e=>{t.push(...e._internal_timeAxisViews())})),t}_internal_autoscaleInfo(t,e){if(void 0!==this._private__options.autoscaleInfoProvider){const i=this._private__options.autoscaleInfoProvider((()=>{const i=this._private__autoscaleInfoImpl(t,e);return null===i?null:i._internal_toRaw()}));return It._internal_fromRaw(i)}return this._private__autoscaleInfoImpl(t,e)}_internal_minMove(){return this._private__options.priceFormat.minMove}_internal_formatter(){return this._private__formatter}_internal_updateAllViews(){var t;this._private__paneView._internal_update();for(const t of this._private__priceAxisViews)t._internal_update();for(const t of this._private__customPriceLines)t._internal_update();this._private__priceLineView._internal_update(),this._private__baseHorizontalLineView._internal_update(),null===(t=this._private__lastPriceAnimationPaneView)||void 0===t||t._internal_update(),this._private__primitives.forEach((t=>t._internal_updateAllViews()))}_internal_priceScale(){return o(super._internal_priceScale())}_internal_markerDataAtIndex(t){if("Line"!==this._private__seriesType&&"Area"!==this._private__seriesType&&"Baseline"!==this._private__seriesType||!this._private__options.crosshairMarkerVisible)return null;const e=this._private__data._internal_valueAt(t);return null===e?null:{_internal_price:e._internal_value[3],_internal_radius:this._private__markerRadius(),_internal_borderColor:this._private__markerBorderColor(),_internal_borderWidth:this._private__markerBorderWidth(),_internal_backgroundColor:this._private__markerBackgroundColor(t)}}_internal_title(){return this._private__options.title}_internal_visible(){return this._private__options.visible}_internal_customSeriesPlotValuesBuilder(){if(this._private__paneView instanceof pt)return t=>this._private__paneView._internal_priceValueBuilder(t)}_internal_customSeriesWhitespaceCheck(){if(this._private__paneView instanceof pt)return t=>this._private__paneView._internal_isWhitespace(t)}_private__isOverlay(){return!zt(this._internal_priceScale()._internal_id())}_private__autoscaleInfoImpl(t,i){if(!e(t)||!e(i)||this._private__data._internal_isEmpty())return null;const _="Line"===this._private__seriesType||"Area"===this._private__seriesType||"Baseline"===this._private__seriesType||"Histogram"===this._private__seriesType?[3]:[2,1],n=this._private__data._internal_minMaxOnRangeCached(t,i,_);let r=null!==n?new Bt(n._internal_min,n._internal_max):null;if("Histogram"===this._internal_seriesType()){const t=this._private__options.base,e=new Bt(t,t);r=null!==r?r._internal_merge(e):e}return this._private__primitives.forEach((e=>{const _=e._internal_autoscaleInfo(t,i);if(null==_?void 0:_.priceRange){const t=new Bt(_.priceRange.minValue,_.priceRange.maxValue);r=null!==r?r._internal_merge(t):t}})),new It(r,null)}_private__markerRadius(){switch(this._private__seriesType){case"Line":case"Area":case"Baseline":return this._private__options.crosshairMarkerRadius}return 0}_private__markerBorderColor(){switch(this._private__seriesType){case"Line":case"Area":case"Baseline":{const t=this._private__options.crosshairMarkerBorderColor;if(0!==t.length)return t}}return null}_private__markerBorderWidth(){switch(this._private__seriesType){case"Line":case"Area":case"Baseline":return this._private__options.crosshairMarkerBorderWidth}return 0}_private__markerBackgroundColor(t){switch(this._private__seriesType){case"Line":case"Area":case"Baseline":{const t=this._private__options.crosshairMarkerBackgroundColor;if(0!==t.length)return t}}return this._internal_barColorer()._internal_barStyle(t)._internal_barColor}_private__recreateFormatter(){switch(this._private__options.priceFormat.type){case"custom":this._private__formatter={format:this._private__options.priceFormat.formatter};break;case"volume":this._private__formatter=new D(this._private__options.priceFormat.precision);break;case"percent":this._private__formatter=new A(this._private__options.priceFormat.precision);break;default:{const t=Math.pow(10,this._private__options.priceFormat.precision);this._private__formatter=new I(t,this._private__options.priceFormat.minMove*t)}}null!==this._internal__priceScale&&this._internal__priceScale._internal_updateFormatter()}_private__recreatePaneViews(){switch(this._private__seriesType){case"Candlestick":this._private__paneView=new ot(this,this._internal_model());break;case"Line":this._private__paneView=new ct(this,this._internal_model());break;default:throw Error("Unknown chart style assigned: "+this._private__seriesType)}}_private__extractPaneViews(t,e){const i=[];return Ft(this._private__primitives,t,e,i),i}}class $t extends N{constructor(){super(...arguments),this._private__data=null}_internal_setData(t){this._private__data=t}_internal__drawImpl({context:t,bitmapSize:e,horizontalPixelRatio:i,verticalPixelRatio:_}){if(null===this._private__data)return;const n=Math.max(1,Math.floor(i));t.lineWidth=n,function(t,e){t.save(),t.lineWidth%2&&t.translate(.5,.5),e(),t.restore()}(t,(()=>{const r=o(this._private__data);if(r._internal_vertLinesVisible){t.strokeStyle=r._internal_vertLinesColor,u(t,r._internal_vertLineStyle),t.beginPath();for(const _ of r._internal_timeMarks){const r=Math.round(_._internal_coord*i);t.moveTo(r,-n),t.lineTo(r,e.height+n)}t.stroke()}if(r._internal_horzLinesVisible){t.strokeStyle=r._internal_horzLinesColor,u(t,r._internal_horzLineStyle),t.beginPath();for(const i of r._internal_priceMarks){const r=Math.round(i._internal_coord*_);t.moveTo(-n,r),t.lineTo(e.width+n,r)}t.stroke()}}))}}class jt{constructor(t){this._private__renderer=new $t,this._private__invalidated=!0,this._private__pane=t}_internal_update(){this._private__invalidated=!0}_internal_renderer(){if(this._private__invalidated){const t=this._private__pane._internal_model()._internal_options().grid,e={_internal_horzLinesVisible:t.horzLines.visible,_internal_vertLinesVisible:t.vertLines.visible,_internal_horzLinesColor:t.horzLines.color,_internal_vertLinesColor:t.vertLines.color,_internal_horzLineStyle:t.horzLines.style,_internal_vertLineStyle:t.vertLines.style,_internal_priceMarks:this._private__pane._internal_defaultPriceScale()._internal_marks(),_internal_timeMarks:(this._private__pane._internal_model()._internal_timeScale()._internal_marks()||[]).map((t=>({_internal_coord:t.coord})))};this._private__renderer._internal_setData(e),this._private__invalidated=!1}return this._private__renderer}}class Xt{constructor(t){this._private__paneView=new jt(t)}_internal_paneView(){return this._private__paneView}}const Gt={_internal_logicalOffset:4,_internal_coordOffset:1e-4};function Kt(t,e){const i=100*(t-e)/e;return e<0?-i:i}function Zt(t,e){const i=Kt(t._internal_minValue(),e),_=Kt(t._internal_maxValue(),e);return new Bt(i,_)}function qt(t,e){const i=100*(t-e)/e+100;return e<0?-i:i}function Qt(t,e){const i=qt(t._internal_minValue(),e),_=qt(t._internal_maxValue(),e);return new Bt(i,_)}function Jt(t,e){const i=Math.abs(t);if(i<1e-15)return 0;const _=Math.log10(i+e._internal_coordOffset)+e._internal_logicalOffset;return t<0?-_:_}function te(t,e){const i=Math.abs(t);if(i<1e-15)return 0;const _=Math.pow(10,i-e._internal_logicalOffset)-e._internal_coordOffset;return t<0?-_:_}function ee(t,e){if(null===t)return null;const i=Jt(t._internal_minValue(),e),_=Jt(t._internal_maxValue(),e);return new Bt(i,_)}function ie(t,e){if(null===t)return null;const i=te(t._internal_minValue(),e),_=te(t._internal_maxValue(),e);return new Bt(i,_)}function _e(t){if(null===t)return Gt;const e=Math.abs(t._internal_maxValue()-t._internal_minValue());if(e>=1||e<1e-15)return Gt;const i=Math.ceil(Math.abs(Math.log10(e))),_=Gt._internal_logicalOffset+i;return{_internal_logicalOffset:_,_internal_coordOffset:1/Math.pow(10,_)}}class ne{constructor(t,e){if(this._private__base=t,this._private__integralDividers=e,function(t){if(t<0)return!1;for(let e=t;e>1;e/=10)if(e%10!=0)return!1;return!0}(this._private__base))this._private__fractionalDividers=[2,2.5,2];else{this._private__fractionalDividers=[];for(let t=this._private__base;1!==t;){if(t%2==0)this._private__fractionalDividers.push(2),t/=2;else{if(t%5!=0)throw new Error("unexpected base");this._private__fractionalDividers.push(2,2.5),t/=5}if(this._private__fractionalDividers.length>100)throw new Error("something wrong with base")}}}_internal_tickSpan(t,e,i){const _=0===this._private__base?0:1/this._private__base;let n=Math.pow(10,Math.max(0,Math.ceil(Math.log10(t-e)))),r=0,a=this._private__integralDividers[0];for(;;){const t=v(n,_,1e-14)&&n>_+1e-14,e=v(n,i*a,1e-14),l=v(n,1,1e-14);if(!(t&&e&&l))break;n/=a,a=this._private__integralDividers[++r%this._private__integralDividers.length]}if(n<=_+1e-14&&(n=_),n=Math.max(1,n),this._private__fractionalDividers.length>0&&(l=n,1,1e-14,Math.abs(l-1)<1e-14))for(r=0,a=this._private__fractionalDividers[0];v(n,i*a,1e-14)&&n>_+1e-14;)n/=a,a=this._private__fractionalDividers[++r%this._private__fractionalDividers.length];var l;return n}}class re{constructor(t,e,i,_){this._private__marks=[],this._private__priceScale=t,this._private__base=e,this._private__coordinateToLogicalFunc=i,this._private__logicalToCoordinateFunc=_}_internal_tickSpan(t,e){if(t<e)throw new Error("high < low");const i=this._private__priceScale._internal_height(),_=(t-e)*this._private__tickMarkHeight()/i,n=new ne(this._private__base,[2,2.5,2]),r=new ne(this._private__base,[2,2,2.5]),a=new ne(this._private__base,[2.5,2,2]),l=[];return l.push(n._internal_tickSpan(t,e,_),r._internal_tickSpan(t,e,_),a._internal_tickSpan(t,e,_)),function(t){if(t.length<1)throw Error("array is empty");let e=t[0];for(let i=1;i<t.length;++i)t[i]<e&&(e=t[i]);return e}(l)}_internal_rebuildTickMarks(){const t=this._private__priceScale,e=t._internal_firstValue();if(null===e)return void(this._private__marks=[]);const i=t._internal_height(),_=this._private__coordinateToLogicalFunc(i-1,e),n=this._private__coordinateToLogicalFunc(0,e),r=this._private__priceScale._internal_options().entireTextOnly?this._private__fontHeight()/2:0,a=r,l=i-1-r,s=Math.max(_,n),o=Math.min(_,n);if(s===o)return void(this._private__marks=[]);let h=this._internal_tickSpan(s,o),p=s%h;p+=p<0?h:0;const c=s>=o?1:-1;let v=null,d=0;for(let i=s-p;i>o;i-=h){const _=this._private__logicalToCoordinateFunc(i,e,!0);null!==v&&Math.abs(_-v)<this._private__tickMarkHeight()||_<a||_>l||(d<this._private__marks.length?(this._private__marks[d]._internal_coord=_,this._private__marks[d]._internal_label=t._internal_formatLogical(i)):this._private__marks.push({_internal_coord:_,_internal_label:t._internal_formatLogical(i)}),d++,v=_,t._internal_isLog()&&(h=this._internal_tickSpan(i*c,o)))}this._private__marks.length=d}_internal_marks(){return this._private__marks}_private__fontHeight(){return this._private__priceScale._internal_fontSize()}_private__tickMarkHeight(){return Math.ceil(2.5*this._private__fontHeight())}}function ae(t){return t.slice().sort(((t,e)=>o(t._internal_zorder())-o(e._internal_zorder())))}const le=new A,se=new I(100,1);class oe{constructor(t,e,i,_){this._private__height=0,this._private__internalHeightCache=null,this._private__priceRange=null,this._private__priceRangeSnapshot=null,this._private__invalidatedForRange={_internal_isValid:!1,_internal_visibleBars:null},this._private__marginAbove=0,this._private__marginBelow=0,this._private__onMarksChanged=new Mt,this._private__modeChanged=new Mt,this._private__dataSources=[],this._private__cachedOrderedSources=null,this._private__marksCache=null,this._private__scaleStartPoint=null,this._private__scrollStartPoint=null,this._private__formatter=se,this._private__logFormula=_e(null),this._private__id=t,this._private__options=e,this._private__layoutOptions=i,this._private__localizationOptions=_,this._private__markBuilder=new re(this,100,this._private__coordinateToLogical.bind(this),this._private__logicalToCoordinate.bind(this))}_internal_id(){return this._private__id}_internal_options(){return this._private__options}_internal_applyOptions(t){if(p(this._private__options,t),this._internal_updateFormatter(),void 0!==t.mode&&this._internal_setMode({_internal_mode:t.mode}),void 0!==t.scaleMargins){const e=s(t.scaleMargins.top),i=s(t.scaleMargins.bottom);if(e<0||e>1)throw new Error(`Invalid top margin - expect value between 0 and 1, given=${e}`);if(i<0||i>1)throw new Error(`Invalid bottom margin - expect value between 0 and 1, given=${i}`);if(e+i>1)throw new Error(`Invalid margins - sum of margins must be less than 1, given=${e+i}`);this._private__invalidateInternalHeightCache(),this._private__marksCache=null}}_internal_isAutoScale(){return this._private__options.autoScale}_internal_isLog(){return 1===this._private__options.mode}_internal_isPercentage(){return 2===this._private__options.mode}_internal_isIndexedTo100(){return 3===this._private__options.mode}_internal_mode(){return{_internal_autoScale:this._private__options.autoScale,_internal_isInverted:this._private__options.invertScale,_internal_mode:this._private__options.mode}}_internal_setMode(t){const e=this._internal_mode();let i=null;void 0!==t._internal_autoScale&&(this._private__options.autoScale=t._internal_autoScale),void 0!==t._internal_mode&&(this._private__options.mode=t._internal_mode,2!==t._internal_mode&&3!==t._internal_mode||(this._private__options.autoScale=!0),this._private__invalidatedForRange._internal_isValid=!1),1===e._internal_mode&&t._internal_mode!==e._internal_mode&&(function(t,e){if(null===t)return!1;const i=te(t._internal_minValue(),e),_=te(t._internal_maxValue(),e);return isFinite(i)&&isFinite(_)}(this._private__priceRange,this._private__logFormula)?(i=ie(this._private__priceRange,this._private__logFormula),null!==i&&this._internal_setPriceRange(i)):this._private__options.autoScale=!0),1===t._internal_mode&&t._internal_mode!==e._internal_mode&&(i=ee(this._private__priceRange,this._private__logFormula),null!==i&&this._internal_setPriceRange(i));const _=e._internal_mode!==this._private__options.mode;_&&(2===e._internal_mode||this._internal_isPercentage())&&this._internal_updateFormatter(),_&&(3===e._internal_mode||this._internal_isIndexedTo100())&&this._internal_updateFormatter(),void 0!==t._internal_isInverted&&e._internal_isInverted!==t._internal_isInverted&&(this._private__options.invertScale=t._internal_isInverted,this._private__onIsInvertedChanged()),this._private__modeChanged._internal_fire(e,this._internal_mode())}_internal_modeChanged(){return this._private__modeChanged}_internal_fontSize(){return this._private__layoutOptions.fontSize}_internal_height(){return this._private__height}_internal_setHeight(t){this._private__height!==t&&(this._private__height=t,this._private__invalidateInternalHeightCache(),this._private__marksCache=null)}_internal_internalHeight(){if(this._private__internalHeightCache)return this._private__internalHeightCache;const t=this._internal_height()-this._private__topMarginPx()-this._private__bottomMarginPx();return this._private__internalHeightCache=t,t}_internal_priceRange(){return this._private__makeSureItIsValid(),this._private__priceRange}_internal_setPriceRange(t,e){const i=this._private__priceRange;(e||null===i&&null!==t||null!==i&&!i._internal_equals(t))&&(this._private__marksCache=null,this._private__priceRange=t)}_internal_isEmpty(){return this._private__makeSureItIsValid(),0===this._private__height||!this._private__priceRange||this._private__priceRange._internal_isEmpty()}_internal_invertedCoordinate(t){return this._internal_isInverted()?t:this._internal_height()-1-t}_internal_priceToCoordinate(t,e){return this._internal_isPercentage()?t=Kt(t,e):this._internal_isIndexedTo100()&&(t=qt(t,e)),this._private__logicalToCoordinate(t,e)}_internal_pointsArrayToCoordinates(t,e,i){this._private__makeSureItIsValid();const _=this._private__bottomMarginPx(),n=o(this._internal_priceRange()),r=n._internal_minValue(),a=n._internal_maxValue(),l=this._internal_internalHeight()-1,s=this._internal_isInverted(),h=l/(a-r),p=void 0===i?0:i.from,c=void 0===i?t.length:i.to,v=this._private__getCoordinateTransformer();for(let i=p;i<c;i++){const n=t[i],a=n._internal_price;if(isNaN(a))continue;let l=a;null!==v&&(l=v(n._internal_price,e));const o=_+h*(l-r);n._internal_y=s?o:this._private__height-1-o}}_internal_barPricesToCoordinates(t,e,i){this._private__makeSureItIsValid();const _=this._private__bottomMarginPx(),n=o(this._internal_priceRange()),r=n._internal_minValue(),a=n._internal_maxValue(),l=this._internal_internalHeight()-1,s=this._internal_isInverted(),h=l/(a-r),p=void 0===i?0:i.from,c=void 0===i?t.length:i.to,v=this._private__getCoordinateTransformer();for(let i=p;i<c;i++){const n=t[i];let a=n._internal_open,l=n._internal_high,o=n._internal_low,p=n._internal_close;null!==v&&(a=v(n._internal_open,e),l=v(n._internal_high,e),o=v(n._internal_low,e),p=v(n._internal_close,e));let c=_+h*(a-r),d=s?c:this._private__height-1-c;n._internal_openY=d,c=_+h*(l-r),d=s?c:this._private__height-1-c,n._internal_highY=d,c=_+h*(o-r),d=s?c:this._private__height-1-c,n._internal_lowY=d,c=_+h*(p-r),d=s?c:this._private__height-1-c,n._internal_closeY=d}}_internal_coordinateToPrice(t,e){const i=this._private__coordinateToLogical(t,e);return this._internal_logicalToPrice(i,e)}_internal_logicalToPrice(t,e){let i=t;return this._internal_isPercentage()?i=function(t,e){return e<0&&(t=-t),t/100*e+e}(i,e):this._internal_isIndexedTo100()&&(i=function(t,e){return t-=100,e<0&&(t=-t),t/100*e+e}(i,e)),i}_internal_dataSources(){return this._private__dataSources}_internal_orderedSources(){if(this._private__cachedOrderedSources)return this._private__cachedOrderedSources;let t=[];for(let e=0;e<this._private__dataSources.length;e++){const i=this._private__dataSources[e];null===i._internal_zorder()&&i._internal_setZorder(e+1),t.push(i)}return t=ae(t),this._private__cachedOrderedSources=t,this._private__cachedOrderedSources}_internal_addDataSource(t){-1===this._private__dataSources.indexOf(t)&&(this._private__dataSources.push(t),this._internal_updateFormatter(),this._internal_invalidateSourcesCache())}_internal_removeDataSource(t){const e=this._private__dataSources.indexOf(t);if(-1===e)throw new Error("source is not attached to scale");this._private__dataSources.splice(e,1),0===this._private__dataSources.length&&(this._internal_setMode({_internal_autoScale:!0}),this._internal_setPriceRange(null)),this._internal_updateFormatter(),this._internal_invalidateSourcesCache()}_internal_firstValue(){let t=null;for(const e of this._private__dataSources){const i=e._internal_firstValue();null!==i&&(null===t||i._internal_timePoint<t._internal_timePoint)&&(t=i)}return null===t?null:t._internal_value}_internal_isInverted(){return this._private__options.invertScale}_internal_marks(){const t=null===this._internal_firstValue();if(null!==this._private__marksCache&&(t||this._private__marksCache._internal_firstValueIsNull===t))return this._private__marksCache._internal_marks;this._private__markBuilder._internal_rebuildTickMarks();const e=this._private__markBuilder._internal_marks();return this._private__marksCache={_internal_marks:e,_internal_firstValueIsNull:t},this._private__onMarksChanged._internal_fire(),e}_internal_onMarksChanged(){return this._private__onMarksChanged}_internal_startScale(t){this._internal_isPercentage()||this._internal_isIndexedTo100()||null===this._private__scaleStartPoint&&null===this._private__priceRangeSnapshot&&(this._internal_isEmpty()||(this._private__scaleStartPoint=this._private__height-t,this._private__priceRangeSnapshot=o(this._internal_priceRange())._internal_clone()))}_internal_scaleTo(t){if(this._internal_isPercentage()||this._internal_isIndexedTo100())return;if(null===this._private__scaleStartPoint)return;this._internal_setMode({_internal_autoScale:!1}),(t=this._private__height-t)<0&&(t=0);let e=(this._private__scaleStartPoint+.2*(this._private__height-1))/(t+.2*(this._private__height-1));const i=o(this._private__priceRangeSnapshot)._internal_clone();e=Math.max(e,.1),i._internal_scaleAroundCenter(e),this._internal_setPriceRange(i)}_internal_endScale(){this._internal_isPercentage()||this._internal_isIndexedTo100()||(this._private__scaleStartPoint=null,this._private__priceRangeSnapshot=null)}_internal_startScroll(t){this._internal_isAutoScale()||null===this._private__scrollStartPoint&&null===this._private__priceRangeSnapshot&&(this._internal_isEmpty()||(this._private__scrollStartPoint=t,this._private__priceRangeSnapshot=o(this._internal_priceRange())._internal_clone()))}_internal_scrollTo(t){if(this._internal_isAutoScale())return;if(null===this._private__scrollStartPoint)return;const e=o(this._internal_priceRange())._internal_length()/(this._internal_internalHeight()-1);let i=t-this._private__scrollStartPoint;this._internal_isInverted()&&(i*=-1);const _=i*e,n=o(this._private__priceRangeSnapshot)._internal_clone();n._internal_shift(_),this._internal_setPriceRange(n,!0),this._private__marksCache=null}_internal_endScroll(){this._internal_isAutoScale()||null!==this._private__scrollStartPoint&&(this._private__scrollStartPoint=null,this._private__priceRangeSnapshot=null)}_internal_formatter(){return this._private__formatter||this._internal_updateFormatter(),this._private__formatter}_internal_formatPrice(t,e){switch(this._private__options.mode){case 2:return this._private__formatPercentage(Kt(t,e));case 3:return this._internal_formatter().format(qt(t,e));default:return this._private__formatPrice(t)}}_internal_formatLogical(t){switch(this._private__options.mode){case 2:return this._private__formatPercentage(t);case 3:return this._internal_formatter().format(t);default:return this._private__formatPrice(t)}}_internal_formatPriceAbsolute(t){return this._private__formatPrice(t,o(this._private__formatterSource())._internal_formatter())}_internal_formatPricePercentage(t,e){return t=Kt(t,e),this._private__formatPercentage(t,le)}_internal_sourcesForAutoScale(){return this._private__dataSources}_internal_recalculatePriceRange(t){this._private__invalidatedForRange={_internal_visibleBars:t,_internal_isValid:!1}}_internal_updateAllViews(){this._private__dataSources.forEach((t=>t._internal_updateAllViews()))}_internal_updateFormatter(){this._private__marksCache=null;const t=this._private__formatterSource();let e=100;null!==t&&(e=Math.round(1/t._internal_minMove())),this._private__formatter=se,this._internal_isPercentage()?(this._private__formatter=le,e=100):this._internal_isIndexedTo100()?(this._private__formatter=new I(100,1),e=100):null!==t&&(this._private__formatter=t._internal_formatter()),this._private__markBuilder=new re(this,e,this._private__coordinateToLogical.bind(this),this._private__logicalToCoordinate.bind(this)),this._private__markBuilder._internal_rebuildTickMarks()}_internal_invalidateSourcesCache(){this._private__cachedOrderedSources=null}_private__formatterSource(){return this._private__dataSources[0]||null}_private__topMarginPx(){return this._internal_isInverted()?this._private__options.scaleMargins.bottom*this._internal_height()+this._private__marginBelow:this._private__options.scaleMargins.top*this._internal_height()+this._private__marginAbove}_private__bottomMarginPx(){return this._internal_isInverted()?this._private__options.scaleMargins.top*this._internal_height()+this._private__marginAbove:this._private__options.scaleMargins.bottom*this._internal_height()+this._private__marginBelow}_private__makeSureItIsValid(){this._private__invalidatedForRange._internal_isValid||(this._private__invalidatedForRange._internal_isValid=!0,this._private__recalculatePriceRangeImpl())}_private__invalidateInternalHeightCache(){this._private__internalHeightCache=null}_private__logicalToCoordinate(t,e){if(this._private__makeSureItIsValid(),this._internal_isEmpty())return 0;t=this._internal_isLog()&&t?Jt(t,this._private__logFormula):t;const i=o(this._internal_priceRange()),_=this._private__bottomMarginPx()+(this._internal_internalHeight()-1)*(t-i._internal_minValue())/i._internal_length();return this._internal_invertedCoordinate(_)}_private__coordinateToLogical(t,e){if(this._private__makeSureItIsValid(),this._internal_isEmpty())return 0;const i=this._internal_invertedCoordinate(t),_=o(this._internal_priceRange()),n=_._internal_minValue()+_._internal_length()*((i-this._private__bottomMarginPx())/(this._internal_internalHeight()-1));return this._internal_isLog()?te(n,this._private__logFormula):n}_private__onIsInvertedChanged(){this._private__marksCache=null,this._private__markBuilder._internal_rebuildTickMarks()}_private__recalculatePriceRangeImpl(){const t=this._private__invalidatedForRange._internal_visibleBars;if(null===t)return;let e=null;const i=this._internal_sourcesForAutoScale();let _=0,n=0;for(const r of i){if(!r._internal_visible())continue;const i=r._internal_firstValue();if(null===i)continue;const a=r._internal_autoscaleInfo(t._internal_left(),t._internal_right());let l=a&&a._internal_priceRange();if(null!==l){switch(this._private__options.mode){case 1:l=ee(l,this._private__logFormula);break;case 2:l=Zt(l,i._internal_value);break;case 3:l=Qt(l,i._internal_value)}if(e=null===e?l:e._internal_merge(o(l)),null!==a){const t=a._internal_margins();null!==t&&(_=Math.max(_,t.above),n=Math.max(_,t.below))}}}if(_===this._private__marginAbove&&n===this._private__marginBelow||(this._private__marginAbove=_,this._private__marginBelow=n,this._private__marksCache=null,this._private__invalidateInternalHeightCache()),null!==e){if(e._internal_minValue()===e._internal_maxValue()){const t=this._private__formatterSource(),i=5*(null===t||this._internal_isPercentage()||this._internal_isIndexedTo100()?1:t._internal_minMove());this._internal_isLog()&&(e=ie(e,this._private__logFormula)),e=new Bt(e._internal_minValue()-i,e._internal_maxValue()+i),this._internal_isLog()&&(e=ee(e,this._private__logFormula))}if(this._internal_isLog()){const t=ie(e,this._private__logFormula),i=_e(t);if(r=i,a=this._private__logFormula,r._internal_logicalOffset!==a._internal_logicalOffset||r._internal_coordOffset!==a._internal_coordOffset){const _=null!==this._private__priceRangeSnapshot?ie(this._private__priceRangeSnapshot,this._private__logFormula):null;this._private__logFormula=i,e=ee(t,i),null!==_&&(this._private__priceRangeSnapshot=ee(_,i))}}this._internal_setPriceRange(e)}else null===this._private__priceRange&&(this._internal_setPriceRange(new Bt(-.5,.5)),this._private__logFormula=_e(null));var r,a;this._private__invalidatedForRange._internal_isValid=!0}_private__getCoordinateTransformer(){return this._internal_isPercentage()?Kt:this._internal_isIndexedTo100()?qt:this._internal_isLog()?t=>Jt(t,this._private__logFormula):null}_private__formatValue(t,e,i){return void 0===e?(void 0===i&&(i=this._internal_formatter()),i.format(t)):e(t)}_private__formatPrice(t,e){return this._private__formatValue(t,this._private__localizationOptions.priceFormatter,e)}_private__formatPercentage(t,e){return this._private__formatValue(t,this._private__localizationOptions.percentageFormatter,e)}}class he{constructor(t,e){this._private__dataSources=[],this._private__overlaySourcesByScaleId=new Map,this._private__height=0,this._private__width=0,this._private__stretchFactor=1e3,this._private__cachedOrderedSources=null,this._private__destroyed=new Mt,this._private__timeScale=t,this._private__model=e,this._private__grid=new Xt(this);const i=e._internal_options();this._private__leftPriceScale=this._private__createPriceScale("left",i.leftPriceScale),this._private__rightPriceScale=this._private__createPriceScale("right",i.rightPriceScale),this._private__leftPriceScale._internal_modeChanged()._internal_subscribe(this._private__onPriceScaleModeChanged.bind(this,this._private__leftPriceScale),this),this._private__rightPriceScale._internal_modeChanged()._internal_subscribe(this._private__onPriceScaleModeChanged.bind(this,this._private__rightPriceScale),this),this._internal_applyScaleOptions(i)}_internal_applyScaleOptions(t){if(t.leftPriceScale&&this._private__leftPriceScale._internal_applyOptions(t.leftPriceScale),t.rightPriceScale&&this._private__rightPriceScale._internal_applyOptions(t.rightPriceScale),t.localization&&(this._private__leftPriceScale._internal_updateFormatter(),this._private__rightPriceScale._internal_updateFormatter()),t.overlayPriceScales){const e=Array.from(this._private__overlaySourcesByScaleId.values());for(const i of e){const e=o(i[0]._internal_priceScale());e._internal_applyOptions(t.overlayPriceScales),t.localization&&e._internal_updateFormatter()}}}_internal_priceScaleById(t){switch(t){case"left":return this._private__leftPriceScale;case"right":return this._private__rightPriceScale}return this._private__overlaySourcesByScaleId.has(t)?s(this._private__overlaySourcesByScaleId.get(t))[0]._internal_priceScale():null}_internal_destroy(){this._internal_model()._internal_priceScalesOptionsChanged()._internal_unsubscribeAll(this),this._private__leftPriceScale._internal_modeChanged()._internal_unsubscribeAll(this),this._private__rightPriceScale._internal_modeChanged()._internal_unsubscribeAll(this),this._private__dataSources.forEach((t=>{t._internal_destroy&&t._internal_destroy()})),this._private__destroyed._internal_fire()}_internal_stretchFactor(){return this._private__stretchFactor}_internal_setStretchFactor(t){this._private__stretchFactor=t}_internal_model(){return this._private__model}_internal_width(){return this._private__width}_internal_height(){return this._private__height}_internal_setWidth(t){this._private__width=t,this._internal_updateAllSources()}_internal_setHeight(t){this._private__height=t,this._private__leftPriceScale._internal_setHeight(t),this._private__rightPriceScale._internal_setHeight(t),this._private__dataSources.forEach((e=>{if(this._internal_isOverlay(e)){const i=e._internal_priceScale();null!==i&&i._internal_setHeight(t)}})),this._internal_updateAllSources()}_internal_dataSources(){return this._private__dataSources}_internal_isOverlay(t){const e=t._internal_priceScale();return null===e||this._private__leftPriceScale!==e&&this._private__rightPriceScale!==e}_internal_addDataSource(t,e,i){const _=void 0!==i?i:this._private__getZOrderMinMax()._internal_maxZOrder+1;this._private__insertDataSource(t,e,_)}_internal_removeDataSource(t){const e=this._private__dataSources.indexOf(t);l(-1!==e,"removeDataSource: invalid data source"),this._private__dataSources.splice(e,1);const i=o(t._internal_priceScale())._internal_id();if(this._private__overlaySourcesByScaleId.has(i)){const e=s(this._private__overlaySourcesByScaleId.get(i)),_=e.indexOf(t);-1!==_&&(e.splice(_,1),0===e.length&&this._private__overlaySourcesByScaleId.delete(i))}const _=t._internal_priceScale();_&&_._internal_dataSources().indexOf(t)>=0&&_._internal_removeDataSource(t),null!==_&&(_._internal_invalidateSourcesCache(),this._internal_recalculatePriceScale(_)),this._private__cachedOrderedSources=null}_internal_priceScalePosition(t){return t===this._private__leftPriceScale?"left":t===this._private__rightPriceScale?"right":"overlay"}_internal_leftPriceScale(){return this._private__leftPriceScale}_internal_rightPriceScale(){return this._private__rightPriceScale}_internal_startScalePrice(t,e){t._internal_startScale(e)}_internal_scalePriceTo(t,e){t._internal_scaleTo(e),this._internal_updateAllSources()}_internal_endScalePrice(t){t._internal_endScale()}_internal_startScrollPrice(t,e){t._internal_startScroll(e)}_internal_scrollPriceTo(t,e){t._internal_scrollTo(e),this._internal_updateAllSources()}_internal_endScrollPrice(t){t._internal_endScroll()}_internal_updateAllSources(){this._private__dataSources.forEach((t=>{t._internal_updateAllViews()}))}_internal_defaultPriceScale(){let t=null;return this._private__model._internal_options().rightPriceScale.visible&&0!==this._private__rightPriceScale._internal_dataSources().length?t=this._private__rightPriceScale:this._private__model._internal_options().leftPriceScale.visible&&0!==this._private__leftPriceScale._internal_dataSources().length?t=this._private__leftPriceScale:0!==this._private__dataSources.length&&(t=this._private__dataSources[0]._internal_priceScale()),null===t&&(t=this._private__rightPriceScale),t}_internal_defaultVisiblePriceScale(){let t=null;return this._private__model._internal_options().rightPriceScale.visible?t=this._private__rightPriceScale:this._private__model._internal_options().leftPriceScale.visible&&(t=this._private__leftPriceScale),t}_internal_recalculatePriceScale(t){null!==t&&t._internal_isAutoScale()&&this._private__recalculatePriceScaleImpl(t)}_internal_resetPriceScale(t){const e=this._private__timeScale._internal_visibleStrictRange();t._internal_setMode({_internal_autoScale:!0}),null!==e&&t._internal_recalculatePriceRange(e),this._internal_updateAllSources()}_internal_momentaryAutoScale(){this._private__recalculatePriceScaleImpl(this._private__leftPriceScale),this._private__recalculatePriceScaleImpl(this._private__rightPriceScale)}_internal_recalculate(){this._internal_recalculatePriceScale(this._private__leftPriceScale),this._internal_recalculatePriceScale(this._private__rightPriceScale),this._private__dataSources.forEach((t=>{this._internal_isOverlay(t)&&this._internal_recalculatePriceScale(t._internal_priceScale())})),this._internal_updateAllSources(),this._private__model._internal_lightUpdate()}_internal_orderedSources(){return null===this._private__cachedOrderedSources&&(this._private__cachedOrderedSources=ae(this._private__dataSources)),this._private__cachedOrderedSources}_internal_onDestroyed(){return this._private__destroyed}_internal_grid(){return this._private__grid}_private__recalculatePriceScaleImpl(t){const e=t._internal_sourcesForAutoScale();if(e&&e.length>0&&!this._private__timeScale._internal_isEmpty()){const e=this._private__timeScale._internal_visibleStrictRange();null!==e&&t._internal_recalculatePriceRange(e)}t._internal_updateAllViews()}_private__getZOrderMinMax(){const t=this._internal_orderedSources();if(0===t.length)return{_internal_minZOrder:0,_internal_maxZOrder:0};let e=0,i=0;for(let _=0;_<t.length;_++){const n=t[_]._internal_zorder();null!==n&&(n<e&&(e=n),n>i&&(i=n))}return{_internal_minZOrder:e,_internal_maxZOrder:i}}_private__insertDataSource(t,e,i){let _=this._internal_priceScaleById(e);if(null===_&&(_=this._private__createPriceScale(e,this._private__model._internal_options().overlayPriceScales)),this._private__dataSources.push(t),!zt(e)){const i=this._private__overlaySourcesByScaleId.get(e)||[];i.push(t),this._private__overlaySourcesByScaleId.set(e,i)}_._internal_addDataSource(t),t._internal_setPriceScale(_),t._internal_setZorder(i),this._internal_recalculatePriceScale(_),this._private__cachedOrderedSources=null}_private__onPriceScaleModeChanged(t,e,i){e._internal_mode!==i._internal_mode&&this._private__recalculatePriceScaleImpl(t)}_private__createPriceScale(t,e){const i=Object.assign({visible:!0,autoScale:!0},n(e)),_=new oe(t,i,this._private__model._internal_options().layout,this._private__model._internal_options().localization);return _._internal_setHeight(this._internal_height()),_}}class pe{constructor(t,e,i=50){this._private__actualSize=0,this._private__usageTick=1,this._private__oldestTick=1,this._private__cache=new Map,this._private__tick2Labels=new Map,this._private__format=t,this._private__horzScaleBehavior=e,this._private__maxSize=i}_internal_format(t){const e=t.time,i=this._private__horzScaleBehavior.cacheKey(e),_=this._private__cache.get(i);if(void 0!==_)return _._internal_string;if(this._private__actualSize===this._private__maxSize){const t=this._private__tick2Labels.get(this._private__oldestTick);this._private__tick2Labels.delete(this._private__oldestTick),this._private__cache.delete(s(t)),this._private__oldestTick++,this._private__actualSize--}const n=this._private__format(t);return this._private__cache.set(i,{_internal_string:n,_internal_tick:this._private__usageTick}),this._private__tick2Labels.set(this._private__usageTick,i),this._private__actualSize++,this._private__usageTick++,n}}class ce{constructor(t,e){l(t<=e,"right should be >= left"),this._private__left=t,this._private__right=e}_internal_left(){return this._private__left}_internal_right(){return this._private__right}_internal_count(){return this._private__right-this._private__left+1}_internal_contains(t){return this._private__left<=t&&t<=this._private__right}_internal_equals(t){return this._private__left===t._internal_left()&&this._private__right===t._internal_right()}}class ve{constructor(){this._private__marksByWeight=new Map,this._private__cache=null,this._private__uniformDistribution=!1}_internal_setUniformDistribution(t){this._private__uniformDistribution=t,this._private__cache=null}_internal_setTimeScalePoints(t,e){this._private__removeMarksSinceIndex(e),this._private__cache=null;for(let i=e;i<t.length;++i){const e=t[i];let _=this._private__marksByWeight.get(e.timeWeight);void 0===_&&(_=[],this._private__marksByWeight.set(e.timeWeight,_)),_.push({index:i,time:e.time,weight:e.timeWeight,originalTime:e.originalTime})}}_internal_build(t,e){const i=Math.ceil(e/t);return null!==this._private__cache&&this._private__cache._internal_maxIndexesPerMark===i||(this._private__cache={_internal_marks:this._private__buildMarksImpl(i),_internal_maxIndexesPerMark:i}),this._private__cache._internal_marks}_private__removeMarksSinceIndex(t){if(0===t)return void this._private__marksByWeight.clear();const e=[];this._private__marksByWeight.forEach(((i,_)=>{t<=i[0].index?e.push(_):i.splice(et(i,t,(e=>e.index<t)),1/0)}));for(const t of e)this._private__marksByWeight.delete(t)}_private__buildMarksImpl(t){let e=[];for(const i of Array.from(this._private__marksByWeight.keys()).sort(((t,e)=>e-t))){if(!this._private__marksByWeight.get(i))continue;const _=e;e=[];const n=_.length;let r=0;const a=s(this._private__marksByWeight.get(i)),l=a.length;let o=1/0,h=-1/0;for(let i=0;i<l;i++){const l=a[i],s=l.index;for(;r<n;){const t=_[r],i=t.index;if(!(i<s)){o=i;break}r++,e.push(t),h=i,o=1/0}if(o-s>=t&&s-h>=t)e.push(l),h=s;else if(this._private__uniformDistribution)return _}for(;r<n;r++)e.push(_[r])}return e}}class de{constructor(t){this._private__logicalRange=t}_internal_strictRange(){return null===this._private__logicalRange?null:new ce(Math.floor(this._private__logicalRange._internal_left()),Math.ceil(this._private__logicalRange._internal_right()))}_internal_logicalRange(){return this._private__logicalRange}static _internal_invalid(){return new de(null)}}function ue(t,e){return t.weight>e.weight?t:e}class me{constructor(t,e,i,_){this._private__width=0,this._private__baseIndexOrNull=null,this._private__points=[],this._private__scrollStartPoint=null,this._private__scaleStartPoint=null,this._private__tickMarks=new ve,this._private__formattedByWeight=new Map,this._private__visibleRange=de._internal_invalid(),this._private__visibleRangeInvalidated=!0,this._private__visibleBarsChanged=new Mt,this._private__logicalRangeChanged=new Mt,this._private__optionsApplied=new Mt,this._private__commonTransitionStartState=null,this._private__timeMarksCache=null,this._private__labels=[],this._private__options=e,this._private__localizationOptions=i,this._private__rightOffset=e.rightOffset,this._private__barSpacing=e.barSpacing,this._private__model=t,this._private__horzScaleBehavior=_,this._private__updateDateTimeFormatter(),this._private__tickMarks._internal_setUniformDistribution(e.uniformDistribution)}_internal_options(){return this._private__options}_internal_applyLocalizationOptions(t){p(this._private__localizationOptions,t),this._private__invalidateTickMarks(),this._private__updateDateTimeFormatter()}_internal_applyOptions(t,e){var i;p(this._private__options,t),this._private__options.fixLeftEdge&&this._private__doFixLeftEdge(),this._private__options.fixRightEdge&&this._private__doFixRightEdge(),void 0!==t.barSpacing&&this._private__model._internal_setBarSpacing(t.barSpacing),void 0!==t.rightOffset&&this._private__model._internal_setRightOffset(t.rightOffset),void 0!==t.minBarSpacing&&this._private__model._internal_setBarSpacing(null!==(i=t.barSpacing)&&void 0!==i?i:this._private__barSpacing),this._private__invalidateTickMarks(),this._private__updateDateTimeFormatter(),this._private__optionsApplied._internal_fire()}_internal_indexToTime(t){var e,i;return null!==(i=null===(e=this._private__points[t])||void 0===e?void 0:e.time)&&void 0!==i?i:null}_internal_indexToTimeScalePoint(t){var e;return null!==(e=this._private__points[t])&&void 0!==e?e:null}_internal_timeToIndex(t,e){if(this._private__points.length<1)return null;if(this._private__horzScaleBehavior.key(t)>this._private__horzScaleBehavior.key(this._private__points[this._private__points.length-1].time))return e?this._private__points.length-1:null;const i=et(this._private__points,this._private__horzScaleBehavior.key(t),((t,e)=>this._private__horzScaleBehavior.key(t.time)<e));return this._private__horzScaleBehavior.key(t)<this._private__horzScaleBehavior.key(this._private__points[i].time)?e?i:null:i}_internal_isEmpty(){return 0===this._private__width||0===this._private__points.length||null===this._private__baseIndexOrNull}_internal_visibleStrictRange(){return this._private__updateVisibleRange(),this._private__visibleRange._internal_strictRange()}_internal_visibleLogicalRange(){return this._private__updateVisibleRange(),this._private__visibleRange._internal_logicalRange()}_internal_logicalRangeForTimeRange(t){return{from:o(this._internal_timeToIndex(t.from,!0)),to:o(this._internal_timeToIndex(t.to,!0))}}_internal_width(){return this._private__width}_internal_setWidth(t){if(!isFinite(t)||t<=0)return;if(this._private__width===t)return;const e=this._internal_visibleLogicalRange(),i=this._private__width;if(this._private__width=t,this._private__visibleRangeInvalidated=!0,this._private__options.lockVisibleTimeRangeOnResize&&0!==i&&(this._private__barSpacing=this._private__barSpacing*t/i),this._private__options.fixLeftEdge&&null!==e&&e._internal_left()<=0){const e=i-t;this._private__rightOffset-=Math.round(e/this._private__barSpacing)+1,this._private__visibleRangeInvalidated=!0}this._private__correctBarSpacing(),this._private__correctOffset()}_internal_indexToCoordinate(t){if(this._internal_isEmpty()||!e(t))return 0;const i=this._internal_baseIndex()+this._private__rightOffset-t;return this._private__width-(i+.5)*this._private__barSpacing-1}_internal_indexesToCoordinates(t,e){const i=this._internal_baseIndex(),_=void 0===e?0:e.from,n=void 0===e?t.length:e.to;for(let e=_;e<n;e++){const _=t[e]._internal_time,n=i+this._private__rightOffset-_;t[e]._internal_x=this._private__width-(n+.5)*this._private__barSpacing-1}}_internal_coordinateToIndex(t){return Math.ceil(this._private__coordinateToFloatIndex(t))}_internal_setRightOffset(t){this._private__visibleRangeInvalidated=!0,this._private__rightOffset=t,this._private__correctOffset(),this._private__model._internal_recalculateAllPanes(),this._private__model._internal_lightUpdate()}_internal_barSpacing(){return this._private__barSpacing}_internal_setBarSpacing(t){this._private__setBarSpacing(t),this._private__correctOffset(),this._private__model._internal_recalculateAllPanes(),this._private__model._internal_lightUpdate()}_internal_rightOffset(){return this._private__rightOffset}_internal_marks(){if(this._internal_isEmpty())return null;if(null!==this._private__timeMarksCache)return this._private__timeMarksCache;const t=this._private__barSpacing,e=5*(this._private__model._internal_options().layout.fontSize+4)/8*(this._private__options.tickMarkMaxCharacterLength||8),i=Math.round(e/t),_=o(this._internal_visibleStrictRange()),n=Math.max(_._internal_left(),_._internal_left()-i),r=Math.max(_._internal_right(),_._internal_right()-i),a=this._private__tickMarks._internal_build(t,e),l=this._private__firstIndex()+i,s=this._private__lastIndex()-i,h=this._private__isAllScalingAndScrollingDisabled(),p=this._private__options.fixLeftEdge||h,c=this._private__options.fixRightEdge||h;let v=0;for(const t of a){if(!(n<=t.index&&t.index<=r))continue;let i;v<this._private__labels.length?(i=this._private__labels[v],i.coord=this._internal_indexToCoordinate(t.index),i.label=this._private__formatLabel(t),i.weight=t.weight):(i={needAlignCoordinate:!1,coord:this._internal_indexToCoordinate(t.index),label:this._private__formatLabel(t),weight:t.weight},this._private__labels.push(i)),this._private__barSpacing>e/2&&!h?i.needAlignCoordinate=!1:i.needAlignCoordinate=p&&t.index<=l||c&&t.index>=s,v++}return this._private__labels.length=v,this._private__timeMarksCache=this._private__labels,this._private__labels}_internal_restoreDefault(){this._private__visibleRangeInvalidated=!0,this._internal_setBarSpacing(this._private__options.barSpacing),this._internal_setRightOffset(this._private__options.rightOffset)}_internal_setBaseIndex(t){this._private__visibleRangeInvalidated=!0,this._private__baseIndexOrNull=t,this._private__correctOffset(),this._private__doFixLeftEdge()}_internal_zoom(t,e){const i=this._private__coordinateToFloatIndex(t),_=this._internal_barSpacing(),n=_+e*(_/10);this._internal_setBarSpacing(n),this._private__options.rightBarStaysOnScroll||this._internal_setRightOffset(this._internal_rightOffset()+(i-this._private__coordinateToFloatIndex(t)))}_internal_startScale(t){this._private__scrollStartPoint&&this._internal_endScroll(),null===this._private__scaleStartPoint&&null===this._private__commonTransitionStartState&&(this._internal_isEmpty()||(this._private__scaleStartPoint=t,this._private__saveCommonTransitionsStartState()))}_internal_scaleTo(t){if(null===this._private__commonTransitionStartState)return;const e=c(this._private__width-t,0,this._private__width),i=c(this._private__width-o(this._private__scaleStartPoint),0,this._private__width);0!==e&&0!==i&&this._internal_setBarSpacing(this._private__commonTransitionStartState._internal_barSpacing*e/i)}_internal_endScale(){null!==this._private__scaleStartPoint&&(this._private__scaleStartPoint=null,this._private__clearCommonTransitionsStartState())}_internal_startScroll(t){null===this._private__scrollStartPoint&&null===this._private__commonTransitionStartState&&(this._internal_isEmpty()||(this._private__scrollStartPoint=t,this._private__saveCommonTransitionsStartState()))}_internal_scrollTo(t){if(null===this._private__scrollStartPoint)return;const e=(this._private__scrollStartPoint-t)/this._internal_barSpacing();this._private__rightOffset=o(this._private__commonTransitionStartState)._internal_rightOffset+e,this._private__visibleRangeInvalidated=!0,this._private__correctOffset()}_internal_endScroll(){null!==this._private__scrollStartPoint&&(this._private__scrollStartPoint=null,this._private__clearCommonTransitionsStartState())}_internal_scrollToRealTime(){this._internal_scrollToOffsetAnimated(this._private__options.rightOffset)}_internal_scrollToOffsetAnimated(t,e=400){if(!isFinite(t))throw new RangeError("offset is required and must be finite number");if(!isFinite(e)||e<=0)throw new RangeError("animationDuration (optional) must be finite positive number");const i=this._private__rightOffset,_=performance.now();this._private__model._internal_setTimeScaleAnimation({_internal_finished:t=>(t-_)/e>=1,_internal_getPosition:n=>{const r=(n-_)/e;return r>=1?t:i+(t-i)*r}})}_internal_update(t,e){this._private__visibleRangeInvalidated=!0,this._private__points=t,this._private__tickMarks._internal_setTimeScalePoints(t,e),this._private__correctOffset()}_internal_optionsApplied(){return this._private__optionsApplied}_internal_baseIndex(){return this._private__baseIndexOrNull||0}_internal_setVisibleRange(t){const e=t._internal_count();this._private__setBarSpacing(this._private__width/e),this._private__rightOffset=t._internal_right()-this._internal_baseIndex(),this._private__correctOffset(),this._private__visibleRangeInvalidated=!0,this._private__model._internal_recalculateAllPanes(),this._private__model._internal_lightUpdate()}_internal_fitContent(){const t=this._private__firstIndex(),e=this._private__lastIndex();null!==t&&null!==e&&this._internal_setVisibleRange(new ce(t,e+this._private__options.rightOffset))}_internal_setLogicalRange(t){const e=new ce(t.from,t.to);this._internal_setVisibleRange(e)}_internal_formatDateTime(t){return void 0!==this._private__localizationOptions.timeFormatter?this._private__localizationOptions.timeFormatter(t.originalTime):this._private__horzScaleBehavior.formatHorzItem(t.time)}_private__isAllScalingAndScrollingDisabled(){const{handleScroll:t,handleScale:e}=this._private__model._internal_options();return!(t.horzTouchDrag||t.mouseWheel||t.pressedMouseMove||t.vertTouchDrag||e.axisDoubleClickReset.time||e.axisPressedMouseMove.time||e.mouseWheel||e.pinch)}_private__firstIndex(){return 0===this._private__points.length?null:0}_private__lastIndex(){return 0===this._private__points.length?null:this._private__points.length-1}_private__rightOffsetForCoordinate(t){return(this._private__width-1-t)/this._private__barSpacing}_private__coordinateToFloatIndex(t){const e=this._private__rightOffsetForCoordinate(t),i=this._internal_baseIndex()+this._private__rightOffset-e;return Math.round(1e6*i)/1e6}_private__setBarSpacing(t){const e=this._private__barSpacing;this._private__barSpacing=t,this._private__correctBarSpacing(),e!==this._private__barSpacing&&(this._private__visibleRangeInvalidated=!0,this._private__resetTimeMarksCache())}_private__updateVisibleRange(){if(!this._private__visibleRangeInvalidated)return;if(this._private__visibleRangeInvalidated=!1,this._internal_isEmpty())return void this._private__setVisibleRange(de._internal_invalid());const t=this._internal_baseIndex(),e=this._private__width/this._private__barSpacing,i=this._private__rightOffset+t,_=new ce(i-e+1,i);this._private__setVisibleRange(new de(_))}_private__correctBarSpacing(){const t=this._private__minBarSpacing();if(this._private__barSpacing<t&&(this._private__barSpacing=t,this._private__visibleRangeInvalidated=!0),0!==this._private__width){const t=.5*this._private__width;this._private__barSpacing>t&&(this._private__barSpacing=t,this._private__visibleRangeInvalidated=!0)}}_private__minBarSpacing(){return this._private__options.fixLeftEdge&&this._private__options.fixRightEdge&&0!==this._private__points.length?this._private__width/this._private__points.length:this._private__options.minBarSpacing}_private__correctOffset(){const t=this._private__maxRightOffset();this._private__rightOffset>t&&(this._private__rightOffset=t,this._private__visibleRangeInvalidated=!0);const e=this._private__minRightOffset();null!==e&&this._private__rightOffset<e&&(this._private__rightOffset=e,this._private__visibleRangeInvalidated=!0)}_private__minRightOffset(){const t=this._private__firstIndex(),e=this._private__baseIndexOrNull;return null===t||null===e?null:t-e-1+(this._private__options.fixLeftEdge?this._private__width/this._private__barSpacing:Math.min(2,this._private__points.length))}_private__maxRightOffset(){return this._private__options.fixRightEdge?0:this._private__width/this._private__barSpacing-Math.min(2,this._private__points.length)}_private__saveCommonTransitionsStartState(){this._private__commonTransitionStartState={_internal_barSpacing:this._internal_barSpacing(),_internal_rightOffset:this._internal_rightOffset()}}_private__clearCommonTransitionsStartState(){this._private__commonTransitionStartState=null}_private__formatLabel(t){let e=this._private__formattedByWeight.get(t.weight);return void 0===e&&(e=new pe((t=>this._private__formatLabelImpl(t)),this._private__horzScaleBehavior),this._private__formattedByWeight.set(t.weight,e)),e._internal_format(t)}_private__formatLabelImpl(t){return this._private__horzScaleBehavior.formatTickmark(t,this._private__localizationOptions)}_private__setVisibleRange(t){const e=this._private__visibleRange;this._private__visibleRange=t,d(e._internal_strictRange(),this._private__visibleRange._internal_strictRange())||this._private__visibleBarsChanged._internal_fire(),d(e._internal_logicalRange(),this._private__visibleRange._internal_logicalRange())||this._private__logicalRangeChanged._internal_fire(),this._private__resetTimeMarksCache()}_private__resetTimeMarksCache(){this._private__timeMarksCache=null}_private__invalidateTickMarks(){this._private__resetTimeMarksCache(),this._private__formattedByWeight.clear()}_private__updateDateTimeFormatter(){this._private__horzScaleBehavior.updateFormatter(this._private__localizationOptions)}_private__doFixLeftEdge(){if(!this._private__options.fixLeftEdge)return;const t=this._private__firstIndex();if(null===t)return;const e=this._internal_visibleStrictRange();if(null===e)return;const i=e._internal_left()-t;if(i<0){const t=this._private__rightOffset-i-1;this._internal_setRightOffset(t)}this._private__correctBarSpacing()}_private__doFixRightEdge(){this._private__correctOffset(),this._private__correctBarSpacing()}}class ge{_internal_draw(t,e,i){t.useMediaCoordinateSpace((t=>this._internal__drawImpl(t,e,i)))}_internal_drawBackground(t,e,i){t.useMediaCoordinateSpace((t=>this._internal__drawBackgroundImpl(t,e,i)))}_internal__drawBackgroundImpl(t,e,i){}}class fe extends ge{constructor(t){super(),this._private__metricsCache=new Map,this._private__data=t}_internal__drawImpl(t){}_internal__drawBackgroundImpl(t){if(!this._private__data._internal_visible)return;const{context:e,mediaSize:i}=t;let _=0;for(const t of this._private__data._internal_lines){if(0===t._internal_text.length)continue;e.font=t._internal_font;const n=this._private__metrics(e,t._internal_text);n>i.width?t._internal_zoom=i.width/n:t._internal_zoom=1,_+=t._internal_lineHeight*t._internal_zoom}let n=0;switch(this._private__data._internal_vertAlign){case"top":n=0;break;case"center":n=Math.max((i.height-_)/2,0);break;case"bottom":n=Math.max(i.height-_,0)}e.fillStyle=this._private__data._internal_color;for(const t of this._private__data._internal_lines){e.save();let _=0;switch(this._private__data._internal_horzAlign){case"left":e.textAlign="left",_=t._internal_lineHeight/2;break;case"center":e.textAlign="center",_=i.width/2;break;case"right":e.textAlign="right",_=i.width-1-t._internal_lineHeight/2}e.translate(_,n),e.textBaseline="top",e.font=t._internal_font,e.scale(t._internal_zoom,t._internal_zoom),e.fillText(t._internal_text,0,t._internal_vertOffset),e.restore(),n+=t._internal_lineHeight*t._internal_zoom}}_private__metrics(t,e){const i=this._private__fontCache(t.font);let _=i.get(e);return void 0===_&&(_=t.measureText(e).width,i.set(e,_)),_}_private__fontCache(t){let e=this._private__metricsCache.get(t);return void 0===e&&(e=new Map,this._private__metricsCache.set(t,e)),e}}class Se{constructor(t){this._private__invalidated=!0,this._private__rendererData={_internal_visible:!1,_internal_color:"",_internal_lines:[],_internal_vertAlign:"center",_internal_horzAlign:"center"},this._private__renderer=new fe(this._private__rendererData),this._private__source=t}_internal_update(){this._private__invalidated=!0}_internal_renderer(){return this._private__invalidated&&(this._private__updateImpl(),this._private__invalidated=!1),this._private__renderer}_private__updateImpl(){const t=this._private__source._internal_options(),e=this._private__rendererData;e._internal_visible=t.visible,e._internal_visible&&(e._internal_color=t.color,e._internal_horzAlign=t.horzAlign,e._internal_vertAlign=t.vertAlign,e._internal_lines=[{_internal_text:t.text,_internal_font:Et(t.fontSize,t.fontFamily,t.fontStyle),_internal_lineHeight:1.2*t.fontSize,_internal_vertOffset:0,_internal_zoom:0}])}}class be extends Z{constructor(t,e){super(),this._private__options=e,this._private__paneView=new Se(this)}_internal_priceAxisViews(){return[]}_internal_paneViews(){return[this._private__paneView]}_internal_options(){return this._private__options}_internal_updateAllViews(){this._private__paneView._internal_update()}}class we{constructor(t){this._private__rendererOptions={_internal_borderSize:1,_internal_tickLength:5,_internal_fontSize:NaN,_internal_font:"",_internal_fontFamily:"",_internal_color:"",_internal_paneBackgroundColor:"",_internal_paddingBottom:0,_internal_paddingInner:0,_internal_paddingOuter:0,_internal_paddingTop:0,_internal_baselineOffset:0},this._private__chartModel=t}_internal_options(){const t=this._private__rendererOptions,e=this._private__fontSize(),i=this._private__fontFamily();return t._internal_fontSize===e&&t._internal_fontFamily===i||(t._internal_fontSize=e,t._internal_fontFamily=i,t._internal_font=Et(e,i),t._internal_paddingTop=2.5/12*e,t._internal_paddingBottom=t._internal_paddingTop,t._internal_paddingInner=e/12*t._internal_tickLength,t._internal_paddingOuter=e/12*t._internal_tickLength,t._internal_baselineOffset=0),t._internal_color=this._private__textColor(),t._internal_paneBackgroundColor=this._private__paneBackgroundColor(),this._private__rendererOptions}_private__textColor(){return this._private__chartModel._internal_options().layout.textColor}_private__paneBackgroundColor(){return this._private__chartModel._internal_backgroundTopColor()}_private__fontSize(){return this._private__chartModel._internal_options().layout.fontSize}_private__fontFamily(){return this._private__chartModel._internal_options().layout.fontFamily}}class Ce{constructor(t,e,i){this._private__panes=[],this._private__serieses=[],this._private__width=0,this._private__hoveredSource=null,this._private__priceScalesOptionsChanged=new Mt,this._private__crosshairMoved=new Mt,this._private__gradientColorsCache=null,this._private__invalidateHandler=t,this._private__options=e,this._private__horzScaleBehavior=i,this._private__rendererOptionsProvider=new we(this),this._private__timeScale=new me(this,e.timeScale,this._private__options.localization,i),this._private__crosshair=new q(this,e.crosshair),this._private__watermark=new be(this,e.watermark),this._internal_createPane(),this._private__panes[0]._internal_setStretchFactor(2e3),this._private__backgroundTopColor=this._private__getBackgroundColor(0),this._private__backgroundBottomColor=this._private__getBackgroundColor(1)}_internal_fullUpdate(){this._private__invalidate(Rt._internal_full())}_internal_lightUpdate(){this._private__invalidate(Rt._internal_light())}_internal_cursorUpdate(){this._private__invalidate(new Rt(1))}_internal_updateSource(t){const e=this._private__invalidationMaskForSource(t);this._private__invalidate(e)}_internal_hoveredSource(){return this._private__hoveredSource}_internal_setHoveredSource(t){const e=this._private__hoveredSource;this._private__hoveredSource=t,null!==e&&this._internal_updateSource(e._internal_source),null!==t&&this._internal_updateSource(t._internal_source)}_internal_options(){return this._private__options}_internal_applyOptions(t){p(this._private__options,t),this._private__panes.forEach((e=>e._internal_applyScaleOptions(t))),void 0!==t.timeScale&&this._private__timeScale._internal_applyOptions(t.timeScale),void 0!==t.localization&&this._private__timeScale._internal_applyLocalizationOptions(t.localization),(t.leftPriceScale||t.rightPriceScale)&&this._private__priceScalesOptionsChanged._internal_fire(),this._private__backgroundTopColor=this._private__getBackgroundColor(0),this._private__backgroundBottomColor=this._private__getBackgroundColor(1),this._internal_fullUpdate()}_internal_applyPriceScaleOptions(t,e){if("left"===t)return void this._internal_applyOptions({leftPriceScale:e});if("right"===t)return void this._internal_applyOptions({rightPriceScale:e});const i=this._internal_findPriceScale(t);if(null===i)throw new Error(`Trying to apply price scale options with incorrect ID: ${t}`);i._internal_priceScale._internal_applyOptions(e),this._private__priceScalesOptionsChanged._internal_fire()}_internal_findPriceScale(t){for(const e of this._private__panes){const i=e._internal_priceScaleById(t);if(null!==i)return{_internal_pane:e,_internal_priceScale:i}}return null}_internal_timeScale(){return this._private__timeScale}_internal_panes(){return this._private__panes}_internal_watermarkSource(){return this._private__watermark}_internal_crosshairSource(){return this._private__crosshair}_internal_crosshairMoved(){return this._private__crosshairMoved}_internal_setPaneHeight(t,e){t._internal_setHeight(e),this._internal_recalculateAllPanes()}_internal_setWidth(t){this._private__width=t,this._private__timeScale._internal_setWidth(this._private__width),this._private__panes.forEach((e=>e._internal_setWidth(t))),this._internal_recalculateAllPanes()}_internal_createPane(t){const e=new he(this._private__timeScale,this);void 0!==t?this._private__panes.splice(t,0,e):this._private__panes.push(e);const i=void 0===t?this._private__panes.length-1:t,_=Rt._internal_full();return _._internal_invalidatePane(i,{_internal_level:0,_internal_autoScale:!0}),this._private__invalidate(_),e}_internal_startScalePrice(t,e,i){t._internal_startScalePrice(e,i)}_internal_scalePriceTo(t,e,i){t._internal_scalePriceTo(e,i),this._internal_updateCrosshair(),this._private__invalidate(this._private__paneInvalidationMask(t,2))}_internal_endScalePrice(t,e){t._internal_endScalePrice(e),this._private__invalidate(this._private__paneInvalidationMask(t,2))}_internal_startScrollPrice(t,e,i){e._internal_isAutoScale()||t._internal_startScrollPrice(e,i)}_internal_scrollPriceTo(t,e,i){e._internal_isAutoScale()||(t._internal_scrollPriceTo(e,i),this._internal_updateCrosshair(),this._private__invalidate(this._private__paneInvalidationMask(t,2)))}_internal_endScrollPrice(t,e){e._internal_isAutoScale()||(t._internal_endScrollPrice(e),this._private__invalidate(this._private__paneInvalidationMask(t,2)))}_internal_resetPriceScale(t,e){t._internal_resetPriceScale(e),this._private__invalidate(this._private__paneInvalidationMask(t,2))}_internal_startScaleTime(t){this._private__timeScale._internal_startScale(t)}_internal_zoomTime(t,e){const i=this._internal_timeScale();if(i._internal_isEmpty()||0===e)return;const _=i._internal_width();t=Math.max(1,Math.min(t,_)),i._internal_zoom(t,e),this._internal_recalculateAllPanes()}_internal_scrollChart(t){this._internal_startScrollTime(0),this._internal_scrollTimeTo(t),this._internal_endScrollTime()}_internal_scaleTimeTo(t){this._private__timeScale._internal_scaleTo(t),this._internal_recalculateAllPanes()}_internal_endScaleTime(){this._private__timeScale._internal_endScale(),this._internal_lightUpdate()}_internal_startScrollTime(t){this._private__timeScale._internal_startScroll(t)}_internal_scrollTimeTo(t){this._private__timeScale._internal_scrollTo(t),this._internal_recalculateAllPanes()}_internal_endScrollTime(){this._private__timeScale._internal_endScroll(),this._internal_lightUpdate()}_internal_serieses(){return this._private__serieses}_internal_setAndSaveCurrentPosition(t,e,i,_,n){this._private__crosshair._internal_saveOriginCoord(t,e);let r=NaN,a=this._private__timeScale._internal_coordinateToIndex(t);const l=this._private__timeScale._internal_visibleStrictRange();null!==l&&(a=Math.min(Math.max(l._internal_left(),a),l._internal_right()));const s=_._internal_defaultPriceScale(),o=s._internal_firstValue();null!==o&&(r=s._internal_coordinateToPrice(e,o)),this._private__crosshair._internal_setPosition(a,r,_),this._internal_cursorUpdate(),n||this._private__crosshairMoved._internal_fire(this._private__crosshair._internal_appliedIndex(),{x:t,y:e},i)}_internal_clearCurrentPosition(t){this._internal_crosshairSource()._internal_clearPosition(),this._internal_cursorUpdate(),t||this._private__crosshairMoved._internal_fire(null,null,null)}_internal_updateCrosshair(){const t=this._private__crosshair._internal_pane();if(null!==t){const e=this._private__crosshair._internal_originCoordX(),i=this._private__crosshair._internal_originCoordY();this._internal_setAndSaveCurrentPosition(e,i,null,t)}this._private__crosshair._internal_updateAllViews()}_internal_updateTimeScale(t,e,i){const _=this._private__timeScale._internal_indexToTime(0);void 0!==e&&void 0!==i&&this._private__timeScale._internal_update(e,i);const n=this._private__timeScale._internal_indexToTime(0),r=this._private__timeScale._internal_baseIndex(),a=this._private__timeScale._internal_visibleStrictRange();if(null!==a&&null!==_&&null!==n){const e=a._internal_contains(r),l=this._private__horzScaleBehavior.key(_)>this._private__horzScaleBehavior.key(n),s=null!==t&&t>r&&!l,o=this._private__timeScale._internal_options().allowShiftVisibleRangeOnWhitespaceReplacement,h=e&&(!(void 0===i)||o)&&this._private__timeScale._internal_options().shiftVisibleRangeOnNewBar;if(s&&!h){const e=t-r;this._private__timeScale._internal_setRightOffset(this._private__timeScale._internal_rightOffset()-e)}}this._private__timeScale._internal_setBaseIndex(t)}_internal_recalculatePane(t){null!==t&&t._internal_recalculate()}_internal_paneForSource(t){const e=this._private__panes.find((e=>e._internal_orderedSources().includes(t)));return void 0===e?null:e}_internal_recalculateAllPanes(){this._private__watermark._internal_updateAllViews(),this._private__panes.forEach((t=>t._internal_recalculate())),this._internal_updateCrosshair()}_internal_destroy(){this._private__panes.forEach((t=>t._internal_destroy())),this._private__panes.length=0,this._private__options.localization.priceFormatter=void 0,this._private__options.localization.percentageFormatter=void 0,this._private__options.localization.timeFormatter=void 0}_internal_rendererOptionsProvider(){return this._private__rendererOptionsProvider}_internal_priceAxisRendererOptions(){return this._private__rendererOptionsProvider._internal_options()}_internal_priceScalesOptionsChanged(){return this._private__priceScalesOptionsChanged}_internal_createSeries(t,e){const i=this._private__panes[0],_=this._private__createSeries(e,t,i);return this._private__serieses.push(_),1===this._private__serieses.length?this._internal_fullUpdate():this._internal_lightUpdate(),_}_internal_moveSeriesToScale(t,e){const i=o(this._internal_paneForSource(t));i._internal_removeDataSource(t);const _=this._internal_findPriceScale(e);if(null===_){const _=t._internal_zorder();i._internal_addDataSource(t,e,_)}else{const n=_._internal_pane===i?t._internal_zorder():void 0;_._internal_pane._internal_addDataSource(t,e,n)}}_internal_fitContent(){const t=Rt._internal_light();t._internal_setFitContent(),this._private__invalidate(t)}_internal_setTargetLogicalRange(t){const e=Rt._internal_light();e._internal_applyRange(t),this._private__invalidate(e)}_internal_resetTimeScale(){const t=Rt._internal_light();t._internal_resetTimeScale(),this._private__invalidate(t)}_internal_setBarSpacing(t){const e=Rt._internal_light();e._internal_setBarSpacing(t),this._private__invalidate(e)}_internal_setRightOffset(t){const e=Rt._internal_light();e._internal_setRightOffset(t),this._private__invalidate(e)}_internal_setTimeScaleAnimation(t){const e=Rt._internal_light();e._internal_setTimeScaleAnimation(t),this._private__invalidate(e)}_internal_stopTimeScaleAnimation(){const t=Rt._internal_light();t._internal_stopTimeScaleAnimation(),this._private__invalidate(t)}_internal_defaultVisiblePriceScaleId(){return this._private__options.rightPriceScale.visible?"right":"left"}_internal_backgroundBottomColor(){return this._private__backgroundBottomColor}_internal_backgroundTopColor(){return this._private__backgroundTopColor}_internal_backgroundColorAtYPercentFromTop(t){const e=this._private__backgroundBottomColor,i=this._private__backgroundTopColor;if(e===i)return e;if(t=Math.max(0,Math.min(100,Math.round(100*t))),null===this._private__gradientColorsCache||this._private__gradientColorsCache._internal_topColor!==i||this._private__gradientColorsCache._internal_bottomColor!==e)this._private__gradientColorsCache={_internal_topColor:i,_internal_bottomColor:e,_internal_colors:new Map};else{const e=this._private__gradientColorsCache._internal_colors.get(t);if(void 0!==e)return e}const _=function(t,e,i){const[_,n,r,a]=x(t),[l,s,o,h]=x(e),p=[g(_+i*(l-_)),g(n+i*(s-n)),g(r+i*(o-r)),f(a+i*(h-a))];return`rgba(${p[0]}, ${p[1]}, ${p[2]}, ${p[3]})`}(i,e,t/100);return this._private__gradientColorsCache._internal_colors.set(t,_),_}_private__paneInvalidationMask(t,e){const i=new Rt(e);if(null!==t){const _=this._private__panes.indexOf(t);i._internal_invalidatePane(_,{_internal_level:e})}return i}_private__invalidationMaskForSource(t,e){return void 0===e&&(e=2),this._private__paneInvalidationMask(this._internal_paneForSource(t),e)}_private__invalidate(t){this._private__invalidateHandler&&this._private__invalidateHandler(t),this._private__panes.forEach((t=>t._internal_grid()._internal_paneView()._internal_update()))}_private__createSeries(t,e,i){const _=new Yt(this,t,e),n=this._internal_defaultVisiblePriceScaleId();return i._internal_addDataSource(_,n),zt(n)||_._internal_applyOptions(t),_}_private__getBackgroundColor(t){const e=this._private__options.layout;return"gradient"===e.background.type?0===t?e.background.topColor:e.background.bottomColor:e.background.color}}function xe(e){return!t(e)&&!i(e)}function Te(e){return t(e)}function ye(t){return 60*t*60*1e3}function Pe(t){return 60*t*1e3}const Me=[{_internal_divisor:(1,1e3),_internal_weight:10},{_internal_divisor:Pe(1),_internal_weight:20},{_internal_divisor:Pe(5),_internal_weight:21},{_internal_divisor:Pe(30),_internal_weight:22},{_internal_divisor:ye(1),_internal_weight:30},{_internal_divisor:ye(3),_internal_weight:31},{_internal_divisor:ye(6),_internal_weight:32},{_internal_divisor:ye(12),_internal_weight:33}];function ke(t,e){if(t.getUTCFullYear()!==e.getUTCFullYear())return 70;if(t.getUTCMonth()!==e.getUTCMonth())return 60;if(t.getUTCDate()!==e.getUTCDate())return 50;for(let i=Me.length-1;i>=0;--i)if(Math.floor(e.getTime()/Me[i]._internal_divisor)!==Math.floor(t.getTime()/Me[i]._internal_divisor))return Me[i]._internal_weight;return 0}function Ee(t){let e=t;if(i(t)&&(e=Be(t)),!xe(e))throw new Error("time must be of type BusinessDay");const _=new Date(Date.UTC(e.year,e.month-1,e.day,0,0,0,0));return{_internal_timestamp:Math.round(_.getTime()/1e3),_internal_businessDay:e}}function ze(t){if(!Te(t))throw new Error("time must be of type isUTCTimestamp");return{_internal_timestamp:t}}const Re=/^\d\d\d\d-\d\d-\d\d$/;function Be(t){if(!Re.test(t))throw new Error(`Invalid date string=${t}, expected format=yyyy-mm-dd`);const e=new Date(t);if(isNaN(e.getTime()))throw new Error(`Invalid date string=${t}, expected format=yyyy-mm-dd`);return{day:e.getUTCDate(),month:e.getUTCMonth()+1,year:e.getUTCFullYear()}}class Ie{options(){return this._private__options}setOptions(t){this._private__options=t,this.updateFormatter(t.localization)}createConverterToInternalObj(t){return o(function(t){return 0===t.length?null:xe(t[0].time)||i(t[0].time)?Ee:ze}(t))}key(t){return"object"==typeof t&&"_internal_timestamp"in t?t._internal_timestamp:this.key(this.convertHorzItemToInternal(t))}cacheKey(t){const e=t;return void 0===e._internal_businessDay?new Date(1e3*e._internal_timestamp).getTime():new Date(Date.UTC(e._internal_businessDay.year,e._internal_businessDay.month-1,e._internal_businessDay.day)).getTime()}convertHorzItemToInternal(t){return Te(e=t)?ze(e):xe(e)?Ee(e):Ee(Be(e));var e}updateFormatter(t){if(!this._private__options)return;const e=t.dateFormat;this._private__options.timeScale.timeVisible?this._private__dateTimeFormatter=new F({_internal_dateFormat:e,_internal_timeFormat:this._private__options.timeScale.secondsVisible?"%h:%m:%s":"%h:%m",_internal_dateTimeSeparator:"   ",_internal_locale:t.locale}):this._private__dateTimeFormatter=new O(e,t.locale)}formatHorzItem(t){return this._private__dateTimeFormatter._internal_format(new Date(1e3*t._internal_timestamp))}formatTickmark(t,e){const i=function(t,e,i){switch(t){case 0:case 10:return e?i?4:3:2;case 20:case 21:case 22:case 30:case 31:case 32:case 33:return e?3:2;case 50:return 2;case 60:return 1;case 70:return 0}}(t.weight,this._private__options.timeScale.timeVisible,this._private__options.timeScale.secondsVisible);return function(t,e,i){const _={};switch(e){case 0:_.year="numeric";break;case 1:_.month="short";break;case 2:_.day="numeric";break;case 3:_.hour12=!1,_.hour="2-digit",_.minute="2-digit";break;case 4:_.hour12=!1,_.hour="2-digit",_.minute="2-digit",_.second="2-digit"}const n=void 0===t._internal_businessDay?new Date(1e3*t._internal_timestamp):new Date(Date.UTC(t._internal_businessDay.year,t._internal_businessDay.month-1,t._internal_businessDay.day));return new Date(n.getUTCFullYear(),n.getUTCMonth(),n.getUTCDate(),n.getUTCHours(),n.getUTCMinutes(),n.getUTCSeconds(),n.getUTCMilliseconds()).toLocaleString(i,_)}(t.time,i,e.locale)}maxTickMarkWeight(t){let e=t.reduce(ue,t[0]).weight;return e>30&&e<50&&(e=30),e}fillWeightsForPoints(t,e){!function(t,e=0){if(0===t.length)return;let i=0===e?null:t[e-1].time._internal_timestamp,_=null!==i?new Date(1e3*i):null,n=0;for(let r=e;r<t.length;++r){const e=t[r],a=new Date(1e3*e.time._internal_timestamp);null!==_&&(e.timeWeight=ke(a,_)),n+=e.time._internal_timestamp-(i||e.time._internal_timestamp),i=e.time._internal_timestamp,_=a}if(0===e&&t.length>1){const e=Math.ceil(n/(t.length-1)),i=new Date(1e3*(t[0].time._internal_timestamp-e));t[0].timeWeight=ke(new Date(1e3*t[0].time._internal_timestamp),i)}}(t,e)}static _internal_applyDefaults(t){const e=window.navigator.languages[0];return p({localization:{dateFormat:"dd MMM 'yy",priceFormatter:Intl.NumberFormat(e,{style:"currency",currency:"RUB"}).format}},t)}}function Ae(t){var e=t.width,i=t.height;if(e<0)throw new Error("Negative width is not allowed for Size");if(i<0)throw new Error("Negative height is not allowed for Size");return{width:e,height:i}}function De(t,e){return t.width===e.width&&t.height===e.height}const Ve=function(){function t(t){this._resolutionMediaQueryList=null,this._observers=[],this._window=t,this._installResolutionListener()}return Object.defineProperty(t.prototype,"value",{get:function(){return this._window.devicePixelRatio},enumerable:!1,configurable:!0}),t.prototype.subscribe=function(t){var e=this,i={next:t};return this._observers.push(i),{unsubscribe:function(){e._observers=e._observers.filter((function(t){return t!==i}))}}},t.prototype._installResolutionListener=function(){if(null!==this._resolutionMediaQueryList)throw new Error("Resolution listener is already installed");var t=this._window.devicePixelRatio;this._resolutionMediaQueryList=this._window.matchMedia("all and (resolution: ".concat(t,"dppx)")),this._resolutionMediaQueryList.addListener(this._resolutionListener)},t}();var Oe=function(){function t(t,e,i){var _;this._canvasElement=null,this._bitmapSizeChangedListeners=[],this._suggestedBitmapSize=null,this._suggestedBitmapSizeChangedListeners=[],this._devicePixelRatioObservable=null,this._canvasElementResizeObserver=null,this._canvasElement=t,this._canvasElementClientSize=Ae({width:this._canvasElement.clientWidth,height:this._canvasElement.clientHeight}),this._transformBitmapSize=null!=e?e:function(t){return t},this._allowResizeObserver=null===(_=null==i?void 0:i.allowResizeObserver)||void 0===_||_,this._chooseAndInitObserver()}return t.prototype.dispose=function(){var t,e;if(null===this._canvasElement)throw new Error("Object is disposed");null===(t=this._canvasElementResizeObserver)||void 0===t||t.disconnect(),this._canvasElementResizeObserver=null,null===(e=this._devicePixelRatioObservable)||void 0===e||e.dispose(),this._devicePixelRatioObservable=null,this._suggestedBitmapSizeChangedListeners.length=0,this._bitmapSizeChangedListeners.length=0,this._canvasElement=null},Object.defineProperty(t.prototype,"canvasElement",{get:function(){if(null===this._canvasElement)throw new Error("Object is disposed");return this._canvasElement},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"canvasElementClientSize",{get:function(){return this._canvasElementClientSize},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bitmapSize",{get:function(){return Ae({width:this.canvasElement.width,height:this.canvasElement.height})},enumerable:!1,configurable:!0}),t.prototype.resizeCanvasElement=function(t){this._canvasElementClientSize=Ae(t),this.canvasElement.style.width="".concat(this._canvasElementClientSize.width,"px"),this.canvasElement.style.height="".concat(this._canvasElementClientSize.height,"px"),this._invalidateBitmapSize()},Object.defineProperty(t.prototype,"suggestedBitmapSize",{get:function(){return this._suggestedBitmapSize},enumerable:!1,configurable:!0}),t.prototype.subscribeSuggestedBitmapSizeChanged=function(t){this._suggestedBitmapSizeChangedListeners.push(t)},t.prototype.unsubscribeSuggestedBitmapSizeChanged=function(t){this._suggestedBitmapSizeChangedListeners=this._suggestedBitmapSizeChangedListeners.filter((function(e){return e!==t}))},t.prototype.applySuggestedBitmapSize=function(){if(null!==this._suggestedBitmapSize){var t=this._suggestedBitmapSize;this._suggestedBitmapSize=null,this._resizeBitmap(t),this._emitSuggestedBitmapSizeChanged(t,this._suggestedBitmapSize)}},t.prototype._resizeBitmap=function(t){var e=this.bitmapSize;De(e,t)||(this.canvasElement.width=t.width,this.canvasElement.height=t.height,this._emitBitmapSizeChanged(e,t))},t.prototype._emitBitmapSizeChanged=function(t,e){var i=this;this._bitmapSizeChangedListeners.forEach((function(_){return _.call(i,t,e)}))},t.prototype._suggestNewBitmapSize=function(t){var e=this._suggestedBitmapSize,i=Ae(this._transformBitmapSize(t,this._canvasElementClientSize)),_=De(this.bitmapSize,i)?null:i;null===e&&null===_||null!==e&&null!==_&&De(e,_)||(this._suggestedBitmapSize=_,this._emitSuggestedBitmapSizeChanged(e,_))},t.prototype._emitSuggestedBitmapSizeChanged=function(t,e){var i=this;this._suggestedBitmapSizeChangedListeners.forEach((function(_){return _.call(i,t,e)}))},t.prototype._chooseAndInitObserver=function(){var t=this;this._allowResizeObserver?new Promise((function(t){var e=new ResizeObserver((function(i){t(i.every((function(t){return"devicePixelContentBoxSize"in t}))),e.disconnect()}));e.observe(document.body,{box:"device-pixel-content-box"})})).catch((function(){return!1})).then((function(e){return e?t._initResizeObserver():t._initDevicePixelRatioObservable()})):this._initDevicePixelRatioObservable()},t.prototype._initDevicePixelRatioObservable=function(){var t=this;if(null!==this._canvasElement){var e=Le(this._canvasElement);if(null===e)throw new Error("No window is associated with the canvas");this._devicePixelRatioObservable=function(t){return new Ve(t)}(e),this._devicePixelRatioObservable.subscribe((function(){return t._invalidateBitmapSize()})),this._invalidateBitmapSize()}},t.prototype._invalidateBitmapSize=function(){var t,e;if(null!==this._canvasElement){var i=Le(this._canvasElement);if(null!==i){var _=null!==(e=null===(t=this._devicePixelRatioObservable)||void 0===t?void 0:t.value)&&void 0!==e?e:i.devicePixelRatio,n=this._canvasElement.getClientRects(),r=void 0!==n[0]?function(t,e){return Ae({width:Math.round(t.left*e+t.width*e)-Math.round(t.left*e),height:Math.round(t.top*e+t.height*e)-Math.round(t.top*e)})}(n[0],_):Ae({width:this._canvasElementClientSize.width*_,height:this._canvasElementClientSize.height*_});this._suggestNewBitmapSize(r)}}},t.prototype._initResizeObserver=function(){var t=this;null!==this._canvasElement&&(this._canvasElementResizeObserver=new ResizeObserver((function(e){var i=e.find((function(e){return e.target===t._canvasElement}));if(i&&i.devicePixelContentBoxSize&&i.devicePixelContentBoxSize[0]){var _=i.devicePixelContentBoxSize[0],n=Ae({width:_.inlineSize,height:_.blockSize});t._suggestNewBitmapSize(n)}})),this._canvasElementResizeObserver.observe(this._canvasElement,{box:"device-pixel-content-box"}))},t}();function Le(t){return t.ownerDocument.defaultView}var We=function(){function t(t,e,i){if(0===e.width||0===e.height)throw new TypeError("Rendering target could only be created on a media with positive width and height");if(this._mediaSize=e,0===i.width||0===i.height)throw new TypeError("Rendering target could only be created using a bitmap with positive integer width and height");this._bitmapSize=i,this._context=t}return t.prototype.useMediaCoordinateSpace=function(t){try{return this._context.save(),this._context.setTransform(1,0,0,1,0,0),this._context.scale(this._horizontalPixelRatio,this._verticalPixelRatio),t({context:this._context,mediaSize:this._mediaSize})}finally{this._context.restore()}},t.prototype.useBitmapCoordinateSpace=function(t){try{return this._context.save(),this._context.setTransform(1,0,0,1,0,0),t({context:this._context,mediaSize:this._mediaSize,bitmapSize:this._bitmapSize,horizontalPixelRatio:this._horizontalPixelRatio,verticalPixelRatio:this._verticalPixelRatio})}finally{this._context.restore()}},Object.defineProperty(t.prototype,"_horizontalPixelRatio",{get:function(){return this._bitmapSize.width/this._mediaSize.width},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_verticalPixelRatio",{get:function(){return this._bitmapSize.height/this._mediaSize.height},enumerable:!1,configurable:!0}),t}();function Fe(t,e){var i=t.canvasElementClientSize;if(0===i.width||0===i.height)return null;var _=t.bitmapSize;if(0===_.width||0===_.height)return null;var n=t.canvasElement.getContext("2d",e);return null===n?null:new We(n,i,_)}const Ne="undefined"!=typeof window;function He(){return!!Ne&&window.navigator.userAgent.toLowerCase().indexOf("firefox")>-1}function Ue(){return!!Ne&&/iPhone|iPad|iPod/.test(window.navigator.platform)}function Ye(t){return t+t%2}function $e(t,e){return t._internal_position-e._internal_position}function je(t,e,i){const _=(t._internal_position-e._internal_position)/(t._internal_time-e._internal_time);return Math.sign(_)*Math.min(Math.abs(_),i)}class Xe{constructor(t,e,i,_){this._private__position1=null,this._private__position2=null,this._private__position3=null,this._private__position4=null,this._private__animationStartPosition=null,this._private__durationMsecs=0,this._private__speedPxPerMsec=0,this._private__minSpeed=t,this._private__maxSpeed=e,this._private__dumpingCoeff=i,this._private__minMove=_}_internal_addPosition(t,e){if(null!==this._private__position1){if(this._private__position1._internal_time===e)return void(this._private__position1._internal_position=t);if(Math.abs(this._private__position1._internal_position-t)<this._private__minMove)return}this._private__position4=this._private__position3,this._private__position3=this._private__position2,this._private__position2=this._private__position1,this._private__position1={_internal_time:e,_internal_position:t}}_internal_start(t,e){if(null===this._private__position1||null===this._private__position2)return;if(e-this._private__position1._internal_time>50)return;let i=0;const _=je(this._private__position1,this._private__position2,this._private__maxSpeed),n=$e(this._private__position1,this._private__position2),r=[_],a=[n];if(i+=n,null!==this._private__position3){const t=je(this._private__position2,this._private__position3,this._private__maxSpeed);if(Math.sign(t)===Math.sign(_)){const e=$e(this._private__position2,this._private__position3);if(r.push(t),a.push(e),i+=e,null!==this._private__position4){const t=je(this._private__position3,this._private__position4,this._private__maxSpeed);if(Math.sign(t)===Math.sign(_)){const e=$e(this._private__position3,this._private__position4);r.push(t),a.push(e),i+=e}}}}let l=0;for(let t=0;t<r.length;++t)l+=a[t]/i*r[t];Math.abs(l)<this._private__minSpeed||(this._private__animationStartPosition={_internal_position:t,_internal_time:e},this._private__speedPxPerMsec=l,this._private__durationMsecs=function(t,e){const i=Math.log(e);return Math.log(-t/i)/i}(Math.abs(l),this._private__dumpingCoeff))}_internal_getPosition(t){const e=o(this._private__animationStartPosition),i=t-e._internal_time;return e._internal_position+this._private__speedPxPerMsec*(Math.pow(this._private__dumpingCoeff,i)-1)/Math.log(this._private__dumpingCoeff)}_internal_finished(t){return null===this._private__animationStartPosition||this._private__progressDuration(t)===this._private__durationMsecs}_private__progressDuration(t){const e=t-o(this._private__animationStartPosition)._internal_time;return Math.min(e,this._private__durationMsecs)}}function Ge(t,e){const i=o(t.ownerDocument).createElement("canvas");t.appendChild(i);const _=function(t,e){if("device-pixel-content-box"===e.type)return new Oe(t,e.transform,e.options);throw new Error("Unsupported binding target")}(i,{type:"device-pixel-content-box",options:{allowResizeObserver:!1},transform:(t,e)=>({width:Math.max(t.width,e.width),height:Math.max(t.height,e.height)})});return _.resizeCanvasElement(e),_}function Ke(t){var e;t.width=1,t.height=1,null===(e=t.getContext("2d"))||void 0===e||e.clearRect(0,0,1,1)}function Ze(t,e,i,_){t._internal_drawBackground&&t._internal_drawBackground(e,i,_)}function qe(t,e,i,_){t._internal_draw(e,i,_)}function Qe(t,e,i,_){const n=t(i,_);for(const t of n){const i=t._internal_renderer();null!==i&&e(i)}}class Je{constructor(t,e,i){this._private__clickCount=0,this._private__clickTimeoutId=null,this._private__clickPosition={_internal_x:Number.NEGATIVE_INFINITY,_internal_y:Number.POSITIVE_INFINITY},this._private__tapCount=0,this._private__tapTimeoutId=null,this._private__tapPosition={_internal_x:Number.NEGATIVE_INFINITY,_internal_y:Number.POSITIVE_INFINITY},this._private__longTapTimeoutId=null,this._private__longTapActive=!1,this._private__mouseMoveStartPosition=null,this._private__touchMoveStartPosition=null,this._private__touchMoveExceededManhattanDistance=!1,this._private__cancelClick=!1,this._private__cancelTap=!1,this._private__unsubscribeOutsideMouseEvents=null,this._private__unsubscribeOutsideTouchEvents=null,this._private__unsubscribeMobileSafariEvents=null,this._private__unsubscribeMousemove=null,this._private__unsubscribeRootMouseEvents=null,this._private__unsubscribeRootTouchEvents=null,this._private__startPinchMiddlePoint=null,this._private__startPinchDistance=0,this._private__pinchPrevented=!1,this._private__preventTouchDragProcess=!1,this._private__mousePressed=!1,this._private__lastTouchEventTimeStamp=0,this._private__activeTouchId=null,this._private__acceptMouseLeave=!Ue(),this._private__onFirefoxOutsideMouseUp=t=>{this._private__mouseUpHandler(t)},this._private__onMobileSafariDoubleClick=t=>{if(this._private__firesTouchEvents(t)){const e=this._private__makeCompatEvent(t);if(++this._private__tapCount,this._private__tapTimeoutId&&this._private__tapCount>1){const{_internal_manhattanDistance:i}=this._private__touchMouseMoveWithDownInfo(ii(t),this._private__tapPosition);i<30&&!this._private__cancelTap&&this._private__processTouchEvent(e,this._private__handler._internal_doubleTapEvent),this._private__resetTapTimeout()}}else{const e=this._private__makeCompatEvent(t);if(++this._private__clickCount,this._private__clickTimeoutId&&this._private__clickCount>1){const{_internal_manhattanDistance:i}=this._private__touchMouseMoveWithDownInfo(ii(t),this._private__clickPosition);i<5&&!this._private__cancelClick&&this._private__processMouseEvent(e,this._private__handler._internal_mouseDoubleClickEvent),this._private__resetClickTimeout()}}},this._private__target=t,this._private__handler=e,this._private__options=i,this._private__init()}_internal_destroy(){null!==this._private__unsubscribeOutsideMouseEvents&&(this._private__unsubscribeOutsideMouseEvents(),this._private__unsubscribeOutsideMouseEvents=null),null!==this._private__unsubscribeOutsideTouchEvents&&(this._private__unsubscribeOutsideTouchEvents(),this._private__unsubscribeOutsideTouchEvents=null),null!==this._private__unsubscribeMousemove&&(this._private__unsubscribeMousemove(),this._private__unsubscribeMousemove=null),null!==this._private__unsubscribeRootMouseEvents&&(this._private__unsubscribeRootMouseEvents(),this._private__unsubscribeRootMouseEvents=null),null!==this._private__unsubscribeRootTouchEvents&&(this._private__unsubscribeRootTouchEvents(),this._private__unsubscribeRootTouchEvents=null),null!==this._private__unsubscribeMobileSafariEvents&&(this._private__unsubscribeMobileSafariEvents(),this._private__unsubscribeMobileSafariEvents=null),this._private__clearLongTapTimeout(),this._private__resetClickTimeout()}_private__mouseEnterHandler(t){this._private__unsubscribeMousemove&&this._private__unsubscribeMousemove();const e=this._private__mouseMoveHandler.bind(this);if(this._private__unsubscribeMousemove=()=>{this._private__target.removeEventListener("mousemove",e)},this._private__target.addEventListener("mousemove",e),this._private__firesTouchEvents(t))return;const i=this._private__makeCompatEvent(t);this._private__processMouseEvent(i,this._private__handler._internal_mouseEnterEvent),this._private__acceptMouseLeave=!0}_private__resetClickTimeout(){null!==this._private__clickTimeoutId&&clearTimeout(this._private__clickTimeoutId),this._private__clickCount=0,this._private__clickTimeoutId=null,this._private__clickPosition={_internal_x:Number.NEGATIVE_INFINITY,_internal_y:Number.POSITIVE_INFINITY}}_private__resetTapTimeout(){null!==this._private__tapTimeoutId&&clearTimeout(this._private__tapTimeoutId),this._private__tapCount=0,this._private__tapTimeoutId=null,this._private__tapPosition={_internal_x:Number.NEGATIVE_INFINITY,_internal_y:Number.POSITIVE_INFINITY}}_private__mouseMoveHandler(t){if(this._private__mousePressed||null!==this._private__touchMoveStartPosition)return;if(this._private__firesTouchEvents(t))return;const e=this._private__makeCompatEvent(t);this._private__processMouseEvent(e,this._private__handler._internal_mouseMoveEvent),this._private__acceptMouseLeave=!0}_private__touchMoveHandler(t){const e=ni(t.changedTouches,o(this._private__activeTouchId));if(null===e)return;if(this._private__lastTouchEventTimeStamp=_i(t),null!==this._private__startPinchMiddlePoint)return;if(this._private__preventTouchDragProcess)return;this._private__pinchPrevented=!0;const i=this._private__touchMouseMoveWithDownInfo(ii(e),o(this._private__touchMoveStartPosition)),{_internal_xOffset:_,_internal_yOffset:n,_internal_manhattanDistance:r}=i;if(this._private__touchMoveExceededManhattanDistance||!(r<5)){if(!this._private__touchMoveExceededManhattanDistance){const t=.5*_,e=n>=t&&!this._private__options._internal_treatVertTouchDragAsPageScroll(),i=t>n&&!this._private__options._internal_treatHorzTouchDragAsPageScroll();e||i||(this._private__preventTouchDragProcess=!0),this._private__touchMoveExceededManhattanDistance=!0,this._private__cancelTap=!0,this._private__clearLongTapTimeout(),this._private__resetTapTimeout()}if(!this._private__preventTouchDragProcess){const i=this._private__makeCompatEvent(t,e);this._private__processTouchEvent(i,this._private__handler._internal_touchMoveEvent),ei(t)}}}_private__mouseMoveWithDownHandler(t){if(0!==t.button)return;const e=this._private__touchMouseMoveWithDownInfo(ii(t),o(this._private__mouseMoveStartPosition)),{_internal_manhattanDistance:i}=e;if(i>=5&&(this._private__cancelClick=!0,this._private__resetClickTimeout()),this._private__cancelClick){const e=this._private__makeCompatEvent(t);this._private__processMouseEvent(e,this._private__handler._internal_pressedMouseMoveEvent)}}_private__touchMouseMoveWithDownInfo(t,e){const i=Math.abs(e._internal_x-t._internal_x),_=Math.abs(e._internal_y-t._internal_y);return{_internal_xOffset:i,_internal_yOffset:_,_internal_manhattanDistance:i+_}}_private__touchEndHandler(t){let e=ni(t.changedTouches,o(this._private__activeTouchId));if(null===e&&0===t.touches.length&&(e=t.changedTouches[0]),null===e)return;this._private__activeTouchId=null,this._private__lastTouchEventTimeStamp=_i(t),this._private__clearLongTapTimeout(),this._private__touchMoveStartPosition=null,this._private__unsubscribeRootTouchEvents&&(this._private__unsubscribeRootTouchEvents(),this._private__unsubscribeRootTouchEvents=null);const i=this._private__makeCompatEvent(t,e);if(this._private__processTouchEvent(i,this._private__handler._internal_touchEndEvent),++this._private__tapCount,this._private__tapTimeoutId&&this._private__tapCount>1){const{_internal_manhattanDistance:t}=this._private__touchMouseMoveWithDownInfo(ii(e),this._private__tapPosition);t<30&&!this._private__cancelTap&&this._private__processTouchEvent(i,this._private__handler._internal_doubleTapEvent),this._private__resetTapTimeout()}else this._private__cancelTap||(this._private__processTouchEvent(i,this._private__handler._internal_tapEvent),this._private__handler._internal_tapEvent&&ei(t));0===this._private__tapCount&&ei(t),0===t.touches.length&&this._private__longTapActive&&(this._private__longTapActive=!1,ei(t))}_private__mouseUpHandler(t){if(0!==t.button)return;const e=this._private__makeCompatEvent(t);if(this._private__mouseMoveStartPosition=null,this._private__mousePressed=!1,this._private__unsubscribeRootMouseEvents&&(this._private__unsubscribeRootMouseEvents(),this._private__unsubscribeRootMouseEvents=null),He()&&this._private__target.ownerDocument.documentElement.removeEventListener("mouseleave",this._private__onFirefoxOutsideMouseUp),!this._private__firesTouchEvents(t))if(this._private__processMouseEvent(e,this._private__handler._internal_mouseUpEvent),++this._private__clickCount,this._private__clickTimeoutId&&this._private__clickCount>1){const{_internal_manhattanDistance:i}=this._private__touchMouseMoveWithDownInfo(ii(t),this._private__clickPosition);i<5&&!this._private__cancelClick&&this._private__processMouseEvent(e,this._private__handler._internal_mouseDoubleClickEvent),this._private__resetClickTimeout()}else this._private__cancelClick||this._private__processMouseEvent(e,this._private__handler._internal_mouseClickEvent)}_private__clearLongTapTimeout(){null!==this._private__longTapTimeoutId&&(clearTimeout(this._private__longTapTimeoutId),this._private__longTapTimeoutId=null)}_private__touchStartHandler(t){if(null!==this._private__activeTouchId)return;const e=t.changedTouches[0];this._private__activeTouchId=e.identifier,this._private__lastTouchEventTimeStamp=_i(t);const i=this._private__target.ownerDocument.documentElement;this._private__cancelTap=!1,this._private__touchMoveExceededManhattanDistance=!1,this._private__preventTouchDragProcess=!1,this._private__touchMoveStartPosition=ii(e),this._private__unsubscribeRootTouchEvents&&(this._private__unsubscribeRootTouchEvents(),this._private__unsubscribeRootTouchEvents=null);{const e=this._private__touchMoveHandler.bind(this),_=this._private__touchEndHandler.bind(this);this._private__unsubscribeRootTouchEvents=()=>{i.removeEventListener("touchmove",e),i.removeEventListener("touchend",_)},i.addEventListener("touchmove",e,{passive:!1}),i.addEventListener("touchend",_,{passive:!1}),this._private__clearLongTapTimeout(),this._private__longTapTimeoutId=setTimeout(this._private__longTapHandler.bind(this,t),240)}const _=this._private__makeCompatEvent(t,e);this._private__processTouchEvent(_,this._private__handler._internal_touchStartEvent),this._private__tapTimeoutId||(this._private__tapCount=0,this._private__tapTimeoutId=setTimeout(this._private__resetTapTimeout.bind(this),500),this._private__tapPosition=ii(e))}_private__mouseDownHandler(t){if(0!==t.button)return;const e=this._private__target.ownerDocument.documentElement;He()&&e.addEventListener("mouseleave",this._private__onFirefoxOutsideMouseUp),this._private__cancelClick=!1,this._private__mouseMoveStartPosition=ii(t),this._private__unsubscribeRootMouseEvents&&(this._private__unsubscribeRootMouseEvents(),this._private__unsubscribeRootMouseEvents=null);{const t=this._private__mouseMoveWithDownHandler.bind(this),i=this._private__mouseUpHandler.bind(this);this._private__unsubscribeRootMouseEvents=()=>{e.removeEventListener("mousemove",t),e.removeEventListener("mouseup",i)},e.addEventListener("mousemove",t),e.addEventListener("mouseup",i)}if(this._private__mousePressed=!0,this._private__firesTouchEvents(t))return;const i=this._private__makeCompatEvent(t);this._private__processMouseEvent(i,this._private__handler._internal_mouseDownEvent),this._private__clickTimeoutId||(this._private__clickCount=0,this._private__clickTimeoutId=setTimeout(this._private__resetClickTimeout.bind(this),500),this._private__clickPosition=ii(t))}_private__init(){this._private__target.addEventListener("mouseenter",this._private__mouseEnterHandler.bind(this)),this._private__target.addEventListener("touchcancel",this._private__clearLongTapTimeout.bind(this));{const t=this._private__target.ownerDocument,e=t=>{this._private__handler._internal_mouseDownOutsideEvent&&(t.composed&&this._private__target.contains(t.composedPath()[0])||t.target&&this._private__target.contains(t.target)||this._private__handler._internal_mouseDownOutsideEvent())};this._private__unsubscribeOutsideTouchEvents=()=>{t.removeEventListener("touchstart",e)},this._private__unsubscribeOutsideMouseEvents=()=>{t.removeEventListener("mousedown",e)},t.addEventListener("mousedown",e),t.addEventListener("touchstart",e,{passive:!0})}var t;Ue()&&(this._private__unsubscribeMobileSafariEvents=()=>{this._private__target.removeEventListener("dblclick",this._private__onMobileSafariDoubleClick)},this._private__target.addEventListener("dblclick",this._private__onMobileSafariDoubleClick)),this._private__target.addEventListener("mouseleave",this._private__mouseLeaveHandler.bind(this)),this._private__target.addEventListener("touchstart",this._private__touchStartHandler.bind(this),{passive:!0}),t=this._private__target,Ne&&void 0!==window.chrome&&t.addEventListener("mousedown",(t=>{if(1===t.button)return t.preventDefault(),!1})),this._private__target.addEventListener("mousedown",this._private__mouseDownHandler.bind(this)),this._private__initPinch(),this._private__target.addEventListener("touchmove",(()=>{}),{passive:!1})}_private__initPinch(){void 0===this._private__handler._internal_pinchStartEvent&&void 0===this._private__handler._internal_pinchEvent&&void 0===this._private__handler._internal_pinchEndEvent||(this._private__target.addEventListener("touchstart",(t=>this._private__checkPinchState(t.touches)),{passive:!0}),this._private__target.addEventListener("touchmove",(t=>{if(2===t.touches.length&&null!==this._private__startPinchMiddlePoint&&void 0!==this._private__handler._internal_pinchEvent){const e=ti(t.touches[0],t.touches[1])/this._private__startPinchDistance;this._private__handler._internal_pinchEvent(this._private__startPinchMiddlePoint,e),ei(t)}}),{passive:!1}),this._private__target.addEventListener("touchend",(t=>{this._private__checkPinchState(t.touches)})))}_private__checkPinchState(t){1===t.length&&(this._private__pinchPrevented=!1),2!==t.length||this._private__pinchPrevented||this._private__longTapActive?this._private__stopPinch():this._private__startPinch(t)}_private__startPinch(t){const e=this._private__target.getBoundingClientRect()||{left:0,top:0};this._private__startPinchMiddlePoint={_internal_x:(t[0].clientX-e.left+(t[1].clientX-e.left))/2,_internal_y:(t[0].clientY-e.top+(t[1].clientY-e.top))/2},this._private__startPinchDistance=ti(t[0],t[1]),void 0!==this._private__handler._internal_pinchStartEvent&&this._private__handler._internal_pinchStartEvent(),this._private__clearLongTapTimeout()}_private__stopPinch(){null!==this._private__startPinchMiddlePoint&&(this._private__startPinchMiddlePoint=null,void 0!==this._private__handler._internal_pinchEndEvent&&this._private__handler._internal_pinchEndEvent())}_private__mouseLeaveHandler(t){if(this._private__unsubscribeMousemove&&this._private__unsubscribeMousemove(),this._private__firesTouchEvents(t))return;if(!this._private__acceptMouseLeave)return;const e=this._private__makeCompatEvent(t);this._private__processMouseEvent(e,this._private__handler._internal_mouseLeaveEvent),this._private__acceptMouseLeave=!Ue()}_private__longTapHandler(t){const e=ni(t.touches,o(this._private__activeTouchId));if(null===e)return;const i=this._private__makeCompatEvent(t,e);this._private__processTouchEvent(i,this._private__handler._internal_longTapEvent),this._private__cancelTap=!0,this._private__longTapActive=!0}_private__firesTouchEvents(t){return t.sourceCapabilities&&void 0!==t.sourceCapabilities.firesTouchEvents?t.sourceCapabilities.firesTouchEvents:_i(t)<this._private__lastTouchEventTimeStamp+500}_private__processTouchEvent(t,e){e&&e.call(this._private__handler,t)}_private__processMouseEvent(t,e){e&&e.call(this._private__handler,t)}_private__makeCompatEvent(t,e){const i=e||t,_=this._private__target.getBoundingClientRect()||{left:0,top:0};return{clientX:i.clientX,clientY:i.clientY,pageX:i.pageX,pageY:i.pageY,screenX:i.screenX,screenY:i.screenY,localX:i.clientX-_.left,localY:i.clientY-_.top,ctrlKey:t.ctrlKey,altKey:t.altKey,shiftKey:t.shiftKey,metaKey:t.metaKey,_internal_isTouch:!t.type.startsWith("mouse")&&"contextmenu"!==t.type&&"click"!==t.type,_internal_srcType:t.type,_internal_target:i.target,_internal_view:t.view,_internal_preventDefault:()=>{"touchstart"!==t.type&&ei(t)}}}}function ti(t,e){const i=t.clientX-e.clientX,_=t.clientY-e.clientY;return Math.sqrt(i*i+_*_)}function ei(t){t.cancelable&&t.preventDefault()}function ii(t){return{_internal_x:t.pageX,_internal_y:t.pageY}}function _i(t){return t.timeStamp||performance.now()}function ni(t,e){for(let i=0;i<t.length;++i)if(t[i].identifier===e)return t[i];return null}function ri(t){return{_internal_source:t._internal_source,_internal_object:{_internal_externalId:t._internal_hit.externalId},_internal_cursorStyle:t._internal_hit.cursorStyle}}function ai(t,e,i){for(const _ of t){const t=_._internal_renderer();if(null!==t&&t._internal_hitTest){const n=t._internal_hitTest(e,i);if(null!==n)return{_internal_view:_,_internal_object:n}}}return null}function li(t,e){return i=>{var _,n,r,a;return(null!==(n=null===(_=i._internal_priceScale())||void 0===_?void 0:_._internal_id())&&void 0!==n?n:"")!==e?[]:null!==(a=null===(r=i._internal_pricePaneViews)||void 0===r?void 0:r.call(i,t))&&void 0!==a?a:[]}}class si{constructor(t,e,i,_){this._private__priceScale=null,this._private__size=null,this._private__mousedown=!1,this._private__widthCache=new dt(200),this._private__font=null,this._private__prevOptimalWidth=0,this._private__isSettingSize=!1,this._private__canvasSuggestedBitmapSizeChangedHandler=()=>{this._private__isSettingSize||this._private__pane._internal_chart()._internal_model()._internal_lightUpdate()},this._private__topCanvasSuggestedBitmapSizeChangedHandler=()=>{this._private__isSettingSize||this._private__pane._internal_chart()._internal_model()._internal_lightUpdate()},this._private__pane=t,this._private__options=e,this._private__layoutOptions=e.layout,this._private__rendererOptionsProvider=i,this._private__isLeft="left"===_,this._private__sourcePaneViews=li("normal",_),this._private__sourceTopPaneViews=li("top",_),this._private__sourceBottomPaneViews=li("bottom",_),this._private__cell=document.createElement("div"),this._private__cell.style.height="100%",this._private__cell.style.overflow="hidden",this._private__cell.style.width="25px",this._private__cell.style.left="0",this._private__cell.style.position="relative",this._private__canvasBinding=Ge(this._private__cell,Ae({width:16,height:16})),this._private__canvasBinding.subscribeSuggestedBitmapSizeChanged(this._private__canvasSuggestedBitmapSizeChangedHandler);const n=this._private__canvasBinding.canvasElement;n.style.position="absolute",n.style.zIndex="1",n.style.left="0",n.style.top="0",this._private__topCanvasBinding=Ge(this._private__cell,Ae({width:16,height:16})),this._private__topCanvasBinding.subscribeSuggestedBitmapSizeChanged(this._private__topCanvasSuggestedBitmapSizeChangedHandler);const r=this._private__topCanvasBinding.canvasElement;r.style.position="absolute",r.style.zIndex="2",r.style.left="0",r.style.top="0";const a={_internal_mouseDownEvent:this._private__mouseDownEvent.bind(this),_internal_touchStartEvent:this._private__mouseDownEvent.bind(this),_internal_pressedMouseMoveEvent:this._private__pressedMouseMoveEvent.bind(this),_internal_touchMoveEvent:this._private__pressedMouseMoveEvent.bind(this),_internal_mouseDownOutsideEvent:this._private__mouseDownOutsideEvent.bind(this),_internal_mouseUpEvent:this._private__mouseUpEvent.bind(this),_internal_touchEndEvent:this._private__mouseUpEvent.bind(this),_internal_mouseDoubleClickEvent:this._private__mouseDoubleClickEvent.bind(this),_internal_doubleTapEvent:this._private__mouseDoubleClickEvent.bind(this),_internal_mouseEnterEvent:this._private__mouseEnterEvent.bind(this),_internal_mouseLeaveEvent:this._private__mouseLeaveEvent.bind(this)};this._private__mouseEventHandler=new Je(this._private__topCanvasBinding.canvasElement,a,{_internal_treatVertTouchDragAsPageScroll:()=>!this._private__options.handleScroll.vertTouchDrag,_internal_treatHorzTouchDragAsPageScroll:()=>!0})}_internal_destroy(){this._private__mouseEventHandler._internal_destroy(),this._private__topCanvasBinding.unsubscribeSuggestedBitmapSizeChanged(this._private__topCanvasSuggestedBitmapSizeChangedHandler),Ke(this._private__topCanvasBinding.canvasElement),this._private__topCanvasBinding.dispose(),this._private__canvasBinding.unsubscribeSuggestedBitmapSizeChanged(this._private__canvasSuggestedBitmapSizeChangedHandler),Ke(this._private__canvasBinding.canvasElement),this._private__canvasBinding.dispose(),null!==this._private__priceScale&&this._private__priceScale._internal_onMarksChanged()._internal_unsubscribeAll(this),this._private__priceScale=null}_internal_getElement(){return this._private__cell}_internal_fontSize(){return this._private__layoutOptions.fontSize}_internal_rendererOptions(){const t=this._private__rendererOptionsProvider._internal_options();return this._private__font!==t._internal_font&&(this._private__widthCache._internal_reset(),this._private__font=t._internal_font),t}_internal_optimalWidth(){if(null===this._private__priceScale)return 0;let t=0;const e=this._internal_rendererOptions(),i=o(this._private__canvasBinding.canvasElement.getContext("2d"));i.save();const _=this._private__priceScale._internal_marks();i.font=this._private__baseFont(),_.length>0&&(t=Math.max(this._private__widthCache._internal_measureText(i,_[0]._internal_label),this._private__widthCache._internal_measureText(i,_[_.length-1]._internal_label)));const n=this._private__backLabels();for(let e=n.length;e--;){const _=this._private__widthCache._internal_measureText(i,n[e]._internal_text());_>t&&(t=_)}const r=this._private__priceScale._internal_firstValue();if(null!==r&&null!==this._private__size){const e=this._private__priceScale._internal_coordinateToPrice(1,r),_=this._private__priceScale._internal_coordinateToPrice(this._private__size.height-2,r);t=Math.max(t,this._private__widthCache._internal_measureText(i,this._private__priceScale._internal_formatPrice(Math.floor(Math.min(e,_))+.11111111111111,r)),this._private__widthCache._internal_measureText(i,this._private__priceScale._internal_formatPrice(Math.ceil(Math.max(e,_))-.11111111111111,r)))}i.restore();const a=t||34;return Ye(Math.ceil(e._internal_borderSize+e._internal_tickLength+e._internal_paddingInner+e._internal_paddingOuter+5+a))}_internal_setSize(t){null!==this._private__size&&De(this._private__size,t)||(this._private__size=t,this._private__isSettingSize=!0,this._private__canvasBinding.resizeCanvasElement(t),this._private__topCanvasBinding.resizeCanvasElement(t),this._private__isSettingSize=!1,this._private__cell.style.width=`${t.width}px`,this._private__cell.style.height=`${t.height}px`)}_internal_getWidth(){return o(this._private__size).width}_internal_setPriceScale(t){this._private__priceScale!==t&&(null!==this._private__priceScale&&this._private__priceScale._internal_onMarksChanged()._internal_unsubscribeAll(this),this._private__priceScale=t,t._internal_onMarksChanged()._internal_subscribe(this._private__onMarksChanged.bind(this),this))}_internal_priceScale(){return this._private__priceScale}_internal_reset(){const t=this._private__pane._internal_state();this._private__pane._internal_chart()._internal_model()._internal_resetPriceScale(t,o(this._internal_priceScale()))}_internal_paint(t){if(null===this._private__size)return;if(1!==t){this._private__alignLabels(),this._private__canvasBinding.applySuggestedBitmapSize();const t=Fe(this._private__canvasBinding);null!==t&&(t.useBitmapCoordinateSpace((t=>{this._private__drawBackground(t),this._private__drawBorder(t)})),this._private__pane._internal_drawAdditionalSources(t,this._private__sourceBottomPaneViews),this._private__drawTickMarks(t),this._private__pane._internal_drawAdditionalSources(t,this._private__sourcePaneViews),this._private__drawBackLabels(t))}this._private__topCanvasBinding.applySuggestedBitmapSize();const e=Fe(this._private__topCanvasBinding);null!==e&&(e.useBitmapCoordinateSpace((({context:t,bitmapSize:e})=>{t.clearRect(0,0,e.width,e.height)})),this._private__drawCrosshairLabel(e),this._private__pane._internal_drawAdditionalSources(e,this._private__sourceTopPaneViews))}_internal_getBitmapSize(){return this._private__canvasBinding.bitmapSize}_internal_drawBitmap(t,e,i){const _=this._internal_getBitmapSize();_.width>0&&_.height>0&&t.drawImage(this._private__canvasBinding.canvasElement,e,i)}_internal_update(){var t;null===(t=this._private__priceScale)||void 0===t||t._internal_marks()}_private__mouseDownEvent(t){if(null===this._private__priceScale||this._private__priceScale._internal_isEmpty()||!this._private__options.handleScale.axisPressedMouseMove.price)return;const e=this._private__pane._internal_chart()._internal_model(),i=this._private__pane._internal_state();this._private__mousedown=!0,e._internal_startScalePrice(i,this._private__priceScale,t.localY)}_private__pressedMouseMoveEvent(t){if(null===this._private__priceScale||!this._private__options.handleScale.axisPressedMouseMove.price)return;const e=this._private__pane._internal_chart()._internal_model(),i=this._private__pane._internal_state(),_=this._private__priceScale;e._internal_scalePriceTo(i,_,t.localY)}_private__mouseDownOutsideEvent(){if(null===this._private__priceScale||!this._private__options.handleScale.axisPressedMouseMove.price)return;const t=this._private__pane._internal_chart()._internal_model(),e=this._private__pane._internal_state(),i=this._private__priceScale;this._private__mousedown&&(this._private__mousedown=!1,t._internal_endScalePrice(e,i))}_private__mouseUpEvent(t){if(null===this._private__priceScale||!this._private__options.handleScale.axisPressedMouseMove.price)return;const e=this._private__pane._internal_chart()._internal_model(),i=this._private__pane._internal_state();this._private__mousedown=!1,e._internal_endScalePrice(i,this._private__priceScale)}_private__mouseDoubleClickEvent(t){this._private__options.handleScale.axisDoubleClickReset.price&&this._internal_reset()}_private__mouseEnterEvent(t){null!==this._private__priceScale&&(!this._private__pane._internal_chart()._internal_model()._internal_options().handleScale.axisPressedMouseMove.price||this._private__priceScale._internal_isPercentage()||this._private__priceScale._internal_isIndexedTo100()||this._private__setCursor(1))}_private__mouseLeaveEvent(t){this._private__setCursor(0)}_private__backLabels(){const t=[],e=null===this._private__priceScale?void 0:this._private__priceScale;return(i=>{for(let _=0;_<i.length;++_){const n=i[_]._internal_priceAxisViews(this._private__pane._internal_state(),e);for(let e=0;e<n.length;e++)t.push(n[e])}})(this._private__pane._internal_state()._internal_orderedSources()),t}_private__drawBackground({context:t,bitmapSize:e}){const{width:i,height:_}=e,n=this._private__pane._internal_state()._internal_model(),r=n._internal_backgroundTopColor(),a=n._internal_backgroundBottomColor();r===a?P(t,0,0,i,_,r):z(t,0,0,i,_,r,a)}_private__drawBorder({context:t,bitmapSize:e,horizontalPixelRatio:i}){if(null===this._private__size||null===this._private__priceScale||!this._private__priceScale._internal_options().borderVisible)return;t.fillStyle=this._private__priceScale._internal_options().borderColor;const _=Math.max(1,Math.floor(this._internal_rendererOptions()._internal_borderSize*i));let n;n=this._private__isLeft?e.width-_:0,t.fillRect(n,0,_,e.height)}_private__drawTickMarks(t){if(null===this._private__size||null===this._private__priceScale)return;const e=this._private__priceScale._internal_marks(),i=this._private__priceScale._internal_options(),_=this._internal_rendererOptions(),n=this._private__isLeft?this._private__size.width-_._internal_tickLength:0;i.borderVisible&&i.ticksVisible&&t.useBitmapCoordinateSpace((({context:t,horizontalPixelRatio:r,verticalPixelRatio:a})=>{t.fillStyle=i.borderColor;const l=Math.max(1,Math.floor(a)),s=Math.floor(.5*a),o=Math.round(_._internal_tickLength*r);t.beginPath();for(const i of e)t.rect(Math.floor(n*r),Math.round(i._internal_coord*a)-s,o,l);t.fill()})),t.useMediaCoordinateSpace((({context:t})=>{var r;t.font=this._private__baseFont(),t.fillStyle=null!==(r=i.textColor)&&void 0!==r?r:this._private__layoutOptions.textColor,t.textAlign=this._private__isLeft?"right":"left",t.textBaseline="middle";const a=this._private__isLeft?Math.round(n-_._internal_paddingInner):Math.round(n+_._internal_tickLength+_._internal_paddingInner),l=e.map((e=>this._private__widthCache._internal_yMidCorrection(t,e._internal_label)));for(let i=e.length;i--;){const _=e[i];t.fillText(_._internal_label,a,_._internal_coord+l[i])}}))}_private__alignLabels(){if(null===this._private__size||null===this._private__priceScale)return;let t=this._private__size.height/2;const e=[],i=this._private__priceScale._internal_orderedSources().slice(),_=this._private__pane._internal_state(),n=this._internal_rendererOptions();this._private__priceScale===_._internal_defaultVisiblePriceScale()&&this._private__pane._internal_state()._internal_orderedSources().forEach((t=>{_._internal_isOverlay(t)&&i.push(t)}));const r=this._private__priceScale._internal_dataSources()[0],a=this._private__priceScale;i.forEach((i=>{const n=i._internal_priceAxisViews(_,a);n.forEach((t=>{t._internal_setFixedCoordinate(null),t._internal_isVisible()&&e.push(t)})),r===i&&n.length>0&&(t=n[0]._internal_coordinate())})),e.forEach((t=>t._internal_setFixedCoordinate(t._internal_coordinate()))),this._private__priceScale._internal_options().alignLabels&&this._private__fixLabelOverlap(e,n,t)}_private__fixLabelOverlap(t,e,i){if(null===this._private__size)return;const _=t.filter((t=>t._internal_coordinate()<=i)),n=t.filter((t=>t._internal_coordinate()>i));_.sort(((t,e)=>e._internal_coordinate()-t._internal_coordinate())),_.length&&n.length&&n.push(_[0]),n.sort(((t,e)=>t._internal_coordinate()-e._internal_coordinate()));for(const i of t){const t=Math.floor(i._internal_height(e)/2),_=i._internal_coordinate();_>-t&&_<t&&i._internal_setFixedCoordinate(t),_>this._private__size.height-t&&_<this._private__size.height+t&&i._internal_setFixedCoordinate(this._private__size.height-t)}for(let t=1;t<_.length;t++){const i=_[t],n=_[t-1],r=n._internal_height(e,!1),a=i._internal_coordinate(),l=n._internal_getFixedCoordinate();a>l-r&&i._internal_setFixedCoordinate(l-r)}for(let t=1;t<n.length;t++){const i=n[t],_=n[t-1],r=_._internal_height(e,!0),a=i._internal_coordinate(),l=_._internal_getFixedCoordinate();a<l+r&&i._internal_setFixedCoordinate(l+r)}}_private__drawBackLabels(t){if(null===this._private__size)return;const e=this._private__backLabels(),i=this._internal_rendererOptions(),_=this._private__isLeft?"right":"left";e.forEach((e=>{e._internal_isAxisLabelVisible()&&e._internal_renderer(o(this._private__priceScale))._internal_draw(t,i,this._private__widthCache,_)}))}_private__drawCrosshairLabel(t){if(null===this._private__size||null===this._private__priceScale)return;const e=this._private__pane._internal_chart()._internal_model(),i=[],_=this._private__pane._internal_state(),n=e._internal_crosshairSource()._internal_priceAxisViews(_,this._private__priceScale);n.length&&i.push(n);const r=this._internal_rendererOptions(),a=this._private__isLeft?"right":"left";i.forEach((e=>{e.forEach((e=>{e._internal_renderer(o(this._private__priceScale))._internal_draw(t,r,this._private__widthCache,a)}))}))}_private__setCursor(t){this._private__cell.style.cursor=1===t?"ns-resize":"default"}_private__onMarksChanged(){const t=this._internal_optimalWidth();this._private__prevOptimalWidth<t&&this._private__pane._internal_chart()._internal_model()._internal_fullUpdate(),this._private__prevOptimalWidth=t}_private__baseFont(){return Et(this._private__layoutOptions.fontSize,this._private__layoutOptions.fontFamily)}}function oi(t,e){var i,_;return null!==(_=null===(i=t._internal_bottomPaneViews)||void 0===i?void 0:i.call(t,e))&&void 0!==_?_:[]}function hi(t,e){var i,_;return null!==(_=null===(i=t._internal_paneViews)||void 0===i?void 0:i.call(t,e))&&void 0!==_?_:[]}function pi(t,e){var i,_;return null!==(_=null===(i=t._internal_labelPaneViews)||void 0===i?void 0:i.call(t,e))&&void 0!==_?_:[]}function ci(t,e){var i,_;return null!==(_=null===(i=t._internal_topPaneViews)||void 0===i?void 0:i.call(t,e))&&void 0!==_?_:[]}class vi{constructor(t,e){this._private__size=Ae({width:0,height:0}),this._private__leftPriceAxisWidget=null,this._private__rightPriceAxisWidget=null,this._private__startScrollingPos=null,this._private__isScrolling=!1,this._private__clicked=new Mt,this._private__dblClicked=new Mt,this._private__prevPinchScale=0,this._private__longTap=!1,this._private__startTrackPoint=null,this._private__exitTrackingModeOnNextTry=!1,this._private__initCrosshairPosition=null,this._private__scrollXAnimation=null,this._private__isSettingSize=!1,this._private__canvasSuggestedBitmapSizeChangedHandler=()=>{this._private__isSettingSize||null===this._private__state||this._private__model()._internal_lightUpdate()},this._private__topCanvasSuggestedBitmapSizeChangedHandler=()=>{this._private__isSettingSize||null===this._private__state||this._private__model()._internal_lightUpdate()},this._private__chart=t,this._private__state=e,this._private__state._internal_onDestroyed()._internal_subscribe(this._private__onStateDestroyed.bind(this),this,!0),this._private__paneCell=document.createElement("td"),this._private__paneCell.style.padding="0",this._private__paneCell.style.position="relative";const i=document.createElement("div");i.style.width="100%",i.style.height="100%",i.style.position="relative",i.style.overflow="hidden",this._private__leftAxisCell=document.createElement("td"),this._private__leftAxisCell.style.padding="0",this._private__rightAxisCell=document.createElement("td"),this._private__rightAxisCell.style.padding="0",this._private__paneCell.appendChild(i),this._private__canvasBinding=Ge(i,Ae({width:16,height:16})),this._private__canvasBinding.subscribeSuggestedBitmapSizeChanged(this._private__canvasSuggestedBitmapSizeChangedHandler);const _=this._private__canvasBinding.canvasElement;_.style.position="absolute",_.style.zIndex="1",_.style.left="0",_.style.top="0",this._private__topCanvasBinding=Ge(i,Ae({width:16,height:16})),this._private__topCanvasBinding.subscribeSuggestedBitmapSizeChanged(this._private__topCanvasSuggestedBitmapSizeChangedHandler);const n=this._private__topCanvasBinding.canvasElement;n.style.position="absolute",n.style.zIndex="2",n.style.left="0",n.style.top="0",this._private__rowElement=document.createElement("tr"),this._private__rowElement.appendChild(this._private__leftAxisCell),this._private__rowElement.appendChild(this._private__paneCell),this._private__rowElement.appendChild(this._private__rightAxisCell),this._internal_updatePriceAxisWidgetsStates(),this._private__mouseEventHandler=new Je(this._private__topCanvasBinding.canvasElement,this,{_internal_treatVertTouchDragAsPageScroll:()=>null===this._private__startTrackPoint&&!this._private__chart._internal_options().handleScroll.vertTouchDrag,_internal_treatHorzTouchDragAsPageScroll:()=>null===this._private__startTrackPoint&&!this._private__chart._internal_options().handleScroll.horzTouchDrag})}_internal_destroy(){null!==this._private__leftPriceAxisWidget&&this._private__leftPriceAxisWidget._internal_destroy(),null!==this._private__rightPriceAxisWidget&&this._private__rightPriceAxisWidget._internal_destroy(),this._private__topCanvasBinding.unsubscribeSuggestedBitmapSizeChanged(this._private__topCanvasSuggestedBitmapSizeChangedHandler),Ke(this._private__topCanvasBinding.canvasElement),this._private__topCanvasBinding.dispose(),this._private__canvasBinding.unsubscribeSuggestedBitmapSizeChanged(this._private__canvasSuggestedBitmapSizeChangedHandler),Ke(this._private__canvasBinding.canvasElement),this._private__canvasBinding.dispose(),null!==this._private__state&&this._private__state._internal_onDestroyed()._internal_unsubscribeAll(this),this._private__mouseEventHandler._internal_destroy()}_internal_state(){return o(this._private__state)}_internal_setState(t){null!==this._private__state&&this._private__state._internal_onDestroyed()._internal_unsubscribeAll(this),this._private__state=t,null!==this._private__state&&this._private__state._internal_onDestroyed()._internal_subscribe(vi.prototype._private__onStateDestroyed.bind(this),this,!0),this._internal_updatePriceAxisWidgetsStates()}_internal_chart(){return this._private__chart}_internal_getElement(){return this._private__rowElement}_internal_updatePriceAxisWidgetsStates(){if(null!==this._private__state&&(this._private__recreatePriceAxisWidgets(),0!==this._private__model()._internal_serieses().length)){if(null!==this._private__leftPriceAxisWidget){const t=this._private__state._internal_leftPriceScale();this._private__leftPriceAxisWidget._internal_setPriceScale(o(t))}if(null!==this._private__rightPriceAxisWidget){const t=this._private__state._internal_rightPriceScale();this._private__rightPriceAxisWidget._internal_setPriceScale(o(t))}}}_internal_updatePriceAxisWidgets(){null!==this._private__leftPriceAxisWidget&&this._private__leftPriceAxisWidget._internal_update(),null!==this._private__rightPriceAxisWidget&&this._private__rightPriceAxisWidget._internal_update()}_internal_stretchFactor(){return null!==this._private__state?this._private__state._internal_stretchFactor():0}_internal_setStretchFactor(t){this._private__state&&this._private__state._internal_setStretchFactor(t)}_internal_mouseEnterEvent(t){if(!this._private__state)return;this._private__onMouseEvent();const e=t.localX,i=t.localY;this._private__setCrosshairPosition(e,i,t)}_internal_mouseDownEvent(t){this._private__onMouseEvent(),this._private__mouseTouchDownEvent(),this._private__setCrosshairPosition(t.localX,t.localY,t)}_internal_mouseMoveEvent(t){var e;if(!this._private__state)return;this._private__onMouseEvent();const i=t.localX,_=t.localY;this._private__setCrosshairPosition(i,_,t);const n=this._internal_hitTest(i,_);this._private__chart._internal_setCursorStyle(null!==(e=null==n?void 0:n._internal_cursorStyle)&&void 0!==e?e:null),this._private__model()._internal_setHoveredSource(n&&{_internal_source:n._internal_source,_internal_object:n._internal_object})}_internal_mouseClickEvent(t){null!==this._private__state&&(this._private__onMouseEvent(),this._private__fireClickedDelegate(t))}_internal_mouseDoubleClickEvent(t){null!==this._private__state&&this._private__fireMouseClickDelegate(this._private__dblClicked,t)}_internal_doubleTapEvent(t){this._internal_mouseDoubleClickEvent(t)}_internal_pressedMouseMoveEvent(t){this._private__onMouseEvent(),this._private__pressedMouseTouchMoveEvent(t),this._private__setCrosshairPosition(t.localX,t.localY,t)}_internal_mouseUpEvent(t){null!==this._private__state&&(this._private__onMouseEvent(),this._private__longTap=!1,this._private__endScroll(t))}_internal_tapEvent(t){null!==this._private__state&&this._private__fireClickedDelegate(t)}_internal_longTapEvent(t){if(this._private__longTap=!0,null===this._private__startTrackPoint){const e={x:t.localX,y:t.localY};this._private__startTrackingMode(e,e,t)}}_internal_mouseLeaveEvent(t){null!==this._private__state&&(this._private__onMouseEvent(),this._private__state._internal_model()._internal_setHoveredSource(null),this._private__clearCrosshairPosition())}_internal_clicked(){return this._private__clicked}_internal_dblClicked(){return this._private__dblClicked}_internal_pinchStartEvent(){this._private__prevPinchScale=1,this._private__model()._internal_stopTimeScaleAnimation()}_internal_pinchEvent(t,e){if(!this._private__chart._internal_options().handleScale.pinch)return;const i=5*(e-this._private__prevPinchScale);this._private__prevPinchScale=e,this._private__model()._internal_zoomTime(t._internal_x,i)}_internal_touchStartEvent(t){this._private__longTap=!1,this._private__exitTrackingModeOnNextTry=null!==this._private__startTrackPoint,this._private__mouseTouchDownEvent();const e=this._private__model()._internal_crosshairSource();null!==this._private__startTrackPoint&&e._internal_visible()&&(this._private__initCrosshairPosition={x:e._internal_appliedX(),y:e._internal_appliedY()},this._private__startTrackPoint={x:t.localX,y:t.localY})}_internal_touchMoveEvent(t){if(null===this._private__state)return;const e=t.localX,i=t.localY;if(null===this._private__startTrackPoint)this._private__pressedMouseTouchMoveEvent(t);else{this._private__exitTrackingModeOnNextTry=!1;const _=o(this._private__initCrosshairPosition),n=_.x+(e-this._private__startTrackPoint.x),r=_.y+(i-this._private__startTrackPoint.y);this._private__setCrosshairPosition(n,r,t)}}_internal_touchEndEvent(t){0===this._internal_chart()._internal_options().trackingMode.exitMode&&(this._private__exitTrackingModeOnNextTry=!0),this._private__tryExitTrackingMode(),this._private__endScroll(t)}_internal_hitTest(t,e){const i=this._private__state;return null===i?null:function(t,e,i){const _=t._internal_orderedSources(),n=function(t,e,i){var _,n;let r,a;for(const o of t){const t=null!==(n=null===(_=o._internal_primitiveHitTest)||void 0===_?void 0:_.call(o,e,i))&&void 0!==n?n:[];for(const e of t)l=e.zOrder,(!(s=null==r?void 0:r.zOrder)||"top"===l&&"top"!==s||"normal"===l&&"bottom"===s)&&(r=e,a=o)}var l,s;return r&&a?{_internal_hit:r,_internal_source:a}:null}(_,e,i);if("top"===(null==n?void 0:n._internal_hit.zOrder))return ri(n);for(const r of _){if(n&&n._internal_source===r&&"bottom"!==n._internal_hit.zOrder&&!n._internal_hit.isBackground)return ri(n);const _=ai(r._internal_paneViews(t),e,i);if(null!==_)return{_internal_source:r,_internal_view:_._internal_view,_internal_object:_._internal_object};if(n&&n._internal_source===r&&"bottom"!==n._internal_hit.zOrder&&n._internal_hit.isBackground)return ri(n)}return(null==n?void 0:n._internal_hit)?ri(n):null}(i,t,e)}_internal_setPriceAxisSize(t,e){o("left"===e?this._private__leftPriceAxisWidget:this._private__rightPriceAxisWidget)._internal_setSize(Ae({width:t,height:this._private__size.height}))}_internal_getSize(){return this._private__size}_internal_setSize(t){De(this._private__size,t)||(this._private__size=t,this._private__isSettingSize=!0,this._private__canvasBinding.resizeCanvasElement(t),this._private__topCanvasBinding.resizeCanvasElement(t),this._private__isSettingSize=!1,this._private__paneCell.style.width=t.width+"px",this._private__paneCell.style.height=t.height+"px")}_internal_recalculatePriceScales(){const t=o(this._private__state);t._internal_recalculatePriceScale(t._internal_leftPriceScale()),t._internal_recalculatePriceScale(t._internal_rightPriceScale());for(const e of t._internal_dataSources())if(t._internal_isOverlay(e)){const i=e._internal_priceScale();null!==i&&t._internal_recalculatePriceScale(i),e._internal_updateAllViews()}}_internal_paint(t){if(0===t)return;if(null===this._private__state)return;if(t>1&&this._internal_recalculatePriceScales(),null!==this._private__leftPriceAxisWidget&&this._private__leftPriceAxisWidget._internal_paint(t),null!==this._private__rightPriceAxisWidget&&this._private__rightPriceAxisWidget._internal_paint(t),1!==t){this._private__canvasBinding.applySuggestedBitmapSize();const t=Fe(this._private__canvasBinding);null!==t&&(t.useBitmapCoordinateSpace((t=>{this._private__drawBackground(t)})),this._private__state&&(this._private__drawSources(t,oi),this._private__drawGrid(t),this._private__drawWatermark(t),this._private__drawSources(t,hi),this._private__drawSources(t,pi)))}this._private__topCanvasBinding.applySuggestedBitmapSize();const e=Fe(this._private__topCanvasBinding);null!==e&&(e.useBitmapCoordinateSpace((({context:t,bitmapSize:e})=>{t.clearRect(0,0,e.width,e.height)})),this._private__drawCrosshair(e),this._private__drawSources(e,ci))}_internal_leftPriceAxisWidget(){return this._private__leftPriceAxisWidget}_internal_rightPriceAxisWidget(){return this._private__rightPriceAxisWidget}_internal_drawAdditionalSources(t,e){this._private__drawSources(t,e)}_private__onStateDestroyed(){null!==this._private__state&&this._private__state._internal_onDestroyed()._internal_unsubscribeAll(this),this._private__state=null}_private__fireClickedDelegate(t){this._private__fireMouseClickDelegate(this._private__clicked,t)}_private__fireMouseClickDelegate(t,e){const i=e.localX,_=e.localY;t._internal_hasListeners()&&t._internal_fire(this._private__model()._internal_timeScale()._internal_coordinateToIndex(i),{x:i,y:_},e)}_private__drawBackground({context:t,bitmapSize:e}){const{width:i,height:_}=e,n=this._private__model(),r=n._internal_backgroundTopColor(),a=n._internal_backgroundBottomColor();r===a?P(t,0,0,i,_,a):z(t,0,0,i,_,r,a)}_private__drawGrid(t){const e=o(this._private__state)._internal_grid()._internal_paneView()._internal_renderer();null!==e&&e._internal_draw(t,!1)}_private__drawWatermark(t){const e=this._private__model()._internal_watermarkSource();this._private__drawSourceImpl(t,hi,Ze,e),this._private__drawSourceImpl(t,hi,qe,e)}_private__drawCrosshair(t){this._private__drawSourceImpl(t,hi,qe,this._private__model()._internal_crosshairSource())}_private__drawSources(t,e){const i=o(this._private__state)._internal_orderedSources();for(const _ of i)this._private__drawSourceImpl(t,e,Ze,_);for(const _ of i)this._private__drawSourceImpl(t,e,qe,_)}_private__drawSourceImpl(t,e,i,_){const n=o(this._private__state),r=n._internal_model()._internal_hoveredSource(),a=null!==r&&r._internal_source===_,l=null!==r&&a&&void 0!==r._internal_object?r._internal_object._internal_hitTestData:void 0;Qe(e,(e=>i(e,t,a,l)),_,n)}_private__recreatePriceAxisWidgets(){if(null===this._private__state)return;const t=this._private__chart,e=this._private__state._internal_leftPriceScale()._internal_options().visible,i=this._private__state._internal_rightPriceScale()._internal_options().visible;e||null===this._private__leftPriceAxisWidget||(this._private__leftAxisCell.removeChild(this._private__leftPriceAxisWidget._internal_getElement()),this._private__leftPriceAxisWidget._internal_destroy(),this._private__leftPriceAxisWidget=null),i||null===this._private__rightPriceAxisWidget||(this._private__rightAxisCell.removeChild(this._private__rightPriceAxisWidget._internal_getElement()),this._private__rightPriceAxisWidget._internal_destroy(),this._private__rightPriceAxisWidget=null);const _=t._internal_model()._internal_rendererOptionsProvider();e&&null===this._private__leftPriceAxisWidget&&(this._private__leftPriceAxisWidget=new si(this,t._internal_options(),_,"left"),this._private__leftAxisCell.appendChild(this._private__leftPriceAxisWidget._internal_getElement())),i&&null===this._private__rightPriceAxisWidget&&(this._private__rightPriceAxisWidget=new si(this,t._internal_options(),_,"right"),this._private__rightAxisCell.appendChild(this._private__rightPriceAxisWidget._internal_getElement()))}_private__preventScroll(t){return t._internal_isTouch&&this._private__longTap||null!==this._private__startTrackPoint}_private__correctXCoord(t){return Math.max(0,Math.min(t,this._private__size.width-1))}_private__correctYCoord(t){return Math.max(0,Math.min(t,this._private__size.height-1))}_private__setCrosshairPosition(t,e,i){this._private__model()._internal_setAndSaveCurrentPosition(this._private__correctXCoord(t),this._private__correctYCoord(e),i,o(this._private__state))}_private__clearCrosshairPosition(){this._private__model()._internal_clearCurrentPosition()}_private__tryExitTrackingMode(){this._private__exitTrackingModeOnNextTry&&(this._private__startTrackPoint=null,this._private__clearCrosshairPosition())}_private__startTrackingMode(t,e,i){this._private__startTrackPoint=t,this._private__exitTrackingModeOnNextTry=!1,this._private__setCrosshairPosition(e.x,e.y,i);const _=this._private__model()._internal_crosshairSource();this._private__initCrosshairPosition={x:_._internal_appliedX(),y:_._internal_appliedY()}}_private__model(){return this._private__chart._internal_model()}_private__endScroll(t){if(!this._private__isScrolling)return;const e=this._private__model(),i=this._internal_state();if(e._internal_endScrollPrice(i,i._internal_defaultPriceScale()),this._private__startScrollingPos=null,this._private__isScrolling=!1,e._internal_endScrollTime(),null!==this._private__scrollXAnimation){const t=performance.now(),i=e._internal_timeScale();this._private__scrollXAnimation._internal_start(i._internal_rightOffset(),t),this._private__scrollXAnimation._internal_finished(t)||e._internal_setTimeScaleAnimation(this._private__scrollXAnimation)}}_private__onMouseEvent(){this._private__startTrackPoint=null}_private__mouseTouchDownEvent(){if(this._private__state){if(this._private__model()._internal_stopTimeScaleAnimation(),document.activeElement!==document.body&&document.activeElement!==document.documentElement)o(document.activeElement).blur();else{const t=document.getSelection();null!==t&&t.removeAllRanges()}this._private__state._internal_defaultPriceScale()._internal_isEmpty()||this._private__model()._internal_timeScale()._internal_isEmpty()}}_private__pressedMouseTouchMoveEvent(t){if(null===this._private__state)return;const e=this._private__model(),i=e._internal_timeScale();if(i._internal_isEmpty())return;const _=this._private__chart._internal_options(),n=_.handleScroll,r=_.kineticScroll;if((!n.pressedMouseMove||t._internal_isTouch)&&(!n.horzTouchDrag&&!n.vertTouchDrag||!t._internal_isTouch))return;const a=this._private__state._internal_defaultPriceScale(),l=performance.now();if(null!==this._private__startScrollingPos||this._private__preventScroll(t)||(this._private__startScrollingPos={x:t.clientX,y:t.clientY,_internal_timestamp:l,_internal_localX:t.localX,_internal_localY:t.localY}),null!==this._private__startScrollingPos&&!this._private__isScrolling&&(this._private__startScrollingPos.x!==t.clientX||this._private__startScrollingPos.y!==t.clientY)){if(t._internal_isTouch&&r.touch||!t._internal_isTouch&&r.mouse){const t=i._internal_barSpacing();this._private__scrollXAnimation=new Xe(.2/t,7/t,.997,15/t),this._private__scrollXAnimation._internal_addPosition(i._internal_rightOffset(),this._private__startScrollingPos._internal_timestamp)}else this._private__scrollXAnimation=null;a._internal_isEmpty()||e._internal_startScrollPrice(this._private__state,a,t.localY),e._internal_startScrollTime(t.localX),this._private__isScrolling=!0}this._private__isScrolling&&(a._internal_isEmpty()||e._internal_scrollPriceTo(this._private__state,a,t.localY),e._internal_scrollTimeTo(t.localX),null!==this._private__scrollXAnimation&&this._private__scrollXAnimation._internal_addPosition(i._internal_rightOffset(),l))}}class di{constructor(t,e,i,_,n){this._private__invalidated=!0,this._private__size=Ae({width:0,height:0}),this._private__canvasSuggestedBitmapSizeChangedHandler=()=>this._internal_paint(3),this._private__isLeft="left"===t,this._private__rendererOptionsProvider=i._internal_rendererOptionsProvider,this._private__options=e,this._private__borderVisible=_,this._private__bottomColor=n,this._private__cell=document.createElement("div"),this._private__cell.style.width="25px",this._private__cell.style.height="100%",this._private__cell.style.overflow="hidden",this._private__canvasBinding=Ge(this._private__cell,Ae({width:16,height:16})),this._private__canvasBinding.subscribeSuggestedBitmapSizeChanged(this._private__canvasSuggestedBitmapSizeChangedHandler)}_internal_destroy(){this._private__canvasBinding.unsubscribeSuggestedBitmapSizeChanged(this._private__canvasSuggestedBitmapSizeChangedHandler),Ke(this._private__canvasBinding.canvasElement),this._private__canvasBinding.dispose()}_internal_getElement(){return this._private__cell}_internal_getSize(){return this._private__size}_internal_setSize(t){De(this._private__size,t)||(this._private__size=t,this._private__canvasBinding.resizeCanvasElement(t),this._private__cell.style.width=`${t.width}px`,this._private__cell.style.height=`${t.height}px`,this._private__invalidated=!0)}_internal_paint(t){if(t<3&&!this._private__invalidated)return;if(0===this._private__size.width||0===this._private__size.height)return;this._private__invalidated=!1,this._private__canvasBinding.applySuggestedBitmapSize();const e=Fe(this._private__canvasBinding);null!==e&&e.useBitmapCoordinateSpace((t=>{this._private__drawBackground(t),this._private__drawBorder(t)}))}_private__drawBorder({context:t,bitmapSize:e,horizontalPixelRatio:i,verticalPixelRatio:_}){if(!this._private__borderVisible())return;t.fillStyle=this._private__options.timeScale.borderColor;const n=Math.floor(this._private__rendererOptionsProvider._internal_options()._internal_borderSize*i),r=Math.floor(this._private__rendererOptionsProvider._internal_options()._internal_borderSize*_),a=this._private__isLeft?e.width-n:0;t.fillRect(a,0,n,r)}_private__drawBackground({context:t,bitmapSize:e}){P(t,0,0,e.width,e.height,this._private__bottomColor())}}function ui(t){return e=>{var i,_;return null!==(_=null===(i=e._internal_timePaneViews)||void 0===i?void 0:i.call(e,t))&&void 0!==_?_:[]}}const mi=ui("normal"),gi=ui("top"),fi=ui("bottom");class Si{constructor(t,e){this._private__leftStub=null,this._private__rightStub=null,this._private__rendererOptions=null,this._private__mouseDown=!1,this._private__size=Ae({width:0,height:0}),this._private__sizeChanged=new Mt,this._private__widthCache=new dt(5),this._private__isSettingSize=!1,this._private__canvasSuggestedBitmapSizeChangedHandler=()=>{this._private__isSettingSize||this._private__chart._internal_model()._internal_lightUpdate()},this._private__topCanvasSuggestedBitmapSizeChangedHandler=()=>{this._private__isSettingSize||this._private__chart._internal_model()._internal_lightUpdate()},this._private__chart=t,this._private__horzScaleBehavior=e,this._private__options=t._internal_options().layout,this._private__element=document.createElement("tr"),this._private__leftStubCell=document.createElement("td"),this._private__leftStubCell.style.padding="0",this._private__rightStubCell=document.createElement("td"),this._private__rightStubCell.style.padding="0",this._private__cell=document.createElement("td"),this._private__cell.style.height="25px",this._private__cell.style.padding="0",this._private__dv=document.createElement("div"),this._private__dv.style.width="100%",this._private__dv.style.height="100%",this._private__dv.style.position="relative",this._private__dv.style.overflow="hidden",this._private__cell.appendChild(this._private__dv),this._private__canvasBinding=Ge(this._private__dv,Ae({width:16,height:16})),this._private__canvasBinding.subscribeSuggestedBitmapSizeChanged(this._private__canvasSuggestedBitmapSizeChangedHandler);const i=this._private__canvasBinding.canvasElement;i.style.position="absolute",i.style.zIndex="1",i.style.left="0",i.style.top="0",this._private__topCanvasBinding=Ge(this._private__dv,Ae({width:16,height:16})),this._private__topCanvasBinding.subscribeSuggestedBitmapSizeChanged(this._private__topCanvasSuggestedBitmapSizeChangedHandler);const _=this._private__topCanvasBinding.canvasElement;_.style.position="absolute",_.style.zIndex="2",_.style.left="0",_.style.top="0",this._private__element.appendChild(this._private__leftStubCell),this._private__element.appendChild(this._private__cell),this._private__element.appendChild(this._private__rightStubCell),this._private__recreateStubs(),this._private__chart._internal_model()._internal_priceScalesOptionsChanged()._internal_subscribe(this._private__recreateStubs.bind(this),this),this._private__mouseEventHandler=new Je(this._private__topCanvasBinding.canvasElement,this,{_internal_treatVertTouchDragAsPageScroll:()=>!0,_internal_treatHorzTouchDragAsPageScroll:()=>!this._private__chart._internal_options().handleScroll.horzTouchDrag})}_internal_destroy(){this._private__mouseEventHandler._internal_destroy(),null!==this._private__leftStub&&this._private__leftStub._internal_destroy(),null!==this._private__rightStub&&this._private__rightStub._internal_destroy(),this._private__topCanvasBinding.unsubscribeSuggestedBitmapSizeChanged(this._private__topCanvasSuggestedBitmapSizeChangedHandler),Ke(this._private__topCanvasBinding.canvasElement),this._private__topCanvasBinding.dispose(),this._private__canvasBinding.unsubscribeSuggestedBitmapSizeChanged(this._private__canvasSuggestedBitmapSizeChangedHandler),Ke(this._private__canvasBinding.canvasElement),this._private__canvasBinding.dispose()}_internal_getElement(){return this._private__element}_internal_mouseDownEvent(t){if(this._private__mouseDown)return;this._private__mouseDown=!0;const e=this._private__chart._internal_model();!e._internal_timeScale()._internal_isEmpty()&&this._private__chart._internal_options().handleScale.axisPressedMouseMove.time&&e._internal_startScaleTime(t.localX)}_internal_touchStartEvent(t){this._internal_mouseDownEvent(t)}_internal_mouseDownOutsideEvent(){const t=this._private__chart._internal_model();!t._internal_timeScale()._internal_isEmpty()&&this._private__mouseDown&&(this._private__mouseDown=!1,this._private__chart._internal_options().handleScale.axisPressedMouseMove.time&&t._internal_endScaleTime())}_internal_pressedMouseMoveEvent(t){const e=this._private__chart._internal_model();!e._internal_timeScale()._internal_isEmpty()&&this._private__chart._internal_options().handleScale.axisPressedMouseMove.time&&e._internal_scaleTimeTo(t.localX)}_internal_touchMoveEvent(t){this._internal_pressedMouseMoveEvent(t)}_internal_mouseUpEvent(){this._private__mouseDown=!1;const t=this._private__chart._internal_model();t._internal_timeScale()._internal_isEmpty()&&!this._private__chart._internal_options().handleScale.axisPressedMouseMove.time||t._internal_endScaleTime()}_internal_touchEndEvent(){this._internal_mouseUpEvent()}_internal_mouseDoubleClickEvent(){this._private__chart._internal_options().handleScale.axisDoubleClickReset.time&&this._private__chart._internal_model()._internal_resetTimeScale()}_internal_doubleTapEvent(){this._internal_mouseDoubleClickEvent()}_internal_mouseEnterEvent(){this._private__chart._internal_model()._internal_options().handleScale.axisPressedMouseMove.time&&this._private__setCursor(1)}_internal_mouseLeaveEvent(){this._private__setCursor(0)}_internal_getSize(){return this._private__size}_internal_setSizes(t,e,i){De(this._private__size,t)||(this._private__size=t,this._private__isSettingSize=!0,this._private__canvasBinding.resizeCanvasElement(t),this._private__topCanvasBinding.resizeCanvasElement(t),this._private__isSettingSize=!1,this._private__cell.style.width=`${t.width}px`,this._private__cell.style.height=`${t.height}px`,this._private__sizeChanged._internal_fire(t)),null!==this._private__leftStub&&this._private__leftStub._internal_setSize(Ae({width:e,height:t.height})),null!==this._private__rightStub&&this._private__rightStub._internal_setSize(Ae({width:i,height:t.height}))}_internal_optimalHeight(){const t=this._private__getRendererOptions();return Math.ceil(t._internal_borderSize+t._internal_tickLength+t._internal_fontSize+t._internal_paddingTop+t._internal_paddingBottom+t._internal_labelBottomOffset)}_internal_update(){this._private__chart._internal_model()._internal_timeScale()._internal_marks()}_internal_paint(t){if(0===t)return;if(1!==t){this._private__canvasBinding.applySuggestedBitmapSize();const e=Fe(this._private__canvasBinding);null!==e&&(e.useBitmapCoordinateSpace((t=>{this._private__drawBackground(t),this._private__drawBorder(t),this._private__drawAdditionalSources(e,fi)})),this._private__drawTickMarks(e),this._private__drawAdditionalSources(e,mi)),null!==this._private__leftStub&&this._private__leftStub._internal_paint(t),null!==this._private__rightStub&&this._private__rightStub._internal_paint(t)}this._private__topCanvasBinding.applySuggestedBitmapSize();const e=Fe(this._private__topCanvasBinding);null!==e&&(e.useBitmapCoordinateSpace((({context:t,bitmapSize:e})=>{t.clearRect(0,0,e.width,e.height)})),this._private__drawLabels([...this._private__chart._internal_model()._internal_serieses(),this._private__chart._internal_model()._internal_crosshairSource()],e),this._private__drawAdditionalSources(e,gi))}_private__drawAdditionalSources(t,e){const i=this._private__chart._internal_model()._internal_serieses();for(const _ of i)Qe(e,(e=>Ze(e,t,!1,void 0)),_,void 0);for(const _ of i)Qe(e,(e=>qe(e,t,!1,void 0)),_,void 0)}_private__drawBackground({context:t,bitmapSize:e}){P(t,0,0,e.width,e.height,this._private__chart._internal_model()._internal_backgroundBottomColor())}_private__drawBorder({context:t,bitmapSize:e,verticalPixelRatio:i}){if(this._private__chart._internal_options().timeScale.borderVisible){t.fillStyle=this._private__lineColor();const _=Math.max(1,Math.floor(this._private__getRendererOptions()._internal_borderSize*i));t.fillRect(0,0,e.width,_)}}_private__drawTickMarks(t){const e=this._private__chart._internal_model()._internal_timeScale(),i=e._internal_marks();if(!i||0===i.length)return;const _=this._private__horzScaleBehavior.maxTickMarkWeight(i),n=this._private__getRendererOptions(),r=e._internal_options();r.borderVisible&&r.ticksVisible&&t.useBitmapCoordinateSpace((({context:t,horizontalPixelRatio:e,verticalPixelRatio:_})=>{t.strokeStyle=this._private__lineColor(),t.fillStyle=this._private__lineColor();const r=Math.max(1,Math.floor(e)),a=Math.floor(.5*e);t.beginPath();const l=Math.round(n._internal_tickLength*_);for(let _=i.length;_--;){const n=Math.round(i[_].coord*e);t.rect(n-a,0,r,l)}t.fill()})),t.useMediaCoordinateSpace((({context:t})=>{const e=n._internal_borderSize+n._internal_tickLength+n._internal_paddingTop+n._internal_fontSize/2;t.textAlign="center",t.textBaseline="middle",t.fillStyle=this._private__textColor(),t.font=this._private__baseFont();for(const n of i)if(n.weight<_){const i=n.needAlignCoordinate?this._private__alignTickMarkLabelCoordinate(t,n.coord,n.label):n.coord;t.fillText(n.label,i,e)}this._private__chart._internal_options().timeScale.allowBoldLabels&&(t.font=this._private__baseBoldFont());for(const n of i)if(n.weight>=_){const i=n.needAlignCoordinate?this._private__alignTickMarkLabelCoordinate(t,n.coord,n.label):n.coord;t.fillText(n.label,i,e)}}))}_private__alignTickMarkLabelCoordinate(t,e,i){const _=this._private__widthCache._internal_measureText(t,i),n=_/2,r=Math.floor(e-n)+.5;return r<0?e+=Math.abs(0-r):r+_>this._private__size.width&&(e-=Math.abs(this._private__size.width-(r+_))),e}_private__drawLabels(t,e){const i=this._private__getRendererOptions();for(const _ of t)for(const t of _._internal_timeAxisViews())t._internal_renderer()._internal_draw(e,i)}_private__lineColor(){return this._private__chart._internal_options().timeScale.borderColor}_private__textColor(){return this._private__options.textColor}_private__fontSize(){return this._private__options.fontSize}_private__baseFont(){return Et(this._private__fontSize(),this._private__options.fontFamily)}_private__baseBoldFont(){return Et(this._private__fontSize(),this._private__options.fontFamily,"bold")}_private__getRendererOptions(){null===this._private__rendererOptions&&(this._private__rendererOptions={_internal_borderSize:1,_internal_baselineOffset:NaN,_internal_paddingTop:NaN,_internal_paddingBottom:NaN,_internal_paddingHorizontal:NaN,_internal_tickLength:5,_internal_fontSize:NaN,_internal_font:"",_internal_widthCache:new dt,_internal_labelBottomOffset:0});const t=this._private__rendererOptions,e=this._private__baseFont();if(t._internal_font!==e){const i=this._private__fontSize();t._internal_fontSize=i,t._internal_font=e,t._internal_paddingTop=3*i/12,t._internal_paddingBottom=3*i/12,t._internal_paddingHorizontal=9*i/12,t._internal_baselineOffset=0,t._internal_labelBottomOffset=4*i/12,t._internal_widthCache._internal_reset()}return this._private__rendererOptions}_private__setCursor(t){this._private__cell.style.cursor=1===t?"ew-resize":"default"}_private__recreateStubs(){const t=this._private__chart._internal_model(),e=t._internal_options();e.leftPriceScale.visible||null===this._private__leftStub||(this._private__leftStubCell.removeChild(this._private__leftStub._internal_getElement()),this._private__leftStub._internal_destroy(),this._private__leftStub=null),e.rightPriceScale.visible||null===this._private__rightStub||(this._private__rightStubCell.removeChild(this._private__rightStub._internal_getElement()),this._private__rightStub._internal_destroy(),this._private__rightStub=null);const i={_internal_rendererOptionsProvider:this._private__chart._internal_model()._internal_rendererOptionsProvider()},_=()=>e.leftPriceScale.borderVisible&&t._internal_timeScale()._internal_options().borderVisible,n=()=>t._internal_backgroundBottomColor();e.leftPriceScale.visible&&null===this._private__leftStub&&(this._private__leftStub=new di("left",e,i,_,n),this._private__leftStubCell.appendChild(this._private__leftStub._internal_getElement())),e.rightPriceScale.visible&&null===this._private__rightStub&&(this._private__rightStub=new di("right",e,i,_,n),this._private__rightStubCell.appendChild(this._private__rightStub._internal_getElement()))}}const bi=!!Ne&&!!navigator.userAgentData&&navigator.userAgentData.brands.some((t=>t.brand.includes("Chromium")))&&!!Ne&&((null===(wi=null===navigator||void 0===navigator?void 0:navigator.userAgentData)||void 0===wi?void 0:wi.platform)?"Windows"===navigator.userAgentData.platform:navigator.userAgent.toLowerCase().indexOf("win")>=0);var wi;class Ci{constructor(t,e,i){this._private__paneWidgets=[],this._private__drawRafId=0,this._private__height=0,this._private__width=0,this._private__leftPriceAxisWidth=0,this._private__rightPriceAxisWidth=0,this._private__invalidateMask=null,this._private__drawPlanned=!1,this._private__clicked=new Mt,this._private__dblClicked=new Mt,this._private__crosshairMoved=new Mt,this._private__observer=null,this._private__cursorStyleOverride=null,this._private__options=e,this._private__horzScaleBehavior=i,this._private__element=document.createElement("div"),this._private__element.classList.add("tv-lightweight-charts"),this._private__element.style.overflow="hidden",this._private__element.style.direction="ltr",this._private__element.style.width="100%",this._private__element.style.height="100%",this._private__tableElement=document.createElement("table"),this._private__tableElement.setAttribute("cellspacing","0"),this._private__element.appendChild(this._private__tableElement),this._private__onWheelBound=this._private__onMousewheel.bind(this),xi(this._private__options)&&this._private__setMouseWheelEventListener(!0),this._private__model=new Ce(this._private__invalidateHandler.bind(this),this._private__options,i),this._internal_model()._internal_crosshairMoved()._internal_subscribe(this._private__onPaneWidgetCrosshairMoved.bind(this),this),this._private__timeAxisWidget=new Si(this,this._private__horzScaleBehavior),this._private__tableElement.appendChild(this._private__timeAxisWidget._internal_getElement());const _=e.autoSize&&this._private__installObserver();let n=this._private__options.width,r=this._private__options.height;if(_||0===n||0===r){const e=t.getBoundingClientRect();n=n||e.width,r=r||e.height}this._internal_resize(n,r),this._private__syncGuiWithModel(),t.appendChild(this._private__element),this._private__updateTimeAxisVisibility(),this._private__model._internal_timeScale()._internal_optionsApplied()._internal_subscribe(this._private__model._internal_fullUpdate.bind(this._private__model),this),this._private__model._internal_priceScalesOptionsChanged()._internal_subscribe(this._private__model._internal_fullUpdate.bind(this._private__model),this)}_internal_model(){return this._private__model}_internal_options(){return this._private__options}_internal_timeAxisWidget(){return this._private__timeAxisWidget}_internal_destroy(){this._private__setMouseWheelEventListener(!1),0!==this._private__drawRafId&&window.cancelAnimationFrame(this._private__drawRafId),this._private__model._internal_crosshairMoved()._internal_unsubscribeAll(this),this._private__model._internal_timeScale()._internal_optionsApplied()._internal_unsubscribeAll(this),this._private__model._internal_priceScalesOptionsChanged()._internal_unsubscribeAll(this),this._private__model._internal_destroy();for(const t of this._private__paneWidgets)this._private__tableElement.removeChild(t._internal_getElement()),t._internal_clicked()._internal_unsubscribeAll(this),t._internal_dblClicked()._internal_unsubscribeAll(this),t._internal_destroy();this._private__paneWidgets=[],o(this._private__timeAxisWidget)._internal_destroy(),null!==this._private__element.parentElement&&this._private__element.parentElement.removeChild(this._private__element),this._private__crosshairMoved._internal_destroy(),this._private__clicked._internal_destroy(),this._private__dblClicked._internal_destroy(),this._private__uninstallObserver()}_internal_resize(t,e,i=!1){if(this._private__height===e&&this._private__width===t)return;const _=function(t){const e=Math.floor(t.width),i=Math.floor(t.height);return Ae({width:e-e%2,height:i-i%2})}(Ae({width:t,height:e}));this._private__height=_.height,this._private__width=_.width;const n=this._private__height+"px",r=this._private__width+"px";o(this._private__element).style.height=n,o(this._private__element).style.width=r,this._private__tableElement.style.height=n,this._private__tableElement.style.width=r,i?this._private__drawImpl(Rt._internal_full(),performance.now()):this._private__model._internal_fullUpdate()}_internal_paint(t){void 0===t&&(t=Rt._internal_full());for(let e=0;e<this._private__paneWidgets.length;e++)this._private__paneWidgets[e]._internal_paint(t._internal_invalidateForPane(e)._internal_level);this._private__options.timeScale.visible&&this._private__timeAxisWidget._internal_paint(t._internal_fullInvalidation())}_internal_applyOptions(t){const e=xi(this._private__options);this._private__model._internal_applyOptions(t);const i=xi(this._private__options);i!==e&&this._private__setMouseWheelEventListener(i),this._private__updateTimeAxisVisibility(),this._private__applyAutoSizeOptions(t)}_internal_clicked(){return this._private__clicked}_internal_dblClicked(){return this._private__dblClicked}_internal_crosshairMoved(){return this._private__crosshairMoved}_internal_getPriceAxisWidth(t){return("left"!==t||this._private__isLeftAxisVisible())&&("right"!==t||this._private__isRightAxisVisible())?0===this._private__paneWidgets.length?0:o("left"===t?this._private__paneWidgets[0]._internal_leftPriceAxisWidget():this._private__paneWidgets[0]._internal_rightPriceAxisWidget())._internal_getWidth():0}_internal_element(){return this._private__element}_internal_setCursorStyle(t){this._private__cursorStyleOverride=t,this._private__cursorStyleOverride?this._internal_element().style.setProperty("cursor",t):this._internal_element().style.removeProperty("cursor")}_private__applyAutoSizeOptions(t){t.autoSize&&!this._private__observer&&this._private__installObserver(),t.autoSize||void 0===t.width&&void 0===t.height||this._internal_resize(t.width||this._private__width,t.height||this._private__height)}_private__adjustSizeImpl(){let t=0,e=0,i=0;for(const _ of this._private__paneWidgets)this._private__isLeftAxisVisible()&&(e=Math.max(e,o(_._internal_leftPriceAxisWidget())._internal_optimalWidth(),this._private__options.leftPriceScale.minimumWidth)),this._private__isRightAxisVisible()&&(i=Math.max(i,o(_._internal_rightPriceAxisWidget())._internal_optimalWidth(),this._private__options.rightPriceScale.minimumWidth)),t+=_._internal_stretchFactor();e=Ye(e),i=Ye(i);const _=this._private__width,n=this._private__height,r=Math.max(_-e-i,0),a=this._private__options.timeScale.visible;let l=a?Math.max(this._private__timeAxisWidget._internal_optimalHeight(),this._private__options.timeScale.minimumHeight):0;var s;l=(s=l)+s%2;const h=0+l,p=n<h?0:n-h,c=p/t;let v=0;for(let t=0;t<this._private__paneWidgets.length;++t){const _=this._private__paneWidgets[t];_._internal_setState(this._private__model._internal_panes()[t]);let n=0,a=0;a=t===this._private__paneWidgets.length-1?p-v:Math.round(_._internal_stretchFactor()*c),n=Math.max(a,2),v+=n,_._internal_setSize(Ae({width:r,height:n})),this._private__isLeftAxisVisible()&&_._internal_setPriceAxisSize(e,"left"),this._private__isRightAxisVisible()&&_._internal_setPriceAxisSize(i,"right"),_._internal_state()&&this._private__model._internal_setPaneHeight(_._internal_state(),n)}this._private__timeAxisWidget._internal_setSizes(Ae({width:a?r:0,height:l}),a?e:0,a?i:0),this._private__model._internal_setWidth(r),this._private__leftPriceAxisWidth!==e&&(this._private__leftPriceAxisWidth=e),this._private__rightPriceAxisWidth!==i&&(this._private__rightPriceAxisWidth=i)}_private__setMouseWheelEventListener(t){t?this._private__element.addEventListener("wheel",this._private__onWheelBound,{passive:!1}):this._private__element.removeEventListener("wheel",this._private__onWheelBound)}_private__determineWheelSpeedAdjustment(t){switch(t.deltaMode){case t.DOM_DELTA_PAGE:return 120;case t.DOM_DELTA_LINE:return 32}return bi?1/window.devicePixelRatio:1}_private__onMousewheel(t){if(!(0!==t.deltaX&&this._private__options.handleScroll.mouseWheel||0!==t.deltaY&&this._private__options.handleScale.mouseWheel))return;const e=this._private__determineWheelSpeedAdjustment(t),i=e*t.deltaX/100,_=-e*t.deltaY/100;if(t.cancelable&&t.preventDefault(),0!==_&&this._private__options.handleScale.mouseWheel){const e=Math.sign(_)*Math.min(1,Math.abs(_)),i=t.clientX-this._private__element.getBoundingClientRect().left;this._internal_model()._internal_zoomTime(i,e)}0!==i&&this._private__options.handleScroll.mouseWheel&&this._internal_model()._internal_scrollChart(-80*i)}_private__drawImpl(t,e){var i;const _=t._internal_fullInvalidation();3===_&&this._private__updateGui(),3!==_&&2!==_||(this._private__applyMomentaryAutoScale(t),this._private__applyTimeScaleInvalidations(t,e),this._private__timeAxisWidget._internal_update(),this._private__paneWidgets.forEach((t=>{t._internal_updatePriceAxisWidgets()})),3===(null===(i=this._private__invalidateMask)||void 0===i?void 0:i._internal_fullInvalidation())&&(this._private__invalidateMask._internal_merge(t),this._private__updateGui(),this._private__applyMomentaryAutoScale(this._private__invalidateMask),this._private__applyTimeScaleInvalidations(this._private__invalidateMask,e),t=this._private__invalidateMask,this._private__invalidateMask=null)),this._internal_paint(t)}_private__applyTimeScaleInvalidations(t,e){for(const i of t._internal_timeScaleInvalidations())this._private__applyTimeScaleInvalidation(i,e)}_private__applyMomentaryAutoScale(t){const e=this._private__model._internal_panes();for(let i=0;i<e.length;i++)t._internal_invalidateForPane(i)._internal_autoScale&&e[i]._internal_momentaryAutoScale()}_private__applyTimeScaleInvalidation(t,e){const i=this._private__model._internal_timeScale();switch(t._internal_type){case 0:i._internal_fitContent();break;case 1:i._internal_setLogicalRange(t._internal_value);break;case 2:i._internal_setBarSpacing(t._internal_value);break;case 3:i._internal_setRightOffset(t._internal_value);break;case 4:i._internal_restoreDefault();break;case 5:t._internal_value._internal_finished(e)||i._internal_setRightOffset(t._internal_value._internal_getPosition(e))}}_private__invalidateHandler(t){null!==this._private__invalidateMask?this._private__invalidateMask._internal_merge(t):this._private__invalidateMask=t,this._private__drawPlanned||(this._private__drawPlanned=!0,this._private__drawRafId=window.requestAnimationFrame((t=>{if(this._private__drawPlanned=!1,this._private__drawRafId=0,null!==this._private__invalidateMask){const e=this._private__invalidateMask;this._private__invalidateMask=null,this._private__drawImpl(e,t);for(const i of e._internal_timeScaleInvalidations())if(5===i._internal_type&&!i._internal_value._internal_finished(t)){this._internal_model()._internal_setTimeScaleAnimation(i._internal_value);break}}})))}_private__updateGui(){this._private__syncGuiWithModel()}_private__syncGuiWithModel(){const t=this._private__model._internal_panes(),e=t.length,i=this._private__paneWidgets.length;for(let t=e;t<i;t++){const t=s(this._private__paneWidgets.pop());this._private__tableElement.removeChild(t._internal_getElement()),t._internal_clicked()._internal_unsubscribeAll(this),t._internal_dblClicked()._internal_unsubscribeAll(this),t._internal_destroy()}for(let _=i;_<e;_++){const e=new vi(this,t[_]);e._internal_clicked()._internal_subscribe(this._private__onPaneWidgetClicked.bind(this),this),e._internal_dblClicked()._internal_subscribe(this._private__onPaneWidgetDblClicked.bind(this),this),this._private__paneWidgets.push(e),this._private__tableElement.insertBefore(e._internal_getElement(),this._private__timeAxisWidget._internal_getElement())}for(let i=0;i<e;i++){const e=t[i],_=this._private__paneWidgets[i];_._internal_state()!==e?_._internal_setState(e):_._internal_updatePriceAxisWidgetsStates()}this._private__updateTimeAxisVisibility(),this._private__adjustSizeImpl()}_private__getMouseEventParamsImpl(t,e,i){var _;const n=new Map;let r;if(null!==t&&this._private__model._internal_serieses().forEach((e=>{const i=e._internal_bars()._internal_search(t);null!==i&&n.set(e,i)})),null!==t){const e=null===(_=this._private__model._internal_timeScale()._internal_indexToTimeScalePoint(t))||void 0===_?void 0:_.originalTime;void 0!==e&&(r=e)}const a=this._internal_model()._internal_hoveredSource(),l=null!==a&&a._internal_source instanceof Yt?a._internal_source:void 0,s=null!==a&&void 0!==a._internal_object?a._internal_object._internal_externalId:void 0;return{_internal_originalTime:r,_internal_index:null!=t?t:void 0,_internal_point:null!=e?e:void 0,_internal_hoveredSeries:l,_internal_seriesData:n,_internal_hoveredObject:s,_internal_touchMouseEventData:null!=i?i:void 0}}_private__onPaneWidgetClicked(t,e,i){this._private__clicked._internal_fire((()=>this._private__getMouseEventParamsImpl(t,e,i)))}_private__onPaneWidgetDblClicked(t,e,i){this._private__dblClicked._internal_fire((()=>this._private__getMouseEventParamsImpl(t,e,i)))}_private__onPaneWidgetCrosshairMoved(t,e,i){this._private__crosshairMoved._internal_fire((()=>this._private__getMouseEventParamsImpl(t,e,i)))}_private__updateTimeAxisVisibility(){this._private__timeAxisWidget._internal_getElement().style.display=this._private__options.timeScale.visible?"":"none"}_private__isLeftAxisVisible(){return this._private__paneWidgets[0]._internal_state()._internal_leftPriceScale()._internal_options().visible}_private__isRightAxisVisible(){return this._private__paneWidgets[0]._internal_state()._internal_rightPriceScale()._internal_options().visible}}function xi(t){return Boolean(t.handleScroll.mouseWheel||t.handleScale.mouseWheel)}function Ti(t){return void 0!==t.open||void 0!==t.value}function yi(t,e,i,_){const n=i.value,r={_internal_index:e,_internal_time:t,_internal_value:[n,n,n,n],_internal_originalTime:_};return void 0!==i.color&&(r._internal_color=i.color),r}function Pi(t,e,i,_){const n=i.value,r={_internal_index:e,_internal_time:t,_internal_value:[n,n,n,n],_internal_originalTime:_};return void 0!==i.lineColor&&(r._internal_lineColor=i.lineColor),void 0!==i.topColor&&(r._internal_topColor=i.topColor),void 0!==i.bottomColor&&(r._internal_bottomColor=i.bottomColor),r}function Mi(t,e,i,_){const n=i.value,r={_internal_index:e,_internal_time:t,_internal_value:[n,n,n,n],_internal_originalTime:_};return void 0!==i.topLineColor&&(r._internal_topLineColor=i.topLineColor),void 0!==i.bottomLineColor&&(r._internal_bottomLineColor=i.bottomLineColor),void 0!==i.topFillColor1&&(r._internal_topFillColor1=i.topFillColor1),void 0!==i.topFillColor2&&(r._internal_topFillColor2=i.topFillColor2),void 0!==i.bottomFillColor1&&(r._internal_bottomFillColor1=i.bottomFillColor1),void 0!==i.bottomFillColor2&&(r._internal_bottomFillColor2=i.bottomFillColor2),r}function ki(t,e,i,_){const n={_internal_index:e,_internal_time:t,_internal_value:[i.open,i.high,i.low,i.close],_internal_originalTime:_};return void 0!==i.color&&(n._internal_color=i.color),n}function Ei(t,e,i,_){const n={_internal_index:e,_internal_time:t,_internal_value:[i.open,i.high,i.low,i.close],_internal_originalTime:_};return void 0!==i.color&&(n._internal_color=i.color),void 0!==i.borderColor&&(n._internal_borderColor=i.borderColor),void 0!==i.wickColor&&(n._internal_wickColor=i.wickColor),n}function zi(t,e,i,_,n){const r=s(n)(i),a=Math.max(...r),l=Math.min(...r),o=r[r.length-1],h=[o,a,l,o],p=i,{color:c}=p;return{_internal_index:e,_internal_time:t,_internal_value:h,_internal_originalTime:_,_internal_data:function(t,e){let i,_;const n={};for(_ in t)Object.prototype.hasOwnProperty.call(t,_)&&e.indexOf(_)<0&&(n[_]=t[_]);for(null!=t&&"function"==typeof Object.getOwnPropertySymbols&&(i=0),_=Object.getOwnPropertySymbols(t);i<_.length;i++)e.indexOf(_[i])<0&&Object.prototype.propertyIsEnumerable.call(t,_[i])&&(n[_[i]]=t[_[i]]);return n}(p,["time","color"]),_internal_color:c}}function Ri(t){return void 0!==t._internal_value}function Bi(t,e){return void 0!==e.customValues&&(t._internal_customValues=e.customValues),t}function Ii(t){return(e,i,_,n,r,a)=>function(t,e){return e?e(t):function(t){return void 0===t.open&&void 0===t.value}(t)}(_,a)?Bi({_internal_time:e,_internal_index:i,_internal_originalTime:n},_):Bi(t(e,i,_,n,r),_)}function Ai(t,e){if(void 0!==t&&0!==t.length)return{_internal_firstTime:e.key(t[0]._internal_time),_internal_lastTime:e.key(t[t.length-1]._internal_time)}}function Di(t){let e;return t.forEach((t=>{void 0===e&&(e=t._internal_originalTime)})),s(e)}class Vi{constructor(t){this._private__pointDataByTimePoint=new Map,this._private__seriesRowsBySeries=new Map,this._private__seriesLastTimePoint=new Map,this._private__sortedTimePoints=[],this._private__horzScaleBehavior=t}_internal_destroy(){this._private__pointDataByTimePoint.clear(),this._private__seriesRowsBySeries.clear(),this._private__seriesLastTimePoint.clear(),this._private__sortedTimePoints=[]}_internal_setSeriesData(t,e){let i=0!==this._private__pointDataByTimePoint.size,_=!1;const n=this._private__seriesRowsBySeries.get(t);if(void 0!==n)if(1===this._private__seriesRowsBySeries.size)i=!1,_=!0,this._private__pointDataByTimePoint.clear();else for(const e of this._private__sortedTimePoints)e.pointData._internal_mapping.delete(t)&&(_=!0);let r=[];if(0!==e.length){const i=e.map((t=>t.time)),n=this._private__horzScaleBehavior.createConverterToInternalObj(e),l=(a=t._internal_seriesType(),{Candlestick:Ii(Ei),Bar:Ii(ki),Area:Ii(Pi),Baseline:Ii(Mi),Histogram:Ii(yi),Line:Ii(yi),Custom:Ii(zi)}[a]),s=t._internal_customSeriesPlotValuesBuilder(),o=t._internal_customSeriesWhitespaceCheck();r=e.map(((e,r)=>{const a=n(e.time),h=this._private__horzScaleBehavior.key(a);let p=this._private__pointDataByTimePoint.get(h);var c;void 0===p&&(c=a,p={_internal_index:0,_internal_mapping:new Map,_internal_timePoint:c},this._private__pointDataByTimePoint.set(h,p),_=!0);const v=l(a,p._internal_index,e,i[r],s,o);return p._internal_mapping.set(t,v),v}))}var a;i&&this._private__cleanupPointsData(),this._private__setRowsToSeries(t,r);let l=-1;if(_){const t=[];this._private__pointDataByTimePoint.forEach((e=>{t.push({timeWeight:0,time:e._internal_timePoint,pointData:e,originalTime:Di(e._internal_mapping)})})),t.sort(((t,e)=>this._private__horzScaleBehavior.key(t.time)-this._private__horzScaleBehavior.key(e.time))),l=this._private__replaceTimeScalePoints(t)}return this._private__getUpdateResponse(t,l,function(t,e,i){const _=Ai(t,i),n=Ai(e,i);if(void 0!==_&&void 0!==n)return{_internal_lastBarUpdatedOrNewBarsAddedToTheRight:_._internal_lastTime>=n._internal_lastTime&&_._internal_firstTime>=n._internal_firstTime}}(this._private__seriesRowsBySeries.get(t),n,this._private__horzScaleBehavior))}_private__setRowsToSeries(t,e){0!==e.length?(this._private__seriesRowsBySeries.set(t,e.filter(Ri)),this._private__seriesLastTimePoint.set(t,e[e.length-1]._internal_time)):(this._private__seriesRowsBySeries.delete(t),this._private__seriesLastTimePoint.delete(t))}_private__cleanupPointsData(){for(const t of this._private__sortedTimePoints)0===t.pointData._internal_mapping.size&&this._private__pointDataByTimePoint.delete(this._private__horzScaleBehavior.key(t.time))}_private__replaceTimeScalePoints(t){let e=-1;for(let i=0;i<this._private__sortedTimePoints.length&&i<t.length;++i){const _=this._private__sortedTimePoints[i],n=t[i];if(this._private__horzScaleBehavior.key(_.time)!==this._private__horzScaleBehavior.key(n.time)){e=i;break}n.timeWeight=_.timeWeight,Oi(n.pointData,i)}if(-1===e&&this._private__sortedTimePoints.length!==t.length&&(e=Math.min(this._private__sortedTimePoints.length,t.length)),-1===e)return-1;for(let i=e;i<t.length;++i)Oi(t[i].pointData,i);return this._private__horzScaleBehavior.fillWeightsForPoints(t,e),this._private__sortedTimePoints=t,e}_private__getBaseIndex(){if(0===this._private__seriesRowsBySeries.size)return null;let t=0;return this._private__seriesRowsBySeries.forEach((e=>{0!==e.length&&(t=Math.max(t,e[e.length-1]._internal_index))})),t}_private__getUpdateResponse(t,e,i){const _={_internal_series:new Map,_internal_timeScale:{_internal_baseIndex:this._private__getBaseIndex()}};if(-1!==e)this._private__seriesRowsBySeries.forEach(((e,n)=>{_._internal_series.set(n,{_internal_data:e,_internal_info:n===t?i:void 0})})),this._private__seriesRowsBySeries.has(t)||_._internal_series.set(t,{_internal_data:[],_internal_info:i}),_._internal_timeScale._internal_points=this._private__sortedTimePoints,_._internal_timeScale._internal_firstChangedPointIndex=e;else{const e=this._private__seriesRowsBySeries.get(t);_._internal_series.set(t,{_internal_data:e||[],_internal_info:i})}return _}}function Oi(t,e){t._internal_index=e,t._internal_mapping.forEach((t=>{t._internal_index=e}))}function Li(t){const e={value:t._internal_value[3],time:t._internal_originalTime};return void 0!==t._internal_customValues&&(e.customValues=t._internal_customValues),e}function Wi(t){const e=Li(t);return void 0!==t._internal_color&&(e.color=t._internal_color),e}function Fi(t){const e=Li(t);return void 0!==t._internal_lineColor&&(e.lineColor=t._internal_lineColor),void 0!==t._internal_topColor&&(e.topColor=t._internal_topColor),void 0!==t._internal_bottomColor&&(e.bottomColor=t._internal_bottomColor),e}function Ni(t){const e=Li(t);return void 0!==t._internal_topLineColor&&(e.topLineColor=t._internal_topLineColor),void 0!==t._internal_bottomLineColor&&(e.bottomLineColor=t._internal_bottomLineColor),void 0!==t._internal_topFillColor1&&(e.topFillColor1=t._internal_topFillColor1),void 0!==t._internal_topFillColor2&&(e.topFillColor2=t._internal_topFillColor2),void 0!==t._internal_bottomFillColor1&&(e.bottomFillColor1=t._internal_bottomFillColor1),void 0!==t._internal_bottomFillColor2&&(e.bottomFillColor2=t._internal_bottomFillColor2),e}function Hi(t){const e={open:t._internal_value[0],high:t._internal_value[1],low:t._internal_value[2],close:t._internal_value[3],time:t._internal_originalTime};return void 0!==t._internal_customValues&&(e.customValues=t._internal_customValues),e}function Ui(t){const e=Hi(t);return void 0!==t._internal_color&&(e.color=t._internal_color),e}function Yi(t){const e=Hi(t),{_internal_color:i,_internal_borderColor:_,_internal_wickColor:n}=t;return void 0!==i&&(e.color=i),void 0!==_&&(e.borderColor=_),void 0!==n&&(e.wickColor=n),e}function $i(t){const e=t._internal_originalTime;return Object.assign(Object.assign({},t._internal_data),{time:e})}const ji={vertLine:{color:"#9598A1",width:1,style:3,visible:!0,labelVisible:!0,labelBackgroundColor:"#131722"},horzLine:{color:"#9598A1",width:1,style:3,visible:!0,labelVisible:!0,labelBackgroundColor:"#131722"},mode:0},Xi={vertLines:{color:"#D6DCDE",style:0,visible:!0},horzLines:{color:"#D6DCDE",style:0,visible:!0}},Gi={background:{type:"solid",color:"#FFFFFF"},textColor:"#191919",fontSize:12,fontFamily:kt},Ki={autoScale:!0,mode:0,invertScale:!1,alignLabels:!0,borderVisible:!0,borderColor:"#2B2B43",entireTextOnly:!1,visible:!1,ticksVisible:!1,scaleMargins:{bottom:.1,top:.2},minimumWidth:0},Zi={rightOffset:0,barSpacing:6,minBarSpacing:.5,fixLeftEdge:!1,fixRightEdge:!1,lockVisibleTimeRangeOnResize:!1,rightBarStaysOnScroll:!1,borderVisible:!0,borderColor:"#2B2B43",visible:!0,timeVisible:!1,secondsVisible:!0,shiftVisibleRangeOnNewBar:!0,allowShiftVisibleRangeOnWhitespaceReplacement:!1,ticksVisible:!1,uniformDistribution:!1,minimumHeight:0,allowBoldLabels:!0},qi={color:"rgba(0, 0, 0, 0)",visible:!1,fontSize:48,fontFamily:kt,fontStyle:"",text:"",horzAlign:"center",vertAlign:"center"};function Qi(){return{width:0,height:0,autoSize:!1,layout:Gi,crosshair:ji,grid:Xi,overlayPriceScales:Object.assign({},Ki),leftPriceScale:Object.assign(Object.assign({},Ki),{visible:!1}),rightPriceScale:Object.assign(Object.assign({},Ki),{visible:!0}),timeScale:Zi,watermark:qi,localization:{locale:Ne?navigator.language:"",dateFormat:"dd MMM 'yy"},handleScroll:{mouseWheel:!0,pressedMouseMove:!0,horzTouchDrag:!0,vertTouchDrag:!0},handleScale:{axisPressedMouseMove:{time:!0,price:!0},axisDoubleClickReset:{time:!0,price:!0},mouseWheel:!0,pinch:!0},kineticScroll:{mouse:!1,touch:!0},trackingMode:{exitMode:1}}}class Ji{constructor(t,e){this._private__chartWidget=t,this._private__priceScaleId=e}applyOptions(t){this._private__chartWidget._internal_model()._internal_applyPriceScaleOptions(this._private__priceScaleId,t)}options(){return this._private__priceScale()._internal_options()}width(){return zt(this._private__priceScaleId)?this._private__chartWidget._internal_getPriceAxisWidth(this._private__priceScaleId):0}_private__priceScale(){return o(this._private__chartWidget._internal_model()._internal_findPriceScale(this._private__priceScaleId))._internal_priceScale}}function t_(t,e){e.forEach(function(t){switch(t){case"Candlestick":return e_.bind(null,t);case"Line":return i_.bind(null,t)}}(t))}function e_(t,e){Ti(e)&&(l("number"==typeof e.open,`${t} series item data value of open must be a number, got=${typeof e.open}, value=${e.open}`),l("number"==typeof e.high,`${t} series item data value of high must be a number, got=${typeof e.high}, value=${e.high}`),l("number"==typeof e.low,`${t} series item data value of low must be a number, got=${typeof e.low}, value=${e.low}`),l("number"==typeof e.close,`${t} series item data value of close must be a number, got=${typeof e.close}, value=${e.close}`))}function i_(t,e){Ti(e)&&l("number"==typeof e.value,`${t} series item data value must be a number, got=${typeof e.value}, value=${e.value}`)}class __{constructor(t,e,i,_,n){this._private__dataChangedDelegate=new Mt,this._internal__series=t,this._internal__dataUpdatesConsumer=e,this._private__horzScaleBehavior=n}_internal_destroy(){this._private__dataChangedDelegate._internal_destroy()}priceFormatter(){return this._internal__series._internal_formatter()}setData(t){!function(t,e,i=!1){if(0===t.length)return;let _=e.key(t[0].time);for(let n=1;n<t.length;++n){const r=e.key(t[n].time);l(i?_<=r:_<r,`data must be asc ordered by time, index=${n}, time=${r}, prev time=${_}`),_=r}}(t,this._private__horzScaleBehavior),t_(this._internal__series._internal_seriesType(),t),this._internal__dataUpdatesConsumer._internal_applyNewData(this._internal__series,t),this._private__onDataChanged("full")}applyOptions(t){this._internal__series._internal_applyOptions(t)}options(){return n(this._internal__series._internal_options())}_private__onDataChanged(t){this._private__dataChangedDelegate._internal_hasListeners()&&this._private__dataChangedDelegate._internal_fire(t)}}class n_{constructor(t,e,i){this._private__timeRangeChanged=new Mt,this._private__logicalRangeChanged=new Mt,this._private__sizeChanged=new Mt,this._private__model=t,this._private__timeScale=t._internal_timeScale(),this._private__timeAxisWidget=e,this._private__horzScaleBehavior=i}_internal_destroy(){this._private__timeRangeChanged._internal_destroy(),this._private__logicalRangeChanged._internal_destroy(),this._private__sizeChanged._internal_destroy()}scrollToRealTime(){this._private__timeScale._internal_scrollToRealTime()}setVisibleRange(t){const e={from:this._private__horzScaleBehavior.convertHorzItemToInternal(t.from),to:this._private__horzScaleBehavior.convertHorzItemToInternal(t.to)},i=this._private__timeScale._internal_logicalRangeForTimeRange(e);this._private__model._internal_setTargetLogicalRange(i)}width(){return this._private__timeAxisWidget._internal_getSize().width}height(){return this._private__timeAxisWidget._internal_getSize().height}applyOptions(t){this._private__timeScale._internal_applyOptions(t)}options(){return Object.assign(Object.assign({},n(this._private__timeScale._internal_options())),{barSpacing:this._private__timeScale._internal_barSpacing()})}}function r_(t){return function(t){if(_(t.handleScale)){const e=t.handleScale;t.handleScale={axisDoubleClickReset:{time:e,price:e},axisPressedMouseMove:{time:e,price:e},mouseWheel:e,pinch:e}}else if(void 0!==t.handleScale){const{axisPressedMouseMove:e,axisDoubleClickReset:i}=t.handleScale;_(e)&&(t.handleScale.axisPressedMouseMove={time:e,price:e}),_(i)&&(t.handleScale.axisDoubleClickReset={time:i,price:i})}const e=t.handleScroll;_(e)&&(t.handleScroll={horzTouchDrag:e,vertTouchDrag:e,mouseWheel:e,pressedMouseMove:e})}(t),t}class a_{constructor(t,e,i){this._private__seriesMap=new Map,this._private__seriesMapReversed=new Map,this._private__clickedDelegate=new Mt,this._private__dblClickedDelegate=new Mt,this._private__crosshairMovedDelegate=new Mt,this._private__dataLayer=new Vi(e);const _=void 0===i?n(Qi()):p(n(Qi()),r_(i));this._private__horzScaleBehavior=e,this._private__chartWidget=new Ci(t,_,e),this._private__chartWidget._internal_clicked()._internal_subscribe((t=>{this._private__clickedDelegate._internal_hasListeners()&&this._private__clickedDelegate._internal_fire(this._private__convertMouseParams(t()))}),this),this._private__chartWidget._internal_dblClicked()._internal_subscribe((t=>{this._private__dblClickedDelegate._internal_hasListeners()&&this._private__dblClickedDelegate._internal_fire(this._private__convertMouseParams(t()))}),this),this._private__chartWidget._internal_crosshairMoved()._internal_subscribe((t=>{this._private__crosshairMovedDelegate._internal_hasListeners()&&this._private__crosshairMovedDelegate._internal_fire(this._private__convertMouseParams(t()))}),this);const r=this._private__chartWidget._internal_model();this._private__timeScaleApi=new n_(r,this._private__chartWidget._internal_timeAxisWidget(),this._private__horzScaleBehavior)}resize(t,e,i){this._private__chartWidget._internal_resize(t,e,i)}addCandlestickSeries(t={}){return function(t){void 0!==t.borderColor&&(t.borderUpColor=t.borderColor,t.borderDownColor=t.borderColor),void 0!==t.wickColor&&(t.wickUpColor=t.wickColor,t.wickDownColor=t.wickColor)}(t),this._private__addSeriesImpl("Candlestick",{upColor:"#26a69a",downColor:"#ef5350",wickVisible:!0,borderVisible:!0,borderColor:"#378658",borderUpColor:"#26a69a",borderDownColor:"#ef5350",wickColor:"#737375",wickUpColor:"#26a69a",wickDownColor:"#ef5350"})}addLineSeries(t){return this._private__addSeriesImpl("Line",{color:"#2196f3",lineStyle:0,lineWidth:3,lineType:0,lineVisible:!0,crosshairMarkerVisible:!0,crosshairMarkerRadius:4,crosshairMarkerBorderColor:"",crosshairMarkerBorderWidth:2,crosshairMarkerBackgroundColor:"",lastPriceAnimation:0},t)}_internal_applyNewData(t,e){this._private__sendUpdateToChart(this._private__dataLayer._internal_setSeriesData(t,e))}priceScale(t){return new Ji(this._private__chartWidget,t)}timeScale(){return this._private__timeScaleApi}applyOptions(t){this._private__chartWidget._internal_applyOptions(r_(t))}options(){return this._private__chartWidget._internal_options()}_private__addSeriesImpl(t,e,i={}){!function(t){if(void 0===t||"custom"===t.type)return;const e=t;void 0!==e.minMove&&void 0===e.precision&&(e.precision=function(t){if(t>=1)return 0;let e=0;for(;e<8;e++){const i=Math.round(t);if(Math.abs(i-t)<1e-8)return e;t*=10}return e}(e.minMove))}(i.priceFormat);const _=p({title:"",visible:!0,lastValueVisible:!0,priceLineVisible:!0,priceLineSource:0,priceLineWidth:1,priceLineColor:"",priceLineStyle:2,baseLineVisible:!0,baseLineWidth:1,baseLineColor:"#B2B5BE",baseLineStyle:0,priceFormat:{type:"price",precision:2,minMove:.01}},e,i),n=this._private__chartWidget._internal_model()._internal_createSeries(t,_),r=new __(n,this,this,this,this._private__horzScaleBehavior);return this._private__seriesMap.set(r,n),this._private__seriesMapReversed.set(n,r),r}_private__sendUpdateToChart(t){const e=this._private__chartWidget._internal_model();e._internal_updateTimeScale(t._internal_timeScale._internal_baseIndex,t._internal_timeScale._internal_points,t._internal_timeScale._internal_firstChangedPointIndex),t._internal_series.forEach(((t,e)=>e._internal_setData(t._internal_data,t._internal_info))),e._internal_recalculateAllPanes()}_private__mapSeriesToApi(t){return s(this._private__seriesMapReversed.get(t))}_private__convertMouseParams(t){const e=new Map;t._internal_seriesData.forEach(((t,i)=>{const _=i._internal_seriesType(),n=function(t){return{Area:Fi,Line:Wi,Baseline:Ni,Histogram:Wi,Bar:Ui,Candlestick:Yi,Custom:$i}[t]}(_)(t);if("Custom"!==_)l(Ti(n));else{const t=i._internal_customSeriesWhitespaceCheck();l(!t||!1===t(n))}e.set(this._private__mapSeriesToApi(i),n)}));const i=void 0===t._internal_hoveredSeries?void 0:this._private__mapSeriesToApi(t._internal_hoveredSeries);return{time:t._internal_originalTime,logical:t._internal_index,point:t._internal_point,hoveredSeries:i,hoveredObjectId:t._internal_hoveredObject,seriesData:e,sourceEvent:t._internal_touchMouseEventData}}}let l_=Object.freeze({__proto__:null,createChart:function(t,e){let i=new Ie,_=Ie._internal_applyDefaults(e);const n=new a_(t,i,_);return i.setOptions(n.options()),n},isBusinessDay:xe,isUTCTimestamp:Te});const s_="#03866a",o_="#dc2020",h_="rgba(140,137,137,0.2)";function p_(t){return new Date(t).getTime()/1e3}const c_=document.getElementById("chart-container"),v_=l_.createChart(c_,{grid:{vertLines:{color:h_},horzLines:{color:h_}},height:600});v_.priceScale("right").applyOptions({borderVisible:!1,autoScale:!1,scaleMargins:{top:.1,bottom:.2}}),v_.timeScale("down").applyOptions({barSpacing:10,borderVisible:!1});const d_=v_.addCandlestickSeries({upColor:s_,downColor:o_,borderVisible:!1,wickUpColor:s_,wickDownColor:o_}),u_=function(t){const e=[];let i=1e3,_=new Date;_.setDate(_.getDate()-100);for(let t=0;t<100;t++){const t=i,n=t+Math.round(10*(Math.random()-.5)),r=Math.max(t,n)+Math.round(10*Math.random()),a=Math.min(t,n)-Math.round(10*Math.random()),l=n>=t?s_:o_;_.setDate(_.getDate()+1);const s=_.getFullYear(),o=String(_.getMonth()+1).padStart(2,"0"),h=String(_.getDate()).padStart(2,"0");e.push({time:`${s}-${o}-${h}`,open:t,high:r,low:a,close:n,color:l}),i=n}return e}();d_.setData(u_),v_.addLineSeries({priceLine:!1,firstValueVisible:!0,lineStyle:1,color:"rgba(79,75,75,0.2)",lineWidth:1}).setData([{time:u_[0].time,value:u_[0].open},{time:u_[u_.length-1].time,value:u_[0].open}]);let m_=u_.length>=60?u_[u_.length-60].time:u_[0].time,g_=u_[u_.length-1].time;function f_(){v_.timeScale().scrollToRealTime()}v_.timeScale().setVisibleRange({from:p_(m_),to:p_(g_)}),f_(),document.getElementById("scrollBtn").addEventListener("click",(()=>{f_()})),window.addEventListener("resize",(()=>{const{width:t,height:e}=c_.getBoundingClientRect();v_.resize(t,e)}))})();