(()=>{"use strict";function t(t){return"number"==typeof t&&isFinite(t)}function e(t){return"number"==typeof t&&t%1==0}function i(t){return"string"==typeof t}function _(t){return"boolean"==typeof t}function r(t){const e=t;if(!e||"object"!=typeof e)return e;let i,_,n;for(_ in i=Array.isArray(e)?[]:{},e)e.hasOwnProperty(_)&&(n=e[_],i[_]=n&&"object"==typeof n?r(n):n);return i}function n(t){return null!==t}function a(t){return null===t?void 0:t}function l(t,e){if(!t)throw new Error("Assertion failed"+(e?": "+e:""))}function s(t){if(void 0===t)throw new Error("Value is undefined");return t}function o(t){if(null===t)throw new Error("Value is null");return t}function h(t){return o(s(t))}function p(t,...e){for(const i of e)for(const e in i)void 0!==i[e]&&("object"!=typeof i[e]||void 0===t[e]||Array.isArray(i[e])?t[e]=i[e]:p(t[e],i[e]));return t}function c(t,e,i){return Math.min(Math.max(t,e),i)}function v(t,e,i){return e-t<=i}function d(t,e){const i={0:[],1:[t.lineWidth,t.lineWidth],2:[2*t.lineWidth,2*t.lineWidth],3:[6*t.lineWidth,6*t.lineWidth],4:[t.lineWidth,4*t.lineWidth]}[e];t.setLineDash(i)}function u(t,e,i,_){t.beginPath();const r=t.lineWidth%2?.5:0;t.moveTo(i,e+r),t.lineTo(_,e+r),t.stroke()}function m(t){return t<0?0:t>255?255:Math.round(t)||0}function g(t){return t<=0||t>0?t<0?0:t>1?1:Math.round(1e4*t)/1e4:0}const f=/^#([0-9a-f])([0-9a-f])([0-9a-f])([0-9a-f])?$/i,S=/^#([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})?$/i,b=/^rgb\(\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*\)$/,w=/^rgba\(\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*,\s*(-?[\d]{0,10}(?:\.\d+)?)\s*\)$/;function C(t){t=t.toLowerCase();{const e=w.exec(t)||b.exec(t);if(e)return[m(parseInt(e[1],10)),m(parseInt(e[2],10)),m(parseInt(e[3],10)),g(e.length<5?1:parseFloat(e[4]))]}{const e=S.exec(t);if(e)return[m(parseInt(e[1],16)),m(parseInt(e[2],16)),m(parseInt(e[3],16)),1]}{const e=f.exec(t);if(e)return[m(17*parseInt(e[1],16)),m(17*parseInt(e[2],16)),m(17*parseInt(e[3],16)),1]}throw new Error(`Cannot parse color: ${t}`)}function x(t){const e=C(t);return{_internal_background:`rgb(${e[0]}, ${e[1]}, ${e[2]})`,_internal_foreground:(i=e,.199*i[0]+.687*i[1]+.114*i[2]>160?"black":"white")};var i}function T(t,e,i,_,r,n){t.fillRect(e+n,i,_-2*n,n),t.fillRect(e+n,i+r-n,_-2*n,n),t.fillRect(e,i,n,r),t.fillRect(e+_-n,i,n,r)}function P(t,e,i,_,r,n){t.save(),t.globalCompositeOperation="copy",t.fillStyle=n,t.fillRect(e,i,_,r),t.restore()}function y(t,e){return t.map((t=>0===t?t:t+e))}function M(t,e,i,_,r,n){t.beginPath(),t.lineTo(e+_-n[1],i),0!==n[1]&&t.arcTo(e+_,i,e+_,i+n[1],n[1]),t.lineTo(e+_,i+r-n[2]),0!==n[2]&&t.arcTo(e+_,i+r,e+_-n[2],i+r,n[2]),t.lineTo(e+n[3],i+r),0!==n[3]&&t.arcTo(e,i+r,e,i+r-n[3],n[3]),t.lineTo(e,i+n[0]),0!==n[0]&&t.arcTo(e,i,e+n[0],i,n[0])}function k(t,e,i,_,r,n,a=0,l=[0,0,0,0],s=""){if(t.save(),!a||!s||s===n)return M(t,e,i,_,r,l),t.fillStyle=n,t.fill(),void t.restore();const o=a/2;"transparent"!==n&&(M(t,e+a,i+a,_-2*a,r-2*a,y(l,-a)),t.fillStyle=n,t.fill()),"transparent"!==s&&(M(t,e+o,i+o,_-a,r-a,y(l,-o)),t.lineWidth=a,t.strokeStyle=s,t.closePath(),t.stroke()),t.restore()}function E(t,e,i,_,r,n,a){t.save(),t.globalCompositeOperation="copy";const l=t.createLinearGradient(0,0,0,r);l.addColorStop(0,n),l.addColorStop(1,a),t.fillStyle=l,t.fillRect(e,i,_,r),t.restore()}function z(t,e,i){const _=Math.max(0,e-1),r=Math.min(t.length-1,i+1);return[add(t[e],divide(subtract(t[i],t[_]),6)),subtract(t[i],divide(subtract(t[r],t[e]),6))]}function R(i,_){if(!t(i))return"n/a";if(!e(_))throw new TypeError("invalid length");if(_<0||_>16)throw new TypeError("invalid length");return 0===_?i.toString():("0000000000000000"+i.toString()).slice(-_)}class B{constructor(i,_){if(_||(_=1),t(i)&&e(i)||(i=100),i<0)throw new TypeError("invalid base");this._private__priceScale=i,this._private__minMove=_,this._private__calculateDecimal()}format(t){const e=t<0?"âˆ’":"";return t=Math.abs(t),e+this._private__formatAsDecimal(t)}_private__calculateDecimal(){if(this._internal__fractionalLength=0,this._private__priceScale>0&&this._private__minMove>0){let t=this._private__priceScale;for(;t>1;)t/=10,this._internal__fractionalLength++}}_private__formatAsDecimal(t){const e=this._private__priceScale/this._private__minMove;let i=Math.floor(t),_="";const r=void 0!==this._internal__fractionalLength?this._internal__fractionalLength:NaN;if(e>1){let n=+(Math.round(t*e)-i*e).toFixed(this._internal__fractionalLength);n>=e&&(n-=e,i+=1),_="."+R(+n.toFixed(this._internal__fractionalLength)*this._private__minMove,r)}else i=Math.round(i*e)/e,r>0&&(_="."+R(0,r));return i.toFixed(0)+_}}class A extends B{constructor(t=100){super(t)}format(t){return`${super.format(t)}%`}}class V{constructor(t){this._private__precision=t}format(t){let e="";return t<0&&(e="-",t=-t),t<995?e+this._private__formatNumber(t):t<999995?e+this._private__formatNumber(t/1e3)+"K":t<999999995?(t=1e3*Math.round(t/1e3),e+this._private__formatNumber(t/1e6)+"M"):(t=1e6*Math.round(t/1e6),e+this._private__formatNumber(t/1e9)+"B")}_private__formatNumber(t){let e;const i=Math.pow(10,this._private__precision);return e=(t=Math.round(t*i)/i)>=1e-15&&t<1?t.toFixed(this._private__precision).replace(/\.?0+$/,""):String(t),e.replace(/(\.[1-9]*)0+$/,((t,e)=>e))}}const I=t=>t.getUTCFullYear();class D{constructor(t="yyyy-MM-dd",e="default"){this._private__dateFormat=t,this._private__locale=e}_internal_format(t){return function(t,e,i){return e.replace(/yyyy/g,(t=>R(I(t),4))(t)).replace(/yy/g,(t=>R(I(t)%100,2))(t)).replace(/MMMM/g,((t,e)=>new Date(t.getUTCFullYear(),t.getUTCMonth(),1).toLocaleString(e,{month:"long"}))(t,i)).replace(/MMM/g,((t,e)=>new Date(t.getUTCFullYear(),t.getUTCMonth(),1).toLocaleString(e,{month:"short"}))(t,i)).replace(/MM/g,(t=>R((t=>t.getUTCMonth()+1)(t),2))(t)).replace(/dd/g,(t=>R((t=>t.getUTCDate())(t),2))(t))}(t,this._private__dateFormat,this._private__locale)}}class O{constructor(t){this._private__formatStr=t||"%h:%m:%s"}_internal_format(t){return this._private__formatStr.replace("%h",R(t.getUTCHours(),2)).replace("%m",R(t.getUTCMinutes(),2)).replace("%s",R(t.getUTCSeconds(),2))}}const L={_internal_dateFormat:"yyyy-MM-dd",_internal_timeFormat:"%h:%m:%s",_internal_dateTimeSeparator:" ",_internal_locale:"default"};class W{constructor(t={}){const e=Object.assign(Object.assign({},L),t);this._private__dateFormatter=new D(e._internal_dateFormat,e._internal_locale),this._private__timeFormatter=new O(e._internal_timeFormat),this._private__separator=e._internal_dateTimeSeparator}_internal_format(t){return`${this._private__dateFormatter._internal_format(t)}${this._private__separator}${this._private__timeFormatter._internal_format(t)}`}}class F{_internal_draw(t,e,i){t.useBitmapCoordinateSpace((t=>this._internal__drawImpl(t,e,i)))}}class N extends F{constructor(t){super(),this._private__data=t}_internal__drawImpl({context:t,bitmapSize:e,horizontalPixelRatio:i,verticalPixelRatio:_}){if(null===this._private__data)return;const r=this._private__data._internal_vertLine._internal_visible,n=this._private__data._internal_horzLine._internal_visible;if(!r&&!n)return;const a=Math.round(this._private__data._internal_x*i),l=Math.round(this._private__data._internal_y*_);t.lineCap="butt",r&&a>=0&&(t.lineWidth=Math.floor(this._private__data._internal_vertLine._internal_lineWidth*i),t.strokeStyle=this._private__data._internal_vertLine._internal_color,t.fillStyle=this._private__data._internal_vertLine._internal_color,d(t,this._private__data._internal_vertLine._internal_lineStyle),function(t,e,i,_){t.beginPath();const r=t.lineWidth%2?.5:0;t.moveTo(e+r,0),t.lineTo(e+r,_),t.stroke()}(t,a,0,e.height)),n&&l>=0&&(t.lineWidth=Math.floor(this._private__data._internal_horzLine._internal_lineWidth*_),t.strokeStyle=this._private__data._internal_horzLine._internal_color,t.fillStyle=this._private__data._internal_horzLine._internal_color,d(t,this._private__data._internal_horzLine._internal_lineStyle),u(t,l,0,e.width))}}class H{constructor(t){this._private__invalidated=!0,this._private__rendererData={_internal_vertLine:{_internal_lineWidth:1,_internal_lineStyle:0,_internal_color:"",_internal_visible:!1},_internal_horzLine:{_internal_lineWidth:1,_internal_lineStyle:0,_internal_color:"",_internal_visible:!1},_internal_x:0,_internal_y:0},this._private__renderer=new N(this._private__rendererData),this._private__source=t}_internal_update(){this._private__invalidated=!0}_internal_renderer(){return this._private__invalidated&&(this._private__updateImpl(),this._private__invalidated=!1),this._private__renderer}_private__updateImpl(){const t=this._private__source._internal_visible(),e=o(this._private__source._internal_pane()),i=e._internal_model()._internal_options().crosshair,_=this._private__rendererData;_._internal_horzLine._internal_visible=t&&this._private__source._internal_horzLineVisible(e),_._internal_vertLine._internal_visible=t&&this._private__source._internal_vertLineVisible(),_._internal_horzLine._internal_lineWidth=i.horzLine.width,_._internal_horzLine._internal_lineStyle=i.horzLine.style,_._internal_horzLine._internal_color=i.horzLine.color,_._internal_vertLine._internal_lineWidth=i.vertLine.width,_._internal_vertLine._internal_lineStyle=i.vertLine.style,_._internal_vertLine._internal_color=i.vertLine.color,_._internal_x=this._private__source._internal_appliedX(),_._internal_y=this._private__source._internal_appliedY()}}class U{constructor(t,e){this._internal_setData(t,e)}_internal_setData(t,e){this._private__data=t,this._private__commonData=e}_internal_height(t,e){return this._private__data._internal_visible?t._internal_fontSize+t._internal_paddingTop+t._internal_paddingBottom:0}_internal_draw(t,e,i,_){if(!this._private__data._internal_visible||0===this._private__data._internal_text.length)return;const r=this._private__data._internal_color,n=this._private__commonData._internal_background,a=t.useBitmapCoordinateSpace((t=>{const a=t.context;a.font=e._internal_font;const l=this._private__calculateGeometry(t,e,i,_),s=l._internal_bitmap,o=(t,e)=>{l._internal_alignRight?k(a,s._internal_xOutside,s._internal_yTop,s._internal_totalWidth,s._internal_totalHeight,t,s._internal_horzBorder,[s._internal_radius,0,0,s._internal_radius],e):k(a,s._internal_xInside,s._internal_yTop,s._internal_totalWidth,s._internal_totalHeight,t,s._internal_horzBorder,[0,s._internal_radius,s._internal_radius,0],e)};return o(n,"transparent"),this._private__data._internal_tickVisible&&(a.fillStyle=r,a.fillRect(s._internal_xInside,s._internal_yMid,s._internal_xTick-s._internal_xInside,s._internal_tickHeight)),o("transparent",n),this._private__data._internal_borderVisible&&(a.fillStyle=e._internal_paneBackgroundColor,a.fillRect(l._internal_alignRight?s._internal_right-s._internal_horzBorder:0,s._internal_yTop,s._internal_horzBorder,s._internal_yBottom-s._internal_yTop)),l}));t.useMediaCoordinateSpace((({context:t})=>{const i=a._internal_media;t.font=e._internal_font,t.textAlign=a._internal_alignRight?"right":"left",t.textBaseline="middle",t.fillStyle=r,t.fillText(this._private__data._internal_text,i._internal_xText,(i._internal_yTop+i._internal_yBottom)/2+i._internal_textMidCorrection)}))}_private__calculateGeometry(t,e,i,_){var r;const{context:n,bitmapSize:a,mediaSize:l,horizontalPixelRatio:s,verticalPixelRatio:o}=t,h=this._private__data._internal_tickVisible||!this._private__data._internal_moveTextToInvisibleTick?e._internal_tickLength:0,p=this._private__data._internal_separatorVisible?e._internal_borderSize:0,c=e._internal_paddingTop+this._private__commonData._internal_additionalPaddingTop,v=e._internal_paddingBottom+this._private__commonData._internal_additionalPaddingBottom,d=e._internal_paddingInner,u=e._internal_paddingOuter,m=this._private__data._internal_text,g=e._internal_fontSize,f=i._internal_yMidCorrection(n,m),S=Math.ceil(i._internal_measureText(n,m)),b=g+c+v,w=e._internal_borderSize+d+u+S+h,C=Math.max(1,Math.floor(o));let x=Math.round(b*o);x%2!=C%2&&(x+=1);const T=p>0?Math.max(1,Math.floor(p*s)):0,P=Math.round(w*s),y=Math.round(h*s),M=null!==(r=this._private__commonData._internal_fixedCoordinate)&&void 0!==r?r:this._private__commonData._internal_coordinate,k=Math.round(M*o)-Math.floor(.5*o),E=Math.floor(k+C/2-x/2),z=E+x,R="right"===_,B=R?l.width-p:p,A=R?a.width-T:T;let V,I,D;return R?(V=A-P,I=A-y,D=B-h-d-p):(V=A+P,I=A+y,D=B+h+d),{_internal_alignRight:R,_internal_bitmap:{_internal_yTop:E,_internal_yMid:k,_internal_yBottom:z,_internal_totalWidth:P,_internal_totalHeight:x,_internal_radius:2*s,_internal_horzBorder:T,_internal_xOutside:V,_internal_xInside:A,_internal_xTick:I,_internal_tickHeight:C,_internal_right:a.width},_internal_media:{_internal_yTop:E/o,_internal_yBottom:z/o,_internal_xText:D,_internal_textMidCorrection:f}}}}class Y{constructor(t){this._private__commonRendererData={_internal_coordinate:0,_internal_background:"#000",_internal_additionalPaddingBottom:0,_internal_additionalPaddingTop:0},this._private__axisRendererData={_internal_text:"",_internal_visible:!1,_internal_tickVisible:!0,_internal_moveTextToInvisibleTick:!1,_internal_borderColor:"",_internal_color:"#FFF",_internal_borderVisible:!1,_internal_separatorVisible:!1},this._private__paneRendererData={_internal_text:"",_internal_visible:!1,_internal_tickVisible:!1,_internal_moveTextToInvisibleTick:!0,_internal_borderColor:"",_internal_color:"#FFF",_internal_borderVisible:!0,_internal_separatorVisible:!0},this._private__invalidated=!0,this._private__axisRenderer=new(t||U)(this._private__axisRendererData,this._private__commonRendererData),this._private__paneRenderer=new(t||U)(this._private__paneRendererData,this._private__commonRendererData)}_internal_text(){return this._private__updateRendererDataIfNeeded(),this._private__axisRendererData._internal_text}_internal_coordinate(){return this._private__updateRendererDataIfNeeded(),this._private__commonRendererData._internal_coordinate}_internal_update(){this._private__invalidated=!0}_internal_height(t,e=!1){return Math.max(this._private__axisRenderer._internal_height(t,e),this._private__paneRenderer._internal_height(t,e))}_internal_getFixedCoordinate(){return this._private__commonRendererData._internal_fixedCoordinate||0}_internal_setFixedCoordinate(t){this._private__commonRendererData._internal_fixedCoordinate=t}_internal_isVisible(){return this._private__updateRendererDataIfNeeded(),this._private__axisRendererData._internal_visible||this._private__paneRendererData._internal_visible}_internal_isAxisLabelVisible(){return this._private__updateRendererDataIfNeeded(),this._private__axisRendererData._internal_visible}_internal_renderer(t){return this._private__updateRendererDataIfNeeded(),this._private__axisRendererData._internal_tickVisible=this._private__axisRendererData._internal_tickVisible&&t._internal_options().ticksVisible,this._private__paneRendererData._internal_tickVisible=this._private__paneRendererData._internal_tickVisible&&t._internal_options().ticksVisible,this._private__axisRenderer._internal_setData(this._private__axisRendererData,this._private__commonRendererData),this._private__paneRenderer._internal_setData(this._private__paneRendererData,this._private__commonRendererData),this._private__axisRenderer}_internal_paneRenderer(){return this._private__updateRendererDataIfNeeded(),this._private__axisRenderer._internal_setData(this._private__axisRendererData,this._private__commonRendererData),this._private__paneRenderer._internal_setData(this._private__paneRendererData,this._private__commonRendererData),this._private__paneRenderer}_private__updateRendererDataIfNeeded(){this._private__invalidated&&(this._private__axisRendererData._internal_tickVisible=!0,this._private__paneRendererData._internal_tickVisible=!1,this._internal__updateRendererData(this._private__axisRendererData,this._private__paneRendererData,this._private__commonRendererData))}}class $ extends Y{constructor(t,e,i){super(),this._private__source=t,this._private__priceScale=e,this._private__valueProvider=i}_internal__updateRendererData(t,e,i){t._internal_visible=!1;const _=this._private__source._internal_options().horzLine;if(!_.labelVisible)return;const r=this._private__priceScale._internal_firstValue();if(!this._private__source._internal_visible()||this._private__priceScale._internal_isEmpty()||null===r)return;const n=x(_.labelBackgroundColor);i._internal_background=n._internal_background,t._internal_color=n._internal_foreground;const a=2/12*this._private__priceScale._internal_fontSize();i._internal_additionalPaddingTop=a,i._internal_additionalPaddingBottom=a;const l=this._private__valueProvider(this._private__priceScale);i._internal_coordinate=l._internal_coordinate,t._internal_text=this._private__priceScale._internal_formatPrice(l._internal_price,r),t._internal_visible=!0}}const j=/[1-9]/g;class X{constructor(){this._private__data=null}_internal_setData(t){this._private__data=t}_internal_draw(t,e){if(null===this._private__data||!1===this._private__data._internal_visible||0===this._private__data._internal_text.length)return;const i=t.useMediaCoordinateSpace((({context:t})=>(t.font=e._internal_font,Math.round(e._internal_widthCache._internal_measureText(t,o(this._private__data)._internal_text,j)))));if(i<=0)return;const _=e._internal_paddingHorizontal,r=i+2*_,n=r/2,a=this._private__data._internal_width;let l=this._private__data._internal_coordinate,s=Math.floor(l-n)+.5;s<0?(l+=Math.abs(0-s),s=Math.floor(l-n)+.5):s+r>a&&(l-=Math.abs(a-(s+r)),s=Math.floor(l-n)+.5);const h=s+r,p=Math.ceil(0+e._internal_borderSize+e._internal_tickLength+e._internal_paddingTop+e._internal_fontSize+e._internal_paddingBottom);t.useBitmapCoordinateSpace((({context:t,horizontalPixelRatio:i,verticalPixelRatio:_})=>{const r=o(this._private__data);t.fillStyle=r._internal_background;const n=Math.round(s*i),a=Math.round(0*_),l=Math.round(h*i),c=Math.round(p*_),v=Math.round(2*i);if(t.beginPath(),t.moveTo(n,a),t.lineTo(n,c-v),t.arcTo(n,c,n+v,c,v),t.lineTo(l-v,c),t.arcTo(l,c,l,c-v,v),t.lineTo(l,a),t.fill(),r._internal_tickVisible){const n=Math.round(r._internal_coordinate*i),l=a,s=Math.round((l+e._internal_tickLength)*_);t.fillStyle=r._internal_color;const o=Math.max(1,Math.floor(i)),h=Math.floor(.5*i);t.fillRect(n-h,l,o,s-l)}})),t.useMediaCoordinateSpace((({context:t})=>{const i=o(this._private__data),r=0+e._internal_borderSize+e._internal_tickLength+e._internal_paddingTop+e._internal_fontSize/2;t.font=e._internal_font,t.textAlign="left",t.textBaseline="middle",t.fillStyle=i._internal_color;const n=e._internal_widthCache._internal_yMidCorrection(t,"Apr0");t.translate(s+_,r+n),t.fillText(i._internal_text,0,0)}))}}class G{constructor(t,e,i){this._private__invalidated=!0,this._private__renderer=new X,this._private__rendererData={_internal_visible:!1,_internal_background:"#4c525e",_internal_color:"white",_internal_text:"",_internal_width:0,_internal_coordinate:NaN,_internal_tickVisible:!0},this._private__crosshair=t,this._private__model=e,this._private__valueProvider=i}_internal_update(){this._private__invalidated=!0}_internal_renderer(){return this._private__invalidated&&(this._private__updateImpl(),this._private__invalidated=!1),this._private__renderer._internal_setData(this._private__rendererData),this._private__renderer}_private__updateImpl(){const t=this._private__rendererData;t._internal_visible=!1;const e=this._private__crosshair._internal_options().vertLine;if(!e.labelVisible)return;const i=this._private__model._internal_timeScale();if(i._internal_isEmpty())return;t._internal_width=i._internal_width();const _=this._private__valueProvider();if(null===_)return;t._internal_coordinate=_._internal_coordinate;const r=i._internal_indexToTimeScalePoint(this._private__crosshair._internal_appliedIndex());t._internal_text=i._internal_formatDateTime(o(r)),t._internal_visible=!0;const n=x(e.labelBackgroundColor);t._internal_background=n._internal_background,t._internal_color=n._internal_foreground,t._internal_tickVisible=i._internal_options().ticksVisible}}class K{constructor(){this._internal__priceScale=null,this._private__zorder=0}_internal_zorder(){return this._private__zorder}_internal_setZorder(t){this._private__zorder=t}_internal_priceScale(){return this._internal__priceScale}_internal_setPriceScale(t){this._internal__priceScale=t}_internal_labelPaneViews(t){return[]}_internal_timeAxisViews(){return[]}_internal_visible(){return!0}}class Z extends K{constructor(t,e){super(),this._private__pane=null,this._private__price=NaN,this._private__index=0,this._private__visible=!0,this._private__priceAxisViews=new Map,this._private__subscribed=!1,this._private__x=NaN,this._private__y=NaN,this._private__originX=NaN,this._private__originY=NaN,this._private__model=t,this._private__options=e,this._private__currentPosPriceProvider=((t,e)=>i=>{const _=e(),r=t();if(i===o(this._private__pane)._internal_defaultPriceScale())return{_internal_price:r,_internal_coordinate:_};{const t=o(i._internal_firstValue());return{_internal_price:i._internal_coordinateToPrice(_,t),_internal_coordinate:_}}})((()=>this._private__price),(()=>this._private__y));const i=((t,e)=>()=>{const i=this._private__model._internal_timeScale()._internal_indexToTime(t()),_=e();return i&&Number.isFinite(_)?{_internal_time:i,_internal_coordinate:_}:null})((()=>this._private__index),(()=>this._internal_appliedX()));this._private__timeAxisView=new G(this,t,i),this._private__paneView=new H(this)}_internal_options(){return this._private__options}_internal_saveOriginCoord(t,e){this._private__originX=t,this._private__originY=e}_internal_clearOriginCoord(){this._private__originX=NaN,this._private__originY=NaN}_internal_originCoordX(){return this._private__originX}_internal_originCoordY(){return this._private__originY}_internal_setPosition(t,e,i){this._private__subscribed||(this._private__subscribed=!0),this._private__visible=!0,this._private__tryToUpdateViews(t,e,i)}_internal_appliedIndex(){return this._private__index}_internal_appliedX(){return this._private__x}_internal_appliedY(){return this._private__y}_internal_visible(){return this._private__visible}_internal_clearPosition(){this._private__visible=!1,this._private__setIndexToLastSeriesBarIndex(),this._private__price=NaN,this._private__x=NaN,this._private__y=NaN,this._private__pane=null,this._internal_clearOriginCoord()}_internal_paneViews(t){return null!==this._private__pane?[this._private__paneView]:[]}_internal_horzLineVisible(t){return t===this._private__pane&&this._private__options.horzLine.visible}_internal_vertLineVisible(){return this._private__options.vertLine.visible}_internal_priceAxisViews(t,e){this._private__visible&&this._private__pane===t||this._private__priceAxisViews.clear();const i=[];return this._private__pane===t&&i.push(this._private__createPriceAxisViewOnDemand(this._private__priceAxisViews,e,this._private__currentPosPriceProvider)),i}_internal_timeAxisViews(){return this._private__visible?[this._private__timeAxisView]:[]}_internal_pane(){return this._private__pane}_internal_updateAllViews(){this._private__paneView._internal_update(),this._private__priceAxisViews.forEach((t=>t._internal_update())),this._private__timeAxisView._internal_update()}_private__priceScaleByPane(t){return t&&!t._internal_defaultPriceScale()._internal_isEmpty()?t._internal_defaultPriceScale():null}_private__tryToUpdateViews(t,e,i){this._private__tryToUpdateData(t,e,i)&&this._internal_updateAllViews()}_private__tryToUpdateData(t,e,i){const _=this._private__x,r=this._private__y,n=this._private__price,a=this._private__index,l=this._private__pane,s=this._private__priceScaleByPane(i);this._private__index=t,this._private__x=isNaN(t)?NaN:this._private__model._internal_timeScale()._internal_indexToCoordinate(t),this._private__pane=i;const o=null!==s?s._internal_firstValue():null;return null!==s&&null!==o?(this._private__price=e,this._private__y=s._internal_priceToCoordinate(e,o)):(this._private__price=NaN,this._private__y=NaN),_!==this._private__x||r!==this._private__y||a!==this._private__index||n!==this._private__price||l!==this._private__pane}_private__setIndexToLastSeriesBarIndex(){const t=this._private__model._internal_serieses().map((t=>t._internal_bars()._internal_lastIndex())).filter(n),e=0===t.length?null:Math.max(...t);this._private__index=null!==e?e:NaN}_private__createPriceAxisViewOnDemand(t,e,i){let _=t.get(e);return void 0===_&&(_=new $(this,e,i),t.set(e,_)),_}}class q extends F{constructor(){super(...arguments),this._internal__data=null}_internal_setData(t){this._internal__data=t}_internal__drawImpl(t){if(null===this._internal__data)return;const{_internal_items:e,_internal_visibleRange:i,_internal_barWidth:_,_internal_lineType:r,_internal_lineWidth:n,_internal_lineStyle:a}=this._internal__data;if(null===i)return;const l=t.context;l.lineCap="butt",l.lineWidth=n*t.verticalPixelRatio,d(l,a),l.lineJoin="round";const s=this._internal__strokeStyle.bind(this);void 0!==r&&function(t,e,i,_,r,n){function a(t,e){const i=t.context;i.strokeStyle=e,i.stroke()}if(0===e.length||_.from>=e.length||_.to<=0)return;const{context:l,horizontalPixelRatio:s,verticalPixelRatio:o}=t,h=e[_.from];let p=n(t,h),c=h;if(_.to-_.from<2){const e=r/2;l.beginPath();const i={_internal_x:h._internal_x-e,_internal_y:h._internal_y},_={_internal_x:h._internal_x+e,_internal_y:h._internal_y};l.moveTo(i._internal_x*s,i._internal_y*o),l.lineTo(_._internal_x*s,_._internal_y*o),a(t,p)}else{const r=(e,i)=>{a(t,p),l.beginPath(),p=e,c=i};let v=c;l.beginPath(),l.moveTo(h._internal_x*s,h._internal_y*o);for(let a=_.from+1;a<_.to;++a){v=e[a];const _=n(t,v);switch(i){case 0:l.lineTo(v._internal_x*s,v._internal_y*o);break;case 1:l.lineTo(v._internal_x*s,e[a-1]._internal_y*o),_!==p&&(r(_,v),l.lineTo(v._internal_x*s,e[a-1]._internal_y*o)),l.lineTo(v._internal_x*s,v._internal_y*o);break;case 2:{const[t,i]=z(e,a-1,a);l.bezierCurveTo(t._internal_x*s,t._internal_y*o,i._internal_x*s,i._internal_y*o,v._internal_x*s,v._internal_y*o);break}}1!==i&&_!==p&&(r(_,v),l.moveTo(v._internal_x*s,v._internal_y*o))}(c!==v||c===v&&1===i)&&a(t,p)}}(t,e,r,i,_,s)}}class Q extends q{_internal__strokeStyle(t,e){return e._internal_lineColor}}function J(t,e,i,_,r=0,n=e.length){let a=n-r;for(;0<a;){const n=a>>1,l=r+n;_(e[l],i)===t?(r=l+1,a-=n+1):a=n}return r}const tt=J.bind(null,!0),et=J.bind(null,!1);function it(t,e){return t._internal_time<e}function _t(t,e){return e<t._internal_time}class rt{constructor(t,e,i){this._internal__invalidated=!0,this._internal__dataInvalidated=!0,this._internal__optionsInvalidated=!0,this._internal__items=[],this._internal__itemsVisibleRange=null,this._internal__series=t,this._internal__model=e,this._private__extendedVisibleRange=i}_internal_update(t){this._internal__invalidated=!0,"data"===t&&(this._internal__dataInvalidated=!0),"options"===t&&(this._internal__optionsInvalidated=!0)}_internal_renderer(){return this._internal__series._internal_visible()?(this._private__makeValid(),null===this._internal__itemsVisibleRange?null:this._internal__renderer):null}_internal__updateOptions(){this._internal__items=this._internal__items.map((t=>Object.assign(Object.assign({},t),this._internal__series._internal_barColorer()._internal_barStyle(t._internal_time))))}_internal__clearVisibleRange(){this._internal__itemsVisibleRange=null}_private__makeValid(){this._internal__dataInvalidated&&(this._internal__fillRawPoints(),this._internal__dataInvalidated=!1),this._internal__optionsInvalidated&&(this._internal__updateOptions(),this._internal__optionsInvalidated=!1),this._internal__invalidated&&(this._private__makeValidImpl(),this._internal__invalidated=!1)}_private__makeValidImpl(){const t=this._internal__series._internal_priceScale(),e=this._internal__model._internal_timeScale();if(this._internal__clearVisibleRange(),e._internal_isEmpty()||t._internal_isEmpty())return;const i=e._internal_visibleStrictRange();if(null===i)return;if(0===this._internal__series._internal_bars()._internal_size())return;const _=this._internal__series._internal_firstValue();null!==_&&(this._internal__itemsVisibleRange=function(t,e,i){const _=e._internal_left(),r=e._internal_right(),n=tt(t,_,it),a=et(t,r,_t);if(!i)return{from:n,to:a};let l=n,s=a;return n>0&&n<t.length&&t[n]._internal_time>=_&&(l=n-1),a>0&&a<t.length&&t[a-1]._internal_time<=r&&(s=a+1),{from:l,to:s}}(this._internal__items,i,this._private__extendedVisibleRange),this._internal__convertToCoordinates(t,e,_._internal_value),this._internal__prepareRendererData())}}class nt extends rt{constructor(t,e){super(t,e,!0)}_internal__convertToCoordinates(t,e,i){e._internal_indexesToCoordinates(this._internal__items,a(this._internal__itemsVisibleRange)),t._internal_pointsArrayToCoordinates(this._internal__items,i,a(this._internal__itemsVisibleRange))}_internal__createRawItemBase(t,e){return{_internal_time:t,_internal_price:e,_internal_x:NaN,_internal_y:NaN}}_internal__fillRawPoints(){const t=this._internal__series._internal_barColorer();this._internal__items=this._internal__series._internal_bars()._internal_rows().map((e=>{const i=e._internal_value[3];return this._internal__createRawItem(e._internal_index,i,t)}))}}class at extends rt{constructor(t,e){super(t,e,!1)}_internal__convertToCoordinates(t,e,i){e._internal_indexesToCoordinates(this._internal__items,a(this._internal__itemsVisibleRange)),t._internal_barPricesToCoordinates(this._internal__items,i,a(this._internal__itemsVisibleRange))}_internal__createDefaultItem(t,e,i){return{_internal_time:t,_internal_open:e._internal_value[0],_internal_high:e._internal_value[1],_internal_low:e._internal_value[2],_internal_close:e._internal_value[3],_internal_x:NaN,_internal_openY:NaN,_internal_highY:NaN,_internal_lowY:NaN,_internal_closeY:NaN}}_internal__fillRawPoints(){const t=this._internal__series._internal_barColorer();this._internal__items=this._internal__series._internal_bars()._internal_rows().map((e=>this._internal__createRawItem(e._internal_index,e,t)))}}class lt extends F{constructor(){super(...arguments),this._private__data=null,this._private__barWidth=0}_internal_setData(t){this._private__data=t}_internal__drawImpl(t){if(null===this._private__data||0===this._private__data._internal_bars.length||null===this._private__data._internal_visibleRange)return;const{horizontalPixelRatio:e}=t;this._private__barWidth=function(t,e){if(t>=2.5&&t<=4)return Math.floor(3*e);const i=1-.2*Math.atan(Math.max(4,t)-4)/(.5*Math.PI),_=Math.floor(t*i*e),r=Math.floor(t*e),n=Math.min(_,r);return Math.max(Math.floor(e),n)}(this._private__data._internal_barSpacing,e),this._private__barWidth>=2&&Math.floor(e)%2!=this._private__barWidth%2&&this._private__barWidth--;const i=this._private__data._internal_bars;this._private__data._internal_wickVisible&&this._private__drawWicks(t,i,this._private__data._internal_visibleRange),this._private__data._internal_borderVisible&&this._private__drawBorder(t,i,this._private__data._internal_visibleRange);const _=this._private__calculateBorderWidth(e);(!this._private__data._internal_borderVisible||this._private__barWidth>2*_)&&this._private__drawCandles(t,i,this._private__data._internal_visibleRange)}_private__drawWicks(t,e,i){if(null===this._private__data)return;const{context:_,horizontalPixelRatio:r,verticalPixelRatio:n}=t;let a="",l=Math.min(Math.floor(r),Math.floor(this._private__data._internal_barSpacing*r));l=Math.max(Math.floor(r),Math.min(l,this._private__barWidth));const s=Math.floor(.5*l);let o=null;for(let t=i.from;t<i.to;t++){const i=e[t];i._internal_barWickColor!==a&&(_.fillStyle=i._internal_barWickColor,a=i._internal_barWickColor);const h=Math.round(Math.min(i._internal_openY,i._internal_closeY)*n),p=Math.round(Math.max(i._internal_openY,i._internal_closeY)*n),c=Math.round(i._internal_highY*n),v=Math.round(i._internal_lowY*n);let d=Math.round(r*i._internal_x)-s;const u=d+l-1;null!==o&&(d=Math.max(o+1,d),d=Math.min(d,u));const m=u-d+1;_.fillRect(d,c,m,h-c),_.fillRect(d,p+1,m,v-p),o=u}}_private__calculateBorderWidth(t){let e=Math.floor(1*t);this._private__barWidth<=2*e&&(e=Math.floor(.5*(this._private__barWidth-1)));const i=Math.max(Math.floor(t),e);return this._private__barWidth<=2*i?Math.max(Math.floor(t),Math.floor(1*t)):i}_private__drawBorder(t,e,i){if(null===this._private__data)return;const{context:_,horizontalPixelRatio:r,verticalPixelRatio:n}=t;let a="";const l=this._private__calculateBorderWidth(r);let s=null;for(let t=i.from;t<i.to;t++){const i=e[t];i._internal_barBorderColor!==a&&(_.fillStyle=i._internal_barBorderColor,a=i._internal_barBorderColor);let o=Math.round(i._internal_x*r)-Math.floor(.5*this._private__barWidth);const h=o+this._private__barWidth-1,p=Math.round(Math.min(i._internal_openY,i._internal_closeY)*n),c=Math.round(Math.max(i._internal_openY,i._internal_closeY)*n);if(null!==s&&(o=Math.max(s+1,o),o=Math.min(o,h)),this._private__data._internal_barSpacing*r>2*l)T(_,o,p,h-o+1,c-p+1,l);else{const t=h-o+1;_.fillRect(o,p,t,c-p+1)}s=h}}_private__drawCandles(t,e,i){if(null===this._private__data)return;const{context:_,horizontalPixelRatio:r,verticalPixelRatio:n}=t;let a="";for(let t=i.from;t<i.to;t++){const i=e[t];let l=Math.round(Math.min(i._internal_openY,i._internal_closeY)*n),s=Math.round(Math.max(i._internal_openY,i._internal_closeY)*n),o=Math.round(i._internal_x*r)-Math.floor(.5*this._private__barWidth),h=o+this._private__barWidth-1;if(i._internal_barColor!==a){const t=i._internal_barColor;_.fillStyle=t,a=t}l>s||_.fillRect(o,l,h-o+1,s-l+1)}}}class st extends at{constructor(){super(...arguments),this._internal__renderer=new lt}_internal__createRawItem(t,e,i){return Object.assign(Object.assign({},this._internal__createDefaultItem(t,e,i)),i._internal_barStyle(t))}_internal__prepareRendererData(){const t=this._internal__series._internal_options();this._internal__renderer._internal_setData({_internal_bars:this._internal__items,_internal_barSpacing:this._internal__model._internal_timeScale()._internal_barSpacing(),_internal_wickVisible:t.wickVisible,_internal_borderVisible:t.borderVisible,_internal_visibleRange:this._internal__itemsVisibleRange})}}class ot{constructor(t,e){this._private__sourceRenderer=t,this._private__priceScale=e}_internal_draw(t,e,i){this._private__sourceRenderer.draw(t,this._private__priceScale,e,i)}}class ht extends rt{constructor(t,e,i){super(t,e,!1),this._private__paneView=i,this._internal__renderer=new ot(this._private__paneView.renderer(),(e=>{const i=t._internal_firstValue();return null===i?null:t._internal_priceScale()._internal_priceToCoordinate(e,i._internal_value)}))}_internal_priceValueBuilder(t){return this._private__paneView.priceValueBuilder(t)}_internal_isWhitespace(t){return this._private__paneView.isWhitespace(t)}}class pt extends nt{constructor(){super(...arguments),this._internal__renderer=new Q}_internal__createRawItem(t,e,i){return Object.assign(Object.assign({},this._internal__createRawItemBase(t,e)),i._internal_barStyle(t))}_internal__prepareRendererData(){const t=this._internal__series._internal_options(),e={_internal_items:this._internal__items,_internal_lineStyle:t.lineStyle,_internal_lineType:t.lineVisible?t.lineType:void 0,_internal_lineWidth:t.lineWidth,_internal_visibleRange:this._internal__itemsVisibleRange,_internal_barWidth:this._internal__model._internal_timeScale()._internal_barSpacing()};this._internal__renderer._internal_setData(e)}}const ct=/[2-9]/g;class vt{constructor(t=50){this._private__actualSize=0,this._private__usageTick=1,this._private__oldestTick=1,this._private__tick2Labels={},this._private__cache=new Map,this._private__maxSize=t}_internal_reset(){this._private__actualSize=0,this._private__cache.clear(),this._private__usageTick=1,this._private__oldestTick=1,this._private__tick2Labels={}}_internal_measureText(t,e,i){return this._private__getMetrics(t,e,i).width}_internal_yMidCorrection(t,e,i){const _=this._private__getMetrics(t,e,i);return((_.actualBoundingBoxAscent||0)-(_.actualBoundingBoxDescent||0))/2}_private__getMetrics(t,e,i){const _=i||ct,r=String(e).replace(_,"0");if(this._private__cache.has(r))return s(this._private__cache.get(r))._internal_metrics;if(this._private__actualSize===this._private__maxSize){const t=this._private__tick2Labels[this._private__oldestTick];delete this._private__tick2Labels[this._private__oldestTick],this._private__cache.delete(t),this._private__oldestTick++,this._private__actualSize--}t.save(),t.textBaseline="middle";const n=t.measureText(r);return t.restore(),0===n.width&&e.length||(this._private__cache.set(r,{_internal_metrics:n,_internal_tick:this._private__usageTick}),this._private__tick2Labels[this._private__usageTick]=r,this._private__actualSize++,this._private__usageTick++),n}}class dt{constructor(t){this._private__priceAxisViewRenderer=null,this._private__rendererOptions=null,this._private__align="right",this._private__textWidthCache=t}_internal_setParams(t,e,i){this._private__priceAxisViewRenderer=t,this._private__rendererOptions=e,this._private__align=i}_internal_draw(t){null!==this._private__rendererOptions&&null!==this._private__priceAxisViewRenderer&&this._private__priceAxisViewRenderer._internal_draw(t,this._private__rendererOptions,this._private__textWidthCache,this._private__align)}}class ut{constructor(t,e,i){this._private__priceAxisView=t,this._private__textWidthCache=new vt(50),this._private__dataSource=e,this._private__chartModel=i,this._private__fontSize=-1,this._private__renderer=new dt(this._private__textWidthCache)}_internal_renderer(){const t=this._private__chartModel._internal_paneForSource(this._private__dataSource);if(null===t)return null;const e=t._internal_isOverlay(this._private__dataSource)?t._internal_defaultVisiblePriceScale():this._private__dataSource._internal_priceScale();if(null===e)return null;const i=t._internal_priceScalePosition(e);if("overlay"===i)return null;const _=this._private__chartModel._internal_priceAxisRendererOptions();return _._internal_fontSize!==this._private__fontSize&&(this._private__fontSize=_._internal_fontSize,this._private__textWidthCache._internal_reset()),this._private__renderer._internal_setParams(this._private__priceAxisView._internal_paneRenderer(),_,i),this._private__renderer}}class mt extends F{constructor(){super(...arguments),this._private__data=null}_internal_setData(t){this._private__data=t}_internal_hitTest(t,e){var i;if(!(null===(i=this._private__data)||void 0===i?void 0:i._internal_visible))return null;const{_internal_y:_,_internal_lineWidth:r,_internal_externalId:n}=this._private__data;return e>=_-r-7&&e<=_+r+7?{_internal_hitTestData:this._private__data,_internal_externalId:n}:null}_internal__drawImpl({context:t,bitmapSize:e,horizontalPixelRatio:i,verticalPixelRatio:_}){if(null===this._private__data)return;if(!1===this._private__data._internal_visible)return;const r=Math.round(this._private__data._internal_y*_);r<0||r>e.height||(t.lineCap="butt",t.strokeStyle=this._private__data._internal_color,t.lineWidth=Math.floor(this._private__data._internal_lineWidth*i),d(t,this._private__data._internal_lineStyle),u(t,r,0,e.width))}}class gt{constructor(t){this._internal__lineRendererData={_internal_y:0,_internal_color:"rgba(0, 0, 0, 0)",_internal_lineWidth:1,_internal_lineStyle:0,_internal_visible:!1},this._internal__lineRenderer=new mt,this._private__invalidated=!0,this._internal__series=t,this._internal__lineRenderer._internal_setData(this._internal__lineRendererData)}_internal_update(){this._private__invalidated=!0}_internal_renderer(){return this._internal__series._internal_visible()?(this._private__invalidated&&(this._internal__updateImpl(),this._private__invalidated=!1),this._internal__lineRenderer):null}}class ft extends gt{constructor(t){super(t)}_internal__updateImpl(){this._internal__lineRendererData._internal_visible=!1;const t=this._internal__series._internal_priceScale(),e=t._internal_mode()._internal_mode;if(2!==e&&3!==e)return;const i=this._internal__series._internal_options();if(!i.baseLineVisible||!this._internal__series._internal_visible())return;const _=this._internal__series._internal_firstValue();null!==_&&(this._internal__lineRendererData._internal_visible=!0,this._internal__lineRendererData._internal_y=t._internal_priceToCoordinate(_._internal_value,_._internal_value),this._internal__lineRendererData._internal_color=i.baseLineColor,this._internal__lineRendererData._internal_lineWidth=i.baseLineWidth,this._internal__lineRendererData._internal_lineStyle=i.baseLineStyle)}}class St extends F{constructor(){super(...arguments),this._private__data=null}_internal_setData(t){this._private__data=t}_internal_data(){return this._private__data}_internal__drawImpl({context:t,horizontalPixelRatio:e,verticalPixelRatio:i}){const _=this._private__data;if(null===_)return;const r=Math.max(1,Math.floor(e)),n=r%2/2,a=Math.round(_._internal_center.x*e)+n,l=_._internal_center.y*i;t.fillStyle=_._internal_seriesLineColor,t.beginPath();const s=Math.max(2,1.5*_._internal_seriesLineWidth)*e;t.arc(a,l,s,0,2*Math.PI,!1),t.fill(),t.fillStyle=_._internal_fillColor,t.beginPath(),t.arc(a,l,_._internal_radius*e,0,2*Math.PI,!1),t.fill(),t.lineWidth=r,t.strokeStyle=_._internal_strokeColor,t.beginPath(),t.arc(a,l,_._internal_radius*e+r/2,0,2*Math.PI,!1),t.stroke()}}const bt=[{_internal_start:0,_internal_end:.25,_internal_startRadius:4,_internal_endRadius:10,_internal_startFillAlpha:.25,_internal_endFillAlpha:0,_internal_startStrokeAlpha:.4,_internal_endStrokeAlpha:.8},{_internal_start:.25,_internal_end:.525,_internal_startRadius:10,_internal_endRadius:14,_internal_startFillAlpha:0,_internal_endFillAlpha:0,_internal_startStrokeAlpha:.8,_internal_endStrokeAlpha:0},{_internal_start:.525,_internal_end:1,_internal_startRadius:14,_internal_endRadius:14,_internal_startFillAlpha:0,_internal_endFillAlpha:0,_internal_startStrokeAlpha:0,_internal_endStrokeAlpha:0}];function wt(t,e,i,_){return function(t,e){if("transparent"===t)return t;const i=C(t),_=i[3];return`rgba(${i[0]}, ${i[1]}, ${i[2]}, ${e*_})`}(t,i+(_-i)*e)}function Ct(t,e){const i=t%2600/2600;let _;for(const t of bt)if(i>=t._internal_start&&i<=t._internal_end){_=t;break}l(void 0!==_,"Last price animation internal logic error");const r=(i-_._internal_start)/(_._internal_end-_._internal_start);return{_internal_fillColor:wt(e,r,_._internal_startFillAlpha,_._internal_endFillAlpha),_internal_strokeColor:wt(e,r,_._internal_startStrokeAlpha,_._internal_endStrokeAlpha),_internal_radius:(n=r,a=_._internal_startRadius,s=_._internal_endRadius,a+(s-a)*n)};var n,a,s}class xt{constructor(t){this._private__renderer=new St,this._private__invalidated=!0,this._private__stageInvalidated=!0,this._private__startTime=performance.now(),this._private__endTime=this._private__startTime-1,this._private__series=t}_internal_onDataCleared(){this._private__endTime=this._private__startTime-1,this._internal_update()}_internal_onNewRealtimeDataReceived(){if(this._internal_update(),2===this._private__series._internal_options().lastPriceAnimation){const t=performance.now(),e=this._private__endTime-t;if(e>0)return void(e<650&&(this._private__endTime+=2600));this._private__startTime=t,this._private__endTime=t+2600}}_internal_update(){this._private__invalidated=!0}_internal_invalidateStage(){this._private__stageInvalidated=!0}_internal_visible(){return 0!==this._private__series._internal_options().lastPriceAnimation}_internal_animationActive(){switch(this._private__series._internal_options().lastPriceAnimation){case 0:return!1;case 1:return!0;case 2:return performance.now()<=this._private__endTime}}_internal_renderer(){return this._private__invalidated?(this._private__updateImpl(),this._private__invalidated=!1,this._private__stageInvalidated=!1):this._private__stageInvalidated&&(this._private__updateRendererDataStage(),this._private__stageInvalidated=!1),this._private__renderer}_private__updateImpl(){this._private__renderer._internal_setData(null);const t=this._private__series._internal_model()._internal_timeScale(),e=t._internal_visibleStrictRange(),i=this._private__series._internal_firstValue();if(null===e||null===i)return;const _=this._private__series._internal_lastValueData(!0);if(_._internal_noData||!e._internal_contains(_._internal_index))return;const r={x:t._internal_indexToCoordinate(_._internal_index),y:this._private__series._internal_priceScale()._internal_priceToCoordinate(_._internal_price,i._internal_value)},n=_._internal_color,a=this._private__series._internal_options().lineWidth,l=Ct(this._private__duration(),n);this._private__renderer._internal_setData({_internal_seriesLineColor:n,_internal_seriesLineWidth:a,_internal_fillColor:l._internal_fillColor,_internal_strokeColor:l._internal_strokeColor,_internal_radius:l._internal_radius,_internal_center:r})}_private__updateRendererDataStage(){const t=this._private__renderer._internal_data();if(null!==t){const e=Ct(this._private__duration(),t._internal_seriesLineColor);t._internal_fillColor=e._internal_fillColor,t._internal_strokeColor=e._internal_strokeColor,t._internal_radius=e._internal_radius}}_private__duration(){return this._internal_animationActive()?performance.now()-this._private__startTime:2599}}class Tt extends gt{constructor(t){super(t)}_internal__updateImpl(){const t=this._internal__lineRendererData;t._internal_visible=!1;const e=this._internal__series._internal_options();if(!e.priceLineVisible||!this._internal__series._internal_visible())return;const i=this._internal__series._internal_lastValueData(0===e.priceLineSource);i._internal_noData||(t._internal_visible=!0,t._internal_y=i._internal_coordinate,t._internal_color=this._internal__series._internal_priceLineColor(i._internal_color),t._internal_lineWidth=e.priceLineWidth,t._internal_lineStyle=e.priceLineStyle)}}class Pt extends Y{constructor(t){super(),this._private__source=t}_internal__updateRendererData(t,e,i){t._internal_visible=!1,e._internal_visible=!1;const _=this._private__source;if(!_._internal_visible())return;const r=_._internal_options().lastValueVisible,n=""!==_._internal_title(),a=!0,l=_._internal_lastValueData(!1);if(l._internal_noData)return;r&&(t._internal_text=this._internal__axisText(l,r,a),t._internal_visible=0!==t._internal_text.length),e._internal_text=this._internal__paneText(l,r,n,a),e._internal_visible=e._internal_text.length>0;const s=_._internal_priceLineColor(l._internal_color),o=x(s);i._internal_background=o._internal_background,i._internal_coordinate=l._internal_coordinate,e._internal_borderColor=_._internal_model()._internal_backgroundColorAtYPercentFromTop(l._internal_coordinate/_._internal_priceScale()._internal_height()),t._internal_borderColor=s,t._internal_color=o._internal_foreground,e._internal_color=o._internal_foreground}_internal__paneText(t,e,i,_){let r="";const n=this._private__source._internal_title();return i&&0!==n.length&&(r+=`${n} `),e&&_&&(r+=this._private__source._internal_priceScale()._internal_isPercentage()?t._internal_formattedPriceAbsolute:t._internal_formattedPricePercentage),r.trim()}_internal__axisText(t,e,i){return e?i?this._private__source._internal_priceScale()._internal_isPercentage()?t._internal_formattedPricePercentage:t._internal_formattedPriceAbsolute:t._internal_text:""}}class yt{constructor(){this._private__listeners=[]}_internal_subscribe(t,e,i){const _={_internal_callback:t,_internal_linkedObject:e,_internal_singleshot:!0===i};this._private__listeners.push(_)}_internal_unsubscribeAll(t){this._private__listeners=this._private__listeners.filter((e=>e._internal_linkedObject!==t))}_internal_fire(t,e,i){const _=[...this._private__listeners];this._private__listeners=this._private__listeners.filter((t=>!t._internal_singleshot)),_.forEach((_=>_._internal_callback(t,e,i)))}_internal_hasListeners(){return this._private__listeners.length>0}_internal_destroy(){this._private__listeners=[]}}const Mt="-apple-system, BlinkMacSystemFont, 'Trebuchet MS', Roboto, Ubuntu, sans-serif";function kt(t,e,i){return void 0===e&&(e=Mt),`${i=void 0!==i?`${i} `:""}${t}px ${e}`}function Et(t){return"left"===t||"right"===t}class zt{constructor(t){this._private__invalidatedPanes=new Map,this._private__timeScaleInvalidations=[],this._private__globalLevel=t}_internal_invalidatePane(t,e){const i=function(t,e){return void 0===t?e:{_internal_level:Math.max(t._internal_level,e._internal_level),_internal_autoScale:t._internal_autoScale||e._internal_autoScale}}(this._private__invalidatedPanes.get(t),e);this._private__invalidatedPanes.set(t,i)}_internal_fullInvalidation(){return this._private__globalLevel}_internal_invalidateForPane(t){const e=this._private__invalidatedPanes.get(t);return void 0===e?{_internal_level:this._private__globalLevel}:{_internal_level:Math.max(this._private__globalLevel,e._internal_level),_internal_autoScale:e._internal_autoScale}}_internal_setFitContent(){this._internal_stopTimeScaleAnimation(),this._private__timeScaleInvalidations=[{_internal_type:0}]}_internal_applyRange(t){this._internal_stopTimeScaleAnimation(),this._private__timeScaleInvalidations=[{_internal_type:1,_internal_value:t}]}_internal_setTimeScaleAnimation(t){this._private__removeTimeScaleAnimation(),this._private__timeScaleInvalidations.push({_internal_type:5,_internal_value:t})}_internal_stopTimeScaleAnimation(){this._private__removeTimeScaleAnimation(),this._private__timeScaleInvalidations.push({_internal_type:6})}_internal_resetTimeScale(){this._internal_stopTimeScaleAnimation(),this._private__timeScaleInvalidations=[{_internal_type:4}]}_internal_setBarSpacing(t){this._internal_stopTimeScaleAnimation(),this._private__timeScaleInvalidations.push({_internal_type:2,_internal_value:t})}_internal_setRightOffset(t){this._internal_stopTimeScaleAnimation(),this._private__timeScaleInvalidations.push({_internal_type:3,_internal_value:t})}_internal_timeScaleInvalidations(){return this._private__timeScaleInvalidations}_internal_merge(t){for(const e of t._private__timeScaleInvalidations)this._private__applyTimeScaleInvalidation(e);this._private__globalLevel=Math.max(this._private__globalLevel,t._private__globalLevel),t._private__invalidatedPanes.forEach(((t,e)=>{this._internal_invalidatePane(e,t)}))}static _internal_light(){return new zt(2)}static _internal_full(){return new zt(3)}_private__applyTimeScaleInvalidation(t){switch(t._internal_type){case 0:this._internal_setFitContent();break;case 1:this._internal_applyRange(t._internal_value);break;case 2:this._internal_setBarSpacing(t._internal_value);break;case 3:this._internal_setRightOffset(t._internal_value);break;case 4:this._internal_resetTimeScale();break;case 5:this._internal_setTimeScaleAnimation(t._internal_value);break;case 6:this._private__removeTimeScaleAnimation()}}_private__removeTimeScaleAnimation(){const t=this._private__timeScaleInvalidations.findIndex((t=>5===t._internal_type));-1!==t&&this._private__timeScaleInvalidations.splice(t,1)}}class Rt{constructor(t,e){this._private__minValue=t,this._private__maxValue=e}_internal_equals(t){return null!==t&&this._private__minValue===t._private__minValue&&this._private__maxValue===t._private__maxValue}_internal_clone(){return new Rt(this._private__minValue,this._private__maxValue)}_internal_minValue(){return this._private__minValue}_internal_maxValue(){return this._private__maxValue}_internal_length(){return this._private__maxValue-this._private__minValue}_internal_isEmpty(){return this._private__maxValue===this._private__minValue||Number.isNaN(this._private__maxValue)||Number.isNaN(this._private__minValue)}_internal_merge(t){function e(t,e,i,_){const r=Number.isFinite(e),n=Number.isFinite(i);return r&&n?t(e,i):r||n?r?e:i:_}return null===t?this:new Rt(e(Math.min,this._internal_minValue(),t._internal_minValue(),-1/0),e(Math.max,this._internal_maxValue(),t._internal_maxValue(),1/0))}_internal_scaleAroundCenter(e){if(!t(e))return;if(0==this._private__maxValue-this._private__minValue)return;const i=.5*(this._private__maxValue+this._private__minValue);let _=this._private__maxValue-i,r=this._private__minValue-i;_*=e,r*=e,this._private__maxValue=i+_,this._private__minValue=i+r}_internal_shift(e){t(e)&&(this._private__maxValue+=e,this._private__minValue+=e)}_internal_toRaw(){return{minValue:this._private__minValue,maxValue:this._private__maxValue}}static _internal_fromRaw(t){return null===t?null:new Rt(t.minValue,t.maxValue)}}class Bt{constructor(t,e){this._private__priceRange=t,this._private__margins=e||null}_internal_priceRange(){return this._private__priceRange}_internal_margins(){return this._private__margins}_internal_toRaw(){return null===this._private__priceRange?null:{priceRange:this._private__priceRange._internal_toRaw(),margins:this._private__margins||void 0}}static _internal_fromRaw(t){return null===t?null:new Bt(Rt._internal_fromRaw(t.priceRange),t.margins)}}class At extends K{constructor(t){super(),this._private__model=t}_internal_model(){return this._private__model}}const Vt={Bar:(t,e,i,_)=>{var r;const n=e.upColor,a=e.downColor,l=o(t(i,_)),s=h(l._internal_value[0])<=h(l._internal_value[3]);return{_internal_barColor:null!==(r=l._internal_color)&&void 0!==r?r:s?n:a}},Candlestick:(t,e,i,_)=>{var r,n,a;const l=e.upColor,s=e.downColor,p=e.borderUpColor,c=e.borderDownColor,v=e.wickUpColor,d=e.wickDownColor,u=o(t(i,_)),m=h(u._internal_value[0])<=h(u._internal_value[3]);return{_internal_barColor:null!==(r=u._internal_color)&&void 0!==r?r:m?l:s,_internal_barBorderColor:null!==(n=u._internal_borderColor)&&void 0!==n?n:m?p:c,_internal_barWickColor:null!==(a=u._internal_wickColor)&&void 0!==a?a:m?v:d}},Custom:(t,e,i,_)=>{var r;return{_internal_barColor:null!==(r=o(t(i,_))._internal_color)&&void 0!==r?r:e.color}},Area:(t,e,i,_)=>{var r,n,a,l;const s=o(t(i,_));return{_internal_barColor:null!==(r=s._internal_lineColor)&&void 0!==r?r:e.lineColor,_internal_lineColor:null!==(n=s._internal_lineColor)&&void 0!==n?n:e.lineColor,_internal_topColor:null!==(a=s._internal_topColor)&&void 0!==a?a:e.topColor,_internal_bottomColor:null!==(l=s._internal_bottomColor)&&void 0!==l?l:e.bottomColor}},Baseline:(t,e,i,_)=>{var r,n,a,l,s,h;const p=o(t(i,_));return{_internal_barColor:p._internal_value[3]>=e.baseValue.price?e.topLineColor:e.bottomLineColor,_internal_topLineColor:null!==(r=p._internal_topLineColor)&&void 0!==r?r:e.topLineColor,_internal_bottomLineColor:null!==(n=p._internal_bottomLineColor)&&void 0!==n?n:e.bottomLineColor,_internal_topFillColor1:null!==(a=p._internal_topFillColor1)&&void 0!==a?a:e.topFillColor1,_internal_topFillColor2:null!==(l=p._internal_topFillColor2)&&void 0!==l?l:e.topFillColor2,_internal_bottomFillColor1:null!==(s=p._internal_bottomFillColor1)&&void 0!==s?s:e.bottomFillColor1,_internal_bottomFillColor2:null!==(h=p._internal_bottomFillColor2)&&void 0!==h?h:e.bottomFillColor2}},Line:(t,e,i,_)=>{var r,n;const a=o(t(i,_));return{_internal_barColor:null!==(r=a._internal_color)&&void 0!==r?r:e.color,_internal_lineColor:null!==(n=a._internal_color)&&void 0!==n?n:e.color}},Histogram:(t,e,i,_)=>{var r;return{_internal_barColor:null!==(r=o(t(i,_))._internal_color)&&void 0!==r?r:e.color}}};class It{constructor(t){this._private__findBar=(t,e)=>void 0!==e?e._internal_value:this._private__series._internal_bars()._internal_valueAt(t),this._private__series=t,this._private__styleGetter=Vt[t._internal_seriesType()]}_internal_barStyle(t,e){return this._private__styleGetter(this._private__findBar,this._private__series._internal_options(),t,e)}}const Dt=30;class Ot{constructor(){this._private__items=[],this._private__minMaxCache=new Map,this._private__rowSearchCache=new Map}_internal_last(){return this._internal_size()>0?this._private__items[this._private__items.length-1]:null}_internal_firstIndex(){return this._internal_size()>0?this._private__indexAt(0):null}_internal_lastIndex(){return this._internal_size()>0?this._private__indexAt(this._private__items.length-1):null}_internal_size(){return this._private__items.length}_internal_isEmpty(){return 0===this._internal_size()}_internal_contains(t){return null!==this._private__search(t,0)}_internal_valueAt(t){return this._internal_search(t)}_internal_search(t,e=0){const i=this._private__search(t,e);return null===i?null:Object.assign(Object.assign({},this._private__valueAt(i)),{_internal_index:this._private__indexAt(i)})}_internal_rows(){return this._private__items}_internal_minMaxOnRangeCached(t,e,i){if(this._internal_isEmpty())return null;let _=null;for(const r of i)_=Lt(_,this._private__minMaxOnRangeCachedImpl(t,e,r));return _}_internal_setData(t){this._private__rowSearchCache.clear(),this._private__minMaxCache.clear(),this._private__items=t}_private__indexAt(t){return this._private__items[t]._internal_index}_private__valueAt(t){return this._private__items[t]}_private__search(t,e){const i=this._private__bsearch(t);if(null===i&&0!==e)switch(e){case-1:return this._private__searchNearestLeft(t);case 1:return this._private__searchNearestRight(t);default:throw new TypeError("Unknown search mode")}return i}_private__searchNearestLeft(t){let e=this._private__lowerbound(t);return e>0&&(e-=1),e!==this._private__items.length&&this._private__indexAt(e)<t?e:null}_private__searchNearestRight(t){const e=this._private__upperbound(t);return e!==this._private__items.length&&t<this._private__indexAt(e)?e:null}_private__bsearch(t){const e=this._private__lowerbound(t);return e===this._private__items.length||t<this._private__items[e]._internal_index?null:e}_private__lowerbound(t){return tt(this._private__items,t,((t,e)=>t._internal_index<e))}_private__upperbound(t){return et(this._private__items,t,((t,e)=>t._internal_index>e))}_private__plotMinMax(t,e,i){let _=null;for(let r=t;r<e;r++){const t=this._private__items[r]._internal_value[i];Number.isNaN(t)||(null===_?_={_internal_min:t,_internal_max:t}:(t<_._internal_min&&(_._internal_min=t),t>_._internal_max&&(_._internal_max=t)))}return _}_private__minMaxOnRangeCachedImpl(t,e,i){if(this._internal_isEmpty())return null;let _=null;const r=o(this._internal_firstIndex()),n=o(this._internal_lastIndex()),a=Math.max(t,r),l=Math.min(e,n),s=Math.ceil(a/Dt)*Dt,h=Math.max(s,Math.floor(l/Dt)*Dt);{const t=this._private__lowerbound(a),r=this._private__upperbound(Math.min(l,s,e));_=Lt(_,this._private__plotMinMax(t,r,i))}let p=this._private__minMaxCache.get(i);void 0===p&&(p=new Map,this._private__minMaxCache.set(i,p));for(let t=Math.max(s+1,a);t<h;t+=Dt){const e=Math.floor(t/Dt);let r=p.get(e);if(void 0===r){const t=this._private__lowerbound(e*Dt),_=this._private__upperbound((e+1)*Dt-1);r=this._private__plotMinMax(t,_,i),p.set(e,r)}_=Lt(_,r)}{const t=this._private__lowerbound(h),e=this._private__upperbound(l);_=Lt(_,this._private__plotMinMax(t,e,i))}return _}}function Lt(t,e){return null===t?e:null===e?t:{_internal_min:Math.min(t._internal_min,e._internal_min),_internal_max:Math.max(t._internal_max,e._internal_max)}}class Wt{constructor(t){this._private__baseRenderer=t}_internal_draw(t,e,i){this._private__baseRenderer.draw(t)}_internal_drawBackground(t,e,i){var _,r;null===(r=(_=this._private__baseRenderer).drawBackground)||void 0===r||r.call(_,t)}}class Ft{constructor(t){this._private__cache=null,this._private__paneView=t}_internal_renderer(){var t;const e=this._private__paneView.renderer();if(null===e)return null;if((null===(t=this._private__cache)||void 0===t?void 0:t._internal_base)===e)return this._private__cache._internal_wrapper;const i=new Wt(e);return this._private__cache={_internal_base:e,_internal_wrapper:i},i}_internal_zOrder(){var t,e,i;return null!==(i=null===(e=(t=this._private__paneView).zOrder)||void 0===e?void 0:e.call(t))&&void 0!==i?i:"normal"}}class Nt{constructor(t,e){this._private__renderer=new X,this._private__baseView=t,this._private__timeScale=e}_internal_renderer(){var t,e,i,_,r,n;return this._private__renderer._internal_setData(Object.assign({_internal_width:this._private__timeScale._internal_width()},{_internal_text:(t=this._private__baseView).text(),_internal_coordinate:t.coordinate(),_internal_fixedCoordinate:null===(e=t.fixedCoordinate)||void 0===e?void 0:e.call(t),_internal_color:t.textColor(),_internal_background:t.backColor(),_internal_visible:null===(_=null===(i=t.visible)||void 0===i?void 0:i.call(t))||void 0===_||_,_internal_tickVisible:null===(n=null===(r=t.tickVisible)||void 0===r?void 0:r.call(t))||void 0===n||n})),this._private__renderer}}class Ht extends Y{constructor(t,e){super(),this._private__baseView=t,this._private__priceScale=e}}class Ut{constructor(t,e){this._private__paneViewsCache=null,this._private__timeAxisViewsCache=null,this._private__priceAxisViewsCache=null,this._private__priceAxisPaneViewsCache=null,this._private__timeAxisPaneViewsCache=null,this._private__primitive=t,this._private__series=e}_internal_primitive(){return this._private__primitive}_internal_updateAllViews(){var t,e;null===(e=(t=this._private__primitive).updateAllViews)||void 0===e||e.call(t)}_internal_paneViews(){var t,e,i,_;const r=null!==(i=null===(e=(t=this._private__primitive).paneViews)||void 0===e?void 0:e.call(t))&&void 0!==i?i:[];if((null===(_=this._private__paneViewsCache)||void 0===_?void 0:_._internal_base)===r)return this._private__paneViewsCache._internal_wrapper;const n=r.map((t=>new Ft(t)));return this._private__paneViewsCache={_internal_base:r,_internal_wrapper:n},n}_internal_timeAxisViews(){var t,e,i,_;const r=null!==(i=null===(e=(t=this._private__primitive).timeAxisViews)||void 0===e?void 0:e.call(t))&&void 0!==i?i:[];if((null===(_=this._private__timeAxisViewsCache)||void 0===_?void 0:_._internal_base)===r)return this._private__timeAxisViewsCache._internal_wrapper;const n=this._private__series._internal_model()._internal_timeScale(),a=r.map((t=>new Nt(t,n)));return this._private__timeAxisViewsCache={_internal_base:r,_internal_wrapper:a},a}_internal_priceAxisViews(){var t,e,i,_;const r=null!==(i=null===(e=(t=this._private__primitive).priceAxisViews)||void 0===e?void 0:e.call(t))&&void 0!==i?i:[];if((null===(_=this._private__priceAxisViewsCache)||void 0===_?void 0:_._internal_base)===r)return this._private__priceAxisViewsCache._internal_wrapper;const n=this._private__series._internal_priceScale(),a=r.map((t=>new Ht(t,n)));return this._private__priceAxisViewsCache={_internal_base:r,_internal_wrapper:a},a}_internal_priceAxisPaneViews(){var t,e,i,_;const r=null!==(i=null===(e=(t=this._private__primitive).priceAxisPaneViews)||void 0===e?void 0:e.call(t))&&void 0!==i?i:[];if((null===(_=this._private__priceAxisPaneViewsCache)||void 0===_?void 0:_._internal_base)===r)return this._private__priceAxisPaneViewsCache._internal_wrapper;const n=r.map((t=>new Ft(t)));return this._private__priceAxisPaneViewsCache={_internal_base:r,_internal_wrapper:n},n}_internal_timeAxisPaneViews(){var t,e,i,_;const r=null!==(i=null===(e=(t=this._private__primitive).timeAxisPaneViews)||void 0===e?void 0:e.call(t))&&void 0!==i?i:[];if((null===(_=this._private__timeAxisPaneViewsCache)||void 0===_?void 0:_._internal_base)===r)return this._private__timeAxisPaneViewsCache._internal_wrapper;const n=r.map((t=>new Ft(t)));return this._private__timeAxisPaneViewsCache={_internal_base:r,_internal_wrapper:n},n}_internal_autoscaleInfo(t,e){var i,_,r;return null!==(r=null===(_=(i=this._private__primitive).autoscaleInfo)||void 0===_?void 0:_.call(i,t,e))&&void 0!==r?r:null}_internal_hitTest(t,e){var i,_,r;return null!==(r=null===(_=(i=this._private__primitive).hitTest)||void 0===_?void 0:_.call(i,t,e))&&void 0!==r?r:null}}function Yt(t,e,i,_){t.forEach((t=>{e(t).forEach((t=>{t._internal_zOrder()===i&&_.push(t)}))}))}function $t(t){return t._internal_paneViews()}function jt(t){return t._internal_priceAxisPaneViews()}function Xt(t){return t._internal_timeAxisPaneViews()}class Gt extends At{constructor(t,e,i){super(t),this._private__data=new Ot,this._private__priceLineView=new Tt(this),this._private__customPriceLines=[],this._private__baseHorizontalLineView=new ft(this),this._private__lastPriceAnimationPaneView=null,this._private__barColorerCache=null,this._private__animationTimeoutId=null,this._private__primitives=[],this._private__options=e,this._private__seriesType=i;const _=new Pt(this);this._private__priceAxisViews=[_],this._private__panePriceAxisView=new ut(_,this,t),"Area"!==i&&"Line"!==i&&"Baseline"!==i||(this._private__lastPriceAnimationPaneView=new xt(this)),this._private__recreateFormatter(),this._private__recreatePaneViews()}_internal_destroy(){null!==this._private__animationTimeoutId&&clearTimeout(this._private__animationTimeoutId)}_internal_priceLineColor(t){return this._private__options.priceLineColor||t}_internal_lastValueData(t){const e={_internal_noData:!0},i=this._internal_priceScale();if(this._internal_model()._internal_timeScale()._internal_isEmpty()||i._internal_isEmpty()||this._private__data._internal_isEmpty())return e;const _=this._internal_model()._internal_timeScale()._internal_visibleStrictRange(),r=this._internal_firstValue();if(null===_||null===r)return e;let n,a;if(t){const t=this._private__data._internal_last();if(null===t)return e;n=t,a=t._internal_index}else{const t=this._private__data._internal_search(_._internal_right(),-1);if(null===t)return e;if(n=this._private__data._internal_valueAt(t._internal_index),null===n)return e;a=t._internal_index}const l=n._internal_value[3],s=this._internal_barColorer()._internal_barStyle(a,{_internal_value:n}),o=i._internal_priceToCoordinate(l,r._internal_value);return{_internal_noData:!1,_internal_price:l,_internal_text:i._internal_formatPrice(l,r._internal_value),_internal_formattedPriceAbsolute:i._internal_formatPriceAbsolute(l),_internal_formattedPricePercentage:i._internal_formatPricePercentage(l,r._internal_value),_internal_color:s._internal_barColor,_internal_coordinate:o,_internal_index:a}}_internal_barColorer(){return null!==this._private__barColorerCache||(this._private__barColorerCache=new It(this)),this._private__barColorerCache}_internal_options(){return this._private__options}_internal_applyOptions(t){const e=t.priceScaleId;void 0!==e&&e!==this._private__options.priceScaleId&&this._internal_model()._internal_moveSeriesToScale(this,e),p(this._private__options,t),void 0!==t.priceFormat&&(this._private__recreateFormatter(),this._internal_model()._internal_fullUpdate()),this._internal_model()._internal_updateSource(this),this._internal_model()._internal_updateCrosshair(),this._private__paneView._internal_update("options")}_internal_setData(t,e){this._private__data._internal_setData(t),this._private__paneView._internal_update("data"),null!==this._private__lastPriceAnimationPaneView&&(e&&e._internal_lastBarUpdatedOrNewBarsAddedToTheRight?this._private__lastPriceAnimationPaneView._internal_onNewRealtimeDataReceived():0===t.length&&this._private__lastPriceAnimationPaneView._internal_onDataCleared());const i=this._internal_model()._internal_paneForSource(this);this._internal_model()._internal_recalculatePane(i),this._internal_model()._internal_updateSource(this),this._internal_model()._internal_updateCrosshair(),this._internal_model()._internal_lightUpdate()}_internal_seriesType(){return this._private__seriesType}_internal_firstValue(){const t=this._internal_firstBar();return null===t?null:{_internal_value:t._internal_value[3],_internal_timePoint:t._internal_time}}_internal_firstBar(){const t=this._internal_model()._internal_timeScale()._internal_visibleStrictRange();if(null===t)return null;const e=t._internal_left();return this._private__data._internal_search(e,1)}_internal_bars(){return this._private__data}_internal_topPaneViews(t){const e=[];Yt(this._private__primitives,$t,"top",e);const i=this._private__lastPriceAnimationPaneView;return null!==i&&i._internal_visible()?(null===this._private__animationTimeoutId&&i._internal_animationActive()&&(this._private__animationTimeoutId=setTimeout((()=>{this._private__animationTimeoutId=null,this._internal_model()._internal_cursorUpdate()}),0)),i._internal_invalidateStage(),e.push(i),e):e}_internal_paneViews(){const t=[];this._private__isOverlay()||t.push(this._private__baseHorizontalLineView),t.push(this._private__paneView,this._private__priceLineView);const e=this._private__customPriceLines.map((t=>t._internal_paneView()));return t.push(...e),Yt(this._private__primitives,$t,"normal",t),t}_internal_bottomPaneViews(){return this._private__extractPaneViews($t,"bottom")}_internal_pricePaneViews(t){return this._private__extractPaneViews(jt,t)}_internal_timePaneViews(t){return this._private__extractPaneViews(Xt,t)}_internal_primitiveHitTest(t,e){return this._private__primitives.map((i=>i._internal_hitTest(t,e))).filter((t=>null!==t))}_internal_labelPaneViews(t){return[this._private__panePriceAxisView,...this._private__customPriceLines.map((t=>t._internal_labelPaneView()))]}_internal_priceAxisViews(t,e){if(e!==this._internal__priceScale&&!this._private__isOverlay())return[];const i=[...this._private__priceAxisViews];for(const t of this._private__customPriceLines)i.push(t._internal_priceAxisView());return this._private__primitives.forEach((t=>{i.push(...t._internal_priceAxisViews())})),i}_internal_timeAxisViews(){const t=[];return this._private__primitives.forEach((e=>{t.push(...e._internal_timeAxisViews())})),t}_internal_autoscaleInfo(t,e){if(void 0!==this._private__options.autoscaleInfoProvider){const i=this._private__options.autoscaleInfoProvider((()=>{const i=this._private__autoscaleInfoImpl(t,e);return null===i?null:i._internal_toRaw()}));return Bt._internal_fromRaw(i)}return this._private__autoscaleInfoImpl(t,e)}_internal_minMove(){return this._private__options.priceFormat.minMove}_internal_formatter(){return this._private__formatter}_internal_updateAllViews(){var t;this._private__paneView._internal_update();for(const t of this._private__priceAxisViews)t._internal_update();for(const t of this._private__customPriceLines)t._internal_update();this._private__priceLineView._internal_update(),this._private__baseHorizontalLineView._internal_update(),null===(t=this._private__lastPriceAnimationPaneView)||void 0===t||t._internal_update(),this._private__primitives.forEach((t=>t._internal_updateAllViews()))}_internal_priceScale(){return o(super._internal_priceScale())}_internal_markerDataAtIndex(t){if("Line"!==this._private__seriesType&&"Area"!==this._private__seriesType&&"Baseline"!==this._private__seriesType||!this._private__options.crosshairMarkerVisible)return null;const e=this._private__data._internal_valueAt(t);return null===e?null:{_internal_price:e._internal_value[3],_internal_radius:this._private__markerRadius(),_internal_borderColor:this._private__markerBorderColor(),_internal_borderWidth:this._private__markerBorderWidth(),_internal_backgroundColor:this._private__markerBackgroundColor(t)}}_internal_title(){return this._private__options.title}_internal_visible(){return this._private__options.visible}_internal_attachPrimitive(t){this._private__primitives.push(new Ut(t,this))}_internal_detachPrimitive(t){this._private__primitives=this._private__primitives.filter((e=>e._internal_primitive()!==t))}_internal_customSeriesPlotValuesBuilder(){if(this._private__paneView instanceof ht)return t=>this._private__paneView._internal_priceValueBuilder(t)}_internal_customSeriesWhitespaceCheck(){if(this._private__paneView instanceof ht)return t=>this._private__paneView._internal_isWhitespace(t)}_private__isOverlay(){return!Et(this._internal_priceScale()._internal_id())}_private__autoscaleInfoImpl(t,i){if(!e(t)||!e(i)||this._private__data._internal_isEmpty())return null;const _="Line"===this._private__seriesType||"Area"===this._private__seriesType||"Baseline"===this._private__seriesType||"Histogram"===this._private__seriesType?[3]:[2,1],r=this._private__data._internal_minMaxOnRangeCached(t,i,_);let n=null!==r?new Rt(r._internal_min,r._internal_max):null;if("Histogram"===this._internal_seriesType()){const t=this._private__options.base,e=new Rt(t,t);n=null!==n?n._internal_merge(e):e}return this._private__primitives.forEach((e=>{const _=e._internal_autoscaleInfo(t,i);if(null==_?void 0:_.priceRange){const t=new Rt(_.priceRange.minValue,_.priceRange.maxValue);n=null!==n?n._internal_merge(t):t}})),new Bt(n,null)}_private__markerRadius(){switch(this._private__seriesType){case"Line":case"Area":case"Baseline":return this._private__options.crosshairMarkerRadius}return 0}_private__markerBorderColor(){switch(this._private__seriesType){case"Line":case"Area":case"Baseline":{const t=this._private__options.crosshairMarkerBorderColor;if(0!==t.length)return t}}return null}_private__markerBorderWidth(){switch(this._private__seriesType){case"Line":case"Area":case"Baseline":return this._private__options.crosshairMarkerBorderWidth}return 0}_private__markerBackgroundColor(t){switch(this._private__seriesType){case"Line":case"Area":case"Baseline":{const t=this._private__options.crosshairMarkerBackgroundColor;if(0!==t.length)return t}}return this._internal_barColorer()._internal_barStyle(t)._internal_barColor}_private__recreateFormatter(){switch(this._private__options.priceFormat.type){case"custom":this._private__formatter={format:this._private__options.priceFormat.formatter};break;case"volume":this._private__formatter=new V(this._private__options.priceFormat.precision);break;case"percent":this._private__formatter=new A(this._private__options.priceFormat.precision);break;default:{const t=Math.pow(10,this._private__options.priceFormat.precision);this._private__formatter=new B(t,this._private__options.priceFormat.minMove*t)}}null!==this._internal__priceScale&&this._internal__priceScale._internal_updateFormatter()}_private__recreatePaneViews(){switch(this._private__seriesType){case"Candlestick":this._private__paneView=new st(this,this._internal_model());break;case"Line":this._private__paneView=new pt(this,this._internal_model());break;default:throw Error("Unknown chart style assigned: "+this._private__seriesType)}}_private__extractPaneViews(t,e){const i=[];return Yt(this._private__primitives,t,e,i),i}}class Kt extends F{constructor(){super(...arguments),this._private__data=null}_internal_setData(t){this._private__data=t}_internal__drawImpl({context:t,bitmapSize:e,horizontalPixelRatio:i,verticalPixelRatio:_}){if(null===this._private__data)return;const r=Math.max(1,Math.floor(i));t.lineWidth=r,function(t,e){t.save(),t.lineWidth%2&&t.translate(.5,.5),e(),t.restore()}(t,(()=>{const n=o(this._private__data);if(n._internal_vertLinesVisible){t.strokeStyle=n._internal_vertLinesColor,d(t,n._internal_vertLineStyle),t.beginPath();for(const _ of n._internal_timeMarks){const n=Math.round(_._internal_coord*i);t.moveTo(n,-r),t.lineTo(n,e.height+r)}t.stroke()}if(n._internal_horzLinesVisible){t.strokeStyle=n._internal_horzLinesColor,d(t,n._internal_horzLineStyle),t.beginPath();for(const i of n._internal_priceMarks){const n=Math.round(i._internal_coord*_);t.moveTo(-r,n),t.lineTo(e.width+r,n)}t.stroke()}}))}}class Zt{constructor(t){this._private__renderer=new Kt,this._private__invalidated=!0,this._private__pane=t}_internal_update(){this._private__invalidated=!0}_internal_renderer(){if(this._private__invalidated){const t=this._private__pane._internal_model()._internal_options().grid,e={_internal_horzLinesVisible:t.horzLines.visible,_internal_vertLinesVisible:t.vertLines.visible,_internal_horzLinesColor:t.horzLines.color,_internal_vertLinesColor:t.vertLines.color,_internal_horzLineStyle:t.horzLines.style,_internal_vertLineStyle:t.vertLines.style,_internal_priceMarks:this._private__pane._internal_defaultPriceScale()._internal_marks(),_internal_timeMarks:(this._private__pane._internal_model()._internal_timeScale()._internal_marks()||[]).map((t=>({_internal_coord:t.coord})))};this._private__renderer._internal_setData(e),this._private__invalidated=!1}return this._private__renderer}}class qt{constructor(t){this._private__paneView=new Zt(t)}_internal_paneView(){return this._private__paneView}}const Qt={_internal_logicalOffset:4,_internal_coordOffset:1e-4};function Jt(t,e){const i=100*(t-e)/e;return e<0?-i:i}function te(t,e){const i=Jt(t._internal_minValue(),e),_=Jt(t._internal_maxValue(),e);return new Rt(i,_)}function ee(t,e){const i=100*(t-e)/e+100;return e<0?-i:i}function ie(t,e){const i=ee(t._internal_minValue(),e),_=ee(t._internal_maxValue(),e);return new Rt(i,_)}function _e(t,e){const i=Math.abs(t);if(i<1e-15)return 0;const _=Math.log10(i+e._internal_coordOffset)+e._internal_logicalOffset;return t<0?-_:_}function re(t,e){const i=Math.abs(t);if(i<1e-15)return 0;const _=Math.pow(10,i-e._internal_logicalOffset)-e._internal_coordOffset;return t<0?-_:_}function ne(t,e){if(null===t)return null;const i=_e(t._internal_minValue(),e),_=_e(t._internal_maxValue(),e);return new Rt(i,_)}function ae(t,e){if(null===t)return null;const i=re(t._internal_minValue(),e),_=re(t._internal_maxValue(),e);return new Rt(i,_)}function le(t){if(null===t)return Qt;const e=Math.abs(t._internal_maxValue()-t._internal_minValue());if(e>=1||e<1e-15)return Qt;const i=Math.ceil(Math.abs(Math.log10(e))),_=Qt._internal_logicalOffset+i;return{_internal_logicalOffset:_,_internal_coordOffset:1/Math.pow(10,_)}}class se{constructor(t,e){if(this._private__base=t,this._private__integralDividers=e,function(t){if(t<0)return!1;for(let e=t;e>1;e/=10)if(e%10!=0)return!1;return!0}(this._private__base))this._private__fractionalDividers=[2,2.5,2];else{this._private__fractionalDividers=[];for(let t=this._private__base;1!==t;){if(t%2==0)this._private__fractionalDividers.push(2),t/=2;else{if(t%5!=0)throw new Error("unexpected base");this._private__fractionalDividers.push(2,2.5),t/=5}if(this._private__fractionalDividers.length>100)throw new Error("something wrong with base")}}}_internal_tickSpan(t,e,i){const _=0===this._private__base?0:1/this._private__base;let r=Math.pow(10,Math.max(0,Math.ceil(Math.log10(t-e)))),n=0,a=this._private__integralDividers[0];for(;;){const t=v(r,_,1e-14)&&r>_+1e-14,e=v(r,i*a,1e-14),l=v(r,1,1e-14);if(!(t&&e&&l))break;r/=a,a=this._private__integralDividers[++n%this._private__integralDividers.length]}if(r<=_+1e-14&&(r=_),r=Math.max(1,r),this._private__fractionalDividers.length>0&&(l=r,1,1e-14,Math.abs(l-1)<1e-14))for(n=0,a=this._private__fractionalDividers[0];v(r,i*a,1e-14)&&r>_+1e-14;)r/=a,a=this._private__fractionalDividers[++n%this._private__fractionalDividers.length];var l;return r}}class oe{constructor(t,e,i,_){this._private__marks=[],this._private__priceScale=t,this._private__base=e,this._private__coordinateToLogicalFunc=i,this._private__logicalToCoordinateFunc=_}_internal_tickSpan(t,e){if(t<e)throw new Error("high < low");const i=this._private__priceScale._internal_height(),_=(t-e)*this._private__tickMarkHeight()/i,r=new se(this._private__base,[2,2.5,2]),n=new se(this._private__base,[2,2,2.5]),a=new se(this._private__base,[2.5,2,2]),l=[];return l.push(r._internal_tickSpan(t,e,_),n._internal_tickSpan(t,e,_),a._internal_tickSpan(t,e,_)),function(t){if(t.length<1)throw Error("array is empty");let e=t[0];for(let i=1;i<t.length;++i)t[i]<e&&(e=t[i]);return e}(l)}_internal_rebuildTickMarks(){const t=this._private__priceScale,e=t._internal_firstValue();if(null===e)return void(this._private__marks=[]);const i=t._internal_height(),_=this._private__coordinateToLogicalFunc(i-1,e),r=this._private__coordinateToLogicalFunc(0,e),n=this._private__priceScale._internal_options().entireTextOnly?this._private__fontHeight()/2:0,a=n,l=i-1-n,s=Math.max(_,r),o=Math.min(_,r);if(s===o)return void(this._private__marks=[]);let h=this._internal_tickSpan(s,o),p=s%h;p+=p<0?h:0;const c=s>=o?1:-1;let v=null,d=0;for(let i=s-p;i>o;i-=h){const _=this._private__logicalToCoordinateFunc(i,e,!0);null!==v&&Math.abs(_-v)<this._private__tickMarkHeight()||_<a||_>l||(d<this._private__marks.length?(this._private__marks[d]._internal_coord=_,this._private__marks[d]._internal_label=t._internal_formatLogical(i)):this._private__marks.push({_internal_coord:_,_internal_label:t._internal_formatLogical(i)}),d++,v=_,t._internal_isLog()&&(h=this._internal_tickSpan(i*c,o)))}this._private__marks.length=d}_internal_marks(){return this._private__marks}_private__fontHeight(){return this._private__priceScale._internal_fontSize()}_private__tickMarkHeight(){return Math.ceil(2.5*this._private__fontHeight())}}function he(t){return t.slice().sort(((t,e)=>o(t._internal_zorder())-o(e._internal_zorder())))}const pe=new A,ce=new B(100,1);class ve{constructor(t,e,i,_){this._private__height=0,this._private__internalHeightCache=null,this._private__priceRange=null,this._private__priceRangeSnapshot=null,this._private__invalidatedForRange={_internal_isValid:!1,_internal_visibleBars:null},this._private__marginAbove=0,this._private__marginBelow=0,this._private__onMarksChanged=new yt,this._private__modeChanged=new yt,this._private__dataSources=[],this._private__cachedOrderedSources=null,this._private__marksCache=null,this._private__scaleStartPoint=null,this._private__scrollStartPoint=null,this._private__formatter=ce,this._private__logFormula=le(null),this._private__id=t,this._private__options=e,this._private__layoutOptions=i,this._private__localizationOptions=_,this._private__markBuilder=new oe(this,100,this._private__coordinateToLogical.bind(this),this._private__logicalToCoordinate.bind(this))}_internal_id(){return this._private__id}_internal_options(){return this._private__options}_internal_applyOptions(t){if(p(this._private__options,t),this._internal_updateFormatter(),void 0!==t.mode&&this._internal_setMode({_internal_mode:t.mode}),void 0!==t.scaleMargins){const e=s(t.scaleMargins.top),i=s(t.scaleMargins.bottom);if(e<0||e>1)throw new Error(`Invalid top margin - expect value between 0 and 1, given=${e}`);if(i<0||i>1)throw new Error(`Invalid bottom margin - expect value between 0 and 1, given=${i}`);if(e+i>1)throw new Error(`Invalid margins - sum of margins must be less than 1, given=${e+i}`);this._private__invalidateInternalHeightCache(),this._private__marksCache=null}}_internal_isAutoScale(){return this._private__options.autoScale}_internal_isLog(){return 1===this._private__options.mode}_internal_isPercentage(){return 2===this._private__options.mode}_internal_isIndexedTo100(){return 3===this._private__options.mode}_internal_mode(){return{_internal_autoScale:this._private__options.autoScale,_internal_isInverted:this._private__options.invertScale,_internal_mode:this._private__options.mode}}_internal_setMode(t){const e=this._internal_mode();let i=null;void 0!==t._internal_autoScale&&(this._private__options.autoScale=t._internal_autoScale),void 0!==t._internal_mode&&(this._private__options.mode=t._internal_mode,2!==t._internal_mode&&3!==t._internal_mode||(this._private__options.autoScale=!0),this._private__invalidatedForRange._internal_isValid=!1),1===e._internal_mode&&t._internal_mode!==e._internal_mode&&(function(t,e){if(null===t)return!1;const i=re(t._internal_minValue(),e),_=re(t._internal_maxValue(),e);return isFinite(i)&&isFinite(_)}(this._private__priceRange,this._private__logFormula)?(i=ae(this._private__priceRange,this._private__logFormula),null!==i&&this._internal_setPriceRange(i)):this._private__options.autoScale=!0),1===t._internal_mode&&t._internal_mode!==e._internal_mode&&(i=ne(this._private__priceRange,this._private__logFormula),null!==i&&this._internal_setPriceRange(i));const _=e._internal_mode!==this._private__options.mode;_&&(2===e._internal_mode||this._internal_isPercentage())&&this._internal_updateFormatter(),_&&(3===e._internal_mode||this._internal_isIndexedTo100())&&this._internal_updateFormatter(),void 0!==t._internal_isInverted&&e._internal_isInverted!==t._internal_isInverted&&(this._private__options.invertScale=t._internal_isInverted,this._private__onIsInvertedChanged()),this._private__modeChanged._internal_fire(e,this._internal_mode())}_internal_modeChanged(){return this._private__modeChanged}_internal_fontSize(){return this._private__layoutOptions.fontSize}_internal_height(){return this._private__height}_internal_setHeight(t){this._private__height!==t&&(this._private__height=t,this._private__invalidateInternalHeightCache(),this._private__marksCache=null)}_internal_internalHeight(){if(this._private__internalHeightCache)return this._private__internalHeightCache;const t=this._internal_height()-this._private__topMarginPx()-this._private__bottomMarginPx();return this._private__internalHeightCache=t,t}_internal_priceRange(){return this._private__makeSureItIsValid(),this._private__priceRange}_internal_setPriceRange(t,e){const i=this._private__priceRange;(e||null===i&&null!==t||null!==i&&!i._internal_equals(t))&&(this._private__marksCache=null,this._private__priceRange=t)}_internal_isEmpty(){return this._private__makeSureItIsValid(),0===this._private__height||!this._private__priceRange||this._private__priceRange._internal_isEmpty()}_internal_invertedCoordinate(t){return this._internal_isInverted()?t:this._internal_height()-1-t}_internal_priceToCoordinate(t,e){return this._internal_isPercentage()?t=Jt(t,e):this._internal_isIndexedTo100()&&(t=ee(t,e)),this._private__logicalToCoordinate(t,e)}_internal_pointsArrayToCoordinates(t,e,i){this._private__makeSureItIsValid();const _=this._private__bottomMarginPx(),r=o(this._internal_priceRange()),n=r._internal_minValue(),a=r._internal_maxValue(),l=this._internal_internalHeight()-1,s=this._internal_isInverted(),h=l/(a-n),p=void 0===i?0:i.from,c=void 0===i?t.length:i.to,v=this._private__getCoordinateTransformer();for(let i=p;i<c;i++){const r=t[i],a=r._internal_price;if(isNaN(a))continue;let l=a;null!==v&&(l=v(r._internal_price,e));const o=_+h*(l-n);r._internal_y=s?o:this._private__height-1-o}}_internal_barPricesToCoordinates(t,e,i){this._private__makeSureItIsValid();const _=this._private__bottomMarginPx(),r=o(this._internal_priceRange()),n=r._internal_minValue(),a=r._internal_maxValue(),l=this._internal_internalHeight()-1,s=this._internal_isInverted(),h=l/(a-n),p=void 0===i?0:i.from,c=void 0===i?t.length:i.to,v=this._private__getCoordinateTransformer();for(let i=p;i<c;i++){const r=t[i];let a=r._internal_open,l=r._internal_high,o=r._internal_low,p=r._internal_close;null!==v&&(a=v(r._internal_open,e),l=v(r._internal_high,e),o=v(r._internal_low,e),p=v(r._internal_close,e));let c=_+h*(a-n),d=s?c:this._private__height-1-c;r._internal_openY=d,c=_+h*(l-n),d=s?c:this._private__height-1-c,r._internal_highY=d,c=_+h*(o-n),d=s?c:this._private__height-1-c,r._internal_lowY=d,c=_+h*(p-n),d=s?c:this._private__height-1-c,r._internal_closeY=d}}_internal_coordinateToPrice(t,e){const i=this._private__coordinateToLogical(t,e);return this._internal_logicalToPrice(i,e)}_internal_logicalToPrice(t,e){let i=t;return this._internal_isPercentage()?i=function(t,e){return e<0&&(t=-t),t/100*e+e}(i,e):this._internal_isIndexedTo100()&&(i=function(t,e){return t-=100,e<0&&(t=-t),t/100*e+e}(i,e)),i}_internal_dataSources(){return this._private__dataSources}_internal_orderedSources(){if(this._private__cachedOrderedSources)return this._private__cachedOrderedSources;let t=[];for(let e=0;e<this._private__dataSources.length;e++){const i=this._private__dataSources[e];null===i._internal_zorder()&&i._internal_setZorder(e+1),t.push(i)}return t=he(t),this._private__cachedOrderedSources=t,this._private__cachedOrderedSources}_internal_addDataSource(t){-1===this._private__dataSources.indexOf(t)&&(this._private__dataSources.push(t),this._internal_updateFormatter(),this._internal_invalidateSourcesCache())}_internal_removeDataSource(t){const e=this._private__dataSources.indexOf(t);if(-1===e)throw new Error("source is not attached to scale");this._private__dataSources.splice(e,1),0===this._private__dataSources.length&&(this._internal_setMode({_internal_autoScale:!0}),this._internal_setPriceRange(null)),this._internal_updateFormatter(),this._internal_invalidateSourcesCache()}_internal_firstValue(){let t=null;for(const e of this._private__dataSources){const i=e._internal_firstValue();null!==i&&(null===t||i._internal_timePoint<t._internal_timePoint)&&(t=i)}return null===t?null:t._internal_value}_internal_isInverted(){return this._private__options.invertScale}_internal_marks(){const t=null===this._internal_firstValue();if(null!==this._private__marksCache&&(t||this._private__marksCache._internal_firstValueIsNull===t))return this._private__marksCache._internal_marks;this._private__markBuilder._internal_rebuildTickMarks();const e=this._private__markBuilder._internal_marks();return this._private__marksCache={_internal_marks:e,_internal_firstValueIsNull:t},this._private__onMarksChanged._internal_fire(),e}_internal_onMarksChanged(){return this._private__onMarksChanged}_internal_startScale(t){this._internal_isPercentage()||this._internal_isIndexedTo100()||null===this._private__scaleStartPoint&&null===this._private__priceRangeSnapshot&&(this._internal_isEmpty()||(this._private__scaleStartPoint=this._private__height-t,this._private__priceRangeSnapshot=o(this._internal_priceRange())._internal_clone()))}_internal_scaleTo(t){if(this._internal_isPercentage()||this._internal_isIndexedTo100())return;if(null===this._private__scaleStartPoint)return;this._internal_setMode({_internal_autoScale:!1}),(t=this._private__height-t)<0&&(t=0);let e=(this._private__scaleStartPoint+.2*(this._private__height-1))/(t+.2*(this._private__height-1));const i=o(this._private__priceRangeSnapshot)._internal_clone();e=Math.max(e,.1),i._internal_scaleAroundCenter(e),this._internal_setPriceRange(i)}_internal_endScale(){this._internal_isPercentage()||this._internal_isIndexedTo100()||(this._private__scaleStartPoint=null,this._private__priceRangeSnapshot=null)}_internal_startScroll(t){this._internal_isAutoScale()||null===this._private__scrollStartPoint&&null===this._private__priceRangeSnapshot&&(this._internal_isEmpty()||(this._private__scrollStartPoint=t,this._private__priceRangeSnapshot=o(this._internal_priceRange())._internal_clone()))}_internal_scrollTo(t){if(this._internal_isAutoScale())return;if(null===this._private__scrollStartPoint)return;const e=o(this._internal_priceRange())._internal_length()/(this._internal_internalHeight()-1);let i=t-this._private__scrollStartPoint;this._internal_isInverted()&&(i*=-1);const _=i*e,r=o(this._private__priceRangeSnapshot)._internal_clone();r._internal_shift(_),this._internal_setPriceRange(r,!0),this._private__marksCache=null}_internal_endScroll(){this._internal_isAutoScale()||null!==this._private__scrollStartPoint&&(this._private__scrollStartPoint=null,this._private__priceRangeSnapshot=null)}_internal_formatter(){return this._private__formatter||this._internal_updateFormatter(),this._private__formatter}_internal_formatPrice(t,e){switch(this._private__options.mode){case 2:return this._private__formatPercentage(Jt(t,e));case 3:return this._internal_formatter().format(ee(t,e));default:return this._private__formatPrice(t)}}_internal_formatLogical(t){switch(this._private__options.mode){case 2:return this._private__formatPercentage(t);case 3:return this._internal_formatter().format(t);default:return this._private__formatPrice(t)}}_internal_formatPriceAbsolute(t){return this._private__formatPrice(t,o(this._private__formatterSource())._internal_formatter())}_internal_formatPricePercentage(t,e){return t=Jt(t,e),this._private__formatPercentage(t,pe)}_internal_sourcesForAutoScale(){return this._private__dataSources}_internal_recalculatePriceRange(t){this._private__invalidatedForRange={_internal_visibleBars:t,_internal_isValid:!1}}_internal_updateAllViews(){this._private__dataSources.forEach((t=>t._internal_updateAllViews()))}_internal_updateFormatter(){this._private__marksCache=null;const t=this._private__formatterSource();let e=100;null!==t&&(e=Math.round(1/t._internal_minMove())),this._private__formatter=ce,this._internal_isPercentage()?(this._private__formatter=pe,e=100):this._internal_isIndexedTo100()?(this._private__formatter=new B(100,1),e=100):null!==t&&(this._private__formatter=t._internal_formatter()),this._private__markBuilder=new oe(this,e,this._private__coordinateToLogical.bind(this),this._private__logicalToCoordinate.bind(this)),this._private__markBuilder._internal_rebuildTickMarks()}_internal_invalidateSourcesCache(){this._private__cachedOrderedSources=null}_private__formatterSource(){return this._private__dataSources[0]||null}_private__topMarginPx(){return this._internal_isInverted()?this._private__options.scaleMargins.bottom*this._internal_height()+this._private__marginBelow:this._private__options.scaleMargins.top*this._internal_height()+this._private__marginAbove}_private__bottomMarginPx(){return this._internal_isInverted()?this._private__options.scaleMargins.top*this._internal_height()+this._private__marginAbove:this._private__options.scaleMargins.bottom*this._internal_height()+this._private__marginBelow}_private__makeSureItIsValid(){this._private__invalidatedForRange._internal_isValid||(this._private__invalidatedForRange._internal_isValid=!0,this._private__recalculatePriceRangeImpl())}_private__invalidateInternalHeightCache(){this._private__internalHeightCache=null}_private__logicalToCoordinate(t,e){if(this._private__makeSureItIsValid(),this._internal_isEmpty())return 0;t=this._internal_isLog()&&t?_e(t,this._private__logFormula):t;const i=o(this._internal_priceRange()),_=this._private__bottomMarginPx()+(this._internal_internalHeight()-1)*(t-i._internal_minValue())/i._internal_length();return this._internal_invertedCoordinate(_)}_private__coordinateToLogical(t,e){if(this._private__makeSureItIsValid(),this._internal_isEmpty())return 0;const i=this._internal_invertedCoordinate(t),_=o(this._internal_priceRange()),r=_._internal_minValue()+_._internal_length()*((i-this._private__bottomMarginPx())/(this._internal_internalHeight()-1));return this._internal_isLog()?re(r,this._private__logFormula):r}_private__onIsInvertedChanged(){this._private__marksCache=null,this._private__markBuilder._internal_rebuildTickMarks()}_private__recalculatePriceRangeImpl(){const t=this._private__invalidatedForRange._internal_visibleBars;if(null===t)return;let e=null;const i=this._internal_sourcesForAutoScale();let _=0,r=0;for(const n of i){if(!n._internal_visible())continue;const i=n._internal_firstValue();if(null===i)continue;const a=n._internal_autoscaleInfo(t._internal_left(),t._internal_right());let l=a&&a._internal_priceRange();if(null!==l){switch(this._private__options.mode){case 1:l=ne(l,this._private__logFormula);break;case 2:l=te(l,i._internal_value);break;case 3:l=ie(l,i._internal_value)}if(e=null===e?l:e._internal_merge(o(l)),null!==a){const t=a._internal_margins();null!==t&&(_=Math.max(_,t.above),r=Math.max(_,t.below))}}}if(_===this._private__marginAbove&&r===this._private__marginBelow||(this._private__marginAbove=_,this._private__marginBelow=r,this._private__marksCache=null,this._private__invalidateInternalHeightCache()),null!==e){if(e._internal_minValue()===e._internal_maxValue()){const t=this._private__formatterSource(),i=5*(null===t||this._internal_isPercentage()||this._internal_isIndexedTo100()?1:t._internal_minMove());this._internal_isLog()&&(e=ae(e,this._private__logFormula)),e=new Rt(e._internal_minValue()-i,e._internal_maxValue()+i),this._internal_isLog()&&(e=ne(e,this._private__logFormula))}if(this._internal_isLog()){const t=ae(e,this._private__logFormula),i=le(t);if(n=i,a=this._private__logFormula,n._internal_logicalOffset!==a._internal_logicalOffset||n._internal_coordOffset!==a._internal_coordOffset){const _=null!==this._private__priceRangeSnapshot?ae(this._private__priceRangeSnapshot,this._private__logFormula):null;this._private__logFormula=i,e=ne(t,i),null!==_&&(this._private__priceRangeSnapshot=ne(_,i))}}this._internal_setPriceRange(e)}else null===this._private__priceRange&&(this._internal_setPriceRange(new Rt(-.5,.5)),this._private__logFormula=le(null));var n,a;this._private__invalidatedForRange._internal_isValid=!0}_private__getCoordinateTransformer(){return this._internal_isPercentage()?Jt:this._internal_isIndexedTo100()?ee:this._internal_isLog()?t=>_e(t,this._private__logFormula):null}_private__formatValue(t,e,i){return void 0===e?(void 0===i&&(i=this._internal_formatter()),i.format(t)):e(t)}_private__formatPrice(t,e){return this._private__formatValue(t,this._private__localizationOptions.priceFormatter,e)}_private__formatPercentage(t,e){return this._private__formatValue(t,this._private__localizationOptions.percentageFormatter,e)}}class de{constructor(t,e){this._private__dataSources=[],this._private__overlaySourcesByScaleId=new Map,this._private__height=0,this._private__width=0,this._private__stretchFactor=1e3,this._private__cachedOrderedSources=null,this._private__destroyed=new yt,this._private__timeScale=t,this._private__model=e,this._private__grid=new qt(this);const i=e._internal_options();this._private__leftPriceScale=this._private__createPriceScale("left",i.leftPriceScale),this._private__rightPriceScale=this._private__createPriceScale("right",i.rightPriceScale),this._private__leftPriceScale._internal_modeChanged()._internal_subscribe(this._private__onPriceScaleModeChanged.bind(this,this._private__leftPriceScale),this),this._private__rightPriceScale._internal_modeChanged()._internal_subscribe(this._private__onPriceScaleModeChanged.bind(this,this._private__rightPriceScale),this),this._internal_applyScaleOptions(i)}_internal_applyScaleOptions(t){if(t.leftPriceScale&&this._private__leftPriceScale._internal_applyOptions(t.leftPriceScale),t.rightPriceScale&&this._private__rightPriceScale._internal_applyOptions(t.rightPriceScale),t.localization&&(this._private__leftPriceScale._internal_updateFormatter(),this._private__rightPriceScale._internal_updateFormatter()),t.overlayPriceScales){const e=Array.from(this._private__overlaySourcesByScaleId.values());for(const i of e){const e=o(i[0]._internal_priceScale());e._internal_applyOptions(t.overlayPriceScales),t.localization&&e._internal_updateFormatter()}}}_internal_priceScaleById(t){switch(t){case"left":return this._private__leftPriceScale;case"right":return this._private__rightPriceScale}return this._private__overlaySourcesByScaleId.has(t)?s(this._private__overlaySourcesByScaleId.get(t))[0]._internal_priceScale():null}_internal_destroy(){this._internal_model()._internal_priceScalesOptionsChanged()._internal_unsubscribeAll(this),this._private__leftPriceScale._internal_modeChanged()._internal_unsubscribeAll(this),this._private__rightPriceScale._internal_modeChanged()._internal_unsubscribeAll(this),this._private__dataSources.forEach((t=>{t._internal_destroy&&t._internal_destroy()})),this._private__destroyed._internal_fire()}_internal_stretchFactor(){return this._private__stretchFactor}_internal_setStretchFactor(t){this._private__stretchFactor=t}_internal_model(){return this._private__model}_internal_width(){return this._private__width}_internal_height(){return this._private__height}_internal_setWidth(t){this._private__width=t,this._internal_updateAllSources()}_internal_setHeight(t){this._private__height=t,this._private__leftPriceScale._internal_setHeight(t),this._private__rightPriceScale._internal_setHeight(t),this._private__dataSources.forEach((e=>{if(this._internal_isOverlay(e)){const i=e._internal_priceScale();null!==i&&i._internal_setHeight(t)}})),this._internal_updateAllSources()}_internal_dataSources(){return this._private__dataSources}_internal_isOverlay(t){const e=t._internal_priceScale();return null===e||this._private__leftPriceScale!==e&&this._private__rightPriceScale!==e}_internal_addDataSource(t,e,i){const _=void 0!==i?i:this._private__getZOrderMinMax()._internal_maxZOrder+1;this._private__insertDataSource(t,e,_)}_internal_removeDataSource(t){const e=this._private__dataSources.indexOf(t);l(-1!==e,"removeDataSource: invalid data source"),this._private__dataSources.splice(e,1);const i=o(t._internal_priceScale())._internal_id();if(this._private__overlaySourcesByScaleId.has(i)){const e=s(this._private__overlaySourcesByScaleId.get(i)),_=e.indexOf(t);-1!==_&&(e.splice(_,1),0===e.length&&this._private__overlaySourcesByScaleId.delete(i))}const _=t._internal_priceScale();_&&_._internal_dataSources().indexOf(t)>=0&&_._internal_removeDataSource(t),null!==_&&(_._internal_invalidateSourcesCache(),this._internal_recalculatePriceScale(_)),this._private__cachedOrderedSources=null}_internal_priceScalePosition(t){return t===this._private__leftPriceScale?"left":t===this._private__rightPriceScale?"right":"overlay"}_internal_leftPriceScale(){return this._private__leftPriceScale}_internal_rightPriceScale(){return this._private__rightPriceScale}_internal_startScalePrice(t,e){t._internal_startScale(e)}_internal_scalePriceTo(t,e){t._internal_scaleTo(e),this._internal_updateAllSources()}_internal_endScalePrice(t){t._internal_endScale()}_internal_startScrollPrice(t,e){t._internal_startScroll(e)}_internal_scrollPriceTo(t,e){t._internal_scrollTo(e),this._internal_updateAllSources()}_internal_endScrollPrice(t){t._internal_endScroll()}_internal_updateAllSources(){this._private__dataSources.forEach((t=>{t._internal_updateAllViews()}))}_internal_defaultPriceScale(){let t=null;return this._private__model._internal_options().rightPriceScale.visible&&0!==this._private__rightPriceScale._internal_dataSources().length?t=this._private__rightPriceScale:this._private__model._internal_options().leftPriceScale.visible&&0!==this._private__leftPriceScale._internal_dataSources().length?t=this._private__leftPriceScale:0!==this._private__dataSources.length&&(t=this._private__dataSources[0]._internal_priceScale()),null===t&&(t=this._private__rightPriceScale),t}_internal_defaultVisiblePriceScale(){let t=null;return this._private__model._internal_options().rightPriceScale.visible?t=this._private__rightPriceScale:this._private__model._internal_options().leftPriceScale.visible&&(t=this._private__leftPriceScale),t}_internal_recalculatePriceScale(t){null!==t&&t._internal_isAutoScale()&&this._private__recalculatePriceScaleImpl(t)}_internal_resetPriceScale(t){const e=this._private__timeScale._internal_visibleStrictRange();t._internal_setMode({_internal_autoScale:!0}),null!==e&&t._internal_recalculatePriceRange(e),this._internal_updateAllSources()}_internal_momentaryAutoScale(){this._private__recalculatePriceScaleImpl(this._private__leftPriceScale),this._private__recalculatePriceScaleImpl(this._private__rightPriceScale)}_internal_recalculate(){this._internal_recalculatePriceScale(this._private__leftPriceScale),this._internal_recalculatePriceScale(this._private__rightPriceScale),this._private__dataSources.forEach((t=>{this._internal_isOverlay(t)&&this._internal_recalculatePriceScale(t._internal_priceScale())})),this._internal_updateAllSources(),this._private__model._internal_lightUpdate()}_internal_orderedSources(){return null===this._private__cachedOrderedSources&&(this._private__cachedOrderedSources=he(this._private__dataSources)),this._private__cachedOrderedSources}_internal_onDestroyed(){return this._private__destroyed}_internal_grid(){return this._private__grid}_private__recalculatePriceScaleImpl(t){const e=t._internal_sourcesForAutoScale();if(e&&e.length>0&&!this._private__timeScale._internal_isEmpty()){const e=this._private__timeScale._internal_visibleStrictRange();null!==e&&t._internal_recalculatePriceRange(e)}t._internal_updateAllViews()}_private__getZOrderMinMax(){const t=this._internal_orderedSources();if(0===t.length)return{_internal_minZOrder:0,_internal_maxZOrder:0};let e=0,i=0;for(let _=0;_<t.length;_++){const r=t[_]._internal_zorder();null!==r&&(r<e&&(e=r),r>i&&(i=r))}return{_internal_minZOrder:e,_internal_maxZOrder:i}}_private__insertDataSource(t,e,i){let _=this._internal_priceScaleById(e);if(null===_&&(_=this._private__createPriceScale(e,this._private__model._internal_options().overlayPriceScales)),this._private__dataSources.push(t),!Et(e)){const i=this._private__overlaySourcesByScaleId.get(e)||[];i.push(t),this._private__overlaySourcesByScaleId.set(e,i)}_._internal_addDataSource(t),t._internal_setPriceScale(_),t._internal_setZorder(i),this._internal_recalculatePriceScale(_),this._private__cachedOrderedSources=null}_private__onPriceScaleModeChanged(t,e,i){e._internal_mode!==i._internal_mode&&this._private__recalculatePriceScaleImpl(t)}_private__createPriceScale(t,e){const i=Object.assign({visible:!0,autoScale:!0},r(e)),_=new ve(t,i,this._private__model._internal_options().layout,this._private__model._internal_options().localization);return _._internal_setHeight(this._internal_height()),_}}class ue{constructor(t,e,i=50){this._private__actualSize=0,this._private__usageTick=1,this._private__oldestTick=1,this._private__cache=new Map,this._private__tick2Labels=new Map,this._private__format=t,this._private__horzScaleBehavior=e,this._private__maxSize=i}_internal_format(t){const e=t.time,i=this._private__horzScaleBehavior.cacheKey(e),_=this._private__cache.get(i);if(void 0!==_)return _._internal_string;if(this._private__actualSize===this._private__maxSize){const t=this._private__tick2Labels.get(this._private__oldestTick);this._private__tick2Labels.delete(this._private__oldestTick),this._private__cache.delete(s(t)),this._private__oldestTick++,this._private__actualSize--}const r=this._private__format(t);return this._private__cache.set(i,{_internal_string:r,_internal_tick:this._private__usageTick}),this._private__tick2Labels.set(this._private__usageTick,i),this._private__actualSize++,this._private__usageTick++,r}}class me{constructor(t,e){l(t<=e,"right should be >= left"),this._private__left=t,this._private__right=e}_internal_left(){return this._private__left}_internal_right(){return this._private__right}_internal_count(){return this._private__right-this._private__left+1}_internal_contains(t){return this._private__left<=t&&t<=this._private__right}_internal_equals(t){return this._private__left===t._internal_left()&&this._private__right===t._internal_right()}}function ge(t,e){return null===t||null===e?t===e:t._internal_equals(e)}class fe{constructor(){this._private__marksByWeight=new Map,this._private__cache=null,this._private__uniformDistribution=!1}_internal_setUniformDistribution(t){this._private__uniformDistribution=t,this._private__cache=null}_internal_setTimeScalePoints(t,e){this._private__removeMarksSinceIndex(e),this._private__cache=null;for(let i=e;i<t.length;++i){const e=t[i];let _=this._private__marksByWeight.get(e.timeWeight);void 0===_&&(_=[],this._private__marksByWeight.set(e.timeWeight,_)),_.push({index:i,time:e.time,weight:e.timeWeight,originalTime:e.originalTime})}}_internal_build(t,e){const i=Math.ceil(e/t);return null!==this._private__cache&&this._private__cache._internal_maxIndexesPerMark===i||(this._private__cache={_internal_marks:this._private__buildMarksImpl(i),_internal_maxIndexesPerMark:i}),this._private__cache._internal_marks}_private__removeMarksSinceIndex(t){if(0===t)return void this._private__marksByWeight.clear();const e=[];this._private__marksByWeight.forEach(((i,_)=>{t<=i[0].index?e.push(_):i.splice(tt(i,t,(e=>e.index<t)),1/0)}));for(const t of e)this._private__marksByWeight.delete(t)}_private__buildMarksImpl(t){let e=[];for(const i of Array.from(this._private__marksByWeight.keys()).sort(((t,e)=>e-t))){if(!this._private__marksByWeight.get(i))continue;const _=e;e=[];const r=_.length;let n=0;const a=s(this._private__marksByWeight.get(i)),l=a.length;let o=1/0,h=-1/0;for(let i=0;i<l;i++){const l=a[i],s=l.index;for(;n<r;){const t=_[n],i=t.index;if(!(i<s)){o=i;break}n++,e.push(t),h=i,o=1/0}if(o-s>=t&&s-h>=t)e.push(l),h=s;else if(this._private__uniformDistribution)return _}for(;n<r;n++)e.push(_[n])}return e}}class Se{constructor(t){this._private__logicalRange=t}_internal_strictRange(){return null===this._private__logicalRange?null:new me(Math.floor(this._private__logicalRange._internal_left()),Math.ceil(this._private__logicalRange._internal_right()))}_internal_logicalRange(){return this._private__logicalRange}static _internal_invalid(){return new Se(null)}}function be(t,e){return t.weight>e.weight?t:e}class we{constructor(t,e,i,_){this._private__width=0,this._private__baseIndexOrNull=null,this._private__points=[],this._private__scrollStartPoint=null,this._private__scaleStartPoint=null,this._private__tickMarks=new fe,this._private__formattedByWeight=new Map,this._private__visibleRange=Se._internal_invalid(),this._private__visibleRangeInvalidated=!0,this._private__visibleBarsChanged=new yt,this._private__logicalRangeChanged=new yt,this._private__optionsApplied=new yt,this._private__commonTransitionStartState=null,this._private__timeMarksCache=null,this._private__labels=[],this._private__options=e,this._private__localizationOptions=i,this._private__rightOffset=e.rightOffset,this._private__barSpacing=e.barSpacing,this._private__model=t,this._private__horzScaleBehavior=_,this._private__updateDateTimeFormatter(),this._private__tickMarks._internal_setUniformDistribution(e.uniformDistribution)}_internal_options(){return this._private__options}_internal_applyLocalizationOptions(t){p(this._private__localizationOptions,t),this._private__invalidateTickMarks(),this._private__updateDateTimeFormatter()}_internal_applyOptions(t,e){var i;p(this._private__options,t),this._private__options.fixLeftEdge&&this._private__doFixLeftEdge(),this._private__options.fixRightEdge&&this._private__doFixRightEdge(),void 0!==t.barSpacing&&this._private__model._internal_setBarSpacing(t.barSpacing),void 0!==t.rightOffset&&this._private__model._internal_setRightOffset(t.rightOffset),void 0!==t.minBarSpacing&&this._private__model._internal_setBarSpacing(null!==(i=t.barSpacing)&&void 0!==i?i:this._private__barSpacing),this._private__invalidateTickMarks(),this._private__updateDateTimeFormatter(),this._private__optionsApplied._internal_fire()}_internal_indexToTime(t){var e,i;return null!==(i=null===(e=this._private__points[t])||void 0===e?void 0:e.time)&&void 0!==i?i:null}_internal_indexToTimeScalePoint(t){var e;return null!==(e=this._private__points[t])&&void 0!==e?e:null}_internal_timeToIndex(t,e){if(this._private__points.length<1)return null;if(this._private__horzScaleBehavior.key(t)>this._private__horzScaleBehavior.key(this._private__points[this._private__points.length-1].time))return e?this._private__points.length-1:null;const i=tt(this._private__points,this._private__horzScaleBehavior.key(t),((t,e)=>this._private__horzScaleBehavior.key(t.time)<e));return this._private__horzScaleBehavior.key(t)<this._private__horzScaleBehavior.key(this._private__points[i].time)?e?i:null:i}_internal_isEmpty(){return 0===this._private__width||0===this._private__points.length||null===this._private__baseIndexOrNull}_internal_visibleStrictRange(){return this._private__updateVisibleRange(),this._private__visibleRange._internal_strictRange()}_internal_visibleLogicalRange(){return this._private__updateVisibleRange(),this._private__visibleRange._internal_logicalRange()}_internal_logicalRangeForTimeRange(t){return{from:o(this._internal_timeToIndex(t.from,!0)),to:o(this._internal_timeToIndex(t.to,!0))}}_internal_width(){return this._private__width}_internal_setWidth(t){if(!isFinite(t)||t<=0)return;if(this._private__width===t)return;const e=this._internal_visibleLogicalRange(),i=this._private__width;if(this._private__width=t,this._private__visibleRangeInvalidated=!0,this._private__options.lockVisibleTimeRangeOnResize&&0!==i&&(this._private__barSpacing=this._private__barSpacing*t/i),this._private__options.fixLeftEdge&&null!==e&&e._internal_left()<=0){const e=i-t;this._private__rightOffset-=Math.round(e/this._private__barSpacing)+1,this._private__visibleRangeInvalidated=!0}this._private__correctBarSpacing(),this._private__correctOffset()}_internal_indexToCoordinate(t){if(this._internal_isEmpty()||!e(t))return 0;const i=this._internal_baseIndex()+this._private__rightOffset-t;return this._private__width-(i+.5)*this._private__barSpacing-1}_internal_indexesToCoordinates(t,e){const i=this._internal_baseIndex(),_=void 0===e?0:e.from,r=void 0===e?t.length:e.to;for(let e=_;e<r;e++){const _=t[e]._internal_time,r=i+this._private__rightOffset-_;t[e]._internal_x=this._private__width-(r+.5)*this._private__barSpacing-1}}_internal_coordinateToIndex(t){return Math.ceil(this._private__coordinateToFloatIndex(t))}_internal_setRightOffset(t){this._private__visibleRangeInvalidated=!0,this._private__rightOffset=t,this._private__correctOffset(),this._private__model._internal_recalculateAllPanes(),this._private__model._internal_lightUpdate()}_internal_barSpacing(){return this._private__barSpacing}_internal_setBarSpacing(t){this._private__setBarSpacing(t),this._private__correctOffset(),this._private__model._internal_recalculateAllPanes(),this._private__model._internal_lightUpdate()}_internal_rightOffset(){return this._private__rightOffset}_internal_marks(){if(this._internal_isEmpty())return null;if(null!==this._private__timeMarksCache)return this._private__timeMarksCache;const t=this._private__barSpacing,e=5*(this._private__model._internal_options().layout.fontSize+4)/8*(this._private__options.tickMarkMaxCharacterLength||8),i=Math.round(e/t),_=o(this._internal_visibleStrictRange()),r=Math.max(_._internal_left(),_._internal_left()-i),n=Math.max(_._internal_right(),_._internal_right()-i),a=this._private__tickMarks._internal_build(t,e),l=this._private__firstIndex()+i,s=this._private__lastIndex()-i,h=this._private__isAllScalingAndScrollingDisabled(),p=this._private__options.fixLeftEdge||h,c=this._private__options.fixRightEdge||h;let v=0;for(const t of a){if(!(r<=t.index&&t.index<=n))continue;let i;v<this._private__labels.length?(i=this._private__labels[v],i.coord=this._internal_indexToCoordinate(t.index),i.label=this._private__formatLabel(t),i.weight=t.weight):(i={needAlignCoordinate:!1,coord:this._internal_indexToCoordinate(t.index),label:this._private__formatLabel(t),weight:t.weight},this._private__labels.push(i)),this._private__barSpacing>e/2&&!h?i.needAlignCoordinate=!1:i.needAlignCoordinate=p&&t.index<=l||c&&t.index>=s,v++}return this._private__labels.length=v,this._private__timeMarksCache=this._private__labels,this._private__labels}_internal_restoreDefault(){this._private__visibleRangeInvalidated=!0,this._internal_setBarSpacing(this._private__options.barSpacing),this._internal_setRightOffset(this._private__options.rightOffset)}_internal_setBaseIndex(t){this._private__visibleRangeInvalidated=!0,this._private__baseIndexOrNull=t,this._private__correctOffset(),this._private__doFixLeftEdge()}_internal_zoom(t,e){const i=this._private__coordinateToFloatIndex(t),_=this._internal_barSpacing(),r=_+e*(_/10);this._internal_setBarSpacing(r),this._private__options.rightBarStaysOnScroll||this._internal_setRightOffset(this._internal_rightOffset()+(i-this._private__coordinateToFloatIndex(t)))}_internal_startScale(t){this._private__scrollStartPoint&&this._internal_endScroll(),null===this._private__scaleStartPoint&&null===this._private__commonTransitionStartState&&(this._internal_isEmpty()||(this._private__scaleStartPoint=t,this._private__saveCommonTransitionsStartState()))}_internal_scaleTo(t){if(null===this._private__commonTransitionStartState)return;const e=c(this._private__width-t,0,this._private__width),i=c(this._private__width-o(this._private__scaleStartPoint),0,this._private__width);0!==e&&0!==i&&this._internal_setBarSpacing(this._private__commonTransitionStartState._internal_barSpacing*e/i)}_internal_endScale(){null!==this._private__scaleStartPoint&&(this._private__scaleStartPoint=null,this._private__clearCommonTransitionsStartState())}_internal_startScroll(t){null===this._private__scrollStartPoint&&null===this._private__commonTransitionStartState&&(this._internal_isEmpty()||(this._private__scrollStartPoint=t,this._private__saveCommonTransitionsStartState()))}_internal_scrollTo(t){if(null===this._private__scrollStartPoint)return;const e=(this._private__scrollStartPoint-t)/this._internal_barSpacing();this._private__rightOffset=o(this._private__commonTransitionStartState)._internal_rightOffset+e,this._private__visibleRangeInvalidated=!0,this._private__correctOffset()}_internal_endScroll(){null!==this._private__scrollStartPoint&&(this._private__scrollStartPoint=null,this._private__clearCommonTransitionsStartState())}_internal_scrollToRealTime(){this._internal_scrollToOffsetAnimated(this._private__options.rightOffset)}_internal_scrollToOffsetAnimated(t,e=400){if(!isFinite(t))throw new RangeError("offset is required and must be finite number");if(!isFinite(e)||e<=0)throw new RangeError("animationDuration (optional) must be finite positive number");const i=this._private__rightOffset,_=performance.now();this._private__model._internal_setTimeScaleAnimation({_internal_finished:t=>(t-_)/e>=1,_internal_getPosition:r=>{const n=(r-_)/e;return n>=1?t:i+(t-i)*n}})}_internal_update(t,e){this._private__visibleRangeInvalidated=!0,this._private__points=t,this._private__tickMarks._internal_setTimeScalePoints(t,e),this._private__correctOffset()}_internal_optionsApplied(){return this._private__optionsApplied}_internal_baseIndex(){return this._private__baseIndexOrNull||0}_internal_setVisibleRange(t){const e=t._internal_count();this._private__setBarSpacing(this._private__width/e),this._private__rightOffset=t._internal_right()-this._internal_baseIndex(),this._private__correctOffset(),this._private__visibleRangeInvalidated=!0,this._private__model._internal_recalculateAllPanes(),this._private__model._internal_lightUpdate()}_internal_fitContent(){const t=this._private__firstIndex(),e=this._private__lastIndex();null!==t&&null!==e&&this._internal_setVisibleRange(new me(t,e+this._private__options.rightOffset))}_internal_setLogicalRange(t){const e=new me(t.from,t.to);this._internal_setVisibleRange(e)}_internal_formatDateTime(t){return void 0!==this._private__localizationOptions.timeFormatter?this._private__localizationOptions.timeFormatter(t.originalTime):this._private__horzScaleBehavior.formatHorzItem(t.time)}_private__isAllScalingAndScrollingDisabled(){const{handleScroll:t,handleScale:e}=this._private__model._internal_options();return!(t.horzTouchDrag||t.mouseWheel||t.pressedMouseMove||t.vertTouchDrag||e.axisDoubleClickReset.time||e.axisPressedMouseMove.time||e.mouseWheel||e.pinch)}_private__firstIndex(){return 0===this._private__points.length?null:0}_private__lastIndex(){return 0===this._private__points.length?null:this._private__points.length-1}_private__rightOffsetForCoordinate(t){return(this._private__width-1-t)/this._private__barSpacing}_private__coordinateToFloatIndex(t){const e=this._private__rightOffsetForCoordinate(t),i=this._internal_baseIndex()+this._private__rightOffset-e;return Math.round(1e6*i)/1e6}_private__setBarSpacing(t){const e=this._private__barSpacing;this._private__barSpacing=t,this._private__correctBarSpacing(),e!==this._private__barSpacing&&(this._private__visibleRangeInvalidated=!0,this._private__resetTimeMarksCache())}_private__updateVisibleRange(){if(!this._private__visibleRangeInvalidated)return;if(this._private__visibleRangeInvalidated=!1,this._internal_isEmpty())return void this._private__setVisibleRange(Se._internal_invalid());const t=this._internal_baseIndex(),e=this._private__width/this._private__barSpacing,i=this._private__rightOffset+t,_=new me(i-e+1,i);this._private__setVisibleRange(new Se(_))}_private__correctBarSpacing(){const t=this._private__minBarSpacing();if(this._private__barSpacing<t&&(this._private__barSpacing=t,this._private__visibleRangeInvalidated=!0),0!==this._private__width){const t=.5*this._private__width;this._private__barSpacing>t&&(this._private__barSpacing=t,this._private__visibleRangeInvalidated=!0)}}_private__minBarSpacing(){return this._private__options.fixLeftEdge&&this._private__options.fixRightEdge&&0!==this._private__points.length?this._private__width/this._private__points.length:this._private__options.minBarSpacing}_private__correctOffset(){const t=this._private__maxRightOffset();this._private__rightOffset>t&&(this._private__rightOffset=t,this._private__visibleRangeInvalidated=!0);const e=this._private__minRightOffset();null!==e&&this._private__rightOffset<e&&(this._private__rightOffset=e,this._private__visibleRangeInvalidated=!0)}_private__minRightOffset(){const t=this._private__firstIndex(),e=this._private__baseIndexOrNull;return null===t||null===e?null:t-e-1+(this._private__options.fixLeftEdge?this._private__width/this._private__barSpacing:Math.min(2,this._private__points.length))}_private__maxRightOffset(){return this._private__options.fixRightEdge?0:this._private__width/this._private__barSpacing-Math.min(2,this._private__points.length)}_private__saveCommonTransitionsStartState(){this._private__commonTransitionStartState={_internal_barSpacing:this._internal_barSpacing(),_internal_rightOffset:this._internal_rightOffset()}}_private__clearCommonTransitionsStartState(){this._private__commonTransitionStartState=null}_private__formatLabel(t){let e=this._private__formattedByWeight.get(t.weight);return void 0===e&&(e=new ue((t=>this._private__formatLabelImpl(t)),this._private__horzScaleBehavior),this._private__formattedByWeight.set(t.weight,e)),e._internal_format(t)}_private__formatLabelImpl(t){return this._private__horzScaleBehavior.formatTickmark(t,this._private__localizationOptions)}_private__setVisibleRange(t){const e=this._private__visibleRange;this._private__visibleRange=t,ge(e._internal_strictRange(),this._private__visibleRange._internal_strictRange())||this._private__visibleBarsChanged._internal_fire(),ge(e._internal_logicalRange(),this._private__visibleRange._internal_logicalRange())||this._private__logicalRangeChanged._internal_fire(),this._private__resetTimeMarksCache()}_private__resetTimeMarksCache(){this._private__timeMarksCache=null}_private__invalidateTickMarks(){this._private__resetTimeMarksCache(),this._private__formattedByWeight.clear()}_private__updateDateTimeFormatter(){this._private__horzScaleBehavior.updateFormatter(this._private__localizationOptions)}_private__doFixLeftEdge(){if(!this._private__options.fixLeftEdge)return;const t=this._private__firstIndex();if(null===t)return;const e=this._internal_visibleStrictRange();if(null===e)return;const i=e._internal_left()-t;if(i<0){const t=this._private__rightOffset-i-1;this._internal_setRightOffset(t)}this._private__correctBarSpacing()}_private__doFixRightEdge(){this._private__correctOffset(),this._private__correctBarSpacing()}}class Ce{_internal_draw(t,e,i){t.useMediaCoordinateSpace((t=>this._internal__drawImpl(t,e,i)))}_internal_drawBackground(t,e,i){t.useMediaCoordinateSpace((t=>this._internal__drawBackgroundImpl(t,e,i)))}_internal__drawBackgroundImpl(t,e,i){}}class xe extends Ce{constructor(t){super(),this._private__metricsCache=new Map,this._private__data=t}_internal__drawImpl(t){}_internal__drawBackgroundImpl(t){if(!this._private__data._internal_visible)return;const{context:e,mediaSize:i}=t;let _=0;for(const t of this._private__data._internal_lines){if(0===t._internal_text.length)continue;e.font=t._internal_font;const r=this._private__metrics(e,t._internal_text);r>i.width?t._internal_zoom=i.width/r:t._internal_zoom=1,_+=t._internal_lineHeight*t._internal_zoom}let r=0;switch(this._private__data._internal_vertAlign){case"top":r=0;break;case"center":r=Math.max((i.height-_)/2,0);break;case"bottom":r=Math.max(i.height-_,0)}e.fillStyle=this._private__data._internal_color;for(const t of this._private__data._internal_lines){e.save();let _=0;switch(this._private__data._internal_horzAlign){case"left":e.textAlign="left",_=t._internal_lineHeight/2;break;case"center":e.textAlign="center",_=i.width/2;break;case"right":e.textAlign="right",_=i.width-1-t._internal_lineHeight/2}e.translate(_,r),e.textBaseline="top",e.font=t._internal_font,e.scale(t._internal_zoom,t._internal_zoom),e.fillText(t._internal_text,0,t._internal_vertOffset),e.restore(),r+=t._internal_lineHeight*t._internal_zoom}}_private__metrics(t,e){const i=this._private__fontCache(t.font);let _=i.get(e);return void 0===_&&(_=t.measureText(e).width,i.set(e,_)),_}_private__fontCache(t){let e=this._private__metricsCache.get(t);return void 0===e&&(e=new Map,this._private__metricsCache.set(t,e)),e}}class Te{constructor(t){this._private__invalidated=!0,this._private__rendererData={_internal_visible:!1,_internal_color:"",_internal_lines:[],_internal_vertAlign:"center",_internal_horzAlign:"center"},this._private__renderer=new xe(this._private__rendererData),this._private__source=t}_internal_update(){this._private__invalidated=!0}_internal_renderer(){return this._private__invalidated&&(this._private__updateImpl(),this._private__invalidated=!1),this._private__renderer}_private__updateImpl(){const t=this._private__source._internal_options(),e=this._private__rendererData;e._internal_visible=t.visible,e._internal_visible&&(e._internal_color=t.color,e._internal_horzAlign=t.horzAlign,e._internal_vertAlign=t.vertAlign,e._internal_lines=[{_internal_text:t.text,_internal_font:kt(t.fontSize,t.fontFamily,t.fontStyle),_internal_lineHeight:1.2*t.fontSize,_internal_vertOffset:0,_internal_zoom:0}])}}class Pe extends K{constructor(t,e){super(),this._private__options=e,this._private__paneView=new Te(this)}_internal_priceAxisViews(){return[]}_internal_paneViews(){return[this._private__paneView]}_internal_options(){return this._private__options}_internal_updateAllViews(){this._private__paneView._internal_update()}}class ye{constructor(t){this._private__rendererOptions={_internal_borderSize:1,_internal_tickLength:5,_internal_fontSize:NaN,_internal_font:"",_internal_fontFamily:"",_internal_color:"",_internal_paneBackgroundColor:"",_internal_paddingBottom:0,_internal_paddingInner:0,_internal_paddingOuter:0,_internal_paddingTop:0,_internal_baselineOffset:0},this._private__chartModel=t}_internal_options(){const t=this._private__rendererOptions,e=this._private__fontSize(),i=this._private__fontFamily();return t._internal_fontSize===e&&t._internal_fontFamily===i||(t._internal_fontSize=e,t._internal_fontFamily=i,t._internal_font=kt(e,i),t._internal_paddingTop=2.5/12*e,t._internal_paddingBottom=t._internal_paddingTop,t._internal_paddingInner=e/12*t._internal_tickLength,t._internal_paddingOuter=e/12*t._internal_tickLength,t._internal_baselineOffset=0),t._internal_color=this._private__textColor(),t._internal_paneBackgroundColor=this._private__paneBackgroundColor(),this._private__rendererOptions}_private__textColor(){return this._private__chartModel._internal_options().layout.textColor}_private__paneBackgroundColor(){return this._private__chartModel._internal_backgroundTopColor()}_private__fontSize(){return this._private__chartModel._internal_options().layout.fontSize}_private__fontFamily(){return this._private__chartModel._internal_options().layout.fontFamily}}class Me{constructor(t,e,i){this._private__panes=[],this._private__serieses=[],this._private__width=0,this._private__hoveredSource=null,this._private__priceScalesOptionsChanged=new yt,this._private__crosshairMoved=new yt,this._private__gradientColorsCache=null,this._private__invalidateHandler=t,this._private__options=e,this._private__horzScaleBehavior=i,this._private__rendererOptionsProvider=new ye(this),this._private__timeScale=new we(this,e.timeScale,this._private__options.localization,i),this._private__crosshair=new Z(this,e.crosshair),this._private__watermark=new Pe(this,e.watermark),this._internal_createPane(),this._private__panes[0]._internal_setStretchFactor(2e3),this._private__backgroundTopColor=this._private__getBackgroundColor(0),this._private__backgroundBottomColor=this._private__getBackgroundColor(1)}_internal_fullUpdate(){this._private__invalidate(zt._internal_full())}_internal_lightUpdate(){this._private__invalidate(zt._internal_light())}_internal_cursorUpdate(){this._private__invalidate(new zt(1))}_internal_updateSource(t){const e=this._private__invalidationMaskForSource(t);this._private__invalidate(e)}_internal_hoveredSource(){return this._private__hoveredSource}_internal_setHoveredSource(t){const e=this._private__hoveredSource;this._private__hoveredSource=t,null!==e&&this._internal_updateSource(e._internal_source),null!==t&&this._internal_updateSource(t._internal_source)}_internal_options(){return this._private__options}_internal_applyOptions(t){p(this._private__options,t),this._private__panes.forEach((e=>e._internal_applyScaleOptions(t))),void 0!==t.timeScale&&this._private__timeScale._internal_applyOptions(t.timeScale),void 0!==t.localization&&this._private__timeScale._internal_applyLocalizationOptions(t.localization),(t.leftPriceScale||t.rightPriceScale)&&this._private__priceScalesOptionsChanged._internal_fire(),this._private__backgroundTopColor=this._private__getBackgroundColor(0),this._private__backgroundBottomColor=this._private__getBackgroundColor(1),this._internal_fullUpdate()}_internal_applyPriceScaleOptions(t,e){if("left"===t)return void this._internal_applyOptions({leftPriceScale:e});if("right"===t)return void this._internal_applyOptions({rightPriceScale:e});const i=this._internal_findPriceScale(t);if(null===i)throw new Error(`Trying to apply price scale options with incorrect ID: ${t}`);i._internal_priceScale._internal_applyOptions(e),this._private__priceScalesOptionsChanged._internal_fire()}_internal_findPriceScale(t){for(const e of this._private__panes){const i=e._internal_priceScaleById(t);if(null!==i)return{_internal_pane:e,_internal_priceScale:i}}return null}_internal_timeScale(){return this._private__timeScale}_internal_panes(){return this._private__panes}_internal_watermarkSource(){return this._private__watermark}_internal_crosshairSource(){return this._private__crosshair}_internal_crosshairMoved(){return this._private__crosshairMoved}_internal_setPaneHeight(t,e){t._internal_setHeight(e),this._internal_recalculateAllPanes()}_internal_setWidth(t){this._private__width=t,this._private__timeScale._internal_setWidth(this._private__width),this._private__panes.forEach((e=>e._internal_setWidth(t))),this._internal_recalculateAllPanes()}_internal_createPane(t){const e=new de(this._private__timeScale,this);void 0!==t?this._private__panes.splice(t,0,e):this._private__panes.push(e);const i=void 0===t?this._private__panes.length-1:t,_=zt._internal_full();return _._internal_invalidatePane(i,{_internal_level:0,_internal_autoScale:!0}),this._private__invalidate(_),e}_internal_startScalePrice(t,e,i){t._internal_startScalePrice(e,i)}_internal_scalePriceTo(t,e,i){t._internal_scalePriceTo(e,i),this._internal_updateCrosshair(),this._private__invalidate(this._private__paneInvalidationMask(t,2))}_internal_endScalePrice(t,e){t._internal_endScalePrice(e),this._private__invalidate(this._private__paneInvalidationMask(t,2))}_internal_startScrollPrice(t,e,i){e._internal_isAutoScale()||t._internal_startScrollPrice(e,i)}_internal_scrollPriceTo(t,e,i){e._internal_isAutoScale()||(t._internal_scrollPriceTo(e,i),this._internal_updateCrosshair(),this._private__invalidate(this._private__paneInvalidationMask(t,2)))}_internal_endScrollPrice(t,e){e._internal_isAutoScale()||(t._internal_endScrollPrice(e),this._private__invalidate(this._private__paneInvalidationMask(t,2)))}_internal_resetPriceScale(t,e){t._internal_resetPriceScale(e),this._private__invalidate(this._private__paneInvalidationMask(t,2))}_internal_startScaleTime(t){this._private__timeScale._internal_startScale(t)}_internal_zoomTime(t,e){const i=this._internal_timeScale();if(i._internal_isEmpty()||0===e)return;const _=i._internal_width();t=Math.max(1,Math.min(t,_)),i._internal_zoom(t,e),this._internal_recalculateAllPanes()}_internal_scrollChart(t){this._internal_startScrollTime(0),this._internal_scrollTimeTo(t),this._internal_endScrollTime()}_internal_scaleTimeTo(t){this._private__timeScale._internal_scaleTo(t),this._internal_recalculateAllPanes()}_internal_endScaleTime(){this._private__timeScale._internal_endScale(),this._internal_lightUpdate()}_internal_startScrollTime(t){this._private__timeScale._internal_startScroll(t)}_internal_scrollTimeTo(t){this._private__timeScale._internal_scrollTo(t),this._internal_recalculateAllPanes()}_internal_endScrollTime(){this._private__timeScale._internal_endScroll(),this._internal_lightUpdate()}_internal_serieses(){return this._private__serieses}_internal_setAndSaveCurrentPosition(t,e,i,_,r){this._private__crosshair._internal_saveOriginCoord(t,e);let n=NaN,a=this._private__timeScale._internal_coordinateToIndex(t);const l=this._private__timeScale._internal_visibleStrictRange();null!==l&&(a=Math.min(Math.max(l._internal_left(),a),l._internal_right()));const s=_._internal_defaultPriceScale(),o=s._internal_firstValue();null!==o&&(n=s._internal_coordinateToPrice(e,o)),this._private__crosshair._internal_setPosition(a,n,_),this._internal_cursorUpdate(),r||this._private__crosshairMoved._internal_fire(this._private__crosshair._internal_appliedIndex(),{x:t,y:e},i)}_internal_clearCurrentPosition(t){this._internal_crosshairSource()._internal_clearPosition(),this._internal_cursorUpdate(),t||this._private__crosshairMoved._internal_fire(null,null,null)}_internal_updateCrosshair(){const t=this._private__crosshair._internal_pane();if(null!==t){const e=this._private__crosshair._internal_originCoordX(),i=this._private__crosshair._internal_originCoordY();this._internal_setAndSaveCurrentPosition(e,i,null,t)}this._private__crosshair._internal_updateAllViews()}_internal_updateTimeScale(t,e,i){const _=this._private__timeScale._internal_indexToTime(0);void 0!==e&&void 0!==i&&this._private__timeScale._internal_update(e,i);const r=this._private__timeScale._internal_indexToTime(0),n=this._private__timeScale._internal_baseIndex(),a=this._private__timeScale._internal_visibleStrictRange();if(null!==a&&null!==_&&null!==r){const e=a._internal_contains(n),l=this._private__horzScaleBehavior.key(_)>this._private__horzScaleBehavior.key(r),s=null!==t&&t>n&&!l,o=this._private__timeScale._internal_options().allowShiftVisibleRangeOnWhitespaceReplacement,h=e&&(!(void 0===i)||o)&&this._private__timeScale._internal_options().shiftVisibleRangeOnNewBar;if(s&&!h){const e=t-n;this._private__timeScale._internal_setRightOffset(this._private__timeScale._internal_rightOffset()-e)}}this._private__timeScale._internal_setBaseIndex(t)}_internal_recalculatePane(t){null!==t&&t._internal_recalculate()}_internal_paneForSource(t){const e=this._private__panes.find((e=>e._internal_orderedSources().includes(t)));return void 0===e?null:e}_internal_recalculateAllPanes(){this._private__watermark._internal_updateAllViews(),this._private__panes.forEach((t=>t._internal_recalculate())),this._internal_updateCrosshair()}_internal_destroy(){this._private__panes.forEach((t=>t._internal_destroy())),this._private__panes.length=0,this._private__options.localization.priceFormatter=void 0,this._private__options.localization.percentageFormatter=void 0,this._private__options.localization.timeFormatter=void 0}_internal_rendererOptionsProvider(){return this._private__rendererOptionsProvider}_internal_priceAxisRendererOptions(){return this._private__rendererOptionsProvider._internal_options()}_internal_priceScalesOptionsChanged(){return this._private__priceScalesOptionsChanged}_internal_createSeries(t,e){const i=this._private__panes[0],_=this._private__createSeries(e,t,i);return this._private__serieses.push(_),1===this._private__serieses.length?this._internal_fullUpdate():this._internal_lightUpdate(),_}_internal_moveSeriesToScale(t,e){const i=o(this._internal_paneForSource(t));i._internal_removeDataSource(t);const _=this._internal_findPriceScale(e);if(null===_){const _=t._internal_zorder();i._internal_addDataSource(t,e,_)}else{const r=_._internal_pane===i?t._internal_zorder():void 0;_._internal_pane._internal_addDataSource(t,e,r)}}_internal_fitContent(){const t=zt._internal_light();t._internal_setFitContent(),this._private__invalidate(t)}_internal_setTargetLogicalRange(t){const e=zt._internal_light();e._internal_applyRange(t),this._private__invalidate(e)}_internal_resetTimeScale(){const t=zt._internal_light();t._internal_resetTimeScale(),this._private__invalidate(t)}_internal_setBarSpacing(t){const e=zt._internal_light();e._internal_setBarSpacing(t),this._private__invalidate(e)}_internal_setRightOffset(t){const e=zt._internal_light();e._internal_setRightOffset(t),this._private__invalidate(e)}_internal_setTimeScaleAnimation(t){const e=zt._internal_light();e._internal_setTimeScaleAnimation(t),this._private__invalidate(e)}_internal_stopTimeScaleAnimation(){const t=zt._internal_light();t._internal_stopTimeScaleAnimation(),this._private__invalidate(t)}_internal_defaultVisiblePriceScaleId(){return this._private__options.rightPriceScale.visible?"right":"left"}_internal_backgroundBottomColor(){return this._private__backgroundBottomColor}_internal_backgroundTopColor(){return this._private__backgroundTopColor}_internal_backgroundColorAtYPercentFromTop(t){const e=this._private__backgroundBottomColor,i=this._private__backgroundTopColor;if(e===i)return e;if(t=Math.max(0,Math.min(100,Math.round(100*t))),null===this._private__gradientColorsCache||this._private__gradientColorsCache._internal_topColor!==i||this._private__gradientColorsCache._internal_bottomColor!==e)this._private__gradientColorsCache={_internal_topColor:i,_internal_bottomColor:e,_internal_colors:new Map};else{const e=this._private__gradientColorsCache._internal_colors.get(t);if(void 0!==e)return e}const _=function(t,e,i){const[_,r,n,a]=C(t),[l,s,o,h]=C(e),p=[m(_+i*(l-_)),m(r+i*(s-r)),m(n+i*(o-n)),g(a+i*(h-a))];return`rgba(${p[0]}, ${p[1]}, ${p[2]}, ${p[3]})`}(i,e,t/100);return this._private__gradientColorsCache._internal_colors.set(t,_),_}_private__paneInvalidationMask(t,e){const i=new zt(e);if(null!==t){const _=this._private__panes.indexOf(t);i._internal_invalidatePane(_,{_internal_level:e})}return i}_private__invalidationMaskForSource(t,e){return void 0===e&&(e=2),this._private__paneInvalidationMask(this._internal_paneForSource(t),e)}_private__invalidate(t){this._private__invalidateHandler&&this._private__invalidateHandler(t),this._private__panes.forEach((t=>t._internal_grid()._internal_paneView()._internal_update()))}_private__createSeries(t,e,i){const _=new Gt(this,t,e),r=this._internal_defaultVisiblePriceScaleId();return i._internal_addDataSource(_,r),Et(r)||_._internal_applyOptions(t),_}_private__getBackgroundColor(t){const e=this._private__options.layout;return"gradient"===e.background.type?0===t?e.background.topColor:e.background.bottomColor:e.background.color}}function ke(e){return!t(e)&&!i(e)}function Ee(e){return t(e)}function ze(t){return 60*t*60*1e3}function Re(t){return 60*t*1e3}const Be=[{_internal_divisor:(1,1e3),_internal_weight:10},{_internal_divisor:Re(1),_internal_weight:20},{_internal_divisor:Re(5),_internal_weight:21},{_internal_divisor:Re(30),_internal_weight:22},{_internal_divisor:ze(1),_internal_weight:30},{_internal_divisor:ze(3),_internal_weight:31},{_internal_divisor:ze(6),_internal_weight:32},{_internal_divisor:ze(12),_internal_weight:33}];function Ae(t,e){if(t.getUTCFullYear()!==e.getUTCFullYear())return 70;if(t.getUTCMonth()!==e.getUTCMonth())return 60;if(t.getUTCDate()!==e.getUTCDate())return 50;for(let i=Be.length-1;i>=0;--i)if(Math.floor(e.getTime()/Be[i]._internal_divisor)!==Math.floor(t.getTime()/Be[i]._internal_divisor))return Be[i]._internal_weight;return 0}function Ve(t){let e=t;if(i(t)&&(e=Oe(t)),!ke(e))throw new Error("time must be of type BusinessDay");const _=new Date(Date.UTC(e.year,e.month-1,e.day,0,0,0,0));return{_internal_timestamp:Math.round(_.getTime()/1e3),_internal_businessDay:e}}function Ie(t){if(!Ee(t))throw new Error("time must be of type isUTCTimestamp");return{_internal_timestamp:t}}const De=/^\d\d\d\d-\d\d-\d\d$/;function Oe(t){if(!De.test(t))throw new Error(`Invalid date string=${t}, expected format=yyyy-mm-dd`);const e=new Date(t);if(isNaN(e.getTime()))throw new Error(`Invalid date string=${t}, expected format=yyyy-mm-dd`);return{day:e.getUTCDate(),month:e.getUTCMonth()+1,year:e.getUTCFullYear()}}class Le{options(){return this._private__options}setOptions(t){this._private__options=t,this.updateFormatter(t.localization)}createConverterToInternalObj(t){return o(function(t){return 0===t.length?null:ke(t[0].time)||i(t[0].time)?Ve:Ie}(t))}key(t){return"object"==typeof t&&"_internal_timestamp"in t?t._internal_timestamp:this.key(this.convertHorzItemToInternal(t))}cacheKey(t){const e=t;return void 0===e._internal_businessDay?new Date(1e3*e._internal_timestamp).getTime():new Date(Date.UTC(e._internal_businessDay.year,e._internal_businessDay.month-1,e._internal_businessDay.day)).getTime()}convertHorzItemToInternal(t){return Ee(e=t)?Ie(e):ke(e)?Ve(e):Ve(Oe(e));var e}updateFormatter(t){if(!this._private__options)return;const e=t.dateFormat;this._private__options.timeScale.timeVisible?this._private__dateTimeFormatter=new W({_internal_dateFormat:e,_internal_timeFormat:this._private__options.timeScale.secondsVisible?"%h:%m:%s":"%h:%m",_internal_dateTimeSeparator:"   ",_internal_locale:t.locale}):this._private__dateTimeFormatter=new D(e,t.locale)}formatHorzItem(t){return this._private__dateTimeFormatter._internal_format(new Date(1e3*t._internal_timestamp))}formatTickmark(t,e){const i=function(t,e,i){switch(t){case 0:case 10:return e?i?4:3:2;case 20:case 21:case 22:case 30:case 31:case 32:case 33:return e?3:2;case 50:return 2;case 60:return 1;case 70:return 0}}(t.weight,this._private__options.timeScale.timeVisible,this._private__options.timeScale.secondsVisible);return function(t,e,i){const _={};switch(e){case 0:_.year="numeric";break;case 1:_.month="short";break;case 2:_.day="numeric";break;case 3:_.hour12=!1,_.hour="2-digit",_.minute="2-digit";break;case 4:_.hour12=!1,_.hour="2-digit",_.minute="2-digit",_.second="2-digit"}const r=void 0===t._internal_businessDay?new Date(1e3*t._internal_timestamp):new Date(Date.UTC(t._internal_businessDay.year,t._internal_businessDay.month-1,t._internal_businessDay.day));return new Date(r.getUTCFullYear(),r.getUTCMonth(),r.getUTCDate(),r.getUTCHours(),r.getUTCMinutes(),r.getUTCSeconds(),r.getUTCMilliseconds()).toLocaleString(i,_)}(t.time,i,e.locale)}maxTickMarkWeight(t){let e=t.reduce(be,t[0]).weight;return e>30&&e<50&&(e=30),e}fillWeightsForPoints(t,e){!function(t,e=0){if(0===t.length)return;let i=0===e?null:t[e-1].time._internal_timestamp,_=null!==i?new Date(1e3*i):null,r=0;for(let n=e;n<t.length;++n){const e=t[n],a=new Date(1e3*e.time._internal_timestamp);null!==_&&(e.timeWeight=Ae(a,_)),r+=e.time._internal_timestamp-(i||e.time._internal_timestamp),i=e.time._internal_timestamp,_=a}if(0===e&&t.length>1){const e=Math.ceil(r/(t.length-1)),i=new Date(1e3*(t[0].time._internal_timestamp-e));t[0].timeWeight=Ae(new Date(1e3*t[0].time._internal_timestamp),i)}}(t,e)}static _internal_applyDefaults(t){const e=window.navigator.languages[0];return p({localization:{dateFormat:"dd MMM 'yy",priceFormatter:Intl.NumberFormat(e,{style:"currency",currency:"RUB"}).format}},t)}}function We(t){var e=t.width,i=t.height;if(e<0)throw new Error("Negative width is not allowed for Size");if(i<0)throw new Error("Negative height is not allowed for Size");return{width:e,height:i}}function Fe(t,e){return t.width===e.width&&t.height===e.height}const Ne=function(){function t(t){this._resolutionMediaQueryList=null,this._observers=[],this._window=t,this._installResolutionListener()}return Object.defineProperty(t.prototype,"value",{get:function(){return this._window.devicePixelRatio},enumerable:!1,configurable:!0}),t.prototype.subscribe=function(t){var e=this,i={next:t};return this._observers.push(i),{unsubscribe:function(){e._observers=e._observers.filter((function(t){return t!==i}))}}},t.prototype._installResolutionListener=function(){if(null!==this._resolutionMediaQueryList)throw new Error("Resolution listener is already installed");var t=this._window.devicePixelRatio;this._resolutionMediaQueryList=this._window.matchMedia("all and (resolution: ".concat(t,"dppx)")),this._resolutionMediaQueryList.addListener(this._resolutionListener)},t}();var He=function(){function t(t,e,i){var _;this._canvasElement=null,this._bitmapSizeChangedListeners=[],this._suggestedBitmapSize=null,this._suggestedBitmapSizeChangedListeners=[],this._devicePixelRatioObservable=null,this._canvasElementResizeObserver=null,this._canvasElement=t,this._canvasElementClientSize=We({width:this._canvasElement.clientWidth,height:this._canvasElement.clientHeight}),this._transformBitmapSize=null!=e?e:function(t){return t},this._allowResizeObserver=null===(_=null==i?void 0:i.allowResizeObserver)||void 0===_||_,this._chooseAndInitObserver()}return t.prototype.dispose=function(){var t,e;if(null===this._canvasElement)throw new Error("Object is disposed");null===(t=this._canvasElementResizeObserver)||void 0===t||t.disconnect(),this._canvasElementResizeObserver=null,null===(e=this._devicePixelRatioObservable)||void 0===e||e.dispose(),this._devicePixelRatioObservable=null,this._suggestedBitmapSizeChangedListeners.length=0,this._bitmapSizeChangedListeners.length=0,this._canvasElement=null},Object.defineProperty(t.prototype,"canvasElement",{get:function(){if(null===this._canvasElement)throw new Error("Object is disposed");return this._canvasElement},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"canvasElementClientSize",{get:function(){return this._canvasElementClientSize},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bitmapSize",{get:function(){return We({width:this.canvasElement.width,height:this.canvasElement.height})},enumerable:!1,configurable:!0}),t.prototype.resizeCanvasElement=function(t){this._canvasElementClientSize=We(t),this.canvasElement.style.width="".concat(this._canvasElementClientSize.width,"px"),this.canvasElement.style.height="".concat(this._canvasElementClientSize.height,"px"),this._invalidateBitmapSize()},Object.defineProperty(t.prototype,"suggestedBitmapSize",{get:function(){return this._suggestedBitmapSize},enumerable:!1,configurable:!0}),t.prototype.subscribeSuggestedBitmapSizeChanged=function(t){this._suggestedBitmapSizeChangedListeners.push(t)},t.prototype.unsubscribeSuggestedBitmapSizeChanged=function(t){this._suggestedBitmapSizeChangedListeners=this._suggestedBitmapSizeChangedListeners.filter((function(e){return e!==t}))},t.prototype.applySuggestedBitmapSize=function(){if(null!==this._suggestedBitmapSize){var t=this._suggestedBitmapSize;this._suggestedBitmapSize=null,this._resizeBitmap(t),this._emitSuggestedBitmapSizeChanged(t,this._suggestedBitmapSize)}},t.prototype._resizeBitmap=function(t){var e=this.bitmapSize;Fe(e,t)||(this.canvasElement.width=t.width,this.canvasElement.height=t.height,this._emitBitmapSizeChanged(e,t))},t.prototype._emitBitmapSizeChanged=function(t,e){var i=this;this._bitmapSizeChangedListeners.forEach((function(_){return _.call(i,t,e)}))},t.prototype._suggestNewBitmapSize=function(t){var e=this._suggestedBitmapSize,i=We(this._transformBitmapSize(t,this._canvasElementClientSize)),_=Fe(this.bitmapSize,i)?null:i;null===e&&null===_||null!==e&&null!==_&&Fe(e,_)||(this._suggestedBitmapSize=_,this._emitSuggestedBitmapSizeChanged(e,_))},t.prototype._emitSuggestedBitmapSizeChanged=function(t,e){var i=this;this._suggestedBitmapSizeChangedListeners.forEach((function(_){return _.call(i,t,e)}))},t.prototype._chooseAndInitObserver=function(){var t=this;this._allowResizeObserver?new Promise((function(t){var e=new ResizeObserver((function(i){t(i.every((function(t){return"devicePixelContentBoxSize"in t}))),e.disconnect()}));e.observe(document.body,{box:"device-pixel-content-box"})})).catch((function(){return!1})).then((function(e){return e?t._initResizeObserver():t._initDevicePixelRatioObservable()})):this._initDevicePixelRatioObservable()},t.prototype._initDevicePixelRatioObservable=function(){var t=this;if(null!==this._canvasElement){var e=Ue(this._canvasElement);if(null===e)throw new Error("No window is associated with the canvas");this._devicePixelRatioObservable=function(t){return new Ne(t)}(e),this._devicePixelRatioObservable.subscribe((function(){return t._invalidateBitmapSize()})),this._invalidateBitmapSize()}},t.prototype._invalidateBitmapSize=function(){var t,e;if(null!==this._canvasElement){var i=Ue(this._canvasElement);if(null!==i){var _=null!==(e=null===(t=this._devicePixelRatioObservable)||void 0===t?void 0:t.value)&&void 0!==e?e:i.devicePixelRatio,r=this._canvasElement.getClientRects(),n=void 0!==r[0]?function(t,e){return We({width:Math.round(t.left*e+t.width*e)-Math.round(t.left*e),height:Math.round(t.top*e+t.height*e)-Math.round(t.top*e)})}(r[0],_):We({width:this._canvasElementClientSize.width*_,height:this._canvasElementClientSize.height*_});this._suggestNewBitmapSize(n)}}},t.prototype._initResizeObserver=function(){var t=this;null!==this._canvasElement&&(this._canvasElementResizeObserver=new ResizeObserver((function(e){var i=e.find((function(e){return e.target===t._canvasElement}));if(i&&i.devicePixelContentBoxSize&&i.devicePixelContentBoxSize[0]){var _=i.devicePixelContentBoxSize[0],r=We({width:_.inlineSize,height:_.blockSize});t._suggestNewBitmapSize(r)}})),this._canvasElementResizeObserver.observe(this._canvasElement,{box:"device-pixel-content-box"}))},t}();function Ue(t){return t.ownerDocument.defaultView}var Ye=function(){function t(t,e,i){if(0===e.width||0===e.height)throw new TypeError("Rendering target could only be created on a media with positive width and height");if(this._mediaSize=e,0===i.width||0===i.height)throw new TypeError("Rendering target could only be created using a bitmap with positive integer width and height");this._bitmapSize=i,this._context=t}return t.prototype.useMediaCoordinateSpace=function(t){try{return this._context.save(),this._context.setTransform(1,0,0,1,0,0),this._context.scale(this._horizontalPixelRatio,this._verticalPixelRatio),t({context:this._context,mediaSize:this._mediaSize})}finally{this._context.restore()}},t.prototype.useBitmapCoordinateSpace=function(t){try{return this._context.save(),this._context.setTransform(1,0,0,1,0,0),t({context:this._context,mediaSize:this._mediaSize,bitmapSize:this._bitmapSize,horizontalPixelRatio:this._horizontalPixelRatio,verticalPixelRatio:this._verticalPixelRatio})}finally{this._context.restore()}},Object.defineProperty(t.prototype,"_horizontalPixelRatio",{get:function(){return this._bitmapSize.width/this._mediaSize.width},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_verticalPixelRatio",{get:function(){return this._bitmapSize.height/this._mediaSize.height},enumerable:!1,configurable:!0}),t}();function $e(t,e){var i=t.canvasElementClientSize;if(0===i.width||0===i.height)return null;var _=t.bitmapSize;if(0===_.width||0===_.height)return null;var r=t.canvasElement.getContext("2d",e);return null===r?null:new Ye(r,i,_)}const je="undefined"!=typeof window;function Xe(){return!!je&&window.navigator.userAgent.toLowerCase().indexOf("firefox")>-1}function Ge(){return!!je&&/iPhone|iPad|iPod/.test(window.navigator.platform)}function Ke(t){return t+t%2}function Ze(t,e){return t._internal_position-e._internal_position}function qe(t,e,i){const _=(t._internal_position-e._internal_position)/(t._internal_time-e._internal_time);return Math.sign(_)*Math.min(Math.abs(_),i)}class Qe{constructor(t,e,i,_){this._private__position1=null,this._private__position2=null,this._private__position3=null,this._private__position4=null,this._private__animationStartPosition=null,this._private__durationMsecs=0,this._private__speedPxPerMsec=0,this._private__minSpeed=t,this._private__maxSpeed=e,this._private__dumpingCoeff=i,this._private__minMove=_}_internal_addPosition(t,e){if(null!==this._private__position1){if(this._private__position1._internal_time===e)return void(this._private__position1._internal_position=t);if(Math.abs(this._private__position1._internal_position-t)<this._private__minMove)return}this._private__position4=this._private__position3,this._private__position3=this._private__position2,this._private__position2=this._private__position1,this._private__position1={_internal_time:e,_internal_position:t}}_internal_start(t,e){if(null===this._private__position1||null===this._private__position2)return;if(e-this._private__position1._internal_time>50)return;let i=0;const _=qe(this._private__position1,this._private__position2,this._private__maxSpeed),r=Ze(this._private__position1,this._private__position2),n=[_],a=[r];if(i+=r,null!==this._private__position3){const t=qe(this._private__position2,this._private__position3,this._private__maxSpeed);if(Math.sign(t)===Math.sign(_)){const e=Ze(this._private__position2,this._private__position3);if(n.push(t),a.push(e),i+=e,null!==this._private__position4){const t=qe(this._private__position3,this._private__position4,this._private__maxSpeed);if(Math.sign(t)===Math.sign(_)){const e=Ze(this._private__position3,this._private__position4);n.push(t),a.push(e),i+=e}}}}let l=0;for(let t=0;t<n.length;++t)l+=a[t]/i*n[t];Math.abs(l)<this._private__minSpeed||(this._private__animationStartPosition={_internal_position:t,_internal_time:e},this._private__speedPxPerMsec=l,this._private__durationMsecs=function(t,e){const i=Math.log(e);return Math.log(-t/i)/i}(Math.abs(l),this._private__dumpingCoeff))}_internal_getPosition(t){const e=o(this._private__animationStartPosition),i=t-e._internal_time;return e._internal_position+this._private__speedPxPerMsec*(Math.pow(this._private__dumpingCoeff,i)-1)/Math.log(this._private__dumpingCoeff)}_internal_finished(t){return null===this._private__animationStartPosition||this._private__progressDuration(t)===this._private__durationMsecs}_private__progressDuration(t){const e=t-o(this._private__animationStartPosition)._internal_time;return Math.min(e,this._private__durationMsecs)}}function Je(t,e){const i=o(t.ownerDocument).createElement("canvas");t.appendChild(i);const _=function(t,e){if("device-pixel-content-box"===e.type)return new He(t,e.transform,e.options);throw new Error("Unsupported binding target")}(i,{type:"device-pixel-content-box",options:{allowResizeObserver:!1},transform:(t,e)=>({width:Math.max(t.width,e.width),height:Math.max(t.height,e.height)})});return _.resizeCanvasElement(e),_}function ti(t){var e;t.width=1,t.height=1,null===(e=t.getContext("2d"))||void 0===e||e.clearRect(0,0,1,1)}function ei(t,e,i,_){t._internal_drawBackground&&t._internal_drawBackground(e,i,_)}function ii(t,e,i,_){t._internal_draw(e,i,_)}function _i(t,e,i,_){const r=t(i,_);for(const t of r){const i=t._internal_renderer();null!==i&&e(i)}}class ri{constructor(t,e,i){this._private__clickCount=0,this._private__clickTimeoutId=null,this._private__clickPosition={_internal_x:Number.NEGATIVE_INFINITY,_internal_y:Number.POSITIVE_INFINITY},this._private__tapCount=0,this._private__tapTimeoutId=null,this._private__tapPosition={_internal_x:Number.NEGATIVE_INFINITY,_internal_y:Number.POSITIVE_INFINITY},this._private__longTapTimeoutId=null,this._private__longTapActive=!1,this._private__mouseMoveStartPosition=null,this._private__touchMoveStartPosition=null,this._private__touchMoveExceededManhattanDistance=!1,this._private__cancelClick=!1,this._private__cancelTap=!1,this._private__unsubscribeOutsideMouseEvents=null,this._private__unsubscribeOutsideTouchEvents=null,this._private__unsubscribeMobileSafariEvents=null,this._private__unsubscribeMousemove=null,this._private__unsubscribeRootMouseEvents=null,this._private__unsubscribeRootTouchEvents=null,this._private__startPinchMiddlePoint=null,this._private__startPinchDistance=0,this._private__pinchPrevented=!1,this._private__preventTouchDragProcess=!1,this._private__mousePressed=!1,this._private__lastTouchEventTimeStamp=0,this._private__activeTouchId=null,this._private__acceptMouseLeave=!Ge(),this._private__onFirefoxOutsideMouseUp=t=>{this._private__mouseUpHandler(t)},this._private__onMobileSafariDoubleClick=t=>{if(this._private__firesTouchEvents(t)){const e=this._private__makeCompatEvent(t);if(++this._private__tapCount,this._private__tapTimeoutId&&this._private__tapCount>1){const{_internal_manhattanDistance:i}=this._private__touchMouseMoveWithDownInfo(li(t),this._private__tapPosition);i<30&&!this._private__cancelTap&&this._private__processTouchEvent(e,this._private__handler._internal_doubleTapEvent),this._private__resetTapTimeout()}}else{const e=this._private__makeCompatEvent(t);if(++this._private__clickCount,this._private__clickTimeoutId&&this._private__clickCount>1){const{_internal_manhattanDistance:i}=this._private__touchMouseMoveWithDownInfo(li(t),this._private__clickPosition);i<5&&!this._private__cancelClick&&this._private__processMouseEvent(e,this._private__handler._internal_mouseDoubleClickEvent),this._private__resetClickTimeout()}}},this._private__target=t,this._private__handler=e,this._private__options=i,this._private__init()}_internal_destroy(){null!==this._private__unsubscribeOutsideMouseEvents&&(this._private__unsubscribeOutsideMouseEvents(),this._private__unsubscribeOutsideMouseEvents=null),null!==this._private__unsubscribeOutsideTouchEvents&&(this._private__unsubscribeOutsideTouchEvents(),this._private__unsubscribeOutsideTouchEvents=null),null!==this._private__unsubscribeMousemove&&(this._private__unsubscribeMousemove(),this._private__unsubscribeMousemove=null),null!==this._private__unsubscribeRootMouseEvents&&(this._private__unsubscribeRootMouseEvents(),this._private__unsubscribeRootMouseEvents=null),null!==this._private__unsubscribeRootTouchEvents&&(this._private__unsubscribeRootTouchEvents(),this._private__unsubscribeRootTouchEvents=null),null!==this._private__unsubscribeMobileSafariEvents&&(this._private__unsubscribeMobileSafariEvents(),this._private__unsubscribeMobileSafariEvents=null),this._private__clearLongTapTimeout(),this._private__resetClickTimeout()}_private__mouseEnterHandler(t){this._private__unsubscribeMousemove&&this._private__unsubscribeMousemove();const e=this._private__mouseMoveHandler.bind(this);if(this._private__unsubscribeMousemove=()=>{this._private__target.removeEventListener("mousemove",e)},this._private__target.addEventListener("mousemove",e),this._private__firesTouchEvents(t))return;const i=this._private__makeCompatEvent(t);this._private__processMouseEvent(i,this._private__handler._internal_mouseEnterEvent),this._private__acceptMouseLeave=!0}_private__resetClickTimeout(){null!==this._private__clickTimeoutId&&clearTimeout(this._private__clickTimeoutId),this._private__clickCount=0,this._private__clickTimeoutId=null,this._private__clickPosition={_internal_x:Number.NEGATIVE_INFINITY,_internal_y:Number.POSITIVE_INFINITY}}_private__resetTapTimeout(){null!==this._private__tapTimeoutId&&clearTimeout(this._private__tapTimeoutId),this._private__tapCount=0,this._private__tapTimeoutId=null,this._private__tapPosition={_internal_x:Number.NEGATIVE_INFINITY,_internal_y:Number.POSITIVE_INFINITY}}_private__mouseMoveHandler(t){if(this._private__mousePressed||null!==this._private__touchMoveStartPosition)return;if(this._private__firesTouchEvents(t))return;const e=this._private__makeCompatEvent(t);this._private__processMouseEvent(e,this._private__handler._internal_mouseMoveEvent),this._private__acceptMouseLeave=!0}_private__touchMoveHandler(t){const e=oi(t.changedTouches,o(this._private__activeTouchId));if(null===e)return;if(this._private__lastTouchEventTimeStamp=si(t),null!==this._private__startPinchMiddlePoint)return;if(this._private__preventTouchDragProcess)return;this._private__pinchPrevented=!0;const i=this._private__touchMouseMoveWithDownInfo(li(e),o(this._private__touchMoveStartPosition)),{_internal_xOffset:_,_internal_yOffset:r,_internal_manhattanDistance:n}=i;if(this._private__touchMoveExceededManhattanDistance||!(n<5)){if(!this._private__touchMoveExceededManhattanDistance){const t=.5*_,e=r>=t&&!this._private__options._internal_treatVertTouchDragAsPageScroll(),i=t>r&&!this._private__options._internal_treatHorzTouchDragAsPageScroll();e||i||(this._private__preventTouchDragProcess=!0),this._private__touchMoveExceededManhattanDistance=!0,this._private__cancelTap=!0,this._private__clearLongTapTimeout(),this._private__resetTapTimeout()}if(!this._private__preventTouchDragProcess){const i=this._private__makeCompatEvent(t,e);this._private__processTouchEvent(i,this._private__handler._internal_touchMoveEvent),ai(t)}}}_private__mouseMoveWithDownHandler(t){if(0!==t.button)return;const e=this._private__touchMouseMoveWithDownInfo(li(t),o(this._private__mouseMoveStartPosition)),{_internal_manhattanDistance:i}=e;if(i>=5&&(this._private__cancelClick=!0,this._private__resetClickTimeout()),this._private__cancelClick){const e=this._private__makeCompatEvent(t);this._private__processMouseEvent(e,this._private__handler._internal_pressedMouseMoveEvent)}}_private__touchMouseMoveWithDownInfo(t,e){const i=Math.abs(e._internal_x-t._internal_x),_=Math.abs(e._internal_y-t._internal_y);return{_internal_xOffset:i,_internal_yOffset:_,_internal_manhattanDistance:i+_}}_private__touchEndHandler(t){let e=oi(t.changedTouches,o(this._private__activeTouchId));if(null===e&&0===t.touches.length&&(e=t.changedTouches[0]),null===e)return;this._private__activeTouchId=null,this._private__lastTouchEventTimeStamp=si(t),this._private__clearLongTapTimeout(),this._private__touchMoveStartPosition=null,this._private__unsubscribeRootTouchEvents&&(this._private__unsubscribeRootTouchEvents(),this._private__unsubscribeRootTouchEvents=null);const i=this._private__makeCompatEvent(t,e);if(this._private__processTouchEvent(i,this._private__handler._internal_touchEndEvent),++this._private__tapCount,this._private__tapTimeoutId&&this._private__tapCount>1){const{_internal_manhattanDistance:t}=this._private__touchMouseMoveWithDownInfo(li(e),this._private__tapPosition);t<30&&!this._private__cancelTap&&this._private__processTouchEvent(i,this._private__handler._internal_doubleTapEvent),this._private__resetTapTimeout()}else this._private__cancelTap||(this._private__processTouchEvent(i,this._private__handler._internal_tapEvent),this._private__handler._internal_tapEvent&&ai(t));0===this._private__tapCount&&ai(t),0===t.touches.length&&this._private__longTapActive&&(this._private__longTapActive=!1,ai(t))}_private__mouseUpHandler(t){if(0!==t.button)return;const e=this._private__makeCompatEvent(t);if(this._private__mouseMoveStartPosition=null,this._private__mousePressed=!1,this._private__unsubscribeRootMouseEvents&&(this._private__unsubscribeRootMouseEvents(),this._private__unsubscribeRootMouseEvents=null),Xe()&&this._private__target.ownerDocument.documentElement.removeEventListener("mouseleave",this._private__onFirefoxOutsideMouseUp),!this._private__firesTouchEvents(t))if(this._private__processMouseEvent(e,this._private__handler._internal_mouseUpEvent),++this._private__clickCount,this._private__clickTimeoutId&&this._private__clickCount>1){const{_internal_manhattanDistance:i}=this._private__touchMouseMoveWithDownInfo(li(t),this._private__clickPosition);i<5&&!this._private__cancelClick&&this._private__processMouseEvent(e,this._private__handler._internal_mouseDoubleClickEvent),this._private__resetClickTimeout()}else this._private__cancelClick||this._private__processMouseEvent(e,this._private__handler._internal_mouseClickEvent)}_private__clearLongTapTimeout(){null!==this._private__longTapTimeoutId&&(clearTimeout(this._private__longTapTimeoutId),this._private__longTapTimeoutId=null)}_private__touchStartHandler(t){if(null!==this._private__activeTouchId)return;const e=t.changedTouches[0];this._private__activeTouchId=e.identifier,this._private__lastTouchEventTimeStamp=si(t);const i=this._private__target.ownerDocument.documentElement;this._private__cancelTap=!1,this._private__touchMoveExceededManhattanDistance=!1,this._private__preventTouchDragProcess=!1,this._private__touchMoveStartPosition=li(e),this._private__unsubscribeRootTouchEvents&&(this._private__unsubscribeRootTouchEvents(),this._private__unsubscribeRootTouchEvents=null);{const e=this._private__touchMoveHandler.bind(this),_=this._private__touchEndHandler.bind(this);this._private__unsubscribeRootTouchEvents=()=>{i.removeEventListener("touchmove",e),i.removeEventListener("touchend",_)},i.addEventListener("touchmove",e,{passive:!1}),i.addEventListener("touchend",_,{passive:!1}),this._private__clearLongTapTimeout(),this._private__longTapTimeoutId=setTimeout(this._private__longTapHandler.bind(this,t),240)}const _=this._private__makeCompatEvent(t,e);this._private__processTouchEvent(_,this._private__handler._internal_touchStartEvent),this._private__tapTimeoutId||(this._private__tapCount=0,this._private__tapTimeoutId=setTimeout(this._private__resetTapTimeout.bind(this),500),this._private__tapPosition=li(e))}_private__mouseDownHandler(t){if(0!==t.button)return;const e=this._private__target.ownerDocument.documentElement;Xe()&&e.addEventListener("mouseleave",this._private__onFirefoxOutsideMouseUp),this._private__cancelClick=!1,this._private__mouseMoveStartPosition=li(t),this._private__unsubscribeRootMouseEvents&&(this._private__unsubscribeRootMouseEvents(),this._private__unsubscribeRootMouseEvents=null);{const t=this._private__mouseMoveWithDownHandler.bind(this),i=this._private__mouseUpHandler.bind(this);this._private__unsubscribeRootMouseEvents=()=>{e.removeEventListener("mousemove",t),e.removeEventListener("mouseup",i)},e.addEventListener("mousemove",t),e.addEventListener("mouseup",i)}if(this._private__mousePressed=!0,this._private__firesTouchEvents(t))return;const i=this._private__makeCompatEvent(t);this._private__processMouseEvent(i,this._private__handler._internal_mouseDownEvent),this._private__clickTimeoutId||(this._private__clickCount=0,this._private__clickTimeoutId=setTimeout(this._private__resetClickTimeout.bind(this),500),this._private__clickPosition=li(t))}_private__init(){this._private__target.addEventListener("mouseenter",this._private__mouseEnterHandler.bind(this)),this._private__target.addEventListener("touchcancel",this._private__clearLongTapTimeout.bind(this));{const t=this._private__target.ownerDocument,e=t=>{this._private__handler._internal_mouseDownOutsideEvent&&(t.composed&&this._private__target.contains(t.composedPath()[0])||t.target&&this._private__target.contains(t.target)||this._private__handler._internal_mouseDownOutsideEvent())};this._private__unsubscribeOutsideTouchEvents=()=>{t.removeEventListener("touchstart",e)},this._private__unsubscribeOutsideMouseEvents=()=>{t.removeEventListener("mousedown",e)},t.addEventListener("mousedown",e),t.addEventListener("touchstart",e,{passive:!0})}var t;Ge()&&(this._private__unsubscribeMobileSafariEvents=()=>{this._private__target.removeEventListener("dblclick",this._private__onMobileSafariDoubleClick)},this._private__target.addEventListener("dblclick",this._private__onMobileSafariDoubleClick)),this._private__target.addEventListener("mouseleave",this._private__mouseLeaveHandler.bind(this)),this._private__target.addEventListener("touchstart",this._private__touchStartHandler.bind(this),{passive:!0}),t=this._private__target,je&&void 0!==window.chrome&&t.addEventListener("mousedown",(t=>{if(1===t.button)return t.preventDefault(),!1})),this._private__target.addEventListener("mousedown",this._private__mouseDownHandler.bind(this)),this._private__initPinch(),this._private__target.addEventListener("touchmove",(()=>{}),{passive:!1})}_private__initPinch(){void 0===this._private__handler._internal_pinchStartEvent&&void 0===this._private__handler._internal_pinchEvent&&void 0===this._private__handler._internal_pinchEndEvent||(this._private__target.addEventListener("touchstart",(t=>this._private__checkPinchState(t.touches)),{passive:!0}),this._private__target.addEventListener("touchmove",(t=>{if(2===t.touches.length&&null!==this._private__startPinchMiddlePoint&&void 0!==this._private__handler._internal_pinchEvent){const e=ni(t.touches[0],t.touches[1])/this._private__startPinchDistance;this._private__handler._internal_pinchEvent(this._private__startPinchMiddlePoint,e),ai(t)}}),{passive:!1}),this._private__target.addEventListener("touchend",(t=>{this._private__checkPinchState(t.touches)})))}_private__checkPinchState(t){1===t.length&&(this._private__pinchPrevented=!1),2!==t.length||this._private__pinchPrevented||this._private__longTapActive?this._private__stopPinch():this._private__startPinch(t)}_private__startPinch(t){const e=this._private__target.getBoundingClientRect()||{left:0,top:0};this._private__startPinchMiddlePoint={_internal_x:(t[0].clientX-e.left+(t[1].clientX-e.left))/2,_internal_y:(t[0].clientY-e.top+(t[1].clientY-e.top))/2},this._private__startPinchDistance=ni(t[0],t[1]),void 0!==this._private__handler._internal_pinchStartEvent&&this._private__handler._internal_pinchStartEvent(),this._private__clearLongTapTimeout()}_private__stopPinch(){null!==this._private__startPinchMiddlePoint&&(this._private__startPinchMiddlePoint=null,void 0!==this._private__handler._internal_pinchEndEvent&&this._private__handler._internal_pinchEndEvent())}_private__mouseLeaveHandler(t){if(this._private__unsubscribeMousemove&&this._private__unsubscribeMousemove(),this._private__firesTouchEvents(t))return;if(!this._private__acceptMouseLeave)return;const e=this._private__makeCompatEvent(t);this._private__processMouseEvent(e,this._private__handler._internal_mouseLeaveEvent),this._private__acceptMouseLeave=!Ge()}_private__longTapHandler(t){const e=oi(t.touches,o(this._private__activeTouchId));if(null===e)return;const i=this._private__makeCompatEvent(t,e);this._private__processTouchEvent(i,this._private__handler._internal_longTapEvent),this._private__cancelTap=!0,this._private__longTapActive=!0}_private__firesTouchEvents(t){return t.sourceCapabilities&&void 0!==t.sourceCapabilities.firesTouchEvents?t.sourceCapabilities.firesTouchEvents:si(t)<this._private__lastTouchEventTimeStamp+500}_private__processTouchEvent(t,e){e&&e.call(this._private__handler,t)}_private__processMouseEvent(t,e){e&&e.call(this._private__handler,t)}_private__makeCompatEvent(t,e){const i=e||t,_=this._private__target.getBoundingClientRect()||{left:0,top:0};return{clientX:i.clientX,clientY:i.clientY,pageX:i.pageX,pageY:i.pageY,screenX:i.screenX,screenY:i.screenY,localX:i.clientX-_.left,localY:i.clientY-_.top,ctrlKey:t.ctrlKey,altKey:t.altKey,shiftKey:t.shiftKey,metaKey:t.metaKey,_internal_isTouch:!t.type.startsWith("mouse")&&"contextmenu"!==t.type&&"click"!==t.type,_internal_srcType:t.type,_internal_target:i.target,_internal_view:t.view,_internal_preventDefault:()=>{"touchstart"!==t.type&&ai(t)}}}}function ni(t,e){const i=t.clientX-e.clientX,_=t.clientY-e.clientY;return Math.sqrt(i*i+_*_)}function ai(t){t.cancelable&&t.preventDefault()}function li(t){return{_internal_x:t.pageX,_internal_y:t.pageY}}function si(t){return t.timeStamp||performance.now()}function oi(t,e){for(let i=0;i<t.length;++i)if(t[i].identifier===e)return t[i];return null}function hi(t){return{_internal_source:t._internal_source,_internal_object:{_internal_externalId:t._internal_hit.externalId},_internal_cursorStyle:t._internal_hit.cursorStyle}}function pi(t,e,i){for(const _ of t){const t=_._internal_renderer();if(null!==t&&t._internal_hitTest){const r=t._internal_hitTest(e,i);if(null!==r)return{_internal_view:_,_internal_object:r}}}return null}function ci(t,e){return i=>{var _,r,n,a;return(null!==(r=null===(_=i._internal_priceScale())||void 0===_?void 0:_._internal_id())&&void 0!==r?r:"")!==e?[]:null!==(a=null===(n=i._internal_pricePaneViews)||void 0===n?void 0:n.call(i,t))&&void 0!==a?a:[]}}class vi{constructor(t,e,i,_){this._private__priceScale=null,this._private__size=null,this._private__mousedown=!1,this._private__widthCache=new vt(200),this._private__font=null,this._private__prevOptimalWidth=0,this._private__isSettingSize=!1,this._private__canvasSuggestedBitmapSizeChangedHandler=()=>{this._private__isSettingSize||this._private__pane._internal_chart()._internal_model()._internal_lightUpdate()},this._private__topCanvasSuggestedBitmapSizeChangedHandler=()=>{this._private__isSettingSize||this._private__pane._internal_chart()._internal_model()._internal_lightUpdate()},this._private__pane=t,this._private__options=e,this._private__layoutOptions=e.layout,this._private__rendererOptionsProvider=i,this._private__isLeft="left"===_,this._private__sourcePaneViews=ci("normal",_),this._private__sourceTopPaneViews=ci("top",_),this._private__sourceBottomPaneViews=ci("bottom",_),this._private__cell=document.createElement("div"),this._private__cell.style.height="100%",this._private__cell.style.overflow="hidden",this._private__cell.style.width="25px",this._private__cell.style.left="0",this._private__cell.style.position="relative",this._private__canvasBinding=Je(this._private__cell,We({width:16,height:16})),this._private__canvasBinding.subscribeSuggestedBitmapSizeChanged(this._private__canvasSuggestedBitmapSizeChangedHandler);const r=this._private__canvasBinding.canvasElement;r.style.position="absolute",r.style.zIndex="1",r.style.left="0",r.style.top="0",this._private__topCanvasBinding=Je(this._private__cell,We({width:16,height:16})),this._private__topCanvasBinding.subscribeSuggestedBitmapSizeChanged(this._private__topCanvasSuggestedBitmapSizeChangedHandler);const n=this._private__topCanvasBinding.canvasElement;n.style.position="absolute",n.style.zIndex="2",n.style.left="0",n.style.top="0";const a={_internal_mouseDownEvent:this._private__mouseDownEvent.bind(this),_internal_touchStartEvent:this._private__mouseDownEvent.bind(this),_internal_pressedMouseMoveEvent:this._private__pressedMouseMoveEvent.bind(this),_internal_touchMoveEvent:this._private__pressedMouseMoveEvent.bind(this),_internal_mouseDownOutsideEvent:this._private__mouseDownOutsideEvent.bind(this),_internal_mouseUpEvent:this._private__mouseUpEvent.bind(this),_internal_touchEndEvent:this._private__mouseUpEvent.bind(this),_internal_mouseDoubleClickEvent:this._private__mouseDoubleClickEvent.bind(this),_internal_doubleTapEvent:this._private__mouseDoubleClickEvent.bind(this),_internal_mouseEnterEvent:this._private__mouseEnterEvent.bind(this),_internal_mouseLeaveEvent:this._private__mouseLeaveEvent.bind(this)};this._private__mouseEventHandler=new ri(this._private__topCanvasBinding.canvasElement,a,{_internal_treatVertTouchDragAsPageScroll:()=>!this._private__options.handleScroll.vertTouchDrag,_internal_treatHorzTouchDragAsPageScroll:()=>!0})}_internal_destroy(){this._private__mouseEventHandler._internal_destroy(),this._private__topCanvasBinding.unsubscribeSuggestedBitmapSizeChanged(this._private__topCanvasSuggestedBitmapSizeChangedHandler),ti(this._private__topCanvasBinding.canvasElement),this._private__topCanvasBinding.dispose(),this._private__canvasBinding.unsubscribeSuggestedBitmapSizeChanged(this._private__canvasSuggestedBitmapSizeChangedHandler),ti(this._private__canvasBinding.canvasElement),this._private__canvasBinding.dispose(),null!==this._private__priceScale&&this._private__priceScale._internal_onMarksChanged()._internal_unsubscribeAll(this),this._private__priceScale=null}_internal_getElement(){return this._private__cell}_internal_fontSize(){return this._private__layoutOptions.fontSize}_internal_rendererOptions(){const t=this._private__rendererOptionsProvider._internal_options();return this._private__font!==t._internal_font&&(this._private__widthCache._internal_reset(),this._private__font=t._internal_font),t}_internal_optimalWidth(){if(null===this._private__priceScale)return 0;let t=0;const e=this._internal_rendererOptions(),i=o(this._private__canvasBinding.canvasElement.getContext("2d"));i.save();const _=this._private__priceScale._internal_marks();i.font=this._private__baseFont(),_.length>0&&(t=Math.max(this._private__widthCache._internal_measureText(i,_[0]._internal_label),this._private__widthCache._internal_measureText(i,_[_.length-1]._internal_label)));const r=this._private__backLabels();for(let e=r.length;e--;){const _=this._private__widthCache._internal_measureText(i,r[e]._internal_text());_>t&&(t=_)}const n=this._private__priceScale._internal_firstValue();if(null!==n&&null!==this._private__size){const e=this._private__priceScale._internal_coordinateToPrice(1,n),_=this._private__priceScale._internal_coordinateToPrice(this._private__size.height-2,n);t=Math.max(t,this._private__widthCache._internal_measureText(i,this._private__priceScale._internal_formatPrice(Math.floor(Math.min(e,_))+.11111111111111,n)),this._private__widthCache._internal_measureText(i,this._private__priceScale._internal_formatPrice(Math.ceil(Math.max(e,_))-.11111111111111,n)))}i.restore();const a=t||34;return Ke(Math.ceil(e._internal_borderSize+e._internal_tickLength+e._internal_paddingInner+e._internal_paddingOuter+5+a))}_internal_setSize(t){null!==this._private__size&&Fe(this._private__size,t)||(this._private__size=t,this._private__isSettingSize=!0,this._private__canvasBinding.resizeCanvasElement(t),this._private__topCanvasBinding.resizeCanvasElement(t),this._private__isSettingSize=!1,this._private__cell.style.width=`${t.width}px`,this._private__cell.style.height=`${t.height}px`)}_internal_getWidth(){return o(this._private__size).width}_internal_setPriceScale(t){this._private__priceScale!==t&&(null!==this._private__priceScale&&this._private__priceScale._internal_onMarksChanged()._internal_unsubscribeAll(this),this._private__priceScale=t,t._internal_onMarksChanged()._internal_subscribe(this._private__onMarksChanged.bind(this),this))}_internal_priceScale(){return this._private__priceScale}_internal_reset(){const t=this._private__pane._internal_state();this._private__pane._internal_chart()._internal_model()._internal_resetPriceScale(t,o(this._internal_priceScale()))}_internal_paint(t){if(null===this._private__size)return;if(1!==t){this._private__alignLabels(),this._private__canvasBinding.applySuggestedBitmapSize();const t=$e(this._private__canvasBinding);null!==t&&(t.useBitmapCoordinateSpace((t=>{this._private__drawBackground(t),this._private__drawBorder(t)})),this._private__pane._internal_drawAdditionalSources(t,this._private__sourceBottomPaneViews),this._private__drawTickMarks(t),this._private__pane._internal_drawAdditionalSources(t,this._private__sourcePaneViews),this._private__drawBackLabels(t))}this._private__topCanvasBinding.applySuggestedBitmapSize();const e=$e(this._private__topCanvasBinding);null!==e&&(e.useBitmapCoordinateSpace((({context:t,bitmapSize:e})=>{t.clearRect(0,0,e.width,e.height)})),this._private__drawCrosshairLabel(e),this._private__pane._internal_drawAdditionalSources(e,this._private__sourceTopPaneViews))}_internal_getBitmapSize(){return this._private__canvasBinding.bitmapSize}_internal_drawBitmap(t,e,i){const _=this._internal_getBitmapSize();_.width>0&&_.height>0&&t.drawImage(this._private__canvasBinding.canvasElement,e,i)}_internal_update(){var t;null===(t=this._private__priceScale)||void 0===t||t._internal_marks()}_private__mouseDownEvent(t){if(null===this._private__priceScale||this._private__priceScale._internal_isEmpty()||!this._private__options.handleScale.axisPressedMouseMove.price)return;const e=this._private__pane._internal_chart()._internal_model(),i=this._private__pane._internal_state();this._private__mousedown=!0,e._internal_startScalePrice(i,this._private__priceScale,t.localY)}_private__pressedMouseMoveEvent(t){if(null===this._private__priceScale||!this._private__options.handleScale.axisPressedMouseMove.price)return;const e=this._private__pane._internal_chart()._internal_model(),i=this._private__pane._internal_state(),_=this._private__priceScale;e._internal_scalePriceTo(i,_,t.localY)}_private__mouseDownOutsideEvent(){if(null===this._private__priceScale||!this._private__options.handleScale.axisPressedMouseMove.price)return;const t=this._private__pane._internal_chart()._internal_model(),e=this._private__pane._internal_state(),i=this._private__priceScale;this._private__mousedown&&(this._private__mousedown=!1,t._internal_endScalePrice(e,i))}_private__mouseUpEvent(t){if(null===this._private__priceScale||!this._private__options.handleScale.axisPressedMouseMove.price)return;const e=this._private__pane._internal_chart()._internal_model(),i=this._private__pane._internal_state();this._private__mousedown=!1,e._internal_endScalePrice(i,this._private__priceScale)}_private__mouseDoubleClickEvent(t){this._private__options.handleScale.axisDoubleClickReset.price&&this._internal_reset()}_private__mouseEnterEvent(t){null!==this._private__priceScale&&(!this._private__pane._internal_chart()._internal_model()._internal_options().handleScale.axisPressedMouseMove.price||this._private__priceScale._internal_isPercentage()||this._private__priceScale._internal_isIndexedTo100()||this._private__setCursor(1))}_private__mouseLeaveEvent(t){this._private__setCursor(0)}_private__backLabels(){const t=[],e=null===this._private__priceScale?void 0:this._private__priceScale;return(i=>{for(let _=0;_<i.length;++_){const r=i[_]._internal_priceAxisViews(this._private__pane._internal_state(),e);for(let e=0;e<r.length;e++)t.push(r[e])}})(this._private__pane._internal_state()._internal_orderedSources()),t}_private__drawBackground({context:t,bitmapSize:e}){const{width:i,height:_}=e,r=this._private__pane._internal_state()._internal_model(),n=r._internal_backgroundTopColor(),a=r._internal_backgroundBottomColor();n===a?P(t,0,0,i,_,n):E(t,0,0,i,_,n,a)}_private__drawBorder({context:t,bitmapSize:e,horizontalPixelRatio:i}){if(null===this._private__size||null===this._private__priceScale||!this._private__priceScale._internal_options().borderVisible)return;t.fillStyle=this._private__priceScale._internal_options().borderColor;const _=Math.max(1,Math.floor(this._internal_rendererOptions()._internal_borderSize*i));let r;r=this._private__isLeft?e.width-_:0,t.fillRect(r,0,_,e.height)}_private__drawTickMarks(t){if(null===this._private__size||null===this._private__priceScale)return;const e=this._private__priceScale._internal_marks(),i=this._private__priceScale._internal_options(),_=this._internal_rendererOptions(),r=this._private__isLeft?this._private__size.width-_._internal_tickLength:0;i.borderVisible&&i.ticksVisible&&t.useBitmapCoordinateSpace((({context:t,horizontalPixelRatio:n,verticalPixelRatio:a})=>{t.fillStyle=i.borderColor;const l=Math.max(1,Math.floor(a)),s=Math.floor(.5*a),o=Math.round(_._internal_tickLength*n);t.beginPath();for(const i of e)t.rect(Math.floor(r*n),Math.round(i._internal_coord*a)-s,o,l);t.fill()})),t.useMediaCoordinateSpace((({context:t})=>{var n;t.font=this._private__baseFont(),t.fillStyle=null!==(n=i.textColor)&&void 0!==n?n:this._private__layoutOptions.textColor,t.textAlign=this._private__isLeft?"right":"left",t.textBaseline="middle";const a=this._private__isLeft?Math.round(r-_._internal_paddingInner):Math.round(r+_._internal_tickLength+_._internal_paddingInner),l=e.map((e=>this._private__widthCache._internal_yMidCorrection(t,e._internal_label)));for(let i=e.length;i--;){const _=e[i];t.fillText(_._internal_label,a,_._internal_coord+l[i])}}))}_private__alignLabels(){if(null===this._private__size||null===this._private__priceScale)return;let t=this._private__size.height/2;const e=[],i=this._private__priceScale._internal_orderedSources().slice(),_=this._private__pane._internal_state(),r=this._internal_rendererOptions();this._private__priceScale===_._internal_defaultVisiblePriceScale()&&this._private__pane._internal_state()._internal_orderedSources().forEach((t=>{_._internal_isOverlay(t)&&i.push(t)}));const n=this._private__priceScale._internal_dataSources()[0],a=this._private__priceScale;i.forEach((i=>{const r=i._internal_priceAxisViews(_,a);r.forEach((t=>{t._internal_setFixedCoordinate(null),t._internal_isVisible()&&e.push(t)})),n===i&&r.length>0&&(t=r[0]._internal_coordinate())})),e.forEach((t=>t._internal_setFixedCoordinate(t._internal_coordinate()))),this._private__priceScale._internal_options().alignLabels&&this._private__fixLabelOverlap(e,r,t)}_private__fixLabelOverlap(t,e,i){if(null===this._private__size)return;const _=t.filter((t=>t._internal_coordinate()<=i)),r=t.filter((t=>t._internal_coordinate()>i));_.sort(((t,e)=>e._internal_coordinate()-t._internal_coordinate())),_.length&&r.length&&r.push(_[0]),r.sort(((t,e)=>t._internal_coordinate()-e._internal_coordinate()));for(const i of t){const t=Math.floor(i._internal_height(e)/2),_=i._internal_coordinate();_>-t&&_<t&&i._internal_setFixedCoordinate(t),_>this._private__size.height-t&&_<this._private__size.height+t&&i._internal_setFixedCoordinate(this._private__size.height-t)}for(let t=1;t<_.length;t++){const i=_[t],r=_[t-1],n=r._internal_height(e,!1),a=i._internal_coordinate(),l=r._internal_getFixedCoordinate();a>l-n&&i._internal_setFixedCoordinate(l-n)}for(let t=1;t<r.length;t++){const i=r[t],_=r[t-1],n=_._internal_height(e,!0),a=i._internal_coordinate(),l=_._internal_getFixedCoordinate();a<l+n&&i._internal_setFixedCoordinate(l+n)}}_private__drawBackLabels(t){if(null===this._private__size)return;const e=this._private__backLabels(),i=this._internal_rendererOptions(),_=this._private__isLeft?"right":"left";e.forEach((e=>{e._internal_isAxisLabelVisible()&&e._internal_renderer(o(this._private__priceScale))._internal_draw(t,i,this._private__widthCache,_)}))}_private__drawCrosshairLabel(t){if(null===this._private__size||null===this._private__priceScale)return;const e=this._private__pane._internal_chart()._internal_model(),i=[],_=this._private__pane._internal_state(),r=e._internal_crosshairSource()._internal_priceAxisViews(_,this._private__priceScale);r.length&&i.push(r);const n=this._internal_rendererOptions(),a=this._private__isLeft?"right":"left";i.forEach((e=>{e.forEach((e=>{e._internal_renderer(o(this._private__priceScale))._internal_draw(t,n,this._private__widthCache,a)}))}))}_private__setCursor(t){this._private__cell.style.cursor=1===t?"ns-resize":"default"}_private__onMarksChanged(){const t=this._internal_optimalWidth();this._private__prevOptimalWidth<t&&this._private__pane._internal_chart()._internal_model()._internal_fullUpdate(),this._private__prevOptimalWidth=t}_private__baseFont(){return kt(this._private__layoutOptions.fontSize,this._private__layoutOptions.fontFamily)}}function di(t,e){var i,_;return null!==(_=null===(i=t._internal_bottomPaneViews)||void 0===i?void 0:i.call(t,e))&&void 0!==_?_:[]}function ui(t,e){var i,_;return null!==(_=null===(i=t._internal_paneViews)||void 0===i?void 0:i.call(t,e))&&void 0!==_?_:[]}function mi(t,e){var i,_;return null!==(_=null===(i=t._internal_labelPaneViews)||void 0===i?void 0:i.call(t,e))&&void 0!==_?_:[]}function gi(t,e){var i,_;return null!==(_=null===(i=t._internal_topPaneViews)||void 0===i?void 0:i.call(t,e))&&void 0!==_?_:[]}class fi{constructor(t,e){this._private__size=We({width:0,height:0}),this._private__leftPriceAxisWidget=null,this._private__rightPriceAxisWidget=null,this._private__startScrollingPos=null,this._private__isScrolling=!1,this._private__clicked=new yt,this._private__dblClicked=new yt,this._private__prevPinchScale=0,this._private__longTap=!1,this._private__startTrackPoint=null,this._private__exitTrackingModeOnNextTry=!1,this._private__initCrosshairPosition=null,this._private__scrollXAnimation=null,this._private__isSettingSize=!1,this._private__canvasSuggestedBitmapSizeChangedHandler=()=>{this._private__isSettingSize||null===this._private__state||this._private__model()._internal_lightUpdate()},this._private__topCanvasSuggestedBitmapSizeChangedHandler=()=>{this._private__isSettingSize||null===this._private__state||this._private__model()._internal_lightUpdate()},this._private__chart=t,this._private__state=e,this._private__state._internal_onDestroyed()._internal_subscribe(this._private__onStateDestroyed.bind(this),this,!0),this._private__paneCell=document.createElement("td"),this._private__paneCell.style.padding="0",this._private__paneCell.style.position="relative";const i=document.createElement("div");i.style.width="100%",i.style.height="100%",i.style.position="relative",i.style.overflow="hidden",this._private__leftAxisCell=document.createElement("td"),this._private__leftAxisCell.style.padding="0",this._private__rightAxisCell=document.createElement("td"),this._private__rightAxisCell.style.padding="0",this._private__paneCell.appendChild(i),this._private__canvasBinding=Je(i,We({width:16,height:16})),this._private__canvasBinding.subscribeSuggestedBitmapSizeChanged(this._private__canvasSuggestedBitmapSizeChangedHandler);const _=this._private__canvasBinding.canvasElement;_.style.position="absolute",_.style.zIndex="1",_.style.left="0",_.style.top="0",this._private__topCanvasBinding=Je(i,We({width:16,height:16})),this._private__topCanvasBinding.subscribeSuggestedBitmapSizeChanged(this._private__topCanvasSuggestedBitmapSizeChangedHandler);const r=this._private__topCanvasBinding.canvasElement;r.style.position="absolute",r.style.zIndex="2",r.style.left="0",r.style.top="0",this._private__rowElement=document.createElement("tr"),this._private__rowElement.appendChild(this._private__leftAxisCell),this._private__rowElement.appendChild(this._private__paneCell),this._private__rowElement.appendChild(this._private__rightAxisCell),this._internal_updatePriceAxisWidgetsStates(),this._private__mouseEventHandler=new ri(this._private__topCanvasBinding.canvasElement,this,{_internal_treatVertTouchDragAsPageScroll:()=>null===this._private__startTrackPoint&&!this._private__chart._internal_options().handleScroll.vertTouchDrag,_internal_treatHorzTouchDragAsPageScroll:()=>null===this._private__startTrackPoint&&!this._private__chart._internal_options().handleScroll.horzTouchDrag})}_internal_destroy(){null!==this._private__leftPriceAxisWidget&&this._private__leftPriceAxisWidget._internal_destroy(),null!==this._private__rightPriceAxisWidget&&this._private__rightPriceAxisWidget._internal_destroy(),this._private__topCanvasBinding.unsubscribeSuggestedBitmapSizeChanged(this._private__topCanvasSuggestedBitmapSizeChangedHandler),ti(this._private__topCanvasBinding.canvasElement),this._private__topCanvasBinding.dispose(),this._private__canvasBinding.unsubscribeSuggestedBitmapSizeChanged(this._private__canvasSuggestedBitmapSizeChangedHandler),ti(this._private__canvasBinding.canvasElement),this._private__canvasBinding.dispose(),null!==this._private__state&&this._private__state._internal_onDestroyed()._internal_unsubscribeAll(this),this._private__mouseEventHandler._internal_destroy()}_internal_state(){return o(this._private__state)}_internal_setState(t){null!==this._private__state&&this._private__state._internal_onDestroyed()._internal_unsubscribeAll(this),this._private__state=t,null!==this._private__state&&this._private__state._internal_onDestroyed()._internal_subscribe(fi.prototype._private__onStateDestroyed.bind(this),this,!0),this._internal_updatePriceAxisWidgetsStates()}_internal_chart(){return this._private__chart}_internal_getElement(){return this._private__rowElement}_internal_updatePriceAxisWidgetsStates(){if(null!==this._private__state&&(this._private__recreatePriceAxisWidgets(),0!==this._private__model()._internal_serieses().length)){if(null!==this._private__leftPriceAxisWidget){const t=this._private__state._internal_leftPriceScale();this._private__leftPriceAxisWidget._internal_setPriceScale(o(t))}if(null!==this._private__rightPriceAxisWidget){const t=this._private__state._internal_rightPriceScale();this._private__rightPriceAxisWidget._internal_setPriceScale(o(t))}}}_internal_updatePriceAxisWidgets(){null!==this._private__leftPriceAxisWidget&&this._private__leftPriceAxisWidget._internal_update(),null!==this._private__rightPriceAxisWidget&&this._private__rightPriceAxisWidget._internal_update()}_internal_stretchFactor(){return null!==this._private__state?this._private__state._internal_stretchFactor():0}_internal_setStretchFactor(t){this._private__state&&this._private__state._internal_setStretchFactor(t)}_internal_mouseEnterEvent(t){if(!this._private__state)return;this._private__onMouseEvent();const e=t.localX,i=t.localY;this._private__setCrosshairPosition(e,i,t)}_internal_mouseDownEvent(t){this._private__onMouseEvent(),this._private__mouseTouchDownEvent(),this._private__setCrosshairPosition(t.localX,t.localY,t)}_internal_mouseMoveEvent(t){var e;if(!this._private__state)return;this._private__onMouseEvent();const i=t.localX,_=t.localY;this._private__setCrosshairPosition(i,_,t);const r=this._internal_hitTest(i,_);this._private__chart._internal_setCursorStyle(null!==(e=null==r?void 0:r._internal_cursorStyle)&&void 0!==e?e:null),this._private__model()._internal_setHoveredSource(r&&{_internal_source:r._internal_source,_internal_object:r._internal_object})}_internal_mouseClickEvent(t){null!==this._private__state&&(this._private__onMouseEvent(),this._private__fireClickedDelegate(t))}_internal_mouseDoubleClickEvent(t){null!==this._private__state&&this._private__fireMouseClickDelegate(this._private__dblClicked,t)}_internal_doubleTapEvent(t){this._internal_mouseDoubleClickEvent(t)}_internal_pressedMouseMoveEvent(t){this._private__onMouseEvent(),this._private__pressedMouseTouchMoveEvent(t),this._private__setCrosshairPosition(t.localX,t.localY,t)}_internal_mouseUpEvent(t){null!==this._private__state&&(this._private__onMouseEvent(),this._private__longTap=!1,this._private__endScroll(t))}_internal_tapEvent(t){null!==this._private__state&&this._private__fireClickedDelegate(t)}_internal_longTapEvent(t){if(this._private__longTap=!0,null===this._private__startTrackPoint){const e={x:t.localX,y:t.localY};this._private__startTrackingMode(e,e,t)}}_internal_mouseLeaveEvent(t){null!==this._private__state&&(this._private__onMouseEvent(),this._private__state._internal_model()._internal_setHoveredSource(null),this._private__clearCrosshairPosition())}_internal_clicked(){return this._private__clicked}_internal_dblClicked(){return this._private__dblClicked}_internal_pinchStartEvent(){this._private__prevPinchScale=1,this._private__model()._internal_stopTimeScaleAnimation()}_internal_pinchEvent(t,e){if(!this._private__chart._internal_options().handleScale.pinch)return;const i=5*(e-this._private__prevPinchScale);this._private__prevPinchScale=e,this._private__model()._internal_zoomTime(t._internal_x,i)}_internal_touchStartEvent(t){this._private__longTap=!1,this._private__exitTrackingModeOnNextTry=null!==this._private__startTrackPoint,this._private__mouseTouchDownEvent();const e=this._private__model()._internal_crosshairSource();null!==this._private__startTrackPoint&&e._internal_visible()&&(this._private__initCrosshairPosition={x:e._internal_appliedX(),y:e._internal_appliedY()},this._private__startTrackPoint={x:t.localX,y:t.localY})}_internal_touchMoveEvent(t){if(null===this._private__state)return;const e=t.localX,i=t.localY;if(null===this._private__startTrackPoint)this._private__pressedMouseTouchMoveEvent(t);else{this._private__exitTrackingModeOnNextTry=!1;const _=o(this._private__initCrosshairPosition),r=_.x+(e-this._private__startTrackPoint.x),n=_.y+(i-this._private__startTrackPoint.y);this._private__setCrosshairPosition(r,n,t)}}_internal_touchEndEvent(t){0===this._internal_chart()._internal_options().trackingMode.exitMode&&(this._private__exitTrackingModeOnNextTry=!0),this._private__tryExitTrackingMode(),this._private__endScroll(t)}_internal_hitTest(t,e){const i=this._private__state;return null===i?null:function(t,e,i){const _=t._internal_orderedSources(),r=function(t,e,i){var _,r;let n,a;for(const o of t){const t=null!==(r=null===(_=o._internal_primitiveHitTest)||void 0===_?void 0:_.call(o,e,i))&&void 0!==r?r:[];for(const e of t)l=e.zOrder,(!(s=null==n?void 0:n.zOrder)||"top"===l&&"top"!==s||"normal"===l&&"bottom"===s)&&(n=e,a=o)}var l,s;return n&&a?{_internal_hit:n,_internal_source:a}:null}(_,e,i);if("top"===(null==r?void 0:r._internal_hit.zOrder))return hi(r);for(const n of _){if(r&&r._internal_source===n&&"bottom"!==r._internal_hit.zOrder&&!r._internal_hit.isBackground)return hi(r);const _=pi(n._internal_paneViews(t),e,i);if(null!==_)return{_internal_source:n,_internal_view:_._internal_view,_internal_object:_._internal_object};if(r&&r._internal_source===n&&"bottom"!==r._internal_hit.zOrder&&r._internal_hit.isBackground)return hi(r)}return(null==r?void 0:r._internal_hit)?hi(r):null}(i,t,e)}_internal_setPriceAxisSize(t,e){o("left"===e?this._private__leftPriceAxisWidget:this._private__rightPriceAxisWidget)._internal_setSize(We({width:t,height:this._private__size.height}))}_internal_getSize(){return this._private__size}_internal_setSize(t){Fe(this._private__size,t)||(this._private__size=t,this._private__isSettingSize=!0,this._private__canvasBinding.resizeCanvasElement(t),this._private__topCanvasBinding.resizeCanvasElement(t),this._private__isSettingSize=!1,this._private__paneCell.style.width=t.width+"px",this._private__paneCell.style.height=t.height+"px")}_internal_recalculatePriceScales(){const t=o(this._private__state);t._internal_recalculatePriceScale(t._internal_leftPriceScale()),t._internal_recalculatePriceScale(t._internal_rightPriceScale());for(const e of t._internal_dataSources())if(t._internal_isOverlay(e)){const i=e._internal_priceScale();null!==i&&t._internal_recalculatePriceScale(i),e._internal_updateAllViews()}}_internal_paint(t){if(0===t)return;if(null===this._private__state)return;if(t>1&&this._internal_recalculatePriceScales(),null!==this._private__leftPriceAxisWidget&&this._private__leftPriceAxisWidget._internal_paint(t),null!==this._private__rightPriceAxisWidget&&this._private__rightPriceAxisWidget._internal_paint(t),1!==t){this._private__canvasBinding.applySuggestedBitmapSize();const t=$e(this._private__canvasBinding);null!==t&&(t.useBitmapCoordinateSpace((t=>{this._private__drawBackground(t)})),this._private__state&&(this._private__drawSources(t,di),this._private__drawGrid(t),this._private__drawWatermark(t),this._private__drawSources(t,ui),this._private__drawSources(t,mi)))}this._private__topCanvasBinding.applySuggestedBitmapSize();const e=$e(this._private__topCanvasBinding);null!==e&&(e.useBitmapCoordinateSpace((({context:t,bitmapSize:e})=>{t.clearRect(0,0,e.width,e.height)})),this._private__drawCrosshair(e),this._private__drawSources(e,gi))}_internal_leftPriceAxisWidget(){return this._private__leftPriceAxisWidget}_internal_rightPriceAxisWidget(){return this._private__rightPriceAxisWidget}_internal_drawAdditionalSources(t,e){this._private__drawSources(t,e)}_private__onStateDestroyed(){null!==this._private__state&&this._private__state._internal_onDestroyed()._internal_unsubscribeAll(this),this._private__state=null}_private__fireClickedDelegate(t){this._private__fireMouseClickDelegate(this._private__clicked,t)}_private__fireMouseClickDelegate(t,e){const i=e.localX,_=e.localY;t._internal_hasListeners()&&t._internal_fire(this._private__model()._internal_timeScale()._internal_coordinateToIndex(i),{x:i,y:_},e)}_private__drawBackground({context:t,bitmapSize:e}){const{width:i,height:_}=e,r=this._private__model(),n=r._internal_backgroundTopColor(),a=r._internal_backgroundBottomColor();n===a?P(t,0,0,i,_,a):E(t,0,0,i,_,n,a)}_private__drawGrid(t){const e=o(this._private__state)._internal_grid()._internal_paneView()._internal_renderer();null!==e&&e._internal_draw(t,!1)}_private__drawWatermark(t){const e=this._private__model()._internal_watermarkSource();this._private__drawSourceImpl(t,ui,ei,e),this._private__drawSourceImpl(t,ui,ii,e)}_private__drawCrosshair(t){this._private__drawSourceImpl(t,ui,ii,this._private__model()._internal_crosshairSource())}_private__drawSources(t,e){const i=o(this._private__state)._internal_orderedSources();for(const _ of i)this._private__drawSourceImpl(t,e,ei,_);for(const _ of i)this._private__drawSourceImpl(t,e,ii,_)}_private__drawSourceImpl(t,e,i,_){const r=o(this._private__state),n=r._internal_model()._internal_hoveredSource(),a=null!==n&&n._internal_source===_,l=null!==n&&a&&void 0!==n._internal_object?n._internal_object._internal_hitTestData:void 0;_i(e,(e=>i(e,t,a,l)),_,r)}_private__recreatePriceAxisWidgets(){if(null===this._private__state)return;const t=this._private__chart,e=this._private__state._internal_leftPriceScale()._internal_options().visible,i=this._private__state._internal_rightPriceScale()._internal_options().visible;e||null===this._private__leftPriceAxisWidget||(this._private__leftAxisCell.removeChild(this._private__leftPriceAxisWidget._internal_getElement()),this._private__leftPriceAxisWidget._internal_destroy(),this._private__leftPriceAxisWidget=null),i||null===this._private__rightPriceAxisWidget||(this._private__rightAxisCell.removeChild(this._private__rightPriceAxisWidget._internal_getElement()),this._private__rightPriceAxisWidget._internal_destroy(),this._private__rightPriceAxisWidget=null);const _=t._internal_model()._internal_rendererOptionsProvider();e&&null===this._private__leftPriceAxisWidget&&(this._private__leftPriceAxisWidget=new vi(this,t._internal_options(),_,"left"),this._private__leftAxisCell.appendChild(this._private__leftPriceAxisWidget._internal_getElement())),i&&null===this._private__rightPriceAxisWidget&&(this._private__rightPriceAxisWidget=new vi(this,t._internal_options(),_,"right"),this._private__rightAxisCell.appendChild(this._private__rightPriceAxisWidget._internal_getElement()))}_private__preventScroll(t){return t._internal_isTouch&&this._private__longTap||null!==this._private__startTrackPoint}_private__correctXCoord(t){return Math.max(0,Math.min(t,this._private__size.width-1))}_private__correctYCoord(t){return Math.max(0,Math.min(t,this._private__size.height-1))}_private__setCrosshairPosition(t,e,i){this._private__model()._internal_setAndSaveCurrentPosition(this._private__correctXCoord(t),this._private__correctYCoord(e),i,o(this._private__state))}_private__clearCrosshairPosition(){this._private__model()._internal_clearCurrentPosition()}_private__tryExitTrackingMode(){this._private__exitTrackingModeOnNextTry&&(this._private__startTrackPoint=null,this._private__clearCrosshairPosition())}_private__startTrackingMode(t,e,i){this._private__startTrackPoint=t,this._private__exitTrackingModeOnNextTry=!1,this._private__setCrosshairPosition(e.x,e.y,i);const _=this._private__model()._internal_crosshairSource();this._private__initCrosshairPosition={x:_._internal_appliedX(),y:_._internal_appliedY()}}_private__model(){return this._private__chart._internal_model()}_private__endScroll(t){if(!this._private__isScrolling)return;const e=this._private__model(),i=this._internal_state();if(e._internal_endScrollPrice(i,i._internal_defaultPriceScale()),this._private__startScrollingPos=null,this._private__isScrolling=!1,e._internal_endScrollTime(),null!==this._private__scrollXAnimation){const t=performance.now(),i=e._internal_timeScale();this._private__scrollXAnimation._internal_start(i._internal_rightOffset(),t),this._private__scrollXAnimation._internal_finished(t)||e._internal_setTimeScaleAnimation(this._private__scrollXAnimation)}}_private__onMouseEvent(){this._private__startTrackPoint=null}_private__mouseTouchDownEvent(){if(this._private__state){if(this._private__model()._internal_stopTimeScaleAnimation(),document.activeElement!==document.body&&document.activeElement!==document.documentElement)o(document.activeElement).blur();else{const t=document.getSelection();null!==t&&t.removeAllRanges()}this._private__state._internal_defaultPriceScale()._internal_isEmpty()||this._private__model()._internal_timeScale()._internal_isEmpty()}}_private__pressedMouseTouchMoveEvent(t){if(null===this._private__state)return;const e=this._private__model(),i=e._internal_timeScale();if(i._internal_isEmpty())return;const _=this._private__chart._internal_options(),r=_.handleScroll,n=_.kineticScroll;if((!r.pressedMouseMove||t._internal_isTouch)&&(!r.horzTouchDrag&&!r.vertTouchDrag||!t._internal_isTouch))return;const a=this._private__state._internal_defaultPriceScale(),l=performance.now();if(null!==this._private__startScrollingPos||this._private__preventScroll(t)||(this._private__startScrollingPos={x:t.clientX,y:t.clientY,_internal_timestamp:l,_internal_localX:t.localX,_internal_localY:t.localY}),null!==this._private__startScrollingPos&&!this._private__isScrolling&&(this._private__startScrollingPos.x!==t.clientX||this._private__startScrollingPos.y!==t.clientY)){if(t._internal_isTouch&&n.touch||!t._internal_isTouch&&n.mouse){const t=i._internal_barSpacing();this._private__scrollXAnimation=new Qe(.2/t,7/t,.997,15/t),this._private__scrollXAnimation._internal_addPosition(i._internal_rightOffset(),this._private__startScrollingPos._internal_timestamp)}else this._private__scrollXAnimation=null;a._internal_isEmpty()||e._internal_startScrollPrice(this._private__state,a,t.localY),e._internal_startScrollTime(t.localX),this._private__isScrolling=!0}this._private__isScrolling&&(a._internal_isEmpty()||e._internal_scrollPriceTo(this._private__state,a,t.localY),e._internal_scrollTimeTo(t.localX),null!==this._private__scrollXAnimation&&this._private__scrollXAnimation._internal_addPosition(i._internal_rightOffset(),l))}}class Si{constructor(t,e,i,_,r){this._private__invalidated=!0,this._private__size=We({width:0,height:0}),this._private__canvasSuggestedBitmapSizeChangedHandler=()=>this._internal_paint(3),this._private__isLeft="left"===t,this._private__rendererOptionsProvider=i._internal_rendererOptionsProvider,this._private__options=e,this._private__borderVisible=_,this._private__bottomColor=r,this._private__cell=document.createElement("div"),this._private__cell.style.width="25px",this._private__cell.style.height="100%",this._private__cell.style.overflow="hidden",this._private__canvasBinding=Je(this._private__cell,We({width:16,height:16})),this._private__canvasBinding.subscribeSuggestedBitmapSizeChanged(this._private__canvasSuggestedBitmapSizeChangedHandler)}_internal_destroy(){this._private__canvasBinding.unsubscribeSuggestedBitmapSizeChanged(this._private__canvasSuggestedBitmapSizeChangedHandler),ti(this._private__canvasBinding.canvasElement),this._private__canvasBinding.dispose()}_internal_getElement(){return this._private__cell}_internal_getSize(){return this._private__size}_internal_setSize(t){Fe(this._private__size,t)||(this._private__size=t,this._private__canvasBinding.resizeCanvasElement(t),this._private__cell.style.width=`${t.width}px`,this._private__cell.style.height=`${t.height}px`,this._private__invalidated=!0)}_internal_paint(t){if(t<3&&!this._private__invalidated)return;if(0===this._private__size.width||0===this._private__size.height)return;this._private__invalidated=!1,this._private__canvasBinding.applySuggestedBitmapSize();const e=$e(this._private__canvasBinding);null!==e&&e.useBitmapCoordinateSpace((t=>{this._private__drawBackground(t),this._private__drawBorder(t)}))}_private__drawBorder({context:t,bitmapSize:e,horizontalPixelRatio:i,verticalPixelRatio:_}){if(!this._private__borderVisible())return;t.fillStyle=this._private__options.timeScale.borderColor;const r=Math.floor(this._private__rendererOptionsProvider._internal_options()._internal_borderSize*i),n=Math.floor(this._private__rendererOptionsProvider._internal_options()._internal_borderSize*_),a=this._private__isLeft?e.width-r:0;t.fillRect(a,0,r,n)}_private__drawBackground({context:t,bitmapSize:e}){P(t,0,0,e.width,e.height,this._private__bottomColor())}}function bi(t){return e=>{var i,_;return null!==(_=null===(i=e._internal_timePaneViews)||void 0===i?void 0:i.call(e,t))&&void 0!==_?_:[]}}const wi=bi("normal"),Ci=bi("top"),xi=bi("bottom");class Ti{constructor(t,e){this._private__leftStub=null,this._private__rightStub=null,this._private__rendererOptions=null,this._private__mouseDown=!1,this._private__size=We({width:0,height:0}),this._private__sizeChanged=new yt,this._private__widthCache=new vt(5),this._private__isSettingSize=!1,this._private__canvasSuggestedBitmapSizeChangedHandler=()=>{this._private__isSettingSize||this._private__chart._internal_model()._internal_lightUpdate()},this._private__topCanvasSuggestedBitmapSizeChangedHandler=()=>{this._private__isSettingSize||this._private__chart._internal_model()._internal_lightUpdate()},this._private__chart=t,this._private__horzScaleBehavior=e,this._private__options=t._internal_options().layout,this._private__element=document.createElement("tr"),this._private__leftStubCell=document.createElement("td"),this._private__leftStubCell.style.padding="0",this._private__rightStubCell=document.createElement("td"),this._private__rightStubCell.style.padding="0",this._private__cell=document.createElement("td"),this._private__cell.style.height="25px",this._private__cell.style.padding="0",this._private__dv=document.createElement("div"),this._private__dv.style.width="100%",this._private__dv.style.height="100%",this._private__dv.style.position="relative",this._private__dv.style.overflow="hidden",this._private__cell.appendChild(this._private__dv),this._private__canvasBinding=Je(this._private__dv,We({width:16,height:16})),this._private__canvasBinding.subscribeSuggestedBitmapSizeChanged(this._private__canvasSuggestedBitmapSizeChangedHandler);const i=this._private__canvasBinding.canvasElement;i.style.position="absolute",i.style.zIndex="1",i.style.left="0",i.style.top="0",this._private__topCanvasBinding=Je(this._private__dv,We({width:16,height:16})),this._private__topCanvasBinding.subscribeSuggestedBitmapSizeChanged(this._private__topCanvasSuggestedBitmapSizeChangedHandler);const _=this._private__topCanvasBinding.canvasElement;_.style.position="absolute",_.style.zIndex="2",_.style.left="0",_.style.top="0",this._private__element.appendChild(this._private__leftStubCell),this._private__element.appendChild(this._private__cell),this._private__element.appendChild(this._private__rightStubCell),this._private__recreateStubs(),this._private__chart._internal_model()._internal_priceScalesOptionsChanged()._internal_subscribe(this._private__recreateStubs.bind(this),this),this._private__mouseEventHandler=new ri(this._private__topCanvasBinding.canvasElement,this,{_internal_treatVertTouchDragAsPageScroll:()=>!0,_internal_treatHorzTouchDragAsPageScroll:()=>!this._private__chart._internal_options().handleScroll.horzTouchDrag})}_internal_destroy(){this._private__mouseEventHandler._internal_destroy(),null!==this._private__leftStub&&this._private__leftStub._internal_destroy(),null!==this._private__rightStub&&this._private__rightStub._internal_destroy(),this._private__topCanvasBinding.unsubscribeSuggestedBitmapSizeChanged(this._private__topCanvasSuggestedBitmapSizeChangedHandler),ti(this._private__topCanvasBinding.canvasElement),this._private__topCanvasBinding.dispose(),this._private__canvasBinding.unsubscribeSuggestedBitmapSizeChanged(this._private__canvasSuggestedBitmapSizeChangedHandler),ti(this._private__canvasBinding.canvasElement),this._private__canvasBinding.dispose()}_internal_getElement(){return this._private__element}_internal_mouseDownEvent(t){if(this._private__mouseDown)return;this._private__mouseDown=!0;const e=this._private__chart._internal_model();!e._internal_timeScale()._internal_isEmpty()&&this._private__chart._internal_options().handleScale.axisPressedMouseMove.time&&e._internal_startScaleTime(t.localX)}_internal_touchStartEvent(t){this._internal_mouseDownEvent(t)}_internal_mouseDownOutsideEvent(){const t=this._private__chart._internal_model();!t._internal_timeScale()._internal_isEmpty()&&this._private__mouseDown&&(this._private__mouseDown=!1,this._private__chart._internal_options().handleScale.axisPressedMouseMove.time&&t._internal_endScaleTime())}_internal_pressedMouseMoveEvent(t){const e=this._private__chart._internal_model();!e._internal_timeScale()._internal_isEmpty()&&this._private__chart._internal_options().handleScale.axisPressedMouseMove.time&&e._internal_scaleTimeTo(t.localX)}_internal_touchMoveEvent(t){this._internal_pressedMouseMoveEvent(t)}_internal_mouseUpEvent(){this._private__mouseDown=!1;const t=this._private__chart._internal_model();t._internal_timeScale()._internal_isEmpty()&&!this._private__chart._internal_options().handleScale.axisPressedMouseMove.time||t._internal_endScaleTime()}_internal_touchEndEvent(){this._internal_mouseUpEvent()}_internal_mouseDoubleClickEvent(){this._private__chart._internal_options().handleScale.axisDoubleClickReset.time&&this._private__chart._internal_model()._internal_resetTimeScale()}_internal_doubleTapEvent(){this._internal_mouseDoubleClickEvent()}_internal_mouseEnterEvent(){this._private__chart._internal_model()._internal_options().handleScale.axisPressedMouseMove.time&&this._private__setCursor(1)}_internal_mouseLeaveEvent(){this._private__setCursor(0)}_internal_getSize(){return this._private__size}_internal_setSizes(t,e,i){Fe(this._private__size,t)||(this._private__size=t,this._private__isSettingSize=!0,this._private__canvasBinding.resizeCanvasElement(t),this._private__topCanvasBinding.resizeCanvasElement(t),this._private__isSettingSize=!1,this._private__cell.style.width=`${t.width}px`,this._private__cell.style.height=`${t.height}px`,this._private__sizeChanged._internal_fire(t)),null!==this._private__leftStub&&this._private__leftStub._internal_setSize(We({width:e,height:t.height})),null!==this._private__rightStub&&this._private__rightStub._internal_setSize(We({width:i,height:t.height}))}_internal_optimalHeight(){const t=this._private__getRendererOptions();return Math.ceil(t._internal_borderSize+t._internal_tickLength+t._internal_fontSize+t._internal_paddingTop+t._internal_paddingBottom+t._internal_labelBottomOffset)}_internal_update(){this._private__chart._internal_model()._internal_timeScale()._internal_marks()}_internal_paint(t){if(0===t)return;if(1!==t){this._private__canvasBinding.applySuggestedBitmapSize();const e=$e(this._private__canvasBinding);null!==e&&(e.useBitmapCoordinateSpace((t=>{this._private__drawBackground(t),this._private__drawBorder(t),this._private__drawAdditionalSources(e,xi)})),this._private__drawTickMarks(e),this._private__drawAdditionalSources(e,wi)),null!==this._private__leftStub&&this._private__leftStub._internal_paint(t),null!==this._private__rightStub&&this._private__rightStub._internal_paint(t)}this._private__topCanvasBinding.applySuggestedBitmapSize();const e=$e(this._private__topCanvasBinding);null!==e&&(e.useBitmapCoordinateSpace((({context:t,bitmapSize:e})=>{t.clearRect(0,0,e.width,e.height)})),this._private__drawLabels([...this._private__chart._internal_model()._internal_serieses(),this._private__chart._internal_model()._internal_crosshairSource()],e),this._private__drawAdditionalSources(e,Ci))}_private__drawAdditionalSources(t,e){const i=this._private__chart._internal_model()._internal_serieses();for(const _ of i)_i(e,(e=>ei(e,t,!1,void 0)),_,void 0);for(const _ of i)_i(e,(e=>ii(e,t,!1,void 0)),_,void 0)}_private__drawBackground({context:t,bitmapSize:e}){P(t,0,0,e.width,e.height,this._private__chart._internal_model()._internal_backgroundBottomColor())}_private__drawBorder({context:t,bitmapSize:e,verticalPixelRatio:i}){if(this._private__chart._internal_options().timeScale.borderVisible){t.fillStyle=this._private__lineColor();const _=Math.max(1,Math.floor(this._private__getRendererOptions()._internal_borderSize*i));t.fillRect(0,0,e.width,_)}}_private__drawTickMarks(t){const e=this._private__chart._internal_model()._internal_timeScale(),i=e._internal_marks();if(!i||0===i.length)return;const _=this._private__horzScaleBehavior.maxTickMarkWeight(i),r=this._private__getRendererOptions(),n=e._internal_options();n.borderVisible&&n.ticksVisible&&t.useBitmapCoordinateSpace((({context:t,horizontalPixelRatio:e,verticalPixelRatio:_})=>{t.strokeStyle=this._private__lineColor(),t.fillStyle=this._private__lineColor();const n=Math.max(1,Math.floor(e)),a=Math.floor(.5*e);t.beginPath();const l=Math.round(r._internal_tickLength*_);for(let _=i.length;_--;){const r=Math.round(i[_].coord*e);t.rect(r-a,0,n,l)}t.fill()})),t.useMediaCoordinateSpace((({context:t})=>{const e=r._internal_borderSize+r._internal_tickLength+r._internal_paddingTop+r._internal_fontSize/2;t.textAlign="center",t.textBaseline="middle",t.fillStyle=this._private__textColor(),t.font=this._private__baseFont();for(const r of i)if(r.weight<_){const i=r.needAlignCoordinate?this._private__alignTickMarkLabelCoordinate(t,r.coord,r.label):r.coord;t.fillText(r.label,i,e)}this._private__chart._internal_options().timeScale.allowBoldLabels&&(t.font=this._private__baseBoldFont());for(const r of i)if(r.weight>=_){const i=r.needAlignCoordinate?this._private__alignTickMarkLabelCoordinate(t,r.coord,r.label):r.coord;t.fillText(r.label,i,e)}}))}_private__alignTickMarkLabelCoordinate(t,e,i){const _=this._private__widthCache._internal_measureText(t,i),r=_/2,n=Math.floor(e-r)+.5;return n<0?e+=Math.abs(0-n):n+_>this._private__size.width&&(e-=Math.abs(this._private__size.width-(n+_))),e}_private__drawLabels(t,e){const i=this._private__getRendererOptions();for(const _ of t)for(const t of _._internal_timeAxisViews())t._internal_renderer()._internal_draw(e,i)}_private__lineColor(){return this._private__chart._internal_options().timeScale.borderColor}_private__textColor(){return this._private__options.textColor}_private__fontSize(){return this._private__options.fontSize}_private__baseFont(){return kt(this._private__fontSize(),this._private__options.fontFamily)}_private__baseBoldFont(){return kt(this._private__fontSize(),this._private__options.fontFamily,"bold")}_private__getRendererOptions(){null===this._private__rendererOptions&&(this._private__rendererOptions={_internal_borderSize:1,_internal_baselineOffset:NaN,_internal_paddingTop:NaN,_internal_paddingBottom:NaN,_internal_paddingHorizontal:NaN,_internal_tickLength:5,_internal_fontSize:NaN,_internal_font:"",_internal_widthCache:new vt,_internal_labelBottomOffset:0});const t=this._private__rendererOptions,e=this._private__baseFont();if(t._internal_font!==e){const i=this._private__fontSize();t._internal_fontSize=i,t._internal_font=e,t._internal_paddingTop=3*i/12,t._internal_paddingBottom=3*i/12,t._internal_paddingHorizontal=9*i/12,t._internal_baselineOffset=0,t._internal_labelBottomOffset=4*i/12,t._internal_widthCache._internal_reset()}return this._private__rendererOptions}_private__setCursor(t){this._private__cell.style.cursor=1===t?"ew-resize":"default"}_private__recreateStubs(){const t=this._private__chart._internal_model(),e=t._internal_options();e.leftPriceScale.visible||null===this._private__leftStub||(this._private__leftStubCell.removeChild(this._private__leftStub._internal_getElement()),this._private__leftStub._internal_destroy(),this._private__leftStub=null),e.rightPriceScale.visible||null===this._private__rightStub||(this._private__rightStubCell.removeChild(this._private__rightStub._internal_getElement()),this._private__rightStub._internal_destroy(),this._private__rightStub=null);const i={_internal_rendererOptionsProvider:this._private__chart._internal_model()._internal_rendererOptionsProvider()},_=()=>e.leftPriceScale.borderVisible&&t._internal_timeScale()._internal_options().borderVisible,r=()=>t._internal_backgroundBottomColor();e.leftPriceScale.visible&&null===this._private__leftStub&&(this._private__leftStub=new Si("left",e,i,_,r),this._private__leftStubCell.appendChild(this._private__leftStub._internal_getElement())),e.rightPriceScale.visible&&null===this._private__rightStub&&(this._private__rightStub=new Si("right",e,i,_,r),this._private__rightStubCell.appendChild(this._private__rightStub._internal_getElement()))}}const Pi=!!je&&!!navigator.userAgentData&&navigator.userAgentData.brands.some((t=>t.brand.includes("Chromium")))&&!!je&&((null===(yi=null===navigator||void 0===navigator?void 0:navigator.userAgentData)||void 0===yi?void 0:yi.platform)?"Windows"===navigator.userAgentData.platform:navigator.userAgent.toLowerCase().indexOf("win")>=0);var yi;class Mi{constructor(t,e,i){this._private__paneWidgets=[],this._private__drawRafId=0,this._private__height=0,this._private__width=0,this._private__leftPriceAxisWidth=0,this._private__rightPriceAxisWidth=0,this._private__invalidateMask=null,this._private__drawPlanned=!1,this._private__clicked=new yt,this._private__dblClicked=new yt,this._private__crosshairMoved=new yt,this._private__observer=null,this._private__cursorStyleOverride=null,this._private__options=e,this._private__horzScaleBehavior=i,this._private__element=document.createElement("div"),this._private__element.classList.add("tv-lightweight-charts"),this._private__element.style.overflow="hidden",this._private__element.style.direction="ltr",this._private__element.style.width="100%",this._private__element.style.height="100%",this._private__tableElement=document.createElement("table"),this._private__tableElement.setAttribute("cellspacing","0"),this._private__element.appendChild(this._private__tableElement),this._private__onWheelBound=this._private__onMousewheel.bind(this),ki(this._private__options)&&this._private__setMouseWheelEventListener(!0),this._private__model=new Me(this._private__invalidateHandler.bind(this),this._private__options,i),this._internal_model()._internal_crosshairMoved()._internal_subscribe(this._private__onPaneWidgetCrosshairMoved.bind(this),this),this._private__timeAxisWidget=new Ti(this,this._private__horzScaleBehavior),this._private__tableElement.appendChild(this._private__timeAxisWidget._internal_getElement());const _=e.autoSize&&this._private__installObserver();let r=this._private__options.width,n=this._private__options.height;if(_||0===r||0===n){const e=t.getBoundingClientRect();r=r||e.width,n=n||e.height}this._internal_resize(r,n),this._private__syncGuiWithModel(),t.appendChild(this._private__element),this._private__updateTimeAxisVisibility(),this._private__model._internal_timeScale()._internal_optionsApplied()._internal_subscribe(this._private__model._internal_fullUpdate.bind(this._private__model),this),this._private__model._internal_priceScalesOptionsChanged()._internal_subscribe(this._private__model._internal_fullUpdate.bind(this._private__model),this)}_internal_model(){return this._private__model}_internal_options(){return this._private__options}_internal_timeAxisWidget(){return this._private__timeAxisWidget}_internal_destroy(){this._private__setMouseWheelEventListener(!1),0!==this._private__drawRafId&&window.cancelAnimationFrame(this._private__drawRafId),this._private__model._internal_crosshairMoved()._internal_unsubscribeAll(this),this._private__model._internal_timeScale()._internal_optionsApplied()._internal_unsubscribeAll(this),this._private__model._internal_priceScalesOptionsChanged()._internal_unsubscribeAll(this),this._private__model._internal_destroy();for(const t of this._private__paneWidgets)this._private__tableElement.removeChild(t._internal_getElement()),t._internal_clicked()._internal_unsubscribeAll(this),t._internal_dblClicked()._internal_unsubscribeAll(this),t._internal_destroy();this._private__paneWidgets=[],o(this._private__timeAxisWidget)._internal_destroy(),null!==this._private__element.parentElement&&this._private__element.parentElement.removeChild(this._private__element),this._private__crosshairMoved._internal_destroy(),this._private__clicked._internal_destroy(),this._private__dblClicked._internal_destroy(),this._private__uninstallObserver()}_internal_resize(t,e,i=!1){if(this._private__height===e&&this._private__width===t)return;const _=function(t){const e=Math.floor(t.width),i=Math.floor(t.height);return We({width:e-e%2,height:i-i%2})}(We({width:t,height:e}));this._private__height=_.height,this._private__width=_.width;const r=this._private__height+"px",n=this._private__width+"px";o(this._private__element).style.height=r,o(this._private__element).style.width=n,this._private__tableElement.style.height=r,this._private__tableElement.style.width=n,i?this._private__drawImpl(zt._internal_full(),performance.now()):this._private__model._internal_fullUpdate()}_internal_paint(t){void 0===t&&(t=zt._internal_full());for(let e=0;e<this._private__paneWidgets.length;e++)this._private__paneWidgets[e]._internal_paint(t._internal_invalidateForPane(e)._internal_level);this._private__options.timeScale.visible&&this._private__timeAxisWidget._internal_paint(t._internal_fullInvalidation())}_internal_applyOptions(t){const e=ki(this._private__options);this._private__model._internal_applyOptions(t);const i=ki(this._private__options);i!==e&&this._private__setMouseWheelEventListener(i),this._private__updateTimeAxisVisibility(),this._private__applyAutoSizeOptions(t)}_internal_clicked(){return this._private__clicked}_internal_dblClicked(){return this._private__dblClicked}_internal_crosshairMoved(){return this._private__crosshairMoved}_internal_getPriceAxisWidth(t){return("left"!==t||this._private__isLeftAxisVisible())&&("right"!==t||this._private__isRightAxisVisible())?0===this._private__paneWidgets.length?0:o("left"===t?this._private__paneWidgets[0]._internal_leftPriceAxisWidget():this._private__paneWidgets[0]._internal_rightPriceAxisWidget())._internal_getWidth():0}_internal_element(){return this._private__element}_internal_setCursorStyle(t){this._private__cursorStyleOverride=t,this._private__cursorStyleOverride?this._internal_element().style.setProperty("cursor",t):this._internal_element().style.removeProperty("cursor")}_private__applyAutoSizeOptions(t){t.autoSize&&!this._private__observer&&this._private__installObserver(),t.autoSize||void 0===t.width&&void 0===t.height||this._internal_resize(t.width||this._private__width,t.height||this._private__height)}_private__adjustSizeImpl(){let t=0,e=0,i=0;for(const _ of this._private__paneWidgets)this._private__isLeftAxisVisible()&&(e=Math.max(e,o(_._internal_leftPriceAxisWidget())._internal_optimalWidth(),this._private__options.leftPriceScale.minimumWidth)),this._private__isRightAxisVisible()&&(i=Math.max(i,o(_._internal_rightPriceAxisWidget())._internal_optimalWidth(),this._private__options.rightPriceScale.minimumWidth)),t+=_._internal_stretchFactor();e=Ke(e),i=Ke(i);const _=this._private__width,r=this._private__height,n=Math.max(_-e-i,0),a=this._private__options.timeScale.visible;let l=a?Math.max(this._private__timeAxisWidget._internal_optimalHeight(),this._private__options.timeScale.minimumHeight):0;var s;l=(s=l)+s%2;const h=0+l,p=r<h?0:r-h,c=p/t;let v=0;for(let t=0;t<this._private__paneWidgets.length;++t){const _=this._private__paneWidgets[t];_._internal_setState(this._private__model._internal_panes()[t]);let r=0,a=0;a=t===this._private__paneWidgets.length-1?p-v:Math.round(_._internal_stretchFactor()*c),r=Math.max(a,2),v+=r,_._internal_setSize(We({width:n,height:r})),this._private__isLeftAxisVisible()&&_._internal_setPriceAxisSize(e,"left"),this._private__isRightAxisVisible()&&_._internal_setPriceAxisSize(i,"right"),_._internal_state()&&this._private__model._internal_setPaneHeight(_._internal_state(),r)}this._private__timeAxisWidget._internal_setSizes(We({width:a?n:0,height:l}),a?e:0,a?i:0),this._private__model._internal_setWidth(n),this._private__leftPriceAxisWidth!==e&&(this._private__leftPriceAxisWidth=e),this._private__rightPriceAxisWidth!==i&&(this._private__rightPriceAxisWidth=i)}_private__setMouseWheelEventListener(t){t?this._private__element.addEventListener("wheel",this._private__onWheelBound,{passive:!1}):this._private__element.removeEventListener("wheel",this._private__onWheelBound)}_private__determineWheelSpeedAdjustment(t){switch(t.deltaMode){case t.DOM_DELTA_PAGE:return 120;case t.DOM_DELTA_LINE:return 32}return Pi?1/window.devicePixelRatio:1}_private__onMousewheel(t){if(!(0!==t.deltaX&&this._private__options.handleScroll.mouseWheel||0!==t.deltaY&&this._private__options.handleScale.mouseWheel))return;const e=this._private__determineWheelSpeedAdjustment(t),i=e*t.deltaX/100,_=-e*t.deltaY/100;if(t.cancelable&&t.preventDefault(),0!==_&&this._private__options.handleScale.mouseWheel){const e=Math.sign(_)*Math.min(1,Math.abs(_)),i=t.clientX-this._private__element.getBoundingClientRect().left;this._internal_model()._internal_zoomTime(i,e)}0!==i&&this._private__options.handleScroll.mouseWheel&&this._internal_model()._internal_scrollChart(-80*i)}_private__drawImpl(t,e){var i;const _=t._internal_fullInvalidation();3===_&&this._private__updateGui(),3!==_&&2!==_||(this._private__applyMomentaryAutoScale(t),this._private__applyTimeScaleInvalidations(t,e),this._private__timeAxisWidget._internal_update(),this._private__paneWidgets.forEach((t=>{t._internal_updatePriceAxisWidgets()})),3===(null===(i=this._private__invalidateMask)||void 0===i?void 0:i._internal_fullInvalidation())&&(this._private__invalidateMask._internal_merge(t),this._private__updateGui(),this._private__applyMomentaryAutoScale(this._private__invalidateMask),this._private__applyTimeScaleInvalidations(this._private__invalidateMask,e),t=this._private__invalidateMask,this._private__invalidateMask=null)),this._internal_paint(t)}_private__applyTimeScaleInvalidations(t,e){for(const i of t._internal_timeScaleInvalidations())this._private__applyTimeScaleInvalidation(i,e)}_private__applyMomentaryAutoScale(t){const e=this._private__model._internal_panes();for(let i=0;i<e.length;i++)t._internal_invalidateForPane(i)._internal_autoScale&&e[i]._internal_momentaryAutoScale()}_private__applyTimeScaleInvalidation(t,e){const i=this._private__model._internal_timeScale();switch(t._internal_type){case 0:i._internal_fitContent();break;case 1:i._internal_setLogicalRange(t._internal_value);break;case 2:i._internal_setBarSpacing(t._internal_value);break;case 3:i._internal_setRightOffset(t._internal_value);break;case 4:i._internal_restoreDefault();break;case 5:t._internal_value._internal_finished(e)||i._internal_setRightOffset(t._internal_value._internal_getPosition(e))}}_private__invalidateHandler(t){null!==this._private__invalidateMask?this._private__invalidateMask._internal_merge(t):this._private__invalidateMask=t,this._private__drawPlanned||(this._private__drawPlanned=!0,this._private__drawRafId=window.requestAnimationFrame((t=>{if(this._private__drawPlanned=!1,this._private__drawRafId=0,null!==this._private__invalidateMask){const e=this._private__invalidateMask;this._private__invalidateMask=null,this._private__drawImpl(e,t);for(const i of e._internal_timeScaleInvalidations())if(5===i._internal_type&&!i._internal_value._internal_finished(t)){this._internal_model()._internal_setTimeScaleAnimation(i._internal_value);break}}})))}_private__updateGui(){this._private__syncGuiWithModel()}_private__syncGuiWithModel(){const t=this._private__model._internal_panes(),e=t.length,i=this._private__paneWidgets.length;for(let t=e;t<i;t++){const t=s(this._private__paneWidgets.pop());this._private__tableElement.removeChild(t._internal_getElement()),t._internal_clicked()._internal_unsubscribeAll(this),t._internal_dblClicked()._internal_unsubscribeAll(this),t._internal_destroy()}for(let _=i;_<e;_++){const e=new fi(this,t[_]);e._internal_clicked()._internal_subscribe(this._private__onPaneWidgetClicked.bind(this),this),e._internal_dblClicked()._internal_subscribe(this._private__onPaneWidgetDblClicked.bind(this),this),this._private__paneWidgets.push(e),this._private__tableElement.insertBefore(e._internal_getElement(),this._private__timeAxisWidget._internal_getElement())}for(let i=0;i<e;i++){const e=t[i],_=this._private__paneWidgets[i];_._internal_state()!==e?_._internal_setState(e):_._internal_updatePriceAxisWidgetsStates()}this._private__updateTimeAxisVisibility(),this._private__adjustSizeImpl()}_private__getMouseEventParamsImpl(t,e,i){var _;const r=new Map;let n;if(null!==t&&this._private__model._internal_serieses().forEach((e=>{const i=e._internal_bars()._internal_search(t);null!==i&&r.set(e,i)})),null!==t){const e=null===(_=this._private__model._internal_timeScale()._internal_indexToTimeScalePoint(t))||void 0===_?void 0:_.originalTime;void 0!==e&&(n=e)}const a=this._internal_model()._internal_hoveredSource(),l=null!==a&&a._internal_source instanceof Gt?a._internal_source:void 0,s=null!==a&&void 0!==a._internal_object?a._internal_object._internal_externalId:void 0;return{_internal_originalTime:n,_internal_index:null!=t?t:void 0,_internal_point:null!=e?e:void 0,_internal_hoveredSeries:l,_internal_seriesData:r,_internal_hoveredObject:s,_internal_touchMouseEventData:null!=i?i:void 0}}_private__onPaneWidgetClicked(t,e,i){this._private__clicked._internal_fire((()=>this._private__getMouseEventParamsImpl(t,e,i)))}_private__onPaneWidgetDblClicked(t,e,i){this._private__dblClicked._internal_fire((()=>this._private__getMouseEventParamsImpl(t,e,i)))}_private__onPaneWidgetCrosshairMoved(t,e,i){this._private__crosshairMoved._internal_fire((()=>this._private__getMouseEventParamsImpl(t,e,i)))}_private__updateTimeAxisVisibility(){this._private__timeAxisWidget._internal_getElement().style.display=this._private__options.timeScale.visible?"":"none"}_private__isLeftAxisVisible(){return this._private__paneWidgets[0]._internal_state()._internal_leftPriceScale()._internal_options().visible}_private__isRightAxisVisible(){return this._private__paneWidgets[0]._internal_state()._internal_rightPriceScale()._internal_options().visible}}function ki(t){return Boolean(t.handleScroll.mouseWheel||t.handleScale.mouseWheel)}function Ei(t){return void 0!==t.open||void 0!==t.value}function zi(t,e,i,_){const r=i.value,n={_internal_index:e,_internal_time:t,_internal_value:[r,r,r,r],_internal_originalTime:_};return void 0!==i.color&&(n._internal_color=i.color),n}function Ri(t,e,i,_){const r=i.value,n={_internal_index:e,_internal_time:t,_internal_value:[r,r,r,r],_internal_originalTime:_};return void 0!==i.lineColor&&(n._internal_lineColor=i.lineColor),void 0!==i.topColor&&(n._internal_topColor=i.topColor),void 0!==i.bottomColor&&(n._internal_bottomColor=i.bottomColor),n}function Bi(t,e,i,_){const r=i.value,n={_internal_index:e,_internal_time:t,_internal_value:[r,r,r,r],_internal_originalTime:_};return void 0!==i.topLineColor&&(n._internal_topLineColor=i.topLineColor),void 0!==i.bottomLineColor&&(n._internal_bottomLineColor=i.bottomLineColor),void 0!==i.topFillColor1&&(n._internal_topFillColor1=i.topFillColor1),void 0!==i.topFillColor2&&(n._internal_topFillColor2=i.topFillColor2),void 0!==i.bottomFillColor1&&(n._internal_bottomFillColor1=i.bottomFillColor1),void 0!==i.bottomFillColor2&&(n._internal_bottomFillColor2=i.bottomFillColor2),n}function Ai(t,e,i,_){const r={_internal_index:e,_internal_time:t,_internal_value:[i.open,i.high,i.low,i.close],_internal_originalTime:_};return void 0!==i.color&&(r._internal_color=i.color),r}function Vi(t,e,i,_){const r={_internal_index:e,_internal_time:t,_internal_value:[i.open,i.high,i.low,i.close],_internal_originalTime:_};return void 0!==i.color&&(r._internal_color=i.color),void 0!==i.borderColor&&(r._internal_borderColor=i.borderColor),void 0!==i.wickColor&&(r._internal_wickColor=i.wickColor),r}function Ii(t,e,i,_,r){const n=s(r)(i),a=Math.max(...n),l=Math.min(...n),o=n[n.length-1],h=[o,a,l,o],p=i,{color:c}=p;return{_internal_index:e,_internal_time:t,_internal_value:h,_internal_originalTime:_,_internal_data:function(t,e){let i,_;const r={};for(_ in t)Object.prototype.hasOwnProperty.call(t,_)&&e.indexOf(_)<0&&(r[_]=t[_]);for(null!=t&&"function"==typeof Object.getOwnPropertySymbols&&(i=0),_=Object.getOwnPropertySymbols(t);i<_.length;i++)e.indexOf(_[i])<0&&Object.prototype.propertyIsEnumerable.call(t,_[i])&&(r[_[i]]=t[_[i]]);return r}(p,["time","color"]),_internal_color:c}}function Di(t){return void 0!==t._internal_value}function Oi(t,e){return void 0!==e.customValues&&(t._internal_customValues=e.customValues),t}function Li(t){return(e,i,_,r,n,a)=>function(t,e){return e?e(t):function(t){return void 0===t.open&&void 0===t.value}(t)}(_,a)?Oi({_internal_time:e,_internal_index:i,_internal_originalTime:r},_):Oi(t(e,i,_,r,n),_)}function Wi(t,e){if(void 0!==t&&0!==t.length)return{_internal_firstTime:e.key(t[0]._internal_time),_internal_lastTime:e.key(t[t.length-1]._internal_time)}}function Fi(t){let e;return t.forEach((t=>{void 0===e&&(e=t._internal_originalTime)})),s(e)}class Ni{constructor(t){this._private__pointDataByTimePoint=new Map,this._private__seriesRowsBySeries=new Map,this._private__seriesLastTimePoint=new Map,this._private__sortedTimePoints=[],this._private__horzScaleBehavior=t}_internal_destroy(){this._private__pointDataByTimePoint.clear(),this._private__seriesRowsBySeries.clear(),this._private__seriesLastTimePoint.clear(),this._private__sortedTimePoints=[]}_internal_setSeriesData(t,e){let i=0!==this._private__pointDataByTimePoint.size,_=!1;const r=this._private__seriesRowsBySeries.get(t);if(void 0!==r)if(1===this._private__seriesRowsBySeries.size)i=!1,_=!0,this._private__pointDataByTimePoint.clear();else for(const e of this._private__sortedTimePoints)e.pointData._internal_mapping.delete(t)&&(_=!0);let n=[];if(0!==e.length){const i=e.map((t=>t.time)),r=this._private__horzScaleBehavior.createConverterToInternalObj(e),l=(a=t._internal_seriesType(),{Candlestick:Li(Vi),Bar:Li(Ai),Area:Li(Ri),Baseline:Li(Bi),Histogram:Li(zi),Line:Li(zi),Custom:Li(Ii)}[a]),s=t._internal_customSeriesPlotValuesBuilder(),o=t._internal_customSeriesWhitespaceCheck();n=e.map(((e,n)=>{const a=r(e.time),h=this._private__horzScaleBehavior.key(a);let p=this._private__pointDataByTimePoint.get(h);var c;void 0===p&&(c=a,p={_internal_index:0,_internal_mapping:new Map,_internal_timePoint:c},this._private__pointDataByTimePoint.set(h,p),_=!0);const v=l(a,p._internal_index,e,i[n],s,o);return p._internal_mapping.set(t,v),v}))}var a;i&&this._private__cleanupPointsData(),this._private__setRowsToSeries(t,n);let l=-1;if(_){const t=[];this._private__pointDataByTimePoint.forEach((e=>{t.push({timeWeight:0,time:e._internal_timePoint,pointData:e,originalTime:Fi(e._internal_mapping)})})),t.sort(((t,e)=>this._private__horzScaleBehavior.key(t.time)-this._private__horzScaleBehavior.key(e.time))),l=this._private__replaceTimeScalePoints(t)}return this._private__getUpdateResponse(t,l,function(t,e,i){const _=Wi(t,i),r=Wi(e,i);if(void 0!==_&&void 0!==r)return{_internal_lastBarUpdatedOrNewBarsAddedToTheRight:_._internal_lastTime>=r._internal_lastTime&&_._internal_firstTime>=r._internal_firstTime}}(this._private__seriesRowsBySeries.get(t),r,this._private__horzScaleBehavior))}_private__setRowsToSeries(t,e){0!==e.length?(this._private__seriesRowsBySeries.set(t,e.filter(Di)),this._private__seriesLastTimePoint.set(t,e[e.length-1]._internal_time)):(this._private__seriesRowsBySeries.delete(t),this._private__seriesLastTimePoint.delete(t))}_private__cleanupPointsData(){for(const t of this._private__sortedTimePoints)0===t.pointData._internal_mapping.size&&this._private__pointDataByTimePoint.delete(this._private__horzScaleBehavior.key(t.time))}_private__replaceTimeScalePoints(t){let e=-1;for(let i=0;i<this._private__sortedTimePoints.length&&i<t.length;++i){const _=this._private__sortedTimePoints[i],r=t[i];if(this._private__horzScaleBehavior.key(_.time)!==this._private__horzScaleBehavior.key(r.time)){e=i;break}r.timeWeight=_.timeWeight,Hi(r.pointData,i)}if(-1===e&&this._private__sortedTimePoints.length!==t.length&&(e=Math.min(this._private__sortedTimePoints.length,t.length)),-1===e)return-1;for(let i=e;i<t.length;++i)Hi(t[i].pointData,i);return this._private__horzScaleBehavior.fillWeightsForPoints(t,e),this._private__sortedTimePoints=t,e}_private__getBaseIndex(){if(0===this._private__seriesRowsBySeries.size)return null;let t=0;return this._private__seriesRowsBySeries.forEach((e=>{0!==e.length&&(t=Math.max(t,e[e.length-1]._internal_index))})),t}_private__getUpdateResponse(t,e,i){const _={_internal_series:new Map,_internal_timeScale:{_internal_baseIndex:this._private__getBaseIndex()}};if(-1!==e)this._private__seriesRowsBySeries.forEach(((e,r)=>{_._internal_series.set(r,{_internal_data:e,_internal_info:r===t?i:void 0})})),this._private__seriesRowsBySeries.has(t)||_._internal_series.set(t,{_internal_data:[],_internal_info:i}),_._internal_timeScale._internal_points=this._private__sortedTimePoints,_._internal_timeScale._internal_firstChangedPointIndex=e;else{const e=this._private__seriesRowsBySeries.get(t);_._internal_series.set(t,{_internal_data:e||[],_internal_info:i})}return _}}function Hi(t,e){t._internal_index=e,t._internal_mapping.forEach((t=>{t._internal_index=e}))}function Ui(t){const e={value:t._internal_value[3],time:t._internal_originalTime};return void 0!==t._internal_customValues&&(e.customValues=t._internal_customValues),e}function Yi(t){const e=Ui(t);return void 0!==t._internal_color&&(e.color=t._internal_color),e}function $i(t){const e=Ui(t);return void 0!==t._internal_lineColor&&(e.lineColor=t._internal_lineColor),void 0!==t._internal_topColor&&(e.topColor=t._internal_topColor),void 0!==t._internal_bottomColor&&(e.bottomColor=t._internal_bottomColor),e}function ji(t){const e=Ui(t);return void 0!==t._internal_topLineColor&&(e.topLineColor=t._internal_topLineColor),void 0!==t._internal_bottomLineColor&&(e.bottomLineColor=t._internal_bottomLineColor),void 0!==t._internal_topFillColor1&&(e.topFillColor1=t._internal_topFillColor1),void 0!==t._internal_topFillColor2&&(e.topFillColor2=t._internal_topFillColor2),void 0!==t._internal_bottomFillColor1&&(e.bottomFillColor1=t._internal_bottomFillColor1),void 0!==t._internal_bottomFillColor2&&(e.bottomFillColor2=t._internal_bottomFillColor2),e}function Xi(t){const e={open:t._internal_value[0],high:t._internal_value[1],low:t._internal_value[2],close:t._internal_value[3],time:t._internal_originalTime};return void 0!==t._internal_customValues&&(e.customValues=t._internal_customValues),e}function Gi(t){const e=Xi(t);return void 0!==t._internal_color&&(e.color=t._internal_color),e}function Ki(t){const e=Xi(t),{_internal_color:i,_internal_borderColor:_,_internal_wickColor:r}=t;return void 0!==i&&(e.color=i),void 0!==_&&(e.borderColor=_),void 0!==r&&(e.wickColor=r),e}function Zi(t){return{Area:$i,Line:Yi,Baseline:ji,Histogram:Yi,Bar:Gi,Candlestick:Ki,Custom:qi}[t]}function qi(t){const e=t._internal_originalTime;return Object.assign(Object.assign({},t._internal_data),{time:e})}const Qi={vertLine:{color:"#9598A1",width:1,style:3,visible:!0,labelVisible:!0,labelBackgroundColor:"#131722"},horzLine:{color:"#9598A1",width:1,style:3,visible:!0,labelVisible:!0,labelBackgroundColor:"#131722"},mode:0},Ji={vertLines:{color:"#D6DCDE",style:0,visible:!0},horzLines:{color:"#D6DCDE",style:0,visible:!0}},t_={background:{type:"solid",color:"#FFFFFF"},textColor:"#191919",fontSize:12,fontFamily:Mt},e_={autoScale:!0,mode:0,invertScale:!1,alignLabels:!0,borderVisible:!0,borderColor:"#2B2B43",entireTextOnly:!1,visible:!1,ticksVisible:!1,scaleMargins:{bottom:.1,top:.2},minimumWidth:0},i_={rightOffset:0,barSpacing:6,minBarSpacing:.5,fixLeftEdge:!1,fixRightEdge:!1,lockVisibleTimeRangeOnResize:!1,rightBarStaysOnScroll:!1,borderVisible:!0,borderColor:"#2B2B43",visible:!0,timeVisible:!1,secondsVisible:!0,shiftVisibleRangeOnNewBar:!0,allowShiftVisibleRangeOnWhitespaceReplacement:!1,ticksVisible:!1,uniformDistribution:!1,minimumHeight:0,allowBoldLabels:!0},__={color:"rgba(0, 0, 0, 0)",visible:!1,fontSize:48,fontFamily:Mt,fontStyle:"",text:"",horzAlign:"center",vertAlign:"center"};function r_(){return{width:0,height:0,autoSize:!1,layout:t_,crosshair:Qi,grid:Ji,overlayPriceScales:Object.assign({},e_),leftPriceScale:Object.assign(Object.assign({},e_),{visible:!1}),rightPriceScale:Object.assign(Object.assign({},e_),{visible:!0}),timeScale:i_,watermark:__,localization:{locale:je?navigator.language:"",dateFormat:"dd MMM 'yy"},handleScroll:{mouseWheel:!0,pressedMouseMove:!0,horzTouchDrag:!0,vertTouchDrag:!0},handleScale:{axisPressedMouseMove:{time:!0,price:!0},axisDoubleClickReset:{time:!0,price:!0},mouseWheel:!0,pinch:!0},kineticScroll:{mouse:!1,touch:!0},trackingMode:{exitMode:1}}}class n_{constructor(t,e){this._private__chartWidget=t,this._private__priceScaleId=e}applyOptions(t){this._private__chartWidget._internal_model()._internal_applyPriceScaleOptions(this._private__priceScaleId,t)}options(){return this._private__priceScale()._internal_options()}width(){return Et(this._private__priceScaleId)?this._private__chartWidget._internal_getPriceAxisWidth(this._private__priceScaleId):0}_private__priceScale(){return o(this._private__chartWidget._internal_model()._internal_findPriceScale(this._private__priceScaleId))._internal_priceScale}}function a_(t,e){e.forEach(function(t){switch(t){case"Candlestick":return l_.bind(null,t);case"Line":return s_.bind(null,t)}}(t))}function l_(t,e){Ei(e)&&(l("number"==typeof e.open,`${t} series item data value of open must be a number, got=${typeof e.open}, value=${e.open}`),l("number"==typeof e.high,`${t} series item data value of high must be a number, got=${typeof e.high}, value=${e.high}`),l("number"==typeof e.low,`${t} series item data value of low must be a number, got=${typeof e.low}, value=${e.low}`),l("number"==typeof e.close,`${t} series item data value of close must be a number, got=${typeof e.close}, value=${e.close}`))}function s_(t,e){Ei(e)&&l("number"==typeof e.value,`${t} series item data value must be a number, got=${typeof e.value}, value=${e.value}`)}class o_{constructor(t,e,i,_,r){this._private__dataChangedDelegate=new yt,this._internal__series=t,this._internal__dataUpdatesConsumer=e,this._private__horzScaleBehavior=r}_internal_destroy(){this._private__dataChangedDelegate._internal_destroy()}priceFormatter(){return this._internal__series._internal_formatter()}setData(t){!function(t,e,i=!1){if(0===t.length)return;let _=e.key(t[0].time);for(let r=1;r<t.length;++r){const n=e.key(t[r].time);l(i?_<=n:_<n,`data must be asc ordered by time, index=${r}, time=${n}, prev time=${_}`),_=n}}(t,this._private__horzScaleBehavior),a_(this._internal__series._internal_seriesType(),t),this._internal__dataUpdatesConsumer._internal_applyNewData(this._internal__series,t),this._private__onDataChanged("full")}data(){const t=Zi(this.seriesType());return this._internal__series._internal_bars()._internal_rows().map((e=>t(e)))}applyOptions(t){this._internal__series._internal_applyOptions(t)}options(){return r(this._internal__series._internal_options())}seriesType(){return this._internal__series._internal_seriesType()}_private__onDataChanged(t){this._private__dataChangedDelegate._internal_hasListeners()&&this._private__dataChangedDelegate._internal_fire(t)}}class h_{constructor(t,e,i){this._private__timeRangeChanged=new yt,this._private__logicalRangeChanged=new yt,this._private__sizeChanged=new yt,this._private__model=t,this._private__timeScale=t._internal_timeScale(),this._private__timeAxisWidget=e,this._private__horzScaleBehavior=i}_internal_destroy(){this._private__timeRangeChanged._internal_destroy(),this._private__logicalRangeChanged._internal_destroy(),this._private__sizeChanged._internal_destroy()}scrollToRealTime(){this._private__timeScale._internal_scrollToRealTime()}setVisibleRange(t){const e={from:this._private__horzScaleBehavior.convertHorzItemToInternal(t.from),to:this._private__horzScaleBehavior.convertHorzItemToInternal(t.to)},i=this._private__timeScale._internal_logicalRangeForTimeRange(e);this._private__model._internal_setTargetLogicalRange(i)}width(){return this._private__timeAxisWidget._internal_getSize().width}height(){return this._private__timeAxisWidget._internal_getSize().height}applyOptions(t){this._private__timeScale._internal_applyOptions(t)}options(){return Object.assign(Object.assign({},r(this._private__timeScale._internal_options())),{barSpacing:this._private__timeScale._internal_barSpacing()})}}function p_(t){return function(t){if(_(t.handleScale)){const e=t.handleScale;t.handleScale={axisDoubleClickReset:{time:e,price:e},axisPressedMouseMove:{time:e,price:e},mouseWheel:e,pinch:e}}else if(void 0!==t.handleScale){const{axisPressedMouseMove:e,axisDoubleClickReset:i}=t.handleScale;_(e)&&(t.handleScale.axisPressedMouseMove={time:e,price:e}),_(i)&&(t.handleScale.axisDoubleClickReset={time:i,price:i})}const e=t.handleScroll;_(e)&&(t.handleScroll={horzTouchDrag:e,vertTouchDrag:e,mouseWheel:e,pressedMouseMove:e})}(t),t}class c_{constructor(t,e,i){this._private__seriesMap=new Map,this._private__seriesMapReversed=new Map,this._private__clickedDelegate=new yt,this._private__dblClickedDelegate=new yt,this._private__crosshairMovedDelegate=new yt,this._private__dataLayer=new Ni(e);const _=void 0===i?r(r_()):p(r(r_()),p_(i));this._private__horzScaleBehavior=e,this._private__chartWidget=new Mi(t,_,e),this._private__chartWidget._internal_clicked()._internal_subscribe((t=>{this._private__clickedDelegate._internal_hasListeners()&&this._private__clickedDelegate._internal_fire(this._private__convertMouseParams(t()))}),this),this._private__chartWidget._internal_dblClicked()._internal_subscribe((t=>{this._private__dblClickedDelegate._internal_hasListeners()&&this._private__dblClickedDelegate._internal_fire(this._private__convertMouseParams(t()))}),this),this._private__chartWidget._internal_crosshairMoved()._internal_subscribe((t=>{this._private__crosshairMovedDelegate._internal_hasListeners()&&this._private__crosshairMovedDelegate._internal_fire(this._private__convertMouseParams(t()))}),this);const n=this._private__chartWidget._internal_model();this._private__timeScaleApi=new h_(n,this._private__chartWidget._internal_timeAxisWidget(),this._private__horzScaleBehavior)}resize(t,e,i){this._private__chartWidget._internal_resize(t,e,i)}addCandlestickSeries(t={}){return function(t){void 0!==t.borderColor&&(t.borderUpColor=t.borderColor,t.borderDownColor=t.borderColor),void 0!==t.wickColor&&(t.wickUpColor=t.wickColor,t.wickDownColor=t.wickColor)}(t),this._private__addSeriesImpl("Candlestick",{upColor:"#26a69a",downColor:"#ef5350",wickVisible:!0,borderVisible:!0,borderColor:"#378658",borderUpColor:"#26a69a",borderDownColor:"#ef5350",wickColor:"#737375",wickUpColor:"#26a69a",wickDownColor:"#ef5350"})}addLineSeries(t){return this._private__addSeriesImpl("Line",{color:"#2196f3",lineStyle:0,lineWidth:3,lineType:0,lineVisible:!0,crosshairMarkerVisible:!0,crosshairMarkerRadius:4,crosshairMarkerBorderColor:"",crosshairMarkerBorderWidth:2,crosshairMarkerBackgroundColor:"",lastPriceAnimation:0},t)}_internal_applyNewData(t,e){this._private__sendUpdateToChart(this._private__dataLayer._internal_setSeriesData(t,e))}priceScale(t){return new n_(this._private__chartWidget,t)}timeScale(){return this._private__timeScaleApi}applyOptions(t){this._private__chartWidget._internal_applyOptions(p_(t))}options(){return this._private__chartWidget._internal_options()}_private__addSeriesImpl(t,e,i={}){!function(t){if(void 0===t||"custom"===t.type)return;const e=t;void 0!==e.minMove&&void 0===e.precision&&(e.precision=function(t){if(t>=1)return 0;let e=0;for(;e<8;e++){const i=Math.round(t);if(Math.abs(i-t)<1e-8)return e;t*=10}return e}(e.minMove))}(i.priceFormat);const _=p({title:"",visible:!0,lastValueVisible:!0,priceLineVisible:!0,priceLineSource:0,priceLineWidth:1,priceLineColor:"",priceLineStyle:2,baseLineVisible:!0,baseLineWidth:1,baseLineColor:"#B2B5BE",baseLineStyle:0,priceFormat:{type:"price",precision:2,minMove:.01}},e,i),r=this._private__chartWidget._internal_model()._internal_createSeries(t,_),n=new o_(r,this,this,this,this._private__horzScaleBehavior);return this._private__seriesMap.set(n,r),this._private__seriesMapReversed.set(r,n),n}_private__sendUpdateToChart(t){const e=this._private__chartWidget._internal_model();e._internal_updateTimeScale(t._internal_timeScale._internal_baseIndex,t._internal_timeScale._internal_points,t._internal_timeScale._internal_firstChangedPointIndex),t._internal_series.forEach(((t,e)=>e._internal_setData(t._internal_data,t._internal_info))),e._internal_recalculateAllPanes()}_private__mapSeriesToApi(t){return s(this._private__seriesMapReversed.get(t))}_private__convertMouseParams(t){const e=new Map;t._internal_seriesData.forEach(((t,i)=>{const _=i._internal_seriesType(),r=Zi(_)(t);if("Custom"!==_)l(Ei(r));else{const t=i._internal_customSeriesWhitespaceCheck();l(!t||!1===t(r))}e.set(this._private__mapSeriesToApi(i),r)}));const i=void 0===t._internal_hoveredSeries?void 0:this._private__mapSeriesToApi(t._internal_hoveredSeries);return{time:t._internal_originalTime,logical:t._internal_index,point:t._internal_point,hoveredSeries:i,hoveredObjectId:t._internal_hoveredObject,seriesData:e,sourceEvent:t._internal_touchMouseEventData}}}let v_=Object.freeze({__proto__:null,createChart:function(t,e){let i=new Le,_=Le._internal_applyDefaults(e);const r=new c_(t,i,_);return i.setOptions(r.options()),r},isBusinessDay:ke,isUTCTimestamp:Ee});const d_="#03866a",u_="#dc2020",m_="rgba(140,137,137,0.2)";function g_(t){return new Date(t).getTime()/1e3}const f_=document.getElementById("chart-container"),S_=v_.createChart(f_,{grid:{vertLines:{color:m_},horzLines:{color:m_}},height:600});S_.priceScale("right").applyOptions({borderVisible:!1,autoScale:!1,scaleMargins:{top:.1,bottom:.2}}),S_.timeScale("down").applyOptions({barSpacing:10,borderVisible:!1});const b_=S_.addCandlestickSeries({upColor:d_,downColor:u_,borderVisible:!1,wickUpColor:d_,wickDownColor:u_}),w_=function(t){const e=[];let i=1e3,_=new Date;_.setDate(_.getDate()-100);for(let t=0;t<100;t++){const t=i,r=t+Math.round(10*(Math.random()-.5)),n=Math.max(t,r)+Math.round(10*Math.random()),a=Math.min(t,r)-Math.round(10*Math.random()),l=r>=t?d_:u_;_.setDate(_.getDate()+1);const s=_.getFullYear(),o=String(_.getMonth()+1).padStart(2,"0"),h=String(_.getDate()).padStart(2,"0");e.push({time:`${s}-${o}-${h}`,open:t,high:n,low:a,close:r,color:l}),i=r}return e}();b_.setData(w_),S_.addLineSeries({priceLine:!1,firstValueVisible:!0,lineStyle:1,color:"rgba(79,75,75,0.2)",lineWidth:1}).setData([{time:w_[0].time,value:w_[0].open},{time:w_[w_.length-1].time,value:w_[0].open}]);let C_=w_.length>=60?w_[w_.length-60].time:w_[0].time,x_=w_[w_.length-1].time;function T_(){S_.timeScale().scrollToRealTime()}S_.timeScale().setVisibleRange({from:g_(C_),to:g_(x_)}),T_(),document.getElementById("scrollBtn").addEventListener("click",(()=>{T_()})),window.addEventListener("resize",(()=>{const{width:t,height:e}=f_.getBoundingClientRect();S_.resize(t,e)}))})();